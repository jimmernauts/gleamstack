var yv=Object.defineProperty;var Qh=e=>{throw TypeError(e)};var gv=(e,t,n)=>t in e?yv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>gv(e,typeof t!="symbol"?t+"":t,n),Yl=(e,t,n)=>t.has(e)||Qh("Cannot "+n);var H=(e,t,n)=>(Yl(e,t,"read from private field"),n?n.call(e):t.get(e)),wt=(e,t,n)=>t.has(e)?Qh("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ie=(e,t,n,r)=>(Yl(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),pr=(e,t,n)=>(Yl(e,t,"access private method"),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();class w{withFields(t){let n=Object.keys(this).map(r=>r in t?t[r]:this[r]);return new this.constructor(...n)}}class $t{static fromArray(t,n){let r=n||new ag;for(let i=t.length-1;i>=0;--i)r=new cg(t[i],r);return r}[Symbol.iterator](){return new wv(this)}toArray(){return[...this]}atLeastLength(t){for(let n of this){if(t<=0)return!0;t--}return t<=0}hasLength(t){for(let n of this){if(t<=0)return!1;t--}return t===0}countLength(){let t=0;for(let n of this)t++;return t}}function j(e,t){return new cg(e,t)}function h(e,t){return $t.fromArray(e,t)}var ii;class wv{constructor(t){wt(this,ii);ie(this,ii,t)}next(){if(H(this,ii)instanceof ag)return{done:!0};{let{head:t,tail:n}=H(this,ii);return ie(this,ii,n),{value:t,done:!1}}}}ii=new WeakMap;let ag=class extends $t{};class cg extends $t{constructor(t,n){super(),this.head=t,this.tail=n}}class Eo{constructor(t){if(!(t instanceof Uint8Array))throw"BitArray can only be constructed from a Uint8Array";this.buffer=t}get length(){return this.buffer.length}byteAt(t){return this.buffer[t]}floatAt(t){return vv(this.buffer.slice(t,t+8))}intFromSlice(t,n){return _v(this.buffer.slice(t,n))}binaryFromSlice(t,n){return new Eo(this.buffer.slice(t,n))}sliceAfter(t){return new Eo(this.buffer.slice(t))}}class bv{constructor(t){this.value=t}}function _v(e){e=e.reverse();let t=0;for(let n=e.length-1;n>=0;n--)t=t*256+e[n];return t}function vv(e){return new Float64Array(e.reverse().buffer)[0]}class gu extends w{static isResult(t){return t instanceof gu}}class F extends gu{constructor(t){super(),this[0]=t}isOk(){return!0}}let z=class extends gu{constructor(t){super(),this[0]=t}isOk(){return!1}};function _e(e,t){let n=[e,t];for(;n.length;){let r=n.pop(),i=n.pop();if(r===i)continue;if(!Hh(r)||!Hh(i)||!kv(r,i)||Sv(r,i)||Ov(r,i)||$v(r,i)||Tv(r,i)||Iv(r,i)||Av(r,i))return!1;const o=Object.getPrototypeOf(r);if(o!==null&&typeof o.equals=="function")try{if(r.equals(i))continue;return!1}catch{}let[u,a]=xv(r);for(let c of u(r))n.push(a(r,c),a(i,c))}return!0}function xv(e){if(e instanceof Map)return[t=>t.keys(),(t,n)=>t.get(n)];{let t=e instanceof globalThis.Error?["message"]:[];return[n=>[...t,...Object.keys(n)],(n,r)=>n[r]]}}function Sv(e,t){return e instanceof Date&&(e>t||e<t)}function Ov(e,t){return e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((n,r)=>n===t[r]))}function $v(e,t){return Array.isArray(e)&&e.length!==t.length}function Tv(e,t){return e instanceof Map&&e.size!==t.size}function Iv(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(n=>!t.has(n)))}function Av(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function Hh(e){return typeof e=="object"&&e!==null}function kv(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(r=>e instanceof r)?!1:e.constructor===t.constructor}function Et(e,t){return t===0?0:e%t}function fi(e,t){return Math.trunc(Pv(e,t))}function Pv(e,t){return t===0?0:e/t}function jt(e,t,n,r,i,s){let o=new globalThis.Error(i);o.gleam_error=e,o.module=t,o.line=n,o.fn=r;for(let u in s)o[u]=s[u];return o}let $=class extends w{constructor(t){super(),this[0]=t}},C=class extends w{};function Ev(e,t){if(e instanceof $){let n=e[0];return new F(n)}else return new z(t)}function op(e){if(e.isOk()){let t=e[0];return new $(t)}else return new C}function fe(e,t){return e instanceof $?e[0]:t}function Pe(e,t){if(e instanceof $){let n=e[0];return new $(t(n))}else return new C}class Rv extends w{constructor(t,n){super(),this.error=t,this.byte_index=n}}class Mv extends w{constructor(t,n){super(),this.case_insensitive=t,this.multi_line=n}}function Nv(e,t){return aS(e,t)}function Fv(e,t){return uS(e,t)}class Gn extends w{}class Di extends w{}class Ro extends w{}function jv(e){return oS(e)}function Cv(e){return-1*e}function Dv(e){return e>=0?tm(e):0-tm(Cv(e))}function Lv(e){return Dv(e)}function Bv(e){return e>=0?e:e*-1}function Vt(e){return Hx(e)}function k(e){return Gx(e)}function Uv(e){return e}function Ar(e,t){return e===t?new Di:e<t?new Gn:new Ro}function pc(e,t){return e<t?e:t}function hc(e,t){return e>t?e:t}function zv(e,t,n){let i=pc(e,n);return hc(i,t)}function Wv(e){let t=Pg()*Uv(e),n=jv(t);return Lv(n)}function Mo(e,t){{let n=t;return e*n<0&&Et(e,n)!==0?new F(fi(e,n)-1):new F(fi(e,n))}}function me(e){return e[0]}function oi(e){return e[1]}function Vv(e,t){let n=e[0],r=e[1];return[t(n),r]}let up=class extends w{constructor(t){super(),this[0]=t}},_o=class extends w{constructor(t){super(),this[0]=t}};class Ee extends w{}class xr extends w{}function qv(e,t){for(;;){let n=e,r=t;if(n.atLeastLength(1))e=n.tail,t=r+1;else return r}}function lg(e){return qv(e,0)}function tt(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return r;{let i=n.head;e=n.tail,t=j(i,r)}}}function nt(e){return tt(e,h([]))}function Gh(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return!1;if(n.atLeastLength(1)&&_e(n.head,r))return n.head,!0;e=n.tail,t=r}}function fg(e){if(e.hasLength(0))return new z(void 0);{let t=e.head;return new F(t)}}function Jv(e){return(t,n)=>{let r=_t(t,e(n));if(r.isOk()){let i=r[0];return Qt(t,e(n),j(n,i))}else return Qt(t,e(n),h([n]))}}function Kv(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return nt(s);{let o=r.head,u=r.tail,a=i(o)?j(o,s):s;e=u,t=i,n=a}}}function ns(e,t){return Kv(e,t,h([]))}function Qv(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return nt(s);{let o=r.head;e=r.tail,t=i,n=j(i(o),s)}}}function V(e,t){return Qv(e,t,h([]))}function Hv(e,t,n,r){for(;;){let i=e,s=t,o=n,u=r;if(i.hasLength(0))return nt(u);{let a=i.head,c=i.tail,l=j(s(a,o),u);e=c,t=s,n=o+1,r=l}}}function di(e,t){return Hv(e,t,0,h([]))}function Gv(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return new F(nt(s));{let o=r.head,u=r.tail,a=i(o);if(a.isOk()){let c=a[0];e=u,t=i,n=j(c,s)}else{let c=a[0];return new z(c)}}}}function dg(e,t){return Gv(e,t,h([]))}function Xv(e,t){for(;;){let n=e,r=t;if(r<=0)return n;if(n.hasLength(0))return h([]);e=n.tail,t=r-1}}function Yv(e,t,n){for(;;){let r=e,i=t,s=n;if(i<=0)return nt(s);if(r.hasLength(0))return nt(s);{let u=r.head;e=r.tail,t=i-1,n=j(u,s)}}}function Zv(e,t){return Yv(e,t,h([]))}function ex(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return r;{let i=n.head;e=n.tail,t=j(i,r)}}}function ap(e,t){return ex(nt(e),t)}function tx(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return r;{let i=n.head;e=n.tail,t=j(i,r)}}}function pg(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return nt(r);{let i=n.head;e=n.tail,t=tx(i,r)}}}function nx(e){return pg(e,h([]))}function Lf(e){return pg(e,h([]))}function As(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return i;{let o=r.head;e=r.tail,t=s(i,o),n=s}}}function rx(e,t){return As(e,Es(),Jv(t))}function cp(e,t,n){if(e.hasLength(0))return t;{let r=e.head,i=e.tail;return n(cp(i,t,n),r)}}function ix(e,t,n,r){for(;;){let i=e,s=t,o=n,u=r;if(i.hasLength(0))return s;{let a=i.head;e=i.tail,t=o(s,a,u),n=o,r=u+1}}}function sx(e,t,n){return ix(e,t,n,0)}function hg(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return i;{let o=r.head,u=r.tail,a=s(i,o);if(a instanceof up){let c=a[0];e=u,t=c,n=s}else return a[0]}}}function mg(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return new z(void 0);{let i=n.head,s=n.tail;if(r(i))return new F(i);e=s,t=r}}}function ox(e,t,n,r,i,s){for(;;){let o=e,u=t,a=n,c=r,l=i,f=s,p=j(l,a);if(o.hasLength(0))return c instanceof Ee?j(tt(p,h([])),f):j(p,f);{let d=o.head,m=o.tail,y=u(l,d);if(y instanceof Ro&&c instanceof xr)e=m,t=u,n=p,r=c,i=d,s=f;else if(y instanceof Gn&&c instanceof Ee)e=m,t=u,n=p,r=c,i=d,s=f;else if(y instanceof Di&&c instanceof Ee)e=m,t=u,n=p,r=c,i=d,s=f;else if(y instanceof Ro&&c instanceof Ee){let b=c instanceof Ee?j(tt(p,h([])),f):j(p,f);if(m.hasLength(0))return j(h([d]),b);{let g=m.head,v=m.tail,x=(()=>{let S=u(d,g);return S instanceof Gn?new Ee:S instanceof Di?new Ee:new xr})();e=v,t=u,n=h([d]),r=x,i=g,s=b}}else if(y instanceof Gn&&c instanceof xr){let b=c instanceof Ee?j(tt(p,h([])),f):j(p,f);if(m.hasLength(0))return j(h([d]),b);{let g=m.head,v=m.tail,x=(()=>{let S=u(d,g);return S instanceof Gn?new Ee:S instanceof Di?new Ee:new xr})();e=v,t=u,n=h([d]),r=x,i=g,s=b}}else{let b=c instanceof Ee?j(tt(p,h([])),f):j(p,f);if(m.hasLength(0))return j(h([d]),b);{let g=m.head,v=m.tail,x=(()=>{let S=u(d,g);return S instanceof Gn?new Ee:S instanceof Di?new Ee:new xr})();e=v,t=u,n=h([d]),r=x,i=g,s=b}}}}}function ux(e,t,n,r){for(;;){let i=e,s=t,o=n,u=r;if(i.hasLength(0))return tt(s,u);if(s.hasLength(0))return tt(i,u);{let a=i.head,c=i.tail,l=s.head,f=s.tail,p=o(a,l);p instanceof Gn?(e=c,t=s,n=o,r=j(a,u)):(p instanceof Ro,e=i,t=f,n=o,r=j(l,u))}}}function ax(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return tt(s,h([]));if(r.hasLength(1)){let o=r.head;return tt(j(tt(o,h([])),s),h([]))}else{let o=r.head,u=r.tail.head,a=r.tail.tail,c=ux(o,u,i,h([]));e=a,t=i,n=j(c,s)}}}function cx(e,t,n,r){for(;;){let i=e,s=t,o=n,u=r;if(i.hasLength(0))return tt(s,u);if(s.hasLength(0))return tt(i,u);{let a=i.head,c=i.tail,l=s.head,f=s.tail,p=o(a,l);p instanceof Gn?(e=i,t=f,n=o,r=j(l,u)):(p instanceof Ro,e=c,t=s,n=o,r=j(a,u))}}}function lx(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return tt(s,h([]));if(r.hasLength(1)){let o=r.head;return tt(j(tt(o,h([])),s),h([]))}else{let o=r.head,u=r.tail.head,a=r.tail.tail,c=cx(o,u,i,h([]));e=a,t=i,n=j(c,s)}}}function fx(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return h([]);if(r.hasLength(1)&&i instanceof Ee)return r.head;if(r.hasLength(1)&&i instanceof xr){let o=r.head;return tt(o,h([]))}else i instanceof Ee?(e=ax(r,s,h([])),t=new xr,n=s):(e=lx(r,s,h([])),t=new Ee,n=s)}}function Kt(e,t){if(e.hasLength(0))return h([]);if(e.hasLength(1)){let n=e.head;return h([n])}else{let n=e.head,r=e.tail.head,i=e.tail.tail,s=(()=>{let u=t(n,r);return u instanceof Gn?new Ee:u instanceof Di?new Ee:new xr})(),o=ox(i,t,h([n]),s,r,h([]));return fx(o,new Ee,t)}}function dx(e){return!!e.isOk()}function J(e,t){if(e.isOk()){let n=e[0];return new F(t(n))}else{let n=e[0];return new z(n)}}function mc(e,t){if(e.isOk()){let n=e[0];return new F(n)}else{let n=e[0];return new z(t(n))}}function px(e){if(e.isOk())return e[0];{let t=e[0];return new z(t)}}function Yn(e,t){if(e.isOk()){let n=e[0];return t(n)}else{let n=e[0];return new z(n)}}function yg(e,t){return Yn(e,t)}function se(e,t){return e.isOk()?e[0]:t}class vo extends w{}class rs extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}let yc=class extends w{constructor(t){super(),this.continuation=t}};class gg extends w{constructor(t,n){super(),this.element=t,this.accumulator=n}}function hx(){return new vo}function wg(e,t){return()=>{let n=t(e);if(n instanceof gg){let r=n.element,i=n.accumulator;return new rs(r,wg(i,t))}else return new vo}}function mx(e,t){let r=wg(e,t);return new yc(r)}function yx(e){return mx(void 0,t=>new gg(e(),void 0))}function gx(e){return yx(()=>e)}function wx(e,t,n){for(;;){let r=e,i=t,s=n,o=r();if(o instanceof rs){let u=o[0];e=o[1],t=i,n=i(s,u)}else return s}}function bx(e,t,n){let r=e.continuation;return wx(r,n,t)}function _x(e){let n=bx(e,h([]),(r,i)=>j(i,r));return nt(n)}function bg(e,t){return()=>{if(t>0){let r=e();if(r instanceof vo)return new vo;{let i=r[0],s=r[1];return new rs(i,bg(s,t-1))}}else return new vo}}function vx(e,t){let n=e.continuation,r=bg(n,t);return new yc(r)}function _g(e,t){let n=e();if(n instanceof rs){let r=n[0],i=n[1];return new rs(r,()=>_g(i,t))}else return t()}function vg(e,t){let n=()=>_g(e.continuation,t.continuation);return new yc(n)}function xx(e){let t=()=>new rs(e(),hx);return new yc(t)}function xg(e){return xx(()=>e)}function Sx(e,t){return eS(e,t)}function Sg(e){return rS(e)}function gc(e){return e}function Ox(e,t){return Sx(e,gc(t))}function ks(e){return e}function $x(e,t){return tS(e,t)}function Xh(e){return e===""}function cn(e){return Yx(e)}function Ia(e,t,n){let i=gc(e),s=Xx(i,t,n);return ks(s)}function Aa(e){return Zx(e)}function Tx(e,t){let r=gc(e),i=Ox(r,t);return ks(i)}function Ps(e){let n=Sg(e);return ks(n)}function Ix(e,t){return nS(e,t)}function Yh(e,t,n){let i=vc(e),s=Xv(i,t),o=Zv(s,n);return Ps(o)}function lp(e,t,n){if(n<0)return"";if(t<0){let s=cn(e)+t;return s<0?"":Yh(e,s,n)}else return Yh(e,t,n)}function Ax(e,t){{let r=gc(e),i=$x(r,t);return V(i,ks)}}function kx(e,t){let n=cn(t),r=fi(e,n),i=Et(e,n),s=gx(t),o=vx(s,r);return vg(o,xg(lp(t,0,i)))}function mr(e,t,n){let r=cn(e),i=t-r,s=kx(i,n),o=vg(s,xg(e)),u=_x(o);return Ps(u)}function Og(e){let t=ur(e);return ks(t)}class er extends w{constructor(t,n,r){super(),this.expected=t,this.found=n,this.path=r}}function wc(e){return e}function wu(e){return Rg(e)}function fp(e){return mS(e)}function $g(e){return yS(e)}function Px(e){return gS(e)}function Ex(e){return t=>Mg(t,e)}function dp(e){return t=>{if(e.hasLength(0))return new z(h([new er("another type",wu(t),h([]))]));{let n=e.head,r=e.tail,i=n(t);if(i.isOk()){let s=i[0];return new F(s)}else return dp(r)(t)}}}function Zl(e){return e.isOk()?h([]):e[0]}function No(e,t){let n=wc(t),r=dp(h([Le,s=>J(fp(s),k)])),i=(()=>{let s=r(n);if(s.isOk())return s[0];{let o=h(["<",wu(n),">"]),u=Sg(o);return ks(u)}})();return e.withFields({path:j(i,e.path)})}function pp(e){return t=>Yn(Px(t),n=>{let i=dg(n,e);return Fo(i,s=>No(s,"*"))})}function Fo(e,t){return mc(e,n=>V(n,t))}function Le(e){return hS(e)}function Ye(e,t){return n=>{let r=new er("field","nothing",h([]));return Yn(Ng(n,e),i=>{let o=Ev(i,h([r])),u=Yn(o,t);return Fo(u,a=>No(a,e))})}}function Rx(e,t){return n=>Yn(Ng(n,e),r=>{if(r instanceof C)return new F(new C);{let s=r[0],o=Mg(s,t);return Fo(o,u=>No(u,e))}})}function bc(e,t){return n=>Yn(wS(n),r=>Yn((()=>{let s=rt(r);return dg(s,o=>{let u=o[0],a=o[1];return Yn((()=>{let c=e(u);return Fo(c,l=>No(l,"keys"))})(),c=>Yn((()=>{let l=t(a);return Fo(l,f=>No(f,"values"))})(),l=>new F([c,l])))})})(),i=>new F(Ot(i))))}function Mx(e,t,n,r){return i=>{let s=t(i),o=n(i),u=r(i);if(s.isOk()&&o.isOk()&&u.isOk()){let a=s[0],c=o[0],l=u[0];return new F(e(a,c,l))}else{let a=s,c=o,l=u;return new z(nx(h([Zl(a),Zl(c),Zl(l)])))}}}const Zh=new WeakMap,ef=new DataView(new ArrayBuffer(8));let tf=0;function Bf(e){const t=Zh.get(e);if(t!==void 0)return t;const n=tf++;return tf===2147483647&&(tf=0),Zh.set(e,n),n}function Uf(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function hp(e){let t=0;const n=e.length;for(let r=0;r<n;r++)t=Math.imul(31,t)+e.charCodeAt(r)|0;return t}function Tg(e){ef.setFloat64(0,e);const t=ef.getInt32(0),n=ef.getInt32(4);return Math.imul(73244475,t>>16^t)^n}function Nx(e){return hp(e.toString())}function Fx(e){const t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{const r=e.hashCode(e);if(typeof r=="number")return r}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return Bf(e);if(e instanceof Date)return Tg(e.getTime());let n=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let r=0;r<e.length;r++)n=Math.imul(31,n)+zt(e[r])|0;else if(e instanceof Set)e.forEach(r=>{n=n+zt(r)|0});else if(e instanceof Map)e.forEach((r,i)=>{n=n+Uf(zt(r),zt(i))|0});else{const r=Object.keys(e);for(let i=0;i<r.length;i++){const s=r[i],o=e[s];n=n+Uf(zt(o),hp(s))|0}}return n}function zt(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return Tg(e);case"string":return hp(e);case"bigint":return Nx(e);case"object":return Fx(e);case"symbol":return Bf(e);case"function":return Bf(e);default:return 0}}const An=5,mp=Math.pow(2,An),jx=mp-1,Cx=mp/2,Dx=mp/4,ht=0,Tn=1,Rt=2,pi=3,yp={type:Rt,bitmap:0,array:[]};function bu(e,t){return e>>>t&jx}function _c(e,t){return 1<<bu(e,t)}function Lx(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function gp(e,t){return Lx(e&t-1)}function Jt(e,t,n){const r=e.length,i=new Array(r);for(let s=0;s<r;++s)i[s]=e[s];return i[t]=n,i}function Bx(e,t,n){const r=e.length,i=new Array(r+1);let s=0,o=0;for(;s<t;)i[o++]=e[s++];for(i[o++]=n;s<r;)i[o++]=e[s++];return i}function zf(e,t){const n=e.length,r=new Array(n-1);let i=0,s=0;for(;i<t;)r[s++]=e[i++];for(++i;i<n;)r[s++]=e[i++];return r}function Ig(e,t,n,r,i,s){const o=zt(t);if(o===r)return{type:pi,hash:o,array:[{type:ht,k:t,v:n},{type:ht,k:i,v:s}]};const u={val:!1};return _u(wp(yp,e,o,t,n,u),e,r,i,s,u)}function _u(e,t,n,r,i,s){switch(e.type){case Tn:return Ux(e,t,n,r,i,s);case Rt:return wp(e,t,n,r,i,s);case pi:return zx(e,t,n,r,i,s)}}function Ux(e,t,n,r,i,s){const o=bu(n,t),u=e.array[o];if(u===void 0)return s.val=!0,{type:Tn,size:e.size+1,array:Jt(e.array,o,{type:ht,k:r,v:i})};if(u.type===ht)return _e(r,u.k)?i===u.v?e:{type:Tn,size:e.size,array:Jt(e.array,o,{type:ht,k:r,v:i})}:(s.val=!0,{type:Tn,size:e.size,array:Jt(e.array,o,Ig(t+An,u.k,u.v,n,r,i))});const a=_u(u,t+An,n,r,i,s);return a===u?e:{type:Tn,size:e.size,array:Jt(e.array,o,a)}}function wp(e,t,n,r,i,s){const o=_c(n,t),u=gp(e.bitmap,o);if(e.bitmap&o){const a=e.array[u];if(a.type!==ht){const l=_u(a,t+An,n,r,i,s);return l===a?e:{type:Rt,bitmap:e.bitmap,array:Jt(e.array,u,l)}}const c=a.k;return _e(r,c)?i===a.v?e:{type:Rt,bitmap:e.bitmap,array:Jt(e.array,u,{type:ht,k:r,v:i})}:(s.val=!0,{type:Rt,bitmap:e.bitmap,array:Jt(e.array,u,Ig(t+An,c,a.v,n,r,i))})}else{const a=e.array.length;if(a>=Cx){const c=new Array(32),l=bu(n,t);c[l]=wp(yp,t+An,n,r,i,s);let f=0,p=e.bitmap;for(let d=0;d<32;d++){if(p&1){const m=e.array[f++];c[d]=m}p=p>>>1}return{type:Tn,size:a+1,array:c}}else{const c=Bx(e.array,u,{type:ht,k:r,v:i});return s.val=!0,{type:Rt,bitmap:e.bitmap|o,array:c}}}}function zx(e,t,n,r,i,s){if(n===e.hash){const o=bp(e,r);if(o!==-1)return e.array[o].v===i?e:{type:pi,hash:n,array:Jt(e.array,o,{type:ht,k:r,v:i})};const u=e.array.length;return s.val=!0,{type:pi,hash:n,array:Jt(e.array,u,{type:ht,k:r,v:i})}}return _u({type:Rt,bitmap:_c(e.hash,t),array:[e]},t,n,r,i,s)}function bp(e,t){const n=e.array.length;for(let r=0;r<n;r++)if(_e(t,e.array[r].k))return r;return-1}function ka(e,t,n,r){switch(e.type){case Tn:return Wx(e,t,n,r);case Rt:return Vx(e,t,n,r);case pi:return qx(e,r)}}function Wx(e,t,n,r){const i=bu(n,t),s=e.array[i];if(s!==void 0){if(s.type!==ht)return ka(s,t+An,n,r);if(_e(r,s.k))return s}}function Vx(e,t,n,r){const i=_c(n,t);if(!(e.bitmap&i))return;const s=gp(e.bitmap,i),o=e.array[s];if(o.type!==ht)return ka(o,t+An,n,r);if(_e(r,o.k))return o}function qx(e,t){const n=bp(e,t);if(!(n<0))return e.array[n]}function _p(e,t,n,r){switch(e.type){case Tn:return Jx(e,t,n,r);case Rt:return Kx(e,t,n,r);case pi:return Qx(e,r)}}function Jx(e,t,n,r){const i=bu(n,t),s=e.array[i];if(s===void 0)return e;let o;if(s.type===ht){if(!_e(s.k,r))return e}else if(o=_p(s,t+An,n,r),o===s)return e;if(o===void 0){if(e.size<=Dx){const u=e.array,a=new Array(e.size-1);let c=0,l=0,f=0;for(;c<i;){const p=u[c];p!==void 0&&(a[l]=p,f|=1<<c,++l),++c}for(++c;c<u.length;){const p=u[c];p!==void 0&&(a[l]=p,f|=1<<c,++l),++c}return{type:Rt,bitmap:f,array:a}}return{type:Tn,size:e.size-1,array:Jt(e.array,i,o)}}return{type:Tn,size:e.size,array:Jt(e.array,i,o)}}function Kx(e,t,n,r){const i=_c(n,t);if(!(e.bitmap&i))return e;const s=gp(e.bitmap,i),o=e.array[s];if(o.type!==ht){const u=_p(o,t+An,n,r);return u===o?e:u!==void 0?{type:Rt,bitmap:e.bitmap,array:Jt(e.array,s,u)}:e.bitmap===i?void 0:{type:Rt,bitmap:e.bitmap^i,array:zf(e.array,s)}}return _e(r,o.k)?e.bitmap===i?void 0:{type:Rt,bitmap:e.bitmap^i,array:zf(e.array,s)}:e}function Qx(e,t){const n=bp(e,t);if(n<0)return e;if(e.array.length!==1)return{type:pi,hash:e.hash,array:zf(e.array,n)}}function Ag(e,t){if(e===void 0)return;const n=e.array,r=n.length;for(let i=0;i<r;i++){const s=n[i];if(s!==void 0){if(s.type===ht){t(s.v,s.k);continue}Ag(s,t)}}}let ui=class yr{static fromObject(t){const n=Object.keys(t);let r=yr.new();for(let i=0;i<n.length;i++){const s=n[i];r=r.set(s,t[s])}return r}static fromMap(t){let n=yr.new();return t.forEach((r,i)=>{n=n.set(i,r)}),n}static new(){return new yr(void 0,0)}constructor(t,n){this.root=t,this.size=n}get(t,n){if(this.root===void 0)return n;const r=ka(this.root,0,zt(t),t);return r===void 0?n:r.v}set(t,n){const r={val:!1},i=this.root===void 0?yp:this.root,s=_u(i,0,zt(t),t,n,r);return s===this.root?this:new yr(s,r.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;const n=_p(this.root,0,zt(t),t);return n===this.root?this:n===void 0?yr.new():new yr(n,this.size-1)}has(t){return this.root===void 0?!1:ka(this.root,0,zt(t),t)!==void 0}entries(){if(this.root===void 0)return[];const t=[];return this.forEach((n,r)=>t.push([r,n])),t}forEach(t){Ag(this.root,t)}hashCode(){let t=0;return this.forEach((n,r)=>{t=t+Uf(zt(n),zt(r))|0}),t}equals(t){if(!(t instanceof yr)||this.size!==t.size)return!1;let n=!0;return this.forEach((r,i)=>{n=n&&_e(t.get(i,!r),r)}),n}};const vp=void 0,em={};function Hx(e){return/^[-+]?(\d+)$/.test(e)?new F(parseInt(e)):new z(vp)}function Gx(e){return e.toString()}function Xx(e,t,n){return typeof e.replaceAll<"u"?e.replaceAll(t,n):e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n)}function Yx(e){if(e==="")return 0;const t=kg(e);if(t){let n=0;for(const r of t)n++;return n}else return e.match(/./gsu).length}function vc(e){const t=kg(e);return t?$t.fromArray(Array.from(t).map(n=>n.segment)):$t.fromArray(e.match(/./gsu))}function kg(e){if(Intl&&Intl.Segmenter)return new Intl.Segmenter().segment(e)[Symbol.iterator]()}function Zx(e){return e.toLowerCase()}function eS(e,t){return e+t}function tS(e,t){return $t.fromArray(e.split(t))}function nS(e,t){const n=e[Symbol.iterator]();let r=n.next().value||"",i=n.next();for(;!i.done;)r=r+t+i.value,i=n.next();return r}function rS(e){let t="";for(const n of e)t=t+n;return t}function iS(e,t){return e.indexOf(t)>=0}function sS(e){var t;typeof process=="object"&&((t=process.stderr)!=null&&t.write)?process.stderr.write(e+`
`):typeof Deno=="object"?Deno.stderr.writeSync(new TextEncoder().encode(e+`
`)):console.log(e)}function oS(e){return Math.floor(e)}function tm(e){return Math.round(e)}function Pg(){const e=Math.random();return e===1?Pg():e}function uS(e,t){return e.lastIndex=0,e.test(t)}function aS(e,t){try{let n="gu";return t.case_insensitive&&(n+="i"),t.multi_line&&(n+="m"),new F(new RegExp(e,n))}catch(n){const r=(n.columnNumber||0)|0;return new z(new Rv(n.message,r))}}function cS(){return ui.new()}function nf(e){return e.size}function rt(e){return $t.fromArray(e.entries())}function lS(e,t){return t.delete(e)}function Eg(e,t){const n=e.get(t,em);return n===em?new z(vp):new F(n)}function fS(e,t,n){return n.set(e,t)}function nm(e){return decodeURIComponent((e||"").replace("+"," "))}function dS(e){try{const t=[];for(const n of e.split("&")){const[r,i]=n.split("=");r&&t.push([nm(r),nm(i)])}return new F($t.fromArray(t))}catch{return new z(vp)}}function Rg(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof gu)return"Result";if(e instanceof $t)return"List";if(e instanceof Eo)return"BitArray";if(e instanceof ui)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return`Tuple of ${e.length} elements`;if(typeof e=="number")return"Float";if(e===null)return"Null";if(e===void 0)return"Nil";{const t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function kr(e,t){return pS(e,Rg(t))}function pS(e,t){return new z($t.fromArray([new er(e,t,$t.fromArray([]))]))}function hS(e){return typeof e=="string"?new F(e):kr("String",e)}function mS(e){return Number.isInteger(e)?new F(e):kr("Int",e)}function yS(e){return typeof e=="boolean"?new F(e):kr("Bool",e)}function gS(e){return Array.isArray(e)?new F($t.fromArray(e)):e instanceof $t?new F(e):kr("List",e)}function wS(e){if(e instanceof ui)return new F(e);if(e instanceof Map||e instanceof WeakMap)return new F(ui.fromMap(e));if(e==null||typeof e!="object")return kr("Dict",e);const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null?new F(ui.fromObject(e)):kr("Dict",e)}function Mg(e,t){if(e==null||e instanceof C)return new F(new C);e instanceof $&&(e=e[0]);const n=t(e);return n.isOk()?new F(new $(n[0])):n}function Ng(e,t){const n=()=>kr("Dict",e);if(e instanceof ui||e instanceof WeakMap||e instanceof Map){const r=Eg(e,t);return new F(r.isOk()?new $(r[0]):new C)}else return e===null?n():Object.getPrototypeOf(e)==Object.prototype?rm(e,t,()=>new F(new C)):rm(e,t,n)}function rm(e,t,n){try{return t in e?new F(new $(e[t])):n()}catch{return n()}}function ur(e){const t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return bS(e);if(t==="bigint"||t==="number")return e.toString();if(Array.isArray(e))return`#(${e.map(ur).join(", ")})`;if(e instanceof $t)return SS(e);if(e instanceof bv)return $S(e);if(e instanceof Eo)return OS(e);if(e instanceof w)return xS(e);if(e instanceof ui)return _S(e);if(e instanceof Set)return`//js(Set(${[...e].map(ur).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){const n=[];for(const r of Array(e.length).keys())n.push(String.fromCharCode(r+97));return`//fn(${n.join(", ")}) { ... }`}return vS(e)}function bS(e){let t='"';for(let n=0;n<e.length;n++){let r=e[n];switch(r){case`
`:t+="\\n";break;case"\r":t+="\\r";break;case"	":t+="\\t";break;case"\f":t+="\\f";break;case"\\":t+="\\\\";break;case'"':t+='\\"';break;default:r<" "||r>"~"&&r<"Â "?t+="\\u{"+r.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=r}}return t+='"',t}function _S(e){let t="dict.from_list([",n=!0;return e.forEach((r,i)=>{n||(t=t+", "),t=t+"#("+ur(i)+", "+ur(r)+")",n=!1}),t+"])"}function vS(e){var s,o;const t=((o=(s=Object.getPrototypeOf(e))==null?void 0:s.constructor)==null?void 0:o.name)||"Object",n=[];for(const u of Object.keys(e))n.push(`${ur(u)}: ${ur(e[u])}`);const r=n.length?" "+n.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${r}})`}function xS(e){const t=Object.keys(e).map(n=>{const r=ur(e[n]);return isNaN(parseInt(n))?`${n}: ${r}`:r}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function SS(e){return`[${e.toArray().map(ur).join(", ")}]`}function OS(e){return`<<${Array.from(e.buffer).join(", ")}>>`}function $S(e){return`//utfcodepoint(${String.fromCodePoint(e.value)})`}function Es(){return cS()}function _t(e,t){return Eg(e,t)}function Qt(e,t,n){return fS(t,n,e)}function TS(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return r;{let i=n.head;e=n.tail,t=Qt(r,i[0],i[1])}}}function Ot(e){return TS(e,Es())}function Fg(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return r;{let i=n.head;e=n.tail,t=j(i,r)}}}function IS(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return Fg(r,h([]));{let i=n.head;e=n.tail,t=j(i[0],r)}}}function AS(e){let t=rt(e);return IS(t,h([]))}function kS(e){return AS(e)}function PS(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return Fg(r,h([]));{let i=n.head;e=n.tail,t=j(i[1],r)}}}function ES(e){let t=rt(e);return PS(t,h([]))}function ln(e){return ES(e)}function RS(e,t){return Qt(e,t[0],t[1])}function MS(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return r;{let i=n.head;e=n.tail,t=RS(r,i)}}}function NS(e,t){let r=rt(t);return MS(r,e)}function FS(e,t){return NS(e,t)}function jS(e,t){return lS(t,e)}function rf(e,t){for(;;){let n=e,r=t;if(r.hasLength(0))return n;{let i=r.head,s=r.tail;e=jS(n,i),t=s}}}function CS(e,t,n){let i=_t(e,t),s=op(i),o=n(s);return(u=>Qt(e,t,u))(o)}function DS(e,t,n){for(;;){let r=e,i=t,s=n;if(r.hasLength(0))return i;{let o=r.head[0],u=r.head[1];e=r.tail,t=s(i,o,u),n=s}}}function LS(e,t,n){let i=rt(e);return DS(i,t,n)}function BS(e,t){let n=(i,s,o)=>Qt(i,s,e(s,o));return LS(t,Es(),n)}function US(e,t){return BS(t,e)}function vu(e){let n=Og(e);return sS(n),e}class zS extends w{constructor(t,n,r,i,s,o,u){super(),this.scheme=t,this.userinfo=n,this.host=r,this.port=i,this.path=s,this.query=o,this.fragment=u}}function im(e){return dS(e)}function WS(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return nt(r);{let i=n.head,s=n.tail,o=i===""||i==="."?r:i===".."&&r.hasLength(0)?h([]):i===".."&&r.atLeastLength(1)?r.tail:j(i,r);e=s,t=o}}}function VS(e){return WS(e,h([]))}function qS(e){return VS(Ax(e,"/"))}function xp(e){return e?1:0}function jg(e){return e?"True":"False"}function is(e,t,n){return e?t:n()}function JS(e){return JSON.stringify(e)}function KS(e){return Object.fromEntries(e)}function QS(e){return e.toArray()}function HS(){return null}function GS(e){try{const t=JSON.parse(e);return new F(t)}catch(t){return new z(XS(t,e))}}function XS(e,t){return YS(e)?new Cg:ZS(e,t)}function YS(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function ZS(e,t){let n=[eO,tO,rO,nO];for(let r of n){let i=r(e,t);if(i)return i}return new Rs("",0)}function eO(e){const n=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!n)return null;const r=xc(n[1]);return new Rs(r,-1)}function tO(e){const n=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!n)return null;const r=xc(n[1]),i=Number(n[2]);return new Rs(r,i)}function nO(e,t){const r=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!r)return null;const i=Number(r[2]),s=Number(r[3]),o=iO(i,s,t),u=xc(t[o]);return new Rs(u,o)}function rO(e){const n=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!n)return null;const r=xc(n[2]);return new Rs(r,0)}function xc(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function iO(e,t,n){if(e===1)return t-1;let r=1,i=0;return n.split("").find((s,o)=>(s===`
`&&(r+=1),r===e?(i=o+t,!0):!1)),i}class Cg extends w{}class Rs extends w{constructor(t,n){super(),this.byte=t,this.position=n}}class sO extends w{constructor(t,n){super(),this.byte=t,this.position=n}}class oO extends w{constructor(t){super(),this[0]=t}}function uO(e,t){return yg(GS(e),n=>{let r=t(n);return mc(r,i=>new oO(i))})}function Dg(e,t){return uO(e,t)}function ya(e){return JS(e)}function sn(e){return e}function aO(){return HS()}function sf(e,t){if(e instanceof $){let n=e[0];return t(n)}else return aO()}function bi(e){return KS(e)}function cO(e){return QS(e)}function lO(e,t){let r=V(e,t);return cO(r)}class xu extends w{constructor(t){super(),this.all=t}}function Ht(e){return new xu(h([(t,n)=>e(t)]))}function fO(e,t){return new xu(h([(n,r)=>r(e,t)]))}function P(){return new xu(h([]))}function Lg(e){return new xu(As(e,h([]),(t,n)=>{let r=n.all;return ap(t,r)}))}function Wn(e,t){return new xu(V(e.all,n=>(r,i)=>n(s=>r(t(s)),i)))}let Pa=class extends w{constructor(t){super(),this.content=t}};class Se extends w{constructor(t,n,r,i,s,o,u){super(),this.key=t,this.namespace=n,this.tag=r,this.attrs=i,this.children=s,this.self_closing=o,this.void=u}}let Li=class extends w{constructor(t){super(),this.subtree=t}};class jo extends w{constructor(t,n){super(),this.elements=t,this.key=n}}class Ea extends w{constructor(t,n,r){super(),this[0]=t,this[1]=n,this.as_property=r}}let Bg=class extends w{constructor(t,n){super(),this[0]=t,this[1]=n}};function Z(e,t){return new Ea(e,wc(t),!1)}function Su(e,t){return new Ea(e,wc(t),!0)}function dO(e,t){return new Bg("on"+e,t)}function pO(e,t){if(e instanceof Ea){let n=e[0],r=e[1],i=e.as_property;return new Ea(n,r,i)}else{let n=e[0],r=e[1];return new Bg(n,i=>J(r(i),t))}}function vt(e){return Z("style",As(e,"",(t,n)=>{let r=n[0],i=n[1];return t+r+":"+i+";"}))}function _(e){return Z("class",e)}function ye(e){return Z("id",e)}function $e(e){return Z("type",e)}function De(e){return Z("value",e)}function Ug(e){return Su("checked",e)}function of(e){return Z("placeholder",e)}function ra(e){return Su("selected",e)}function sm(e){return Su("disabled",e)}function ct(e){return Z("name",e)}function Sr(e){return Z("for",e)}function Be(e){return Z("href",e)}function de(e,t,n){return e==="area"?new Se("","",e,t,h([]),!1,!0):e==="base"?new Se("","",e,t,h([]),!1,!0):e==="br"?new Se("","",e,t,h([]),!1,!0):e==="col"?new Se("","",e,t,h([]),!1,!0):e==="embed"?new Se("","",e,t,h([]),!1,!0):e==="hr"?new Se("","",e,t,h([]),!1,!0):e==="img"?new Se("","",e,t,h([]),!1,!0):e==="input"?new Se("","",e,t,h([]),!1,!0):e==="link"?new Se("","",e,t,h([]),!1,!0):e==="meta"?new Se("","",e,t,h([]),!1,!0):e==="param"?new Se("","",e,t,h([]),!1,!0):e==="source"?new Se("","",e,t,h([]),!1,!0):e==="track"?new Se("","",e,t,h([]),!1,!0):e==="wbr"?new Se("","",e,t,h([]),!1,!0):new Se("","",e,t,n,!1,!1)}function ga(e,t){if(e instanceof Se){let n=e.namespace,r=e.tag,i=e.attrs,s=e.children,o=e.self_closing,u=e.void;return new Se(t,n,r,i,s,o,u)}else if(e instanceof Li){let n=e.subtree;return new Li(()=>ga(n(),t))}else if(e instanceof jo){let r=e.elements,i=di(r,(s,o)=>{if(s instanceof Se){let u=s.key,a=u===""?t+"-"+k(o):t+"-"+u;return ga(s,a)}else return ga(s,t)});return new jo(i,t)}else return e}function Qi(e,t){return e(V(t,n=>{let r=n[0],i=n[1];return ga(i,r)}))}function E(e){return new Pa(e)}function tr(){return new Pa("")}function hO(e){return cp(e,h([]),(t,n)=>{if(n instanceof jo){let r=n.elements;return ap(r,t)}else return j(n,t)})}function mt(e){let t=hO(e);return new jo(t,"")}function Vn(e,t){if(e instanceof Pa){let n=e.content;return new Pa(n)}else if(e instanceof Li){let n=e.subtree;return new Li(()=>Vn(n(),t))}else if(e instanceof Se){let n=e.key,r=e.namespace,i=e.tag,s=e.attrs,o=e.children,u=e.self_closing,a=e.void;return new Li(()=>new Se(n,r,i,V(s,c=>pO(c,t)),V(o,c=>Vn(c,t)),u,a))}else{let n=e.elements,r=e.key;return new Li(()=>new jo(V(n,i=>Vn(i,t)),r))}}let mO=class extends w{constructor(t){super(),this.dict=t}};function yO(e,t){let n=e.dict,r=_t(n,t);return dx(r)}const gO=void 0;function wO(e){let t=As(e,Es(),(n,r)=>Qt(n,r,gO));return new mO(t)}class bO extends w{constructor(t){super(),this[0]=t}}class Bi extends w{constructor(t){super(),this[0]=t}}class zg extends w{}class _O extends w{constructor(t){super(),this[0]=t}}function om(e,t,n,r=!1){let i,s=[{prev:e,next:t,parent:e.parentNode}];for(;s.length;){let{prev:o,next:u,parent:a}=s.pop();if(u.subtree!==void 0&&(u=u.subtree()),u.content!==void 0)if(o)if(o.nodeType===Node.TEXT_NODE)o.textContent!==u.content&&(o.textContent=u.content),i??(i=o);else{const c=document.createTextNode(u.content);a.replaceChild(c,o),i??(i=c)}else{const c=document.createTextNode(u.content);a.appendChild(c),i??(i=c)}else if(u.tag!==void 0){const c=vO({prev:o,next:u,dispatch:n,stack:s,isComponent:r});o?o!==c&&a.replaceChild(c,o):a.appendChild(c),i??(i=c)}else u.elements!==void 0?Sc(u,c=>{s.unshift({prev:o,next:c,parent:a}),o=o==null?void 0:o.nextSibling}):u.subtree!==void 0&&s.push({prev:o,next:u,parent:a})}return i}function vO({prev:e,next:t,dispatch:n,stack:r}){const i=t.namespace||"http://www.w3.org/1999/xhtml",s=e&&e.nodeType===Node.ELEMENT_NODE&&e.localName===t.tag&&e.namespaceURI===(t.namespace||"http://www.w3.org/1999/xhtml"),o=s?e:i?document.createElementNS(i,t.tag):document.createElement(t.tag);let u;if(xo.has(o))u=xo.get(o);else{const v=new Map;xo.set(o,v),u=v}const a=s?new Set(u.keys()):null,c=s?new Set(Array.from(e.attributes,v=>v.name)):null;let l=null,f=null,p=null;for(const v of t.attrs){const x=v[0],S=v[1];if(v.as_property)o[x]!==S&&(o[x]=S),s&&c.delete(x);else if(x.startsWith("on")){const A=x.slice(2),U=n(S);u.has(A)||o.addEventListener(A,So),u.set(A,U),s&&a.delete(A)}else if(x.startsWith("data-lustre-on-")){const A=x.slice(15),U=n(xO);u.has(A)||o.addEventListener(A,So),u.set(A,U),o.setAttribute(x,S)}else x==="class"?l=l===null?S:l+" "+S:x==="style"?f=f===null?S:f+S:x==="dangerous-unescaped-html"?p=S:(o.getAttribute(x)!==S&&o.setAttribute(x,S),(x==="value"||x==="selected")&&(o[x]=S),s&&c.delete(x))}if(l!==null&&(o.setAttribute("class",l),s&&c.delete("class")),f!==null&&(o.setAttribute("style",f),s&&c.delete("style")),s){for(const v of c)o.removeAttribute(v);for(const v of a)u.delete(v),o.removeEventListener(v,So)}if(t.key!==void 0&&t.key!=="")o.setAttribute("data-lustre-key",t.key);else if(p!==null)return o.innerHTML=p,o;let d=o.firstChild,m=null,y=null,b=null,g=t.children[Symbol.iterator]().next().value;s&&g!==void 0&&g.key!==void 0&&g.key!==""&&(m=new Set,y=um(e),b=um(t));for(const v of t.children)Sc(v,x=>{x.key!==void 0&&m!==null?d=SO(d,x,o,r,b,y,m):(r.unshift({prev:d,next:x,parent:o}),d=d==null?void 0:d.nextSibling)});for(;d;){const v=d.nextSibling;o.removeChild(d),d=v}return o}const xo=new WeakMap;function So(e){const t=e.currentTarget;if(!xo.has(t)){t.removeEventListener(e.type,So);return}const n=xo.get(t);if(!n.has(e.type)){t.removeEventListener(e.type,So);return}n.get(e.type)(e)}function xO(e){const t=e.currentTarget,n=t.getAttribute(`data-lustre-on-${e.type}`),r=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),i=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":i.push("target.value");break}return{tag:n,data:i.reduce((s,o)=>{var a;const u=o.split(".");for(let c=0,l=s,f=e;c<u.length;c++)c===u.length-1?l[u[c]]=f[u[c]]:(l[a=u[c]]??(l[a]={}),f=f[u[c]],l=l[u[c]]);return s},{data:r})}}function um(e){const t=new Map;if(e)for(const n of e.children)Sc(n,r=>{var s;const i=(r==null?void 0:r.key)||((s=r==null?void 0:r.getAttribute)==null?void 0:s.call(r,"data-lustre-key"));i&&t.set(i,r)});return t}function SO(e,t,n,r,i,s,o){for(;e&&!i.has(e.getAttribute("data-lustre-key"));){const a=e.nextSibling;n.removeChild(e),e=a}if(s.size===0)return Sc(t,a=>{r.unshift({prev:e,next:a,parent:n}),e=e==null?void 0:e.nextSibling}),e;if(o.has(t.key))return console.warn(`Duplicate key found in Lustre vnode: ${t.key}`),r.unshift({prev:null,next:t,parent:n}),e;o.add(t.key);const u=s.get(t.key);if(!u&&!e)return r.unshift({prev:null,next:t,parent:n}),e;if(!u&&e!==null){const a=document.createTextNode("");return n.insertBefore(a,e),r.unshift({prev:a,next:t,parent:n}),e}return!u||u===e?(r.unshift({prev:e,next:t,parent:n}),e=e==null?void 0:e.nextSibling,e):(n.insertBefore(u,e),r.unshift({prev:u,next:t,parent:n}),e)}function Sc(e,t){if(e.elements!==void 0)for(const n of e.elements)t(n);else t(e)}var rn,Kn,vn,Qn,es,Hn,ts,si,Ft,wa,Wf,Wg,Vg;const zh=class zh{constructor([t,n],r,i,s=document.body,o=!1){wt(this,Ft);wt(this,rn,null);wt(this,Kn,[]);wt(this,vn,[]);wt(this,Qn,!1);wt(this,es,!1);wt(this,Hn,null);wt(this,ts,null);wt(this,si,null);ie(this,Hn,t),ie(this,ts,r),ie(this,si,i),ie(this,rn,s),ie(this,vn,n.all.toArray()),ie(this,Qn,!0),ie(this,es,o),window.requestAnimationFrame(()=>pr(this,Ft,wa).call(this))}static start(t,n,r,i,s){if(!Oc())return new z(new Sp);const o=n instanceof HTMLElement?n:document.querySelector(n);if(!o)return new z(new PO(n));const u=new zh(r(t),i,s,o);return new F(a=>u.send(a))}send(t){switch(!0){case t instanceof Bi:{H(this,Kn).push(t[0]),pr(this,Ft,wa).call(this);return}case t instanceof zg:{pr(this,Ft,Vg).call(this);return}case t instanceof bO:{pr(this,Ft,Wg).call(this,t[0]);return}default:return}}emit(t,n){H(this,rn).dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:n,composed:!0}))}};rn=new WeakMap,Kn=new WeakMap,vn=new WeakMap,Qn=new WeakMap,es=new WeakMap,Hn=new WeakMap,ts=new WeakMap,si=new WeakMap,Ft=new WeakSet,wa=function(){if(pr(this,Ft,Wf).call(this),H(this,Qn)){const t=H(this,si).call(this,H(this,Hn)),n=r=>i=>{const s=r(i);s instanceof F&&this.send(new Bi(s[0]))};ie(this,Qn,!1),ie(this,rn,om(H(this,rn),t,n,H(this,es)))}},Wf=function(t=0){for(;H(this,Kn).length;){const[n,r]=H(this,ts).call(this,H(this,Hn),H(this,Kn).shift());H(this,Qn)||ie(this,Qn,H(this,Hn)!==n),ie(this,Hn,n),ie(this,vn,H(this,vn).concat(r.all.toArray()))}for(;H(this,vn).length;)H(this,vn).shift()(n=>this.send(new Bi(n)),(n,r)=>this.emit(n,r));H(this,Kn).length&&(t<5?pr(this,Ft,Wf).call(this,++t):window.requestAnimationFrame(()=>pr(this,Ft,wa).call(this)))},Wg=function(t){switch(!0){case t instanceof _O:{const n=H(this,si).call(this,t[0]),r=i=>s=>{const o=i(s);o instanceof F&&this.send(new Bi(o[0]))};ie(this,Kn,[]),ie(this,vn,[]),ie(this,Qn,!1),ie(this,rn,om(H(this,rn),n,r,H(this,es)))}}},Vg=function(){H(this,rn).remove(),ie(this,rn,null),ie(this,Hn,null),ie(this,Kn,[]),ie(this,vn,[]),ie(this,Qn,!1),ie(this,ts,()=>{}),ie(this,si,()=>{})};let Ra=zh;const OO=(e,t,n)=>Ra.start(n,t,e.init,e.update,e.view),Oc=()=>globalThis.window&&window.document,$O=e=>e.preventDefault();function TO({init:e,update:t,view:n,on_attribute_change:r},i){if(!Oc())return new z(new Sp);if(!i.includes("-"))return new z(new AO(i));if(window.customElements.get(i))return new z(new kO(i));const s=IO(e,t,n,r);window.customElements.define(i,s);for(const o of document.querySelectorAll(i)){const u=new s;for(const a of o.attributes)u.setAttribute(a.name,a.value);o.replaceWith(u)}return new F(void 0)}function IO(e,t,n,r){var i,s,o,u;return u=class extends HTMLElement{constructor(){var l;super();wt(this,i,document.createElement("div"));wt(this,s,null);wt(this,o,null);I(this,"slotContent",[]);ie(this,o,this.attachShadow({mode:"closed"})),(l=r[0])==null||l.forEach((f,p)=>{Object.defineProperty(this,p,{get(){return this[`_${p}`]||this.getAttribute(p)},set(d){const m=this[p],y=f(d);y instanceof F&&!_e(m,d)&&(H(this,s)?H(this,s).send(new Bi(y[0])):window.requestAnimationFrame(()=>H(this,s).send(new Bi(y[0])))),this[`_${p}`]=d}})})}static get observedAttributes(){var l;return((l=r[0])==null?void 0:l.entries().map(([f,p])=>f))??[]}connectedCallback(){for(const l of document.querySelectorAll("link"))l.rel==="stylesheet"&&H(this,o).appendChild(l.cloneNode(!0));for(const l of document.querySelectorAll("style"))H(this,o).appendChild(l.cloneNode(!0));ie(this,s,new Ra(e(),t,n,H(this,i),!0)),H(this,o).append(H(this,i))}attributeChangedCallback(l,f,p){this[l]=p}disconnectedCallback(){H(this,s).send(new zg)}get adoptedStyleSheets(){return H(this,o).adoptedStyleSheets}set adoptedStyleSheets(l){H(this,o).adoptedStyleSheets=l}},i=new WeakMap,s=new WeakMap,o=new WeakMap,u}class qg extends w{constructor(t,n,r,i){super(),this.init=t,this.update=n,this.view=r,this.on_attribute_change=i}}class AO extends w{constructor(t){super(),this.name=t}}class kO extends w{constructor(t){super(),this.name=t}}class PO extends w{constructor(t){super(),this.selector=t}}class Sp extends w{}function EO(e,t,n){return new qg(e,t,n,new C)}function RO(e,t,n,r){return new qg(e,t,n,new $(r))}function MO(e,t,n){return is(!Oc(),new z(new Sp),()=>OO(e,t,n))}function NO(e,t){return de("h1",e,t)}function _n(e,t){return de("h2",e,t)}function FO(e,t){return de("main",e,t)}function Ms(e,t){return de("nav",e,t)}function ss(e,t){return de("section",e,t)}function D(e,t){return de("div",e,t)}function Jg(e,t){return de("li",e,t)}function jO(e,t){return de("ol",e,t)}function CO(e,t){return de("ul",e,t)}function Ue(e,t){return de("a",e,t)}function xt(e,t){return de("span",e,t)}function ar(e,t){return de("button",e,t)}function Ce(e,t){return de("fieldset",e,t)}function Kg(e,t){return de("form",e,t)}function Ut(e){return de("input",e,h([]))}function On(e,t){return de("label",e,t)}function Ma(e,t){return de("legend",e,t)}function ia(e,t){return de("option",e,h([E(t)]))}function am(e,t){return de("select",e,t)}function Op(e,t){return de("textarea",e,h([E(t)]))}function DO(e,t){return de("details",e,t)}function LO(e,t){return de("summary",e,t)}const BO={handle_external_links:!1,handle_internal_links:!0};var og;const cm=(og=window==null?void 0:window.location)==null?void 0:og.href,UO=()=>cm?new F(Vf(new URL(cm))):new z(void 0),zO=(e,t=BO)=>{document.body.addEventListener("click",n=>{const r=Qg(n.target);if(r)try{const i=new URL(r.href),s=Vf(i),o=i.host!==window.location.host;return!t.handle_external_links&&o||!t.handle_internal_links&&!o?void 0:(n.preventDefault(),o||(window.history.pushState({},"",r.href),window.requestAnimationFrame(()=>{var u;i.hash&&((u=document.getElementById(i.hash.slice(1)))==null||u.scrollIntoView())})),e(s))}catch{return}}),window.addEventListener("popstate",n=>{n.preventDefault();const r=new URL(window.location.href),i=Vf(r);window.requestAnimationFrame(()=>{var s;r.hash&&((s=document.getElementById(r.hash.slice(1)))==null||s.scrollIntoView())}),e(i)})},Qg=e=>e.tagName==="BODY"?null:e.tagName==="A"?e:Qg(e.parentElement),Vf=e=>new zS(e.protocol?new $(e.protocol):new C,new C,e.host?new $(e.host):new C,e.port?new $(Number(e.port)):new C,e.pathname,e.search?new $(e.search.slice(1)):new C,e.hash?new $(e.hash.slice(1)):new C);function WO(e){return Ht(t=>is(!Oc(),void 0,()=>zO(n=>{let i=e(n);return t(i)})))}function Zr(e){return t=>n=>e(t,n)}class Hg extends w{constructor(t){super(),this.run=t}}class $n extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class Co extends w{}class Na extends w{constructor(t){super(),this[0]=t}}class Do extends w{}class lm extends w{constructor(t,n,r){super(),this.span=t,this.lexeme=n,this.value=r}}class qf extends w{constructor(t,n,r,i){super(),this.row_start=t,this.col_start=n,this.row_end=r,this.col_end=i}}class fm extends w{constructor(t,n,r){super(),this.row=t,this.col=n,this.lexeme=r}}class VO extends w{constructor(t){super(),this.matchers=t}}let mo=class extends w{constructor(t,n,r,i,s){super(),this.source=t,this.tokens=n,this.current=r,this.row=i,this.col=s}};function Gg(e){return new VO(t=>e)}function dm(e){return new Hg((t,n,r)=>{let i=e(n,r),s=J(i,o=>new $n(o,t));return se(s,new Do)})}function Xg(e){return new Hg(e)}function pm(e,t,n,r){return hg(r,new Do,(i,s)=>{let o=s.run(e,t,n);if(o instanceof $n){let u=o;return new _o(u)}else{if(o instanceof Co)return new _o(new Co);if(o instanceof Na){let u=o;return new _o(u)}else return new up(new Do)}})}function qO(e,t){return t===`
`?1:e+1}function JO(e,t){return t===`
`?e+1:e}function KO(e,t,n){for(;;){let r=e,i=t,s=n,o=r.matchers(i),u=s.source,a=s.current;if(u.hasLength(0)&&a[2]==="")return new F(nt(s.tokens));if(u.hasLength(0)){let c=a[0],l=a[1],f=a[2],p=pm(i,f,"",o);if(p instanceof Do)return new z(new fm(c,l,f));if(p instanceof Co)return new z(new fm(c,l,f));if(p instanceof Na)return new F(nt(s.tokens));{let d=p[0],m=new qf(c,l,s.row,s.col),y=new lm(m,f,d);return new F(nt(j(y,s.tokens)))}}else{let c=u.head,l=u.tail,f=a[0],p=a[1],d=a[2],m=JO(s.row,c),y=qO(s.col,c),b=pm(i,d,c,o);if(b instanceof $n){let g=b[0],v=b[1],x=new qf(f,p,s.row,s.col),S=new lm(x,d,g);e=r,t=v,n=new mo(l,j(S,s.tokens),[s.row,s.col,c],m,y)}else if(b instanceof Co)e=r,t=i,n=new mo(l,s.tokens,[f,p,d+c],m,y);else if(b instanceof Na){let g=b[0];e=r,t=g,n=new mo(l,s.tokens,[s.row,s.col,c],m,y)}else e=r,t=i,n=new mo(l,s.tokens,[f,p,d+c],m,y)}}}function Yg(e,t){let n=vc(e),r=new mo(n,h([]),[1,1,""],1,1);return(i=>KO(t,void 0,i))(r)}class Ur extends w{constructor(t){super(),this[0]=t}}class yt extends w{constructor(t,n,r){super(),this[0]=t,this[1]=n,this[2]=r}}class fn extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class QO extends w{constructor(t,n,r,i){super(),this.src=t,this.idx=n,this.pos=r,this.ctx=i}}class it extends w{constructor(t){super(),this[0]=t}}class Zg extends w{}class ew extends w{constructor(t,n){super(),this[0]=t,this.got=n}}class HO extends w{constructor(t){super(),this[0]=t}}class GO extends w{constructor(t,n,r){super(),this.pos=t,this.problem=n,this.context=r}}class Fa extends w{}class Jf extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class XO extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}function os(e,t){let n=t[0];return n(e)}function $c(e){let t=_t(e.src,e.idx);if(t.isOk()){let n=t[0].span,r=t[0].value;return[new $(r),e.withFields({idx:e.idx+1,pos:n})]}else return[new C,e]}function Me(e){return new Ur(t=>new yt(new it(!1),e,t))}function nr(e){return Me(e)}function hm(e){return new Ur(t=>{let n=os(t,e);if(n instanceof yt){let r=n[1],i=n[2];return new yt(new it(!1),r,i)}else{let r=n[1];return new fn(new it(!1),r)}})}function mm(e,t){let n=e[0],r=t[0];return new it(n||r)}function oe(e,t){return new Ur(n=>{let r=os(n,e);if(r instanceof yt){let i=r[0],s=r[1],o=r[2],u=os(o,t(s));if(u instanceof yt){let a=u[0],c=u[1],l=u[2];return new yt(mm(i,a),c,l)}else{let a=u[0],c=u[1];return new fn(mm(i,a),c)}}else{let i=r[0],s=r[1];return new fn(i,s)}})}function kn(e,t){return oe(e,t)}function tw(e,t){return oe(e,n=>Me(t(n)))}function Tc(e){return new Ur(t=>{let n=$c(t),r=n[0],i=n[1],s=Pe(r,e);if(r instanceof $&&s instanceof $&&s[0]){let o=r[0];return os(i,oe(Tc(e),u=>Me(j(o,u))))}else return r instanceof $&&s instanceof $&&!s[0]?new yt(new it(!1),h([]),t):new yt(new it(!1),h([]),t)})}function _i(e,t){return t===0?Me(h([])):oe(e,n=>oe(_i(e,t-1),r=>Me(j(n,r))))}function Lo(e,t){return new Jf(new Fa,new GO(e.pos,t,e.ctx))}function Mr(e){return new Ur(t=>{let n=$c(t);if(n[0]instanceof $&&_e(e,n[0][0])){n[0][0];let r=n[1];return new yt(new it(!0),void 0,r)}else if(n[0]instanceof $){let r=n[0][0],i=n[1];return new fn(new it(!1),Lo(i,new ew(Og(e),r)))}else{let r=n[1];return new fn(new it(!1),Lo(r,new Zg))}})}function $p(){return new Ur(e=>{let t=$c(e);if(t[0]instanceof $){let n=t[0][0],r=t[1];return new fn(new it(!1),Lo(r,new HO(n)))}else return new yt(new it(!1),void 0,e)})}function us(e,t){return new Ur(n=>{let r=$c(n),i=r[0],s=r[1],o=Pe(i,t);if(i instanceof $&&o instanceof $&&o[0]){let u=i[0];return new yt(new it(!1),u,s)}else if(i instanceof $&&o instanceof $&&!o[0]){let u=i[0];return new fn(new it(!1),Lo(s,new ew(e,u)))}else return new fn(new it(!1),Lo(s,new Zg))})}function YO(e,t){return oe(us(e,t),n=>oe(Tc(t),r=>Me(j(n,r))))}function nw(e,t){for(;;){let n=e,r=t;if(n instanceof Fa)return r;if(n instanceof Jf&&n[0]instanceof Fa){let i=n[1];return j(i,r)}else if(n instanceof Jf){let i=n[0],s=n[1];e=i,t=j(s,r)}else{let i=n[0],s=n[1];e=i,t=nw(s,r)}}}function rw(e,t){let n=sx(e,Es(),(s,o,u)=>Qt(s,u,o)),r=new QO(n,0,new qf(1,1,1,1),h([])),i=os(r,t);if(i instanceof yt){let s=i[1];return new F(s)}else{let s=i[1];return new z(nw(s,h([])))}}function ZO(e,t){if(e instanceof yt){let n=e[0],r=e[1],i=e[2];return new yt(n,r,i)}else{let n=e[0],r=e[1];return new fn(n,new XO(t,r))}}function Mn(e){return new Ur(t=>{let n=new fn(new it(!1),new Fa);return hg(e,n,(r,i)=>{if(r instanceof yt)return new _o(r);if(r instanceof fn&&r[0]instanceof it&&r[0][0])return new _o(r);{let s=r[1],o=os(t,i),u=ZO(o,s);return new up(u)}})})}function e$(e){return Mn(h([tw(e,t=>new $(t)),Me(new C)]))}class Ns extends w{constructor(t){super(),this[0]=t}}class iw extends w{}class Ou extends w{}class sw extends w{}class t$ extends w{constructor(t){super(),this[0]=t}}function n$(){let e=new Mv(!1,!0),t=Nv("^[0-9]+$",e);if(!t.isOk())throw jt("assignment_no_match","rada/date/parse",14,"lexer","Assignment pattern did not match",{value:t});let n=t[0],r=i=>Fv(n,i);return Gg(h([Xg((i,s,o)=>s===""?new Na(i):s==="W"?new $n(new iw,i):s==="T"?new $n(new sw,i):s==="-"?new $n(new Ou,i):r(s)?new $n(new Ns(s),i):new $n(new t$(s),i))]))}class ow extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}let ai=class extends w{constructor(t){super(),this[0]=t}};class $u extends w{constructor(t){super(),this[0]=t}}class Tp extends w{}class Ic extends w{}class Ip extends w{constructor(t){super(),this[0]=t}}function r$(e){return e instanceof $u}function i$(e){return t=>t instanceof $u?t[0]===e:!1}function ym(e){return e instanceof Ip}function Kf(e){return e instanceof Tp}function yo(e){if(e.hasLength(0))return"";{let t=e.head,n=e.tail;return t instanceof $u?t[0]+yo(n):t instanceof Tp||t instanceof Ic?"'"+yo(n):t[0]+yo(n)}}function s$(){return oe(us("Expecting an Alpha token",r$),e=>{if(!(e instanceof $u))throw jt("assignment_no_match","rada/date/pattern",170,"","Assignment pattern did not match",{value:e});let t=e[0];return oe(Tc(i$(t)),n=>Me(new ow(t,lg(n)+1)))})}function o$(){let e=Mr(new Ic);return kn(e,t=>nr(new ai("'")))}function u$(){return oe(us("Expecting an Text token",ym),e=>oe(Tc(ym),t=>{let n=(()=>{let r=V(j(e,t),i=>{if(!(i instanceof Ip))throw jt("assignment_no_match","rada/date/pattern",216,"","Assignment pattern did not match",{value:i});return i[0]});return Ps(r)})();return Me(new ai(n))}))}function Qf(e){return Mn(h([oe(YO("Expecting a non-Quote",t=>!Kf(t)),t=>{let n=yo(t);return Qf(e+n)}),(()=>{let t=Mr(new Ic);return kn(t,n=>Qf(e+"'"))})(),nr(e)]))}function a$(){return oe(us("Expecting an Quote",Kf),e=>oe(Qf(""),t=>oe(Mn(h([(()=>{let n=us("Expecting an Quote",Kf);return tw(n,r=>{})})(),$p()])),n=>Me(new ai(t)))))}function c$(e){return As(e,h([]),(t,n)=>{if(n instanceof ai&&t.atLeastLength(1)&&t.head instanceof ai){let r=n[0],i=t.head[0],s=t.tail;return j(new ai(r+i),s)}else return j(n,t)})}function uw(e){return Mn(h([(()=>{let t=Mn(h([s$(),u$(),o$(),a$()]));return kn(t,n=>uw(j(n,e)))})(),nr(c$(e))]))}function l$(e){let t=(()=>{let o=vc("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return wO(o)})(),n=s=>yO(t,s),r=Gg(h([dm((s,o)=>n(s)?new F(new $u(s)):new z(void 0)),Xg((s,o,u)=>o==="'"?u==="'"?new Co:new $n(new Tp,s):o==="''"?new $n(new Ic,s):new Do),dm((s,o)=>s===""?new z(void 0):new F(new Ip(s)))])),i=Yg(e,r);if(i.isOk()){let s=i[0],o=rw(s,uw(h([])));return se(o,h([new ai(e)]))}else return h([])}function f$(){let e=new Date;return[e.getFullYear(),e.getMonth()+1,e.getDate()]}class vi extends w{}class Fs extends w{}class js extends w{}class Cs extends w{}class Ds extends w{}class Ls extends w{}class Bs extends w{}class Us extends w{}class zs extends w{}class Ws extends w{}class Vs extends w{}class d$ extends w{}class as extends w{}class Tu extends w{}class Iu extends w{}class Au extends w{}class ku extends w{}class Pu extends w{}class Ap extends w{}class Te extends w{constructor(t){super(),this[0]=t}}class p$ extends w{constructor(t,n){super(),this.year=t,this.ordinal_day=n}}class h$ extends w{constructor(t,n,r){super(),this.year=t,this.month=n,this.day=r}}class m$ extends w{constructor(t,n,r){super(),this.week_year=t,this.week_number=n,this.weekday=r}}class y$ extends w{constructor(t,n,r,i,s){super(),this.month_name=t,this.month_name_short=n,this.weekday_name=r,this.weekday_name_short=i,this.day_with_suffix=s}}class aw extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class cw extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class lw extends w{constructor(t){super(),this[0]=t}}class g$ extends w{}class gm extends w{}class cs extends w{}class pe extends w{}class w$ extends w{}class b$ extends w{}class _$ extends w{}class v$ extends w{}class Eu extends w{}class x$ extends w{}class S$ extends w{}class O$ extends w{}class $$ extends w{}class T$ extends w{}class I$ extends w{}function fw(e){return new Te(e)}function Hf(e){return e[0]}function wm(e,t){return lp(e,-1*t,t)}function Oo(e,t){return lp(e,0,t)}function Gf(e){return e instanceof vi?"January":e instanceof Fs?"February":e instanceof js?"March":e instanceof Cs?"April":e instanceof Ds?"May":e instanceof Ls?"June":e instanceof Bs?"July":e instanceof Us?"August":e instanceof zs?"September":e instanceof Ws?"October":e instanceof Vs?"November":"December"}function bm(e){return e instanceof as?"Monday":e instanceof Tu?"Tuesday":e instanceof Iu?"Wednesday":e instanceof Au?"Thursday":e instanceof ku?"Friday":e instanceof Pu?"Saturday":"Sunday"}function Ac(){return us("Expecting digit",e=>e instanceof Ns)}function A$(){return oe(e$(Mr(new Ou)),e=>{let t=(()=>{let r=Pe(e,i=>"-");return fe(r,"")})();return oe((()=>{let n=Ac();return _i(n,4)})(),n=>{let r=(()=>{let o=V(n,u=>{if(!(u instanceof Ns))throw jt("assignment_no_match","rada/date",1091,"","Assignment pattern did not match",{value:u});return u[0]});return Ps(o)})(),i=Vt(t+r);if(!i.isOk())throw jt("assignment_no_match","rada/date",1096,"","Assignment pattern did not match",{value:i});let s=i[0];return Me(s)})})}function k$(){return oe((()=>{let e=Ac();return _i(e,3)})(),e=>{let t=(()=>{let i=V(e,s=>{if(!(s instanceof Ns))throw jt("assignment_no_match","rada/date",1109,"","Assignment pattern did not match",{value:s});return s[0]});return Ps(i)})(),n=Vt(t);if(!n.isOk())throw jt("assignment_no_match","rada/date",1114,"","Assignment pattern did not match",{value:n});let r=n[0];return Me(r)})}function _m(){return oe(k$(),e=>Me(new lw(e)))}function Xf(){return oe((()=>{let e=Ac();return _i(e,2)})(),e=>{let t=(()=>{let i=V(e,s=>{if(!(s instanceof Ns))throw jt("assignment_no_match","rada/date",1127,"","Assignment pattern did not match",{value:s});return s[0]});return Ps(i)})(),n=Vt(t);if(!n.isOk())throw jt("assignment_no_match","rada/date",1132,"","Assignment pattern did not match",{value:n});let r=n[0];return Me(r)})}function vm(e){return oe(Xf(),t=>{let n=xp(e);return oe(Mn(h([(()=>{let r=_i(Mr(new Ou),n);return kn(r,i=>Xf())})(),(()=>{let r=$p();return kn(r,i=>nr(1))})()])),r=>Me(new aw(t,r)))})}function P$(){return oe((()=>{let e=Ac();return _i(e,1)})(),e=>{if(!e.hasLength(1)||!(e.head instanceof Ns))throw jt("assignment_no_match","rada/date",1143,"","Assignment pattern did not match",{value:e});let t=e.head[0],n=Vt(t);if(!n.isOk())throw jt("assignment_no_match","rada/date",1145,"","Assignment pattern did not match",{value:n});let r=n[0];return Me(r)})}function xm(e){return oe(Mr(new iw),t=>oe(Xf(),n=>{let r=xp(e);return oe(Mn(h([(()=>{let i=_i(Mr(new Ou),r);return kn(i,s=>P$())})(),nr(1)])),i=>Me(new cw(n,i)))}))}function E$(){return Mn(h([(()=>{let e=Mr(new Ou);return kn(e,t=>Mn(h([hm(_m()),vm(!0),xm(!0)])))})(),hm(vm(!1)),_m(),xm(!1),nr(new lw(1))]))}function Bo(e,t){let n=e[0],r=t[0];return Ar(n,r)}function kc(e){return e instanceof vi?1:e instanceof Fs?2:e instanceof js?3:e instanceof Cs?4:e instanceof Ds?5:e instanceof Ls?6:e instanceof Bs?7:e instanceof Us?8:e instanceof zs?9:e instanceof Ws?10:e instanceof Vs?11:12}function R$(e){return fi(kc(e)+2,3)}function $r(e){let t=hc(1,e);return t===1?new vi:t===2?new Fs:t===3?new js:t===4?new Cs:t===5?new Ds:t===6?new Ls:t===7?new Bs:t===8?new Us:t===9?new zs:t===10?new Ws:t===11?new Vs:new d$}function M$(e){let t=e*3-2;return $r(t)}function N$(e){return e instanceof as?1:e instanceof Tu?2:e instanceof Iu?3:e instanceof Au?4:e instanceof ku?5:e instanceof Pu?6:7}function dw(e){let t=hc(1,e);return t===1?new as:t===2?new Tu:t===3?new Iu:t===4?new Au:t===5?new ku:t===6?new Pu:new Ap}function Sm(e,t){let n=e<0?"-":"",r=(()=>{let s=Bv(e),o=k(s);return mr(o,t,"0")})();return n+r}function $o(e,t){return(e>0&&t<0||e<0&&t>0)&&Et(e,t)!==0?fi(e,t)-1:fi(e,t)}function zr(e){let t=e-1,n=$o(t,4)-$o(t,100)+$o(t,400);return 365*t+n}function pw(e){return new Te(zr(e)+1)}function rr(e,t){let n=Et(e,t);return n>0&&t<0||n<0&&t>0?n+t:n}function Pc(e){return rr(e,4)===0&&rr(e,100)!==0||rr(e,400)===0}function hi(e){let t=e[0],n=rr(t,7);return n===0?7:n}function hw(e){let t=zr(e)+4;return t-hi(new Te(t))}function F$(e){let t=hi(pw(e));return t===4||t===3&&Pc(e)}function br(e){let n=hi(e);return dw(n)}function j$(e){let t=rr(e,100),n=t<20?t:rr(t,10),r=pc(n,4);return r===1?"st":r===2?"nd":r===3?"rd":"th"}function mw(e){return k(e)+j$(e)}function C$(){return new y$(Gf,e=>{let n=Gf(e);return Oo(n,3)},bm,e=>{let n=bm(e);return Oo(n,3)},mw)}function hr(e,t){return rr(hi(t)+7-N$(e),7)}function Uo(e,t){return t instanceof vi?31:t instanceof Fs?Pc(e)?29:28:t instanceof js?31:t instanceof Cs?30:t instanceof Ds?31:t instanceof Ls?30:t instanceof Bs||t instanceof Us?31:t instanceof zs?30:t instanceof Ws?31:t instanceof Vs?30:31}function D$(e,t,n){for(;;){let r=e,i=t,s=n,o=Uo(r,i),u=kc(i);if(u<12&&s>o)e=r,t=$r(u+1),n=s-o;else return new h$(r,i,s)}}function Ec(e,t){let n=xp(Pc(e));return t instanceof vi?0:t instanceof Fs?31:t instanceof js?59+n:t instanceof Cs?90+n:t instanceof Ds?120+n:t instanceof Ls?151+n:t instanceof Bs?181+n:t instanceof Us?212+n:t instanceof zs?243+n:t instanceof Ws?273+n:t instanceof Vs?304+n:334+n}function Om(e,t){return new Te(zr(e)+Ec(e,t)+1)}function L$(e,t,n){return new Te(zr(e)+Ec(e,t)+zv(n,1,Uo(e,t)))}function _r(){let e=f$(),t=e[0],n=e[1],r=e[2];return L$(t,$r(n),r)}function sa(e,t){return[$o(e,t),rr(e,t)]}function ci(e){let t=e[0],n=sa(t,146097),r=n[0],i=n[1],s=sa(i,36524),o=s[0],u=s[1],a=sa(u,1461),c=a[0],l=a[1],f=sa(l,365),p=f[0],d=f[1],m=d===0?0:1;return r*400+o*100+c*4+p+m}function yw(e){let t=e[0],n=ci(e);return new p$(n,t-zr(n))}function kp(e){let t=yw(e);return D$(t.year,new vi,t.ordinal_day)}function gw(e){let t=e[0],n=hi(e),r=ci(new Te(t+(4-n))),i=hw(r)+1;return new m$(r,1+fi(t-i,7),dw(n))}function uf(e){return yw(e).ordinal_day}function li(e){return kp(e).month}function $m(e){let n=li(e);return kc(n)}function Fi(e){let n=li(e);return R$(n)}function ba(e){return kp(e).day}function Tm(e){return gw(e).week_year}function Im(e){return gw(e).week_number}function B$(e,t,n,r){for(;;){let i=e,s=t,o=n,u=r;if(o==="y")if(u===2){let c=ci(i),l=k(c),f=mr(l,2,"0");return wm(f,2)}else{let c=ci(i);return Sm(c,u)}else if(o==="Y")if(u===2){let c=Tm(i),l=k(c),f=mr(l,2,"0");return wm(f,2)}else{let c=Tm(i);return Sm(c,u)}else if(o==="Q")if(u===1){let c=Fi(i);return k(c)}else if(u===2){let c=Fi(i);return k(c)}else if(u===3){let c=Fi(i),l=k(c);return(f=>"Q"+f)(l)}else if(u===4){let c=Fi(i);return mw(c)}else if(u===5){let c=Fi(i);return k(c)}else return"";else if(o==="M")if(u===1){let c=$m(i);return k(c)}else if(u===2){let c=$m(i),l=k(c);return mr(l,2,"0")}else if(u===3){let c=li(i);return s.month_name_short(c)}else if(u===4){let c=li(i);return s.month_name(c)}else if(u===5){let c=li(i),l=s.month_name_short(c);return Oo(l,1)}else return"";else if(o==="w")if(u===1){let c=Im(i);return k(c)}else if(u===2){let c=Im(i),l=k(c);return mr(l,2,"0")}else return"";else if(o==="d")if(u===1){let c=ba(i);return k(c)}else if(u===2){let c=ba(i),l=k(c);return mr(l,2,"0")}else if(u===3){let c=ba(i);return s.day_with_suffix(c)}else return"";else if(o==="D")if(u===1){let c=uf(i);return k(c)}else if(u===2){let c=uf(i),l=k(c);return mr(l,2,"0")}else if(u===3){let c=uf(i),l=k(c);return mr(l,3,"0")}else return"";else if(o==="E")if(u===1){let c=br(i);return s.weekday_name_short(c)}else if(u===2){let c=br(i);return s.weekday_name_short(c)}else if(u===3){let c=br(i);return s.weekday_name_short(c)}else if(u===4){let c=br(i);return s.weekday_name(c)}else if(u===5){let c=br(i),l=s.weekday_name_short(c);return Oo(l,1)}else if(u===6){let c=br(i),l=s.weekday_name_short(c);return Oo(l,2)}else return"";else if(o==="e")if(u===1){let c=hi(i);return k(c)}else if(u===2){let c=hi(i);return k(c)}else e=i,t=s,n="E",r=u;else return""}}function U$(e,t,n){return As(t,"",(r,i)=>{if(i instanceof ow){let s=i[0],o=i[1];return B$(n,e,s,o)+r}else return i[0]+r})}function z$(e,t,n){let r=(()=>{let s=l$(n);return nt(s)})();return U$(t,r,e)}function W$(e,t){return z$(e,C$(),t)}function Hi(e){return W$(e,"yyyy-MM-dd")}function te(e,t,n){for(;;){let r=e,i=t,s=n,o=r[0];if(s instanceof g$)e=r,t=12*i,n=new gm;else if(s instanceof gm){let u=kp(r),a=12*(u.year-1)+(kc(u.month)-1)+i,c=$o(a,12)+1,l=$r(rr(a,12)+1);return new Te(zr(c)+Ec(c,l)+pc(u.day,Uo(c,l)))}else return s instanceof cs?new Te(o+7*i):new Te(o+i)}}function Rc(e,t){let n=e[0];return t instanceof w$?pw(ci(e)):t instanceof b$?Om(ci(e),(()=>{let r=Fi(e);return M$(r)})()):t instanceof _$?Om(ci(e),li(e)):t instanceof v$?new Te(n-hr(new as,e)):t instanceof Eu?new Te(n-hr(new as,e)):t instanceof x$?new Te(n-hr(new Tu,e)):t instanceof S$?new Te(n-hr(new Iu,e)):t instanceof O$?new Te(n-hr(new Au,e)):t instanceof $$?new Te(n-hr(new ku,e)):t instanceof T$?new Te(n-hr(new Pu,e)):t instanceof I$?new Te(n-hr(new Ap,e)):e}function zo(e,t,n){return t<=e&&e<=n}function V$(e,t){let n=Pc(e)?366:365;return zo(t,1,n)?new F(new Te(zr(e)+t)):new z("Invalid ordinal date: "+("ordinal-day "+k(t)+" is out of range")+(" (1 to "+k(n)+")")+(" for "+k(e))+("; received (year "+k(e)+", ordinal-day "+k(t)+")"))}function q$(e,t,n){let r=zo(t,1,12),i=zo(n,1,Uo(e,$r(t)));return r?r&&!i?new z("Invalid date: "+("day "+k(n)+" is out of range")+(" (1 to "+k(Uo(e,$r(t)))+")")+(" for "+(()=>{let o=$r(t);return Gf(o)})())+(t===2&&n===29?" ("+k(e)+" is not a leap year)":"")+("; received (year "+k(e)+", month "+k(t)+", day "+k(n)+")")):new F(new Te(zr(e)+Ec(e,$r(t))+n)):new z("Invalid date: "+("month "+k(t)+" is out of range")+" (1 to 12)"+("; received (year "+k(e)+", month "+k(t)+", day "+k(n)+")"))}function J$(e,t,n){let r=F$(e)?53:52,i=zo(t,1,r),s=zo(n,1,7);return i?i&&!s?new z("Invalid week date: "+("weekday "+k(n)+" is out of range")+" (1 to 7)"+("; received (year "+k(e)+", week "+k(t)+", weekday "+k(n)+")")):new F(new Te(hw(e)+(t-1)*7+n)):new z("Invalid week date: "+("week "+k(t)+" is out of range")+(" (1 to "+k(r)+")")+(" for "+k(e))+("; received (year "+k(e)+", week "+k(t)+", weekday "+k(n)+")"))}function K$(e,t){if(t instanceof aw){let n=t[0],r=t[1];return q$(e,n,r)}else if(t instanceof cw){let n=t[0],r=t[1];return J$(e,n,r)}else{let n=t[0];return V$(e,n)}}function Q$(){return oe(A$(),e=>oe(E$(),t=>Me(K$(e,t))))}function Am(e){let t=Yg(e,n$());if(!t.isOk())throw jt("assignment_no_match","rada/date",950,"from_iso_string","Assignment pattern did not match",{value:t});let n=t[0],r=rw(n,(()=>{let i=Q$();return kn(i,s=>Mn(h([(()=>{let o=$p();return kn(o,u=>nr(s))})(),(()=>{let o=Mr(new sw);return kn(o,u=>nr(new z("Expected a date only, not a date and time")))})(),nr(new z("Expected a date only"))])))})());if(r.isOk()&&r[0].isOk()){let i=r[0][0];return new F(i)}else if(r.isOk()&&!r[0].isOk()){let i=r[0][0];return new z(i)}else return new z("Expected a date in ISO 8601 format")}function H$(e,t){return fO(e,t)}function dn(e,t){return dO(e,t)}function Nr(e){return dn("click",t=>new F(e))}function G$(e){return dn("keydown",t=>{let n=t,r=Ye("key",Le)(n);return J(r,e)})}function X$(e){return dn("focus",t=>new F(e))}function Y$(e){let t=e;return Ye("target",Ye("value",Le))(t)}function lt(e){return dn("input",t=>{let n=Y$(t);return J(n,e)})}function Z$(e){let t=e;return Ye("target",Ye("checked",$g))(t)}function ww(e){return dn("change",t=>{let n=Z$(t);return J(n,e)})}function bw(e){return dn("submit",t=>($O(t),new F(e)))}class Wo{constructor(t){this.promise=t}static wrap(t){return t instanceof Promise?new Wo(t):t}static unwrap(t){return t instanceof Wo?t.promise:t}}function on(e,t){return e.then(n=>Wo.wrap(t(Wo.unwrap(n))))}function Pp(e,t){return on(e,r=>(t(r),r))}function xi(e,t){return D(h([_("mt-4 flex col-start-1 col-span-11"),_((()=>{let n=cn(e);return n>38?"text-4xl":n>18?"text-5.5xl":n===18?"text-6xl":"text-7xl"})()),_(t)]),h([NO(h([ye("title"),_("min-h-[56px] max-h-[140px] overflow-hidden px-0 pb-1 w-full font-transitional font-bold italic text-ecru-white-950")]),h([E(e)]))]))}function eT(e,t){return globalThis.setTimeout(t,e)}function gr(e,t,n){let r=(()=>{let s=_t(e,t);return op(s)})();if(r instanceof $){let s=r[0],o=n(s);return(u=>Qt(e,t,u))(o)}else return e}function af(e){let n=rt(e),r=Kt(n,(s,o)=>Ar(me(s),me(o))),i=di(r,(s,o)=>[o,oi(s)]);return Ot(i)}function tT(e,t){for(;;){let n=e,r=t;if(n.hasLength(0))return new C;if(n.atLeastLength(1)&&r===0){let i=n.head;return new $(i)}else e=n.tail,t=r-1}}function wr(e){let n=ba(e);return k(n)}function _w(e){let t=wr(e);return br(e),(()=>{let i=li(e);return(s=>s instanceof vi?"January":s instanceof Fs?"February":s instanceof js?"March":s instanceof Cs?"April":s instanceof Ds?"May":s instanceof Ls?"June":s instanceof Bs?"July":s instanceof Us?"August":s instanceof zs?"September":s instanceof Ws?"October":s instanceof Vs?"November":"December")(i)})()+" "+t}function nT(e,t){return Ht(n=>{eT(e,()=>n(t))})}function rT(e,t){let r=J(e,i=>mc(i,t));return px(r)}function iT(e){if(e instanceof Cg)return h([new er("end of input","something else",h([""]))]);if(e instanceof Rs){let t=e.byte,n=e.position;return h([new er("unexpected byte",t,h([k(n)]))])}else if(e instanceof sO){let t=e.byte,n=e.position;return h([new er("unexpected sequence",t,h([k(n)]))])}else return e[0]}let sT=class extends w{constructor(t,n,r,i,s,o,u){super(),this.elem_id=t,this.search_items=n,this.search_term=r,this.found_items=i,this.is_open=s,this.is_focused=o,this.hovered_item=u}};class vw extends w{constructor(t){super(),this[0]=t}}class xw extends w{constructor(t){super(),this[0]=t}}class Sw extends w{constructor(t){super(),this[0]=t}}class Ow extends w{constructor(t){super(),this[0]=t}}class Yf extends w{constructor(t){super(),this[0]=t}}class Zf extends w{constructor(t){super(),this[0]=t}}class $w extends w{constructor(t){super(),this[0]=t}}class oT extends w{constructor(t){super(),this[0]=t}}class Tw extends w{}class _a extends w{}class uT extends w{}function aT(e){return de("type-ahead",e,h([]))}function cT(e){return Su("recipe-titles",e)}function lT(e){return Su("search-term",e)}function fT(e){let t=k(Wv(999999));return[new sT(t,h([]),"",h([]),!1,!1,new C),P()]}function dT(e,t){if(vu(t),t instanceof xw){let n=t[0];return[e.withFields({search_term:n}),P()]}else if(t instanceof vw){let n=t[0];return[e.withFields({search_items:n,found_items:n}),P()]}else if(t instanceof Sw){let n=t[0];return[e.withFields({search_term:n,found_items:cn(n)<3?e.search_items:ns(e.search_items,i=>iS(Aa(i),Aa(n))),is_open:!Gh(e.search_items,n)}),P()]}else if(t instanceof Yf){let n=t[0];return[e,H$("typeahead-change",sn(n))]}else if(t instanceof Zf){let n=t[0];return[e.withFields({is_open:!1}),Ht(r=>{let i=new Yf(n);return r(i)})]}else{if(t instanceof Tw)return[e.withFields({is_focused:!0,is_open:!Gh(e.search_items,e.search_term)}),P()];if(t instanceof _a)return[e,nT(100,new _a)];if(t instanceof uT)return[e.withFields({is_open:!1,is_focused:!1,hovered_item:new C}),P()];if(t instanceof Ow){let n=t[0],r=e.is_focused,i=e.is_open;if(r){if(n==="ArrowDown"&&r&&i)return[e.withFields({hovered_item:(()=>{let s=e.hovered_item,o=lg(e.found_items);if(s instanceof C)return new $(0);{let u=s[0],a=o;return new $(pc(u+1,a))}})()}),P()];if(n==="ArrowDown"&&r&&!i)return[e.withFields({is_open:!0}),P()];if(n==="ArrowUp"&&r&&i)return[e.withFields({hovered_item:(()=>{let s=e.hovered_item;if(s instanceof C)return new C;{let o=s[0];return new $(hc(0,o-1))}})()}),P()];if(n==="Enter"&&r){let s=e.hovered_item,o=e.is_open;if(s instanceof C&&!o)return[e.withFields({is_open:!0}),P()];if(s instanceof $&&o){let u=s[0];return[e.withFields({is_open:!1,hovered_item:new C}),Ht(a=>{let c=new Zf(fe(tT(e.found_items,u),""));return a(c)})]}else return[e,P()]}else return n==="Escape"&&r&&i?[e.withFields({is_open:!1,hovered_item:new C}),Ht(s=>{let o=new _a;return s(o)})]:[e,P()]}else return[e,P()]}else if(t instanceof $w){let n=t[0];return[e.withFields({hovered_item:new $(n)}),P()]}else return[e.withFields({hovered_item:new C}),P()]}}function pT(){return Ot(h([["recipe-titles",e=>{let t=e,n=pp(Le)(t);return J(n,r=>new vw(r))}],["search-term",e=>{let n=Le(e);return J(n,r=>new xw(r))}]]))}function km(e){let n=Le(e),r=J(n,Vt);return yg(r,i=>mc(i,s=>h([new er("a stringed int","something else",h([""]))])))}function hT(e,t,n){return Jg(h([Z("role","option"),Z("data-index",k(n)),_(_e(e.hovered_item,new $(n))?"bg-ecru-white-100":""),_("px-1"),Nr(new Zf(t)),dn("mouseover",r=>{let i=r,s=Ye("target",Ye("dataset",Ye("index",km)))(i);return J(s,o=>new $w(o))}),dn("mouseout",r=>{let i=r,s=Ye("target",Ye("dataset",Ye("index",km)))(i);return J(s,o=>new oT(o))})]),h([E(t)]))}function mT(e){return mt(h([Op(h([ye("meal-input-"+e.elem_id),vt(h([["field-sizing","content"],["overflow-x","hidden"],["width","100%"],["font-family","Charter, 'Bitstream Charter', 'Sitka Text', Cambria, serif"],["font-size","clamp(1.125rem, calc(1.125rem + ((1.25 - 1.125) * ((100vw - 20rem) / (96 - 20)))), 1.25rem)"],["line-height","1.6"],["color","rgb(47 40 27)"],["background-color","rgb(241 241 227)"],["border-width","0px"],["border-bottom-width","0px"],["padding-top","0px"],["padding-bottom","0px"],["line-height","inherit"],["resize","none"]])),_((()=>{let t=cn(e.search_term);return t>38?"text-base":t>17?"text-lg":"text-xl"})()),De(e.search_term),Z("autocapitalize","none"),Z("autocomplete","off"),Z("aria-autocomplete","list"),Z("role","combobox"),ct("meal-input"),lt(t=>new Sw(t)),dn("change",t=>{let n=t,r=Ye("target",Ye("value",Le))(n);return J(r,i=>new Yf(i))}),G$(t=>new Ow(t)),X$(new Tw),dn("blur",t=>new F(new _a))]),""),CO(h([ye("search-results-"+e.elem_id),_("font-mono bg-ecru-white-50 border border-ecru-white-950 text-xs"),Z("role","listbox"),vt(e.is_open?h([["display","block"]]):h([["display","none"]])),Z("aria-expanded",e.is_open?"true":"false")]),(()=>{let t=e.found_items,n=V(t,r=>r);return di(n,(r,i)=>hT(e,r,i))})())]))}function yT(){return RO(fT,dT,mT,pT())}function gT(e,t){const n=Number.isInteger(t);if(n&&Array.isArray(e)||e&&typeof e=="object"||Object.getPrototypeOf(e)===Object.prototype)return new F(e[t]);if(value instanceof Dict||value instanceof WeakMap||value instanceof Map){const r=map_get(value,name);return new F(r.isOk()?new Some(r[0]):new None)}return Object.getPrototypeOf(value)==Object.prototype?try_get_field(value,name,()=>new F(new None)):new z(n?"Indexable":"Dict")}class yn extends w{constructor(t){super(),this.continuation=t}}function dt(e){return new yn(t=>new F(e))}function Ru(e,t){return e.continuation(t)}function Mu(e,t){return new yn(n=>{let r=e.continuation(n);if(r.isOk()){let i=r[0],s=t(i);return Ru(s,n)}else{let i=r[0];return new z(i)}})}const et=new yn(Le),wT=new yn($g),va=new yn(fp);function bT(e){return new yn(pp(e.continuation))}function Ep(e,t){return new yn(bc(e.continuation,t.continuation))}function kt(e){return new yn(Ex(e.continuation))}function _T(e,t){let n=wc(t),r=dp(h([Le,s=>J(fp(s),k)])),i=(()=>{let s=r(n);return s.isOk()?s[0]:"<"+wu(n)+">"})();return V(e,s=>s.withFields({path:j(i,s.path)}))}function vT(e,t,n){let r=gT(n,e);if(r.isOk()){let i=r[0],s=t(i);if(s.isOk()){let o=s[0];return new F(o)}else{let o=s[0];return new z(_T(o,e))}}else{let i=r[0];return new z(h([new er(i,wu(n),h([]))]))}}function xT(e,t){return new yn(n=>cp(e,t.continuation,(i,s)=>o=>vT(s,i,o))(n))}function ST(e,t,n){return new yn(r=>{let i=e.continuation(r),s=Ru(xT(t,n),r);if(i.isOk()&&s.isOk()){let o=i[0],u=s[0];return new F(o(u))}else if(!i.isOk()&&!s.isOk()){let o=i[0],u=s[0];return new z(ap(o,u))}else if(s.isOk()){let o=i[0];return new z(o)}else{let o=s[0];return new z(o)}})}function he(e,t,n){return ST(e,h([t]),n)}function Rp(e){return new yn(t=>new z(h([new er(e,wu(t),h([]))])))}function OT(e){return Re(e)&&!Cn(e)&&!Nc(e)&&Symbol.asyncIterator in e}function Cn(e){return Array.isArray(e)}function Iw(e){return typeof e=="bigint"}function Mc(e){return typeof e=="boolean"}function Aw(e){return e instanceof globalThis.Date}function $T(e){return typeof e=="function"}function TT(e){return Re(e)&&!Cn(e)&&!Nc(e)&&Symbol.iterator in e}function IT(e){return e===null}function Fr(e){return typeof e=="number"}function Re(e){return typeof e=="object"&&e!==null}function AT(e){return e instanceof globalThis.RegExp}function Ie(e){return typeof e=="string"}function kT(e){return typeof e=="symbol"}function Nc(e){return e instanceof globalThis.Uint8Array}function be(e){return e===void 0}function PT(e){return e.map(t=>ja(t))}function ET(e){return new Date(e.getTime())}function RT(e){return new Uint8Array(e)}function MT(e){return new RegExp(e.source,e.flags)}function NT(e){const t={};for(const n of Object.getOwnPropertyNames(e))t[n]=ja(e[n]);for(const n of Object.getOwnPropertySymbols(e))t[n]=ja(e[n]);return t}function ja(e){return Cn(e)?PT(e):Aw(e)?ET(e):Nc(e)?RT(e):AT(e)?MT(e):Re(e)?NT(e):e}function FT(e){return ja(e)}function Nt(e){return e.map(t=>B(t))}function B(e,t={}){return{...FT(e),...t}}class Dt extends Error{constructor(t){super(t)}}const In=Symbol.for("TypeBox.Transform"),Fc=Symbol.for("TypeBox.Readonly"),Wr=Symbol.for("TypeBox.Optional"),jc=Symbol.for("TypeBox.Hint"),N=Symbol.for("TypeBox.Kind");function jT(e){return Re(e)&&e[Fc]==="Readonly"}function qs(e){return Re(e)&&e[Wr]==="Optional"}function CT(e){return G(e,"Any")}function Nu(e){return G(e,"Array")}function Mp(e){return G(e,"AsyncIterator")}function kw(e){return G(e,"BigInt")}function Pw(e){return G(e,"Boolean")}function Np(e){return G(e,"Constructor")}function DT(e){return G(e,"Date")}function Fp(e){return G(e,"Function")}function Cc(e){return G(e,"Integer")}function gn(e){return G(e,"Intersect")}function jp(e){return G(e,"Iterator")}function G(e,t){return Re(e)&&N in e&&e[N]===t}function Fu(e){return G(e,"Literal")}function Si(e){return G(e,"MappedKey")}function Lt(e){return G(e,"MappedResult")}function Dc(e){return G(e,"Never")}function LT(e){return G(e,"Not")}function BT(e){return G(e,"Null")}function Lc(e){return G(e,"Number")}function Dn(e){return G(e,"Object")}function Bc(e){return G(e,"Promise")}function Ew(e){return G(e,"Record")}function Rw(e){return G(e,"Ref")}function Mw(e){return G(e,"RegExp")}function Cp(e){return G(e,"String")}function UT(e){return G(e,"Symbol")}function Oi(e){return G(e,"TemplateLiteral")}function zT(e){return G(e,"This")}function Dp(e){return Re(e)&&In in e}function Js(e){return G(e,"Tuple")}function WT(e){return G(e,"Undefined")}function qe(e){return G(e,"Union")}function VT(e){return G(e,"Uint8Array")}function qT(e){return G(e,"Unknown")}function JT(e){return G(e,"Unsafe")}function KT(e){return G(e,"Void")}function QT(e){return Re(e)&&N in e&&Ie(e[N])}function mi(e){return CT(e)||Nu(e)||Pw(e)||kw(e)||Mp(e)||Np(e)||DT(e)||Fp(e)||Cc(e)||gn(e)||jp(e)||Fu(e)||Si(e)||Lt(e)||Dc(e)||LT(e)||BT(e)||Lc(e)||Dn(e)||Bc(e)||Ew(e)||Rw(e)||Mw(e)||Cp(e)||UT(e)||Oi(e)||zT(e)||Js(e)||WT(e)||qe(e)||VT(e)||qT(e)||JT(e)||KT(e)||QT(e)}const HT=["Any","Array","AsyncIterator","BigInt","Boolean","Constructor","Date","Enum","Function","Integer","Intersect","Iterator","Literal","MappedKey","MappedResult","Not","Null","Number","Object","Promise","Record","Ref","RegExp","String","Symbol","TemplateLiteral","This","Tuple","Undefined","Union","Uint8Array","Unknown","Void"];function Nw(e){try{return new RegExp(e),!0}catch{return!1}}function Lp(e){if(!Ie(e))return!1;for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if(n>=7&&n<=13||n===27||n===127)return!1}return!0}function Fw(e){return Bp(e)||Ve(e)}function oo(e){return be(e)||Iw(e)}function ue(e){return be(e)||Fr(e)}function Bp(e){return be(e)||Mc(e)}function re(e){return be(e)||Ie(e)}function GT(e){return be(e)||Ie(e)&&Lp(e)&&Nw(e)}function XT(e){return be(e)||Ie(e)&&Lp(e)}function jw(e){return be(e)||Ve(e)}function Ca(e){return Re(e)&&e[Wr]==="Optional"}function pn(e){return X(e,"Any")&&re(e.$id)}function $i(e){return X(e,"Array")&&e.type==="array"&&re(e.$id)&&Ve(e.items)&&ue(e.minItems)&&ue(e.maxItems)&&Bp(e.uniqueItems)&&jw(e.contains)&&ue(e.minContains)&&ue(e.maxContains)}function Up(e){return X(e,"AsyncIterator")&&e.type==="AsyncIterator"&&re(e.$id)&&Ve(e.items)}function Uc(e){return X(e,"BigInt")&&e.type==="bigint"&&re(e.$id)&&oo(e.exclusiveMaximum)&&oo(e.exclusiveMinimum)&&oo(e.maximum)&&oo(e.minimum)&&oo(e.multipleOf)}function Ti(e){return X(e,"Boolean")&&e.type==="boolean"&&re(e.$id)}function zc(e){return X(e,"Constructor")&&e.type==="Constructor"&&re(e.$id)&&Cn(e.parameters)&&e.parameters.every(t=>Ve(t))&&Ve(e.returns)}function Wc(e){return X(e,"Date")&&e.type==="Date"&&re(e.$id)&&ue(e.exclusiveMaximumTimestamp)&&ue(e.exclusiveMinimumTimestamp)&&ue(e.maximumTimestamp)&&ue(e.minimumTimestamp)&&ue(e.multipleOfTimestamp)}function Vc(e){return X(e,"Function")&&e.type==="Function"&&re(e.$id)&&Cn(e.parameters)&&e.parameters.every(t=>Ve(t))&&Ve(e.returns)}function fr(e){return X(e,"Integer")&&e.type==="integer"&&re(e.$id)&&ue(e.exclusiveMaximum)&&ue(e.exclusiveMinimum)&&ue(e.maximum)&&ue(e.minimum)&&ue(e.multipleOf)}function Cw(e){return Re(e)&&Object.entries(e).every(([t,n])=>Lp(t)&&Ve(n))}function Ii(e){return X(e,"Intersect")&&!(Ie(e.type)&&e.type!=="object")&&Cn(e.allOf)&&e.allOf.every(t=>Ve(t)&&!rI(t))&&re(e.type)&&(Bp(e.unevaluatedProperties)||jw(e.unevaluatedProperties))&&re(e.$id)}function zp(e){return X(e,"Iterator")&&e.type==="Iterator"&&re(e.$id)&&Ve(e.items)}function X(e,t){return Re(e)&&N in e&&e[N]===t}function Dw(e){return Vr(e)&&Ie(e.const)}function Lw(e){return Vr(e)&&Fr(e.const)}function Bw(e){return Vr(e)&&Mc(e.const)}function Vr(e){return X(e,"Literal")&&re(e.$id)&&YT(e.const)}function YT(e){return Mc(e)||Fr(e)||Ie(e)}function ZT(e){return X(e,"MappedKey")&&Cn(e.keys)&&e.keys.every(t=>Fr(t)||Ie(t))}function eI(e){return X(e,"MappedResult")&&Cw(e.properties)}function qr(e){return X(e,"Never")&&Re(e.not)&&Object.getOwnPropertyNames(e.not).length===0}function ls(e){return X(e,"Not")&&Ve(e.not)}function Wp(e){return X(e,"Null")&&e.type==="null"&&re(e.$id)}function St(e){return X(e,"Number")&&e.type==="number"&&re(e.$id)&&ue(e.exclusiveMaximum)&&ue(e.exclusiveMinimum)&&ue(e.maximum)&&ue(e.minimum)&&ue(e.multipleOf)}function ge(e){return X(e,"Object")&&e.type==="object"&&re(e.$id)&&Cw(e.properties)&&Fw(e.additionalProperties)&&ue(e.minProperties)&&ue(e.maxProperties)}function Vp(e){return X(e,"Promise")&&e.type==="Promise"&&re(e.$id)&&Ve(e.item)}function We(e){return X(e,"Record")&&e.type==="object"&&re(e.$id)&&Fw(e.additionalProperties)&&Re(e.patternProperties)&&(t=>{const n=Object.getOwnPropertyNames(t.patternProperties);return n.length===1&&Nw(n[0])&&Re(t.patternProperties)&&Ve(t.patternProperties[n[0]])})(e)}function tI(e){return X(e,"Ref")&&re(e.$id)&&Ie(e.$ref)}function Vo(e){return X(e,"RegExp")&&re(e.$id)&&Ie(e.source)&&Ie(e.flags)&&ue(e.maxLength)&&ue(e.minLength)}function hn(e){return X(e,"String")&&e.type==="string"&&re(e.$id)&&ue(e.minLength)&&ue(e.maxLength)&&GT(e.pattern)&&XT(e.format)}function qo(e){return X(e,"Symbol")&&e.type==="symbol"&&re(e.$id)}function Jo(e){return X(e,"TemplateLiteral")&&e.type==="string"&&Ie(e.pattern)&&e.pattern[0]==="^"&&e.pattern[e.pattern.length-1]==="$"}function nI(e){return X(e,"This")&&re(e.$id)&&Ie(e.$ref)}function rI(e){return Re(e)&&In in e}function qc(e){return X(e,"Tuple")&&e.type==="array"&&re(e.$id)&&Fr(e.minItems)&&Fr(e.maxItems)&&e.minItems===e.maxItems&&(be(e.items)&&be(e.additionalItems)&&e.minItems===0||Cn(e.items)&&e.items.every(t=>Ve(t)))}function yi(e){return X(e,"Undefined")&&e.type==="undefined"&&re(e.$id)}function cr(e){return X(e,"Union")&&re(e.$id)&&Re(e)&&Cn(e.anyOf)&&e.anyOf.every(t=>Ve(t))}function ju(e){return X(e,"Uint8Array")&&e.type==="Uint8Array"&&re(e.$id)&&ue(e.minByteLength)&&ue(e.maxByteLength)}function mn(e){return X(e,"Unknown")&&re(e.$id)}function iI(e){return X(e,"Unsafe")}function Jc(e){return X(e,"Void")&&e.type==="void"&&re(e.$id)}function sI(e){return Re(e)&&N in e&&Ie(e[N])&&!HT.includes(e[N])}function Ve(e){return Re(e)&&(pn(e)||$i(e)||Ti(e)||Uc(e)||Up(e)||zc(e)||Wc(e)||Vc(e)||fr(e)||Ii(e)||zp(e)||Vr(e)||ZT(e)||eI(e)||qr(e)||ls(e)||Wp(e)||St(e)||ge(e)||Vp(e)||We(e)||tI(e)||Vo(e)||hn(e)||qo(e)||Jo(e)||nI(e)||qc(e)||yi(e)||cr(e)||ju(e)||mn(e)||iI(e)||Jc(e)||sI(e))}const oI="(true|false)",xa="(0|[1-9][0-9]*)",Uw="(.*)",Ko=`^${xa}$`,Da=`^${Uw}$`,qp=new Map;function zw(e){return qp.has(e)}function uI(e,t){qp.set(e,t)}function aI(e){return qp.get(e)}const Jp=new Map;function Kp(e){return Jp.has(e)}function cI(e,t){Jp.set(e,t)}function lI(e){return Jp.get(e)}function fI(e,t){return e.includes(t)}function dI(e){return[...new Set(e)]}function pI(e,t){return e.filter(n=>t.includes(n))}function hI(e,t){return e.reduce((n,r)=>pI(n,r),t)}function mI(e){return e.length===1?e[0]:e.length>1?hI(e.slice(1),e[0]):[]}function yI(e){const t=[];for(const n of e)t.push(...n);return t}function Qo(e={}){return{...e,[N]:"Any"}}function Ww(e,t={}){return{...t,[N]:"Array",type:"array",items:B(e)}}function Vw(e,t={}){return{...t,[N]:"AsyncIterator",type:"AsyncIterator",items:B(e)}}function gI(e,t){const{[t]:n,...r}=e;return r}function Xt(e,t){return t.reduce((n,r)=>gI(n,r),e)}function It(e={}){return{...e,[N]:"Never",not:{}}}function Je(e){return{[N]:"MappedResult",properties:e}}function qw(e,t,n){return{...n,[N]:"Constructor",type:"Constructor",parameters:Nt(e),returns:B(t)}}function Kc(e,t,n){return{...n,[N]:"Function",type:"Function",parameters:Nt(e),returns:B(t)}}function ed(e,t){return{...t,[N]:"Union",anyOf:Nt(e)}}function wI(e){return e.some(t=>qs(t))}function Pm(e){return e.map(t=>qs(t)?bI(t):t)}function bI(e){return Xt(e,[Wr])}function _I(e,t){return wI(e)?ki(ed(Pm(e),t)):ed(Pm(e),t)}function Ks(e,t={}){return e.length===0?It(t):e.length===1?B(e[0],t):_I(e,t)}function gt(e,t={}){return e.length===0?It(t):e.length===1?B(e[0],t):ed(e,t)}class Em extends Dt{}function vI(e){return e.replace(/\\\$/g,"$").replace(/\\\*/g,"*").replace(/\\\^/g,"^").replace(/\\\|/g,"|").replace(/\\\(/g,"(").replace(/\\\)/g,")")}function Qp(e,t,n){return e[t]===n&&e.charCodeAt(t-1)!==92}function Zn(e,t){return Qp(e,t,"(")}function Ho(e,t){return Qp(e,t,")")}function Jw(e,t){return Qp(e,t,"|")}function xI(e){if(!(Zn(e,0)&&Ho(e,e.length-1)))return!1;let t=0;for(let n=0;n<e.length;n++)if(Zn(e,n)&&(t+=1),Ho(e,n)&&(t-=1),t===0&&n!==e.length-1)return!1;return!0}function SI(e){return e.slice(1,e.length-1)}function OI(e){let t=0;for(let n=0;n<e.length;n++)if(Zn(e,n)&&(t+=1),Ho(e,n)&&(t-=1),Jw(e,n)&&t===0)return!0;return!1}function $I(e){for(let t=0;t<e.length;t++)if(Zn(e,t))return!0;return!1}function TI(e){let[t,n]=[0,0];const r=[];for(let s=0;s<e.length;s++)if(Zn(e,s)&&(t+=1),Ho(e,s)&&(t-=1),Jw(e,s)&&t===0){const o=e.slice(n,s);o.length>0&&r.push(fs(o)),n=s+1}const i=e.slice(n);return i.length>0&&r.push(fs(i)),r.length===0?{type:"const",const:""}:r.length===1?r[0]:{type:"or",expr:r}}function II(e){function t(i,s){if(!Zn(i,s))throw new Em("TemplateLiteralParser: Index must point to open parens");let o=0;for(let u=s;u<i.length;u++)if(Zn(i,u)&&(o+=1),Ho(i,u)&&(o-=1),o===0)return[s,u];throw new Em("TemplateLiteralParser: Unclosed group parens in expression")}function n(i,s){for(let o=s;o<i.length;o++)if(Zn(i,o))return[s,o];return[s,i.length]}const r=[];for(let i=0;i<e.length;i++)if(Zn(e,i)){const[s,o]=t(e,i),u=e.slice(s,o+1);r.push(fs(u)),i=o}else{const[s,o]=n(e,i),u=e.slice(s,o);u.length>0&&r.push(fs(u)),i=o-1}return r.length===0?{type:"const",const:""}:r.length===1?r[0]:{type:"and",expr:r}}function fs(e){return xI(e)?fs(SI(e)):OI(e)?TI(e):$I(e)?II(e):{type:"const",const:vI(e)}}function Hp(e){return fs(e.slice(1,e.length-1))}class AI extends Dt{}function kI(e){return e.type==="or"&&e.expr.length===2&&e.expr[0].type==="const"&&e.expr[0].const==="0"&&e.expr[1].type==="const"&&e.expr[1].const==="[1-9][0-9]*"}function PI(e){return e.type==="or"&&e.expr.length===2&&e.expr[0].type==="const"&&e.expr[0].const==="true"&&e.expr[1].type==="const"&&e.expr[1].const==="false"}function EI(e){return e.type==="const"&&e.const===".*"}function Go(e){return kI(e)||EI(e)?!1:PI(e)?!0:e.type==="and"?e.expr.every(t=>Go(t)):e.type==="or"?e.expr.every(t=>Go(t)):e.type==="const"?!0:(()=>{throw new AI("Unknown expression type")})()}function RI(e){const t=Hp(e.pattern);return Go(t)}class MI extends Dt{}function*Kw(e){if(e.length===1)return yield*e[0];for(const t of e[0])for(const n of Kw(e.slice(1)))yield`${t}${n}`}function*NI(e){return yield*Kw(e.expr.map(t=>[...Qc(t)]))}function*FI(e){for(const t of e.expr)yield*Qc(t)}function*jI(e){return yield e.const}function*Qc(e){return e.type==="and"?yield*NI(e):e.type==="or"?yield*FI(e):e.type==="const"?yield*jI(e):(()=>{throw new MI("Unknown expression")})()}function Qw(e){const t=Hp(e.pattern);return Go(t)?[...Qc(t)]:[]}function ve(e,t={}){return{...t,[N]:"Literal",const:e,type:typeof e}}function Hw(e={}){return{...e,[N]:"Boolean",type:"boolean"}}function Gp(e={}){return{...e,[N]:"BigInt",type:"bigint"}}function Qs(e={}){return{...e,[N]:"Number",type:"number"}}function jr(e={}){return{...e,[N]:"String",type:"string"}}function*CI(e){const t=e.trim().replace(/"|'/g,"");return t==="boolean"?yield Hw():t==="number"?yield Qs():t==="bigint"?yield Gp():t==="string"?yield jr():yield(()=>{const n=t.split("|").map(r=>ve(r.trim()));return n.length===0?It():n.length===1?n[0]:Ks(n)})()}function*DI(e){if(e[1]!=="{"){const t=ve("$"),n=td(e.slice(1));return yield*[t,...n]}for(let t=2;t<e.length;t++)if(e[t]==="}"){const n=CI(e.slice(2,t)),r=td(e.slice(t+1));return yield*[...n,...r]}yield ve(e)}function*td(e){for(let t=0;t<e.length;t++)if(e[t]==="$"){const n=ve(e.slice(0,t)),r=DI(e.slice(t));return yield*[n,...r]}yield ve(e)}function LI(e){return[...td(e)]}class BI extends Dt{}function UI(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Gw(e,t){return Oi(e)?e.pattern.slice(1,e.pattern.length-1):qe(e)?`(${e.anyOf.map(n=>Gw(n,t)).join("|")})`:Lc(e)?`${t}${xa}`:Cc(e)?`${t}${xa}`:kw(e)?`${t}${xa}`:Cp(e)?`${t}${Uw}`:Fu(e)?`${t}${UI(e.const.toString())}`:Pw(e)?`${t}${oI}`:(()=>{throw new BI(`Unexpected Kind '${e[N]}'`)})()}function Rm(e){return`^${e.map(t=>Gw(t,"")).join("")}$`}function La(e){const n=Qw(e).map(r=>ve(r));return Ks(n)}function Xw(e,t={}){const n=Ie(e)?Rm(LI(e)):Rm(e);return{...t,[N]:"TemplateLiteral",type:"string",pattern:n}}function zI(e){return Qw(e).map(n=>n.toString())}function WI(e){const t=[];for(const n of e)t.push(...Jr(n));return t}function VI(e){return[e.toString()]}function Jr(e){return[...new Set(Oi(e)?zI(e):qe(e)?WI(e.anyOf):Fu(e)?VI(e.const):Lc(e)?["[number]"]:Cc(e)?["[number]"]:[])]}function qI(e,t,n){const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=Xp(e,Jr(t[i]),n);return r}function JI(e,t,n){return qI(e,t.properties,n)}function KI(e,t,n){const r=JI(e,t,n);return Je(r)}function Yw(e,t){return e.map(n=>Zw(n,t))}function QI(e){return e.filter(t=>!Dc(t))}function HI(e,t){return ib(QI(Yw(e,t)))}function GI(e){return e.some(t=>Dc(t))?[]:e}function XI(e,t){return Ks(GI(Yw(e,t)))}function YI(e,t){return t in e?e[t]:t==="[number]"?Ks(e):It()}function ZI(e,t){return t==="[number]"?e:It()}function eA(e,t){return t in e?e[t]:It()}function Zw(e,t){return gn(e)?HI(e.allOf,t):qe(e)?XI(e.anyOf,t):Js(e)?YI(e.items??[],t):Nu(e)?ZI(e.items,t):Dn(e)?eA(e.properties,t):It()}function eb(e,t){return t.map(n=>Zw(e,n))}function Mm(e,t){return Ks(eb(e,t))}function Xp(e,t,n={}){return Lt(t)?B(KI(e,t,n)):Si(t)?B(iA(e,t,n)):mi(t)?B(Mm(e,Jr(t)),n):B(Mm(e,t),n)}function tA(e,t,n){return{[t]:Xp(e,[t],n)}}function nA(e,t,n){return t.reduce((r,i)=>({...r,...tA(e,i,n)}),{})}function rA(e,t,n){return nA(e,t.keys,n)}function iA(e,t,n){const r=rA(e,t,n);return Je(r)}function tb(e,t={}){return{...t,[N]:"Iterator",type:"Iterator",items:B(e)}}function sA(e,t={}){const n=globalThis.Object.getOwnPropertyNames(e),r=n.filter(u=>qs(e[u])),i=n.filter(u=>!r.includes(u)),s=mi(t.additionalProperties)?{additionalProperties:B(t.additionalProperties)}:{},o={};for(const u of n)o[u]=B(e[u]);return i.length>0?{...t,...s,[N]:"Object",type:"object",properties:o,required:i}:{...t,...s,[N]:"Object",type:"object",properties:o}}const Ne=sA;function nb(e,t={}){return{...t,[N]:"Promise",type:"Promise",item:B(e)}}function oA(e){return Xt(B(e),[Fc])}function uA(e){return{...B(e),[Fc]:"Readonly"}}function aA(e,t){return t===!1?oA(e):uA(e)}function Ai(e,t){const n=t??!0;return Lt(e)?fA(e,n):aA(e,n)}function cA(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ai(e[r],t);return n}function lA(e,t){return cA(e.properties,t)}function fA(e,t){const n=lA(e,t);return Je(n)}function Cu(e,t={}){const[n,r,i]=[!1,e.length,e.length];return e.length>0?{...t,[N]:"Tuple",type:"array",items:Nt(e),additionalItems:n,minItems:r,maxItems:i}:{...t,[N]:"Tuple",type:"array",minItems:r,maxItems:i}}function rb(e,t){return e in t?Bt(e,t[e]):Je(t)}function dA(e){return{[e]:ve(e)}}function pA(e){const t={};for(const n of e)t[n]=ve(n);return t}function hA(e,t){return fI(t,e)?dA(e):pA(t)}function mA(e,t){const n=hA(e,t);return rb(e,n)}function uo(e,t){return t.map(n=>Bt(e,n))}function yA(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(t))n[r]=Bt(e,t[r]);return n}function Bt(e,t){return qs(t)?ki(Bt(e,Xt(t,[Wr]))):jT(t)?Ai(Bt(e,Xt(t,[Fc]))):Lt(t)?rb(e,t.properties):Si(t)?mA(e,t.keys):Np(t)?qw(uo(e,t.parameters),Bt(e,t.returns)):Fp(t)?Kc(uo(e,t.parameters),Bt(e,t.returns)):Mp(t)?Vw(Bt(e,t.items)):jp(t)?tb(Bt(e,t.items)):gn(t)?Pi(uo(e,t.allOf)):qe(t)?gt(uo(e,t.anyOf)):Js(t)?Cu(uo(e,t.items??[])):Dn(t)?Ne(yA(e,t.properties)):Nu(t)?Ww(Bt(e,t.items)):Bc(t)?nb(Bt(e,t.item)):t}function gA(e,t){const n={};for(const r of e)n[r]=Bt(r,t);return n}function wA(e,t,n={}){const r=mi(e)?Jr(e):e,i=t({[N]:"MappedKey",keys:r}),s=gA(r,i);return B(Ne(s),n)}function bA(e){return Xt(B(e),[Wr])}function _A(e){return{...B(e),[Wr]:"Optional"}}function vA(e,t){return t===!1?bA(e):_A(e)}function ki(e,t){const n=t??!0;return Lt(e)?OA(e,n):vA(e,n)}function xA(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=ki(e[r],t);return n}function SA(e,t){return xA(e.properties,t)}function OA(e,t){const n=SA(e,t);return Je(n)}function nd(e,t){const n=e.every(i=>Dn(i)),r=mi(t.unevaluatedProperties)?{unevaluatedProperties:B(t.unevaluatedProperties)}:{};return t.unevaluatedProperties===!1||mi(t.unevaluatedProperties)||n?{...t,...r,[N]:"Intersect",type:"object",allOf:Nt(e)}:{...t,...r,[N]:"Intersect",allOf:Nt(e)}}function $A(e){return e.every(t=>qs(t))}function TA(e){return Xt(e,[Wr])}function Nm(e){return e.map(t=>qs(t)?TA(t):t)}function IA(e,t){return $A(e)?ki(nd(Nm(e),t)):nd(Nm(e),t)}function ib(e,t={}){if(e.length===0)return It(t);if(e.length===1)return B(e[0],t);if(e.some(n=>Dp(n)))throw new Error("Cannot intersect transform types");return IA(e,t)}function Pi(e,t={}){if(e.length===0)return It(t);if(e.length===1)return B(e[0],t);if(e.some(n=>Dp(n)))throw new Error("Cannot intersect transform types");return nd(e,t)}function sb(e){return e.map(t=>Yp(t))}function AA(e){return Pi(sb(e))}function kA(e){return gt(sb(e))}function PA(e){return Yp(e)}function Yp(e){return gn(e)?AA(e.allOf):qe(e)?kA(e.anyOf):Bc(e)?PA(e.item):e}function EA(e,t={}){return B(Yp(e),t)}function ob(e){const t=[];for(const n of e)t.push(Hc(n));return t}function RA(e){const t=ob(e);return yI(t)}function MA(e){const t=ob(e);return mI(t)}function NA(e){return e.map((t,n)=>n.toString())}function FA(e){return["[number]"]}function jA(e){return globalThis.Object.getOwnPropertyNames(e)}function CA(e){return rd?globalThis.Object.getOwnPropertyNames(e).map(n=>n[0]==="^"&&n[n.length-1]==="$"?n.slice(1,n.length-1):n):[]}function Hc(e){return gn(e)?RA(e.allOf):qe(e)?MA(e.anyOf):Js(e)?NA(e.items??[]):Nu(e)?FA(e.items):Dn(e)?jA(e.properties):Ew(e)?CA(e.patternProperties):[]}let rd=!1;function Fm(e){rd=!0;const t=Hc(e);return rd=!1,`^(${t.map(r=>`(${r})`).join("|")})$`}function DA(e){return e.map(t=>t==="[number]"?Qs():ve(t))}function ub(e,t={}){if(Lt(e))return UA(e,t);{const n=Hc(e),r=DA(n),i=Ks(r);return B(i,t)}}function LA(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=ub(e[r],t);return n}function BA(e,t){return LA(e.properties,t)}function UA(e,t){const n=BA(e,t);return Je(n)}function zA(e){const t=[];for(const n of e)t.push(...Hc(n));return dI(t)}function WA(e){return e.filter(t=>!Dc(t))}function VA(e,t){const n=[];for(const r of e)n.push(...eb(r,[t]));return WA(n)}function qA(e,t){const n={};for(const r of t)n[r]=ib(VA(e,r));return n}function JA(e,t={}){const n=zA(e),r=qA(e,n);return Ne(r,t)}function ab(e={}){return{...e,[N]:"Date",type:"Date"}}function cb(e={}){return{...e,[N]:"Null",type:"null"}}function lb(e){return{...e,[N]:"Symbol",type:"symbol"}}function fb(e={}){return{...e,[N]:"Undefined",type:"undefined"}}function db(e={}){return{...e,[N]:"Uint8Array",type:"Uint8Array"}}function Du(e={}){return{...e,[N]:"Unknown"}}function KA(e){return e.map(t=>Zp(t,!1))}function QA(e){const t={};for(const n of globalThis.Object.getOwnPropertyNames(e))t[n]=Ai(Zp(e[n],!1));return t}function oa(e,t){return t===!0?e:Ai(e)}function Zp(e,t){return OT(e)||TT(e)?oa(Qo(),t):Cn(e)?Ai(Cu(KA(e))):Nc(e)?db():Aw(e)?ab():Re(e)?oa(Ne(QA(e)),t):$T(e)?oa(Kc([],Du()),t):be(e)?fb():IT(e)?cb():kT(e)?lb():Iw(e)?Gp():Fr(e)||Mc(e)||Ie(e)?ve(e):Ne({})}function HA(e,t={}){return B(Zp(e,!0),t)}function GA(e,t={}){return Cu(Nt(e.parameters),{...t})}function Lu(e,t){return e.map(n=>Ln(n,t))}function XA(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ln(e[r],t);return n}function YA(e,t){return e.parameters=Lu(e.parameters,t),e.returns=Ln(e.returns,t),e}function ZA(e,t){return e.parameters=Lu(e.parameters,t),e.returns=Ln(e.returns,t),e}function ek(e,t){return e.allOf=Lu(e.allOf,t),e}function tk(e,t){return e.anyOf=Lu(e.anyOf,t),e}function nk(e,t){return be(e.items)||(e.items=Lu(e.items,t)),e}function rk(e,t){return e.items=Ln(e.items,t),e}function ik(e,t){return e.properties=XA(e.properties,t),e}function sk(e,t){return e.item=Ln(e.item,t),e}function ok(e,t){return e.items=Ln(e.items,t),e}function uk(e,t){return e.items=Ln(e.items,t),e}function ak(e,t){const n=t.find(i=>i.$id===e.$ref);if(n===void 0)throw Error(`Unable to dereference schema with $id ${e.$ref}`);const r=Xt(n,["$id"]);return Ln(r,t)}function ck(e,t){return Np(e)?YA(e,t):Fp(e)?ZA(e,t):gn(e)?ek(e,t):qe(e)?tk(e,t):Js(e)?nk(e,t):Nu(e)?rk(e,t):Dn(e)?ik(e,t):Bc(e)?sk(e,t):Mp(e)?ok(e,t):jp(e)?uk(e,t):Rw(e)?ak(e,t):e}function Ln(e,t){return ck(B(e),Nt(t))}function lk(e,t={}){if(be(e))throw new Error("Enum undefined or empty");const n=globalThis.Object.getOwnPropertyNames(e).filter(s=>isNaN(s)).map(s=>e[s]),i=[...new Set(n)].map(s=>ve(s));return gt(i,{...t,[jc]:"Enum"})}class fk extends Dt{}var T;(function(e){e[e.Union=0]="Union",e[e.True=1]="True",e[e.False=2]="False"})(T||(T={}));function Yt(e){return e===T.False?e:T.True}function Hs(e){throw new fk(e)}function Ae(e){return qr(e)||Ii(e)||cr(e)||mn(e)||pn(e)}function ke(e,t){return qr(t)?mb():Ii(t)?Gc(e,t):cr(t)?th(e,t):mn(t)?bb():pn(t)?eh():Hs("StructuralRight")}function eh(e,t){return T.True}function dk(e,t){return Ii(t)?Gc(e,t):cr(t)&&t.anyOf.some(n=>pn(n)||mn(n))?T.True:cr(t)?T.Union:mn(t)||pn(t)?T.True:T.Union}function pk(e,t){return mn(e)?T.False:pn(e)?T.Union:qr(e)?T.True:T.False}function hk(e,t){return ge(t)&&Xc(t)?T.True:Ae(t)?ke(e,t):$i(t)?Yt(ne(e.items,t.items)):T.False}function mk(e,t){return Ae(t)?ke(e,t):Up(t)?Yt(ne(e.items,t.items)):T.False}function yk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):Uc(t)?T.True:T.False}function pb(e,t){return Bw(e)||Ti(e)?T.True:T.False}function gk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):Ti(t)?T.True:T.False}function wk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):zc(t)?e.parameters.length>t.parameters.length?T.False:e.parameters.every((n,r)=>Yt(ne(t.parameters[r],n))===T.True)?Yt(ne(e.returns,t.returns)):T.False:T.False}function bk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):Wc(t)?T.True:T.False}function _k(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):Vc(t)?e.parameters.length>t.parameters.length?T.False:e.parameters.every((n,r)=>Yt(ne(t.parameters[r],n))===T.True)?Yt(ne(e.returns,t.returns)):T.False:T.False}function hb(e,t){return Vr(e)&&Fr(e.const)||St(e)||fr(e)?T.True:T.False}function vk(e,t){return fr(t)||St(t)?T.True:Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):T.False}function Gc(e,t){return t.allOf.every(n=>ne(e,n)===T.True)?T.True:T.False}function xk(e,t){return e.allOf.some(n=>ne(n,t)===T.True)?T.True:T.False}function Sk(e,t){return Ae(t)?ke(e,t):zp(t)?Yt(ne(e.items,t.items)):T.False}function Ok(e,t){return Vr(t)&&t.const===e.const?T.True:Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):hn(t)?wb(e):St(t)?yb(e):fr(t)?hb(e):Ti(t)?pb(e):T.False}function mb(e,t){return T.False}function $k(e,t){return T.True}function jm(e){let[t,n]=[e,0];for(;ls(t);)t=t.not,n+=1;return n%2===0?t:Du()}function Tk(e,t){return ls(e)?ne(jm(e),t):ls(t)?ne(e,jm(t)):Hs("Invalid fallthrough for Not")}function Ik(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):Wp(t)?T.True:T.False}function yb(e,t){return Lw(e)||St(e)||fr(e)?T.True:T.False}function Ak(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):fr(t)||St(t)?T.True:T.False}function Tt(e,t){return Object.getOwnPropertyNames(e.properties).length===t}function Cm(e){return Xc(e)}function Dm(e){return Tt(e,0)||Tt(e,1)&&"description"in e.properties&&cr(e.properties.description)&&e.properties.description.anyOf.length===2&&(hn(e.properties.description.anyOf[0])&&yi(e.properties.description.anyOf[1])||hn(e.properties.description.anyOf[1])&&yi(e.properties.description.anyOf[0]))}function cf(e){return Tt(e,0)}function Lm(e){return Tt(e,0)}function kk(e){return Tt(e,0)}function Pk(e){return Tt(e,0)}function Ek(e){return Xc(e)}function Rk(e){const t=Qs();return Tt(e,0)||Tt(e,1)&&"length"in e.properties&&Yt(ne(e.properties.length,t))===T.True}function Mk(e){return Tt(e,0)}function Xc(e){const t=Qs();return Tt(e,0)||Tt(e,1)&&"length"in e.properties&&Yt(ne(e.properties.length,t))===T.True}function Nk(e){const t=Kc([Qo()],Qo());return Tt(e,0)||Tt(e,1)&&"then"in e.properties&&Yt(ne(e.properties.then,t))===T.True}function gb(e,t){return ne(e,t)===T.False||Ca(e)&&!Ca(t)?T.False:T.True}function ut(e,t){return mn(e)?T.False:pn(e)?T.Union:qr(e)||Dw(e)&&Cm(t)||Lw(e)&&cf(t)||Bw(e)&&Lm(t)||qo(e)&&Dm(t)||Uc(e)&&kk(t)||hn(e)&&Cm(t)||qo(e)&&Dm(t)||St(e)&&cf(t)||fr(e)&&cf(t)||Ti(e)&&Lm(t)||ju(e)&&Ek(t)||Wc(e)&&Pk(t)||zc(e)&&Mk(t)||Vc(e)&&Rk(t)?T.True:We(e)&&hn(id(e))?t[jc]==="Record"?T.True:T.False:We(e)&&St(id(e))?Tt(t,0)?T.True:T.False:T.False}function Fk(e,t){return Ae(t)?ke(e,t):We(t)?Zt(e,t):ge(t)?(()=>{for(const n of Object.getOwnPropertyNames(t.properties)){if(!(n in e.properties)&&!Ca(t.properties[n]))return T.False;if(Ca(t.properties[n]))return T.True;if(gb(e.properties[n],t.properties[n])===T.False)return T.False}return T.True})():T.False}function jk(e,t){return Ae(t)?ke(e,t):ge(t)&&Nk(t)?T.True:Vp(t)?Yt(ne(e.item,t.item)):T.False}function id(e){return Ko in e.patternProperties?Qs():Da in e.patternProperties?jr():Hs("Unknown record key pattern")}function sd(e){return Ko in e.patternProperties?e.patternProperties[Ko]:Da in e.patternProperties?e.patternProperties[Da]:Hs("Unable to get record value schema")}function Zt(e,t){const[n,r]=[id(t),sd(t)];return Dw(e)&&St(n)&&Yt(ne(e,r))===T.True?T.True:ju(e)&&St(n)||hn(e)&&St(n)||$i(e)&&St(n)?ne(e,r):ge(e)?(()=>{for(const i of Object.getOwnPropertyNames(e.properties))if(gb(r,e.properties[i])===T.False)return T.False;return T.True})():T.False}function Ck(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?ne(sd(e),sd(t)):T.False}function Dk(e,t){const n=Vo(e)?jr():e,r=Vo(t)?jr():t;return ne(n,r)}function wb(e,t){return Vr(e)&&Ie(e.const)||hn(e)?T.True:T.False}function Lk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):hn(t)?T.True:T.False}function Bk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):qo(t)?T.True:T.False}function Uk(e,t){return Jo(e)?ne(La(e),t):Jo(t)?ne(e,La(t)):Hs("Invalid fallthrough for TemplateLiteral")}function zk(e,t){return $i(t)&&e.items!==void 0&&e.items.every(n=>ne(n,t.items)===T.True)}function Wk(e,t){return qr(e)?T.True:mn(e)?T.False:pn(e)?T.Union:T.False}function Vk(e,t){return Ae(t)?ke(e,t):ge(t)&&Xc(t)||$i(t)&&zk(e,t)?T.True:qc(t)?be(e.items)&&!be(t.items)||!be(e.items)&&be(t.items)?T.False:be(e.items)&&!be(t.items)||e.items.every((n,r)=>ne(n,t.items[r])===T.True)?T.True:T.False:T.False}function qk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):ju(t)?T.True:T.False}function Jk(e,t){return Ae(t)?ke(e,t):ge(t)?ut(e,t):We(t)?Zt(e,t):Jc(t)?Hk(e):yi(t)?T.True:T.False}function th(e,t){return t.anyOf.some(n=>ne(e,n)===T.True)?T.True:T.False}function Kk(e,t){return e.anyOf.every(n=>ne(n,t)===T.True)?T.True:T.False}function bb(e,t){return T.True}function Qk(e,t){return qr(t)?mb():Ii(t)?Gc(e,t):cr(t)?th(e,t):pn(t)?eh():hn(t)?wb(e):St(t)?yb(e):fr(t)?hb(e):Ti(t)?pb(e):$i(t)?pk(e):qc(t)?Wk(e):ge(t)?ut(e,t):mn(t)?T.True:T.False}function Hk(e,t){return yi(e)||yi(e)?T.True:T.False}function Gk(e,t){return Ii(t)?Gc(e,t):cr(t)?th(e,t):mn(t)?bb():pn(t)?eh():ge(t)?ut(e,t):Jc(t)?T.True:T.False}function ne(e,t){return Jo(e)||Jo(t)?Uk(e,t):Vo(e)||Vo(t)?Dk(e,t):ls(e)||ls(t)?Tk(e,t):pn(e)?dk(e,t):$i(e)?hk(e,t):Uc(e)?yk(e,t):Ti(e)?gk(e,t):Up(e)?mk(e,t):zc(e)?wk(e,t):Wc(e)?bk(e,t):Vc(e)?_k(e,t):fr(e)?vk(e,t):Ii(e)?xk(e,t):zp(e)?Sk(e,t):Vr(e)?Ok(e,t):qr(e)?$k():Wp(e)?Ik(e,t):St(e)?Ak(e,t):ge(e)?Fk(e,t):We(e)?Ck(e,t):hn(e)?Lk(e,t):qo(e)?Bk(e,t):qc(e)?Vk(e,t):Vp(e)?jk(e,t):ju(e)?qk(e,t):yi(e)?Jk(e,t):cr(e)?Kk(e,t):mn(e)?Qk(e,t):Jc(e)?Gk(e,t):Hs(`Unknown left type operand '${e[N]}'`)}function Bu(e,t){return ne(e,t)}function Xk(e,t,n,r,i){const s={};for(const o of globalThis.Object.getOwnPropertyNames(e))s[o]=nh(e[o],t,n,r,i);return s}function Yk(e,t,n,r,i){return Xk(e.properties,t,n,r,i)}function Zk(e,t,n,r,i){const s=Yk(e,t,n,r,i);return Je(s)}function eP(e,t,n,r){const i=Bu(e,t);return i===T.Union?gt([n,r]):i===T.True?n:r}function nh(e,t,n,r,i={}){return Lt(e)?Zk(e,t,n,r,i):Si(e)?B(iP(e,t,n,r,i)):B(eP(e,t,n,r),i)}function tP(e,t,n,r,i){return{[e]:nh(ve(e),t,n,r,i)}}function nP(e,t,n,r,i){return e.reduce((s,o)=>({...s,...tP(o,t,n,r,i)}),{})}function rP(e,t,n,r,i){return nP(e.keys,t,n,r,i)}function iP(e,t,n,r,i){const s=rP(e,t,n,r,i);return Je(s)}function sP(e){return e.allOf.every(t=>Yc(t))}function oP(e){return e.anyOf.some(t=>Yc(t))}function uP(e){return!Yc(e.not)}function Yc(e){return e[N]==="Intersect"?sP(e):e[N]==="Union"?oP(e):e[N]==="Not"?uP(e):e[N]==="Undefined"}function aP(e,t){return rh(La(e),t)}function cP(e,t){const n=e.filter(r=>Bu(r,t)===T.False);return n.length===1?n[0]:gt(n)}function rh(e,t,n={}){return Oi(e)?B(aP(e,t),n):Lt(e)?B(dP(e,t),n):B(qe(e)?cP(e.anyOf,t):Bu(e,t)!==T.False?It():e,n)}function lP(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=rh(e[r],t);return n}function fP(e,t){return lP(e.properties,t)}function dP(e,t){const n=fP(e,t);return Je(n)}function pP(e,t){return ih(La(e),t)}function hP(e,t){const n=e.filter(r=>Bu(r,t)!==T.False);return n.length===1?n[0]:gt(n)}function ih(e,t,n={}){return Oi(e)?B(pP(e,t),n):Lt(e)?B(gP(e,t),n):B(qe(e)?hP(e.anyOf,t):Bu(e,t)!==T.False?e:It(),n)}function mP(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=ih(e[r],t);return n}function yP(e,t){return mP(e.properties,t)}function gP(e,t){const n=yP(e,t);return Je(n)}function wP(e,t={}){return B(e.returns,t)}function bP(e={}){return{...e,[N]:"Integer",type:"integer"}}function _P(e,t,n){return{[e]:Gs(ve(e),t,n)}}function vP(e,t,n){return e.reduce((r,i)=>({...r,..._P(i,t,n)}),{})}function xP(e,t,n){return vP(e.keys,t,n)}function SP(e,t,n){const r=xP(e,t,n);return Je(r)}function OP(e){const[t,n]=[e.slice(0,1),e.slice(1)];return[t.toLowerCase(),n].join("")}function $P(e){const[t,n]=[e.slice(0,1),e.slice(1)];return[t.toUpperCase(),n].join("")}function TP(e){return e.toUpperCase()}function IP(e){return e.toLowerCase()}function AP(e,t,n){const r=Hp(e.pattern);if(!Go(r))return{...e,pattern:_b(e.pattern,t)};const o=[...Qc(r)].map(c=>ve(c)),u=vb(o,t),a=gt(u);return Xw([a],n)}function _b(e,t){return typeof e=="string"?t==="Uncapitalize"?OP(e):t==="Capitalize"?$P(e):t==="Uppercase"?TP(e):t==="Lowercase"?IP(e):e:e.toString()}function vb(e,t){return e.map(n=>Gs(n,t))}function Gs(e,t,n={}){return Si(e)?SP(e,t,n):Oi(e)?AP(e,t,e):qe(e)?gt(vb(e.anyOf,t),n):Fu(e)?ve(_b(e.const,t),n):e}function kP(e,t={}){return Gs(e,"Capitalize",t)}function PP(e,t={}){return Gs(e,"Lowercase",t)}function EP(e,t={}){return Gs(e,"Uncapitalize",t)}function RP(e,t={}){return Gs(e,"Uppercase",t)}function MP(e,t){return{...t,[N]:"Not",not:B(e)}}function NP(e,t,n){const r={};for(const i of globalThis.Object.getOwnPropertyNames(e))r[i]=oh(e[i],t,n);return r}function FP(e,t,n){return NP(e.properties,t,n)}function jP(e,t,n){const r=FP(e,t,n);return Je(r)}function CP(e,t){return e.map(n=>sh(n,t))}function DP(e,t){return e.map(n=>sh(n,t))}function LP(e,t){const{[t]:n,...r}=e;return r}function BP(e,t){return t.reduce((n,r)=>LP(n,r),e)}function sh(e,t){return gn(e)?Pi(CP(e.allOf,t)):qe(e)?gt(DP(e.anyOf,t)):Dn(e)?Ne(BP(e.properties,t)):Ne({})}function oh(e,t,n={}){if(Si(t))return VP(e,t,n);if(Lt(e))return jP(e,t,n);const r=mi(t)?Jr(t):t,i=Xt(e,[In,"$id","required"]),s=B(sh(e,r),n);return{...i,...s}}function UP(e,t,n){return{[t]:oh(e,[t],n)}}function zP(e,t,n){return t.reduce((r,i)=>({...r,...UP(e,i,n)}),{})}function WP(e,t,n){return zP(e,t.keys,n)}function VP(e,t,n){const r=WP(e,t,n);return Je(r)}function qP(e,t={}){return Cu(Nt(e.parameters),{...t})}function Bm(e){return e.map(t=>xb(t))}function JP(e){const t={};for(const n of globalThis.Object.getOwnPropertyNames(e))t[n]=ki(e[n]);return t}function xb(e){return gn(e)?Pi(Bm(e.allOf)):qe(e)?gt(Bm(e.anyOf)):Dn(e)?Ne(JP(e.properties)):Ne({})}function Sb(e,t={}){if(Lt(e))return HP(e,t);const n=Xt(e,[In,"$id","required"]),r=B(xb(e),t);return{...n,...r}}function KP(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Sb(e[r],t);return n}function QP(e,t){return KP(e.properties,t)}function HP(e,t){const n=QP(e,t);return Je(n)}function GP(e,t,n){const r={};for(const i of globalThis.Object.getOwnPropertyNames(e))r[i]=ah(e[i],t,n);return r}function XP(e,t,n){return GP(e.properties,t,n)}function YP(e,t,n){const r=XP(e,t,n);return Je(r)}function ZP(e,t){return e.map(n=>uh(n,t))}function eE(e,t){return e.map(n=>uh(n,t))}function tE(e,t){const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}function uh(e,t){return gn(e)?Pi(ZP(e.allOf,t)):qe(e)?gt(eE(e.anyOf,t)):Dn(e)?Ne(tE(e.properties,t)):Ne({})}function ah(e,t,n={}){if(Si(t))return sE(e,t,n);if(Lt(e))return YP(e,t,n);const r=mi(t)?Jr(t):t,i=Xt(e,[In,"$id","required"]),s=B(uh(e,r),n);return{...i,...s}}function nE(e,t,n){return{[t]:ah(e,[t],n)}}function rE(e,t,n){return t.reduce((r,i)=>({...r,...nE(e,i,n)}),{})}function iE(e,t,n){return rE(e,t.keys,n)}function sE(e,t,n){const r=iE(e,t,n);return Je(r)}function oE(e){return Ai(ki(e))}function Uu(e,t,n){return{...n,[N]:"Record",type:"object",patternProperties:{[e]:B(t)}}}function ch(e,t,n){const r={};for(const i of e)r[i]=B(t);return Ne(r,{...n,[jc]:"Record"})}function uE(e,t,n){return RI(e)?ch(Jr(e),t,n):Uu(e.pattern,t,n)}function aE(e,t,n){return ch(Jr(gt(e)),t,n)}function cE(e,t,n){return ch([e.toString()],t,n)}function lE(e,t,n){return Uu(e.source,t,n)}function fE(e,t,n){const r=be(e.pattern)?Da:e.pattern;return Uu(r,t,n)}function dE(e,t,n){return Uu(Ko,t,n)}function pE(e,t,n){return Uu(Ko,t,n)}function hE(e,t,n={}){return qe(e)?aE(e.anyOf,t,n):Oi(e)?uE(e,t,n):Fu(e)?cE(e.const,t,n):Cc(e)?dE(e,t,n):Lc(e)?pE(e,t,n):Mw(e)?lE(e,t,n):Cp(e)?fE(e,t,n):It(n)}let mE=0;function yE(e,t={}){be(t.$id)&&(t.$id=`T${mE++}`);const n=e({[N]:"This",$ref:`${t.$id}`});return n.$id=t.$id,B({...t,[jc]:"Recursive",...n})}function gE(e,t={}){if(Ie(e))return{...t,[N]:"Ref",$ref:e};if(be(e.$id))throw new Error("Reference target type must specify an $id");return{...t,[N]:"Ref",$ref:e.$id}}function wE(e,t={}){const n=Ie(e)?new globalThis.RegExp(e):e;return{...t,[N]:"RegExp",type:"RegExp",source:n.source,flags:n.flags}}function Um(e){return e.map(t=>Ob(t))}function bE(e){const t={};for(const n of globalThis.Object.getOwnPropertyNames(e))t[n]=Xt(e[n],[Wr]);return t}function Ob(e){return gn(e)?Pi(Um(e.allOf)):qe(e)?gt(Um(e.anyOf)):Dn(e)?Ne(bE(e.properties)):Ne({})}function $b(e,t={}){if(Lt(e))return xE(e,t);{const n=Xt(e,[In,"$id","required"]),r=B(Ob(e),t);return{...n,...r}}}function _E(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=$b(e[r],t);return n}function vE(e,t){return _E(e.properties,t)}function xE(e,t){const n=vE(e,t);return Je(n)}function SE(e){return gn(e)?Nt(e.allOf):qe(e)?Nt(e.anyOf):Js(e)?Nt(e.items??[]):[]}function OE(e){return Nt(SE(e))}function $E(e,t={}){return B(e.returns,t)}function TE(e){return JSON.parse(JSON.stringify(e))}class IE{constructor(t){this.schema=t}Decode(t){return new AE(this.schema,t)}}class AE{constructor(t,n){this.schema=t,this.decode=n}EncodeTransform(t,n){const s={Encode:o=>n[In].Encode(t(o)),Decode:o=>this.decode(n[In].Decode(o))};return{...n,[In]:s}}EncodeSchema(t,n){const r={Decode:this.decode,Encode:t};return{...n,[In]:r}}Encode(t){const n=B(this.schema);return Dp(n)?this.EncodeTransform(t,n):this.EncodeSchema(t,n)}}function kE(e){return new IE(e)}function Tb(e={}){return{...e,[N]:e[N]??"Unsafe"}}function PE(e={}){return{...e,[N]:"Void",type:"void"}}const EE=Object.freeze(Object.defineProperty({__proto__:null,Any:Qo,Array:Ww,AsyncIterator:Vw,Awaited:EA,BigInt:Gp,Boolean:Hw,Capitalize:kP,Composite:JA,Const:HA,Constructor:qw,ConstructorParameters:GA,Date:ab,Deref:Ln,Enum:lk,Exclude:rh,Extends:nh,Extract:ih,Function:Kc,Index:Xp,InstanceType:wP,Integer:bP,Intersect:Pi,Iterator:tb,KeyOf:ub,Literal:ve,Lowercase:PP,Mapped:wA,Never:It,Not:MP,Null:cb,Number:Qs,Object:Ne,Omit:oh,Optional:ki,Parameters:qP,Partial:Sb,Pick:ah,Promise:nb,Readonly:Ai,ReadonlyOptional:oE,Record:hE,Recursive:yE,Ref:gE,RegExp:wE,Required:$b,Rest:OE,ReturnType:$E,Strict:TE,String:jr,Symbol:lb,TemplateLiteral:Xw,Transform:kE,Tuple:Cu,Uint8Array:db,Uncapitalize:EP,Undefined:fb,Union:gt,Unknown:Du,Unsafe:Tb,Uppercase:RP,Void:PE},Symbol.toStringTag,{value:"Module"})),Oe=EE,Zc=["string","number","boolean","date"],lh=["set"],RE=["record"];[...Zc,...lh,...RE];const ME=Oe.Object({func:Oe.String(),args:Oe.Optional(Oe.Union([Oe.Array(Oe.Any()),Oe.Null()]))}),NE=Oe.Object({nullable:Oe.Optional(Oe.Boolean()),default:Oe.Optional(Oe.Union([Oe.String(),Oe.Number(),Oe.Boolean(),Oe.Null(),ME]))}),L={Success:200,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,Conflict:409,"Too Many Requests":429,"Internal Server Error":500,"Service Unavailable":503,"Gateway Timeout":504};class R extends Error{constructor(n,...r){super(...r);I(this,"status",L["Internal Server Error"]);I(this,"baseMessage");I(this,"contextMessage");I(this,"__isTriplitError",!0);this.name="TriplitError",this.baseMessage=r[0]||"Triplit Error",this.contextMessage=n}get message(){return this.contextMessage?`${this.baseMessage} | Context: ${this.contextMessage}`:this.baseMessage}toString(){return JSON.stringify(this.toJSON())}toJSON(){return{name:this.name,message:this.baseMessage,status:this.status,contextMessage:this.contextMessage}}static fromJson(n){const r=new R(n.contextMessage);return n.baseMessage&&(r.baseMessage=n.baseMessage),n.name&&(r.name=n.name),n.status&&(r.status=n.status),r}}class Ba extends R{constructor(t,...n){super(...n),this.name="InvalidCollectionNameError",this.baseMessage=`${t} is not a valid collection name.`,this.status=L["Bad Request"]}}class zm extends R{constructor(...t){super(...t),this.name="InvalidInsertDocumentError",this.baseMessage="The document you are attempting to insert is invalid.",this.status=L["Bad Request"]}}class FE extends R{constructor(t,...n){super(...n),this.name="InvalidInternalEntityIdError",this.baseMessage=`${t} is not a valid internal entity id.`,this.status=L["Internal Server Error"]}}class jE extends R{constructor(...t){super(...t),this.name="DBScanFailureError",this.baseMessage="DB scan failed.",this.status=L["Internal Server Error"]}}class CE extends R{constructor(...t){super(...t),this.name="InvalidTimestampIndexScanError",this.baseMessage="The scan over the timestamp index you are attempting is invalid.",this.status=L["Bad Request"]}}class DE extends R{constructor(t,...n){super(...n),this.name="IndexNotFoundError",this.baseMessage=`${t} is not a valid index.`,this.status=L["Bad Request"]}}class LE extends R{constructor(t,n,...r){super(...r),this.name="EntityNotFoundError",this.baseMessage=`Could not find entity with id ${t} in collection ${n}.`,this.status=L["Not Found"]}}class Sa extends R{constructor(...t){super(...t),this.name="InvalidFilterError",this.baseMessage="Your query passed a filter that is invalid.",this.status=L["Bad Request"]}}class Wm extends R{constructor(t,...n){super(...n),this.name="SessionVariableNotFoundError",this.baseMessage=`${t} could not be found in the provided variables for this query.`,this.status=L["Bad Request"]}}class Ib extends R{constructor(...t){super(...t),this.name="InvalidOperationError",this.baseMessage="You are attempting to perform an operation that is not valid.",this.status=L["Bad Request"]}}class BE extends R{constructor(t,n,r,...i){super(...i),this.name="ValueSchemaMismatchError",this.baseMessage=`Cannot assign ${r} to '${n.join(".")}' because it does not match the schema for ${t}.`,this.status=L["Bad Request"]}}class UE extends R{constructor(...t){super(...t),this.name="NoSchemaRegisteredError",this.baseMessage="No schema was availabe when one was expected to be.",this.status=L["Internal Server Error"]}}class To extends R{constructor(t,n,...r){super(...r),this.name="CollectionNotFoundError",this.baseMessage=`Could not find a collection with name ${t} in your schema. Valid collections are: [${Object.keys(n).map(i=>`'${i}'`).join(", ")}].`,this.status=L["Bad Request"]}}class Vm extends R{constructor(t,...n){super(...n),this.name="InvalidEntityIdError",this.baseMessage=`${t} is not a valid entity id.`,this.status=L["Bad Request"]}}class zE extends R{constructor(t,...n){super(...n),this.name="InvalidSetTypeError",this.baseMessage=`When constructing the schema, an invalid type for the items in a set was recieved. A set may only be of type ${lh}. You passed '${t}'.`,this.status=L["Bad Request"]}}class qt extends R{constructor(t,...n){super(...n),this.name="InvalidSchemaPathError",this.baseMessage=`The path '${t.join(".")}' is not a valid path in the schema.`,this.status=L["Bad Request"]}}class WE extends R{constructor(t,n,...r){super(...r),this.name="RelationDoesNotExistError",this.baseMessage=`The attribute '${t}' does not exist in the schema for the '${n}' collection.`,this.status=L["Bad Request"]}}class VE extends R{constructor(t,n,...r){super(...r),this.name="IncludedNonRelationError",this.baseMessage=`The attribute '${t}' in the '${n}' can not be used in the 'include' clause as it is not a relation.`,this.status=L["Bad Request"]}}class el extends R{constructor(t,...n){super(...n),this.name="InvalidTypeOptionsError",this.baseMessage=`Received ${JSON.stringify(t)}`,this.status=L["Bad Request"]}}class qE extends R{constructor(...t){super(...t),this.name="InvalidMigrationOperationError",this.baseMessage="Invalid migration operation.",this.status=L["Bad Request"]}}class Ab extends R{constructor(...t){super(...t),this.name="WriteRuleError",this.baseMessage="Write failed because it didn't pass a Rule.",this.status=L.Unauthorized}}class JE extends R{constructor(t,n,r,i,...s){super(...s),this.name="WritePermissionError",this.baseMessage=`Write to collection '${t}' with id '${n}' is not permitted. Failed operation: ${r}. Session roles: [${i.map(o=>o.key).join(", ")}].`,this.status=L.Unauthorized}}class KE extends R{constructor(t,n,...r){super(...r),this.name="UnrecognizedPropertyInUpdateError",this.baseMessage=`Cannot set unrecognized property ${t} to ${String(n)} during an entity update. The property may not be defined in your schema.`,this.status=L["Bad Request"]}}class QE extends R{constructor(...t){super(...t),this.name="TypeJSONParseError",this.baseMessage="Failed to parse this type from a JSON form.",this.status=L["Internal Server Error"]}}class HE extends R{constructor(t,...n){super(...n),this.name="UnrecognizedAttributeTypeError",this.baseMessage=`An attribute in the schema contains an unsupported type: ${t}. Valid types are ${[Zc,...lh,"query"]}`,this.status=L["Bad Request"]}}class qm extends R{constructor(t,...n){super(...n),this.name="InvalidTripleStoreValueError",this.baseMessage=`Cannot store value ${String(t)} in the triple store.`,this.status=L["Bad Request"]}}class GE extends R{constructor(...t){super(...t),this.name="QueryCacheError",this.baseMessage="An error ocurred inside the query cache",this.status=L["Bad Request"]}}class XE extends R{constructor(t,...n){super(...n),this.name="UnserializableValueError",this.baseMessage=`Cannot serialize value ${String(t)} for insertion into the database.`,this.status=L["Bad Request"]}}class Jm extends R{constructor(...t){super(...t),this.name="TripleStoreOptionsError",this.baseMessage="There was an error in the configuration of the triple store.",this.status=L["Bad Request"]}}class lf extends R{constructor(t,n,...r){super(...r),this.name="QueryClauseFormattingError",this.baseMessage=`The ${t} clause is not formatted correctly.
    
    Received: ${JSON.stringify(n)}`,this.status=L["Bad Request"]}}class YE extends R{constructor(...t){super(...t),this.name="AfterClauseWithNoOrderError",this.baseMessage="The 'after' clause must be used after an 'order' clause.",this.status=L["Bad Request"]}}class Km extends R{constructor(...t){super(...t),this.name="DBOptionsError",this.baseMessage="There was an error in the configuration of the Triplit database.",this.status=L["Bad Request"]}}class Xs extends R{constructor(t,n,...r){super(...r),this.name="DBSerializationError",this.baseMessage=`When inserting or updating an entity, there was an error serializing the data: ${n} as type: ${t}`,this.status=L["Bad Request"]}}class ZE extends R{constructor(...t){super(...t),this.name="InvalidAttributeOptionsError",this.baseMessage="The options for an attribute in the schema are invalid.",this.status=L["Bad Request"]}}class kb extends R{constructor(...t){super(...t),this.name="NotImplementedError",this.baseMessage="This feature is not yet implemented.",this.status=L["Bad Request"]}}class Ys extends R{constructor(t,n,...r){super(...r),this.name="JSONValueParseError",this.baseMessage=`Failed to parse a ${t} value from the provided JSON input: ${JSON.stringify(n)}`,this.status=L["Bad Request"]}}class eR extends R{constructor(t,n,...r){super(...r),this.name="JSToJSONValueParseError",this.baseMessage=`Failed to tranform to JSON from the provided ${t} input: ${JSON.stringify(n)}`,this.status=L["Bad Request"]}}class ff extends R{constructor(t,...n){super(...n),this.name="InvalidQueryCardinalityError",this.baseMessage=`The cardinality ${t} is not valid for the query type.`,this.status=L["Bad Request"]}}class tR extends R{constructor(...t){super(...t),this.name="InvalidOrderClauseError",this.baseMessage="An order clause has been determined to be invalid.",this.status=L["Bad Request"]}}class nR extends R{constructor(...t){super(...t),this.name="InvalidWhereClauseError",this.baseMessage="A where clause has been determined to be invalid.",this.status=L["Bad Request"]}}class rR extends R{constructor(...t){super(...t),this.name="InvalidSelectClauseError",this.baseMessage="The select clause of this query has been determined to be invalid.",this.status=L["Bad Request"]}}class iR extends R{constructor(...t){super(...t),this.name="QueryNotPreparedError",this.baseMessage="The query has not been prepared yet. This indicates a bug. Please inform the Triplit team.",this.status=L["Internal Server Error"]}}function sR(e){return new Map(Array.from(e).map(t=>[oR(t),!0]))}function tl(e,t=[]){if(e===null||typeof e!="object")return[[t,e]];if(Object.keys(e).length===0)return[[t,"{}"]];if(Array.isArray(e))return[[t,e]];const n=[];t.length&&n.push([t,"{}"]);const r=Object.keys(e).flatMap(i=>tl(e[i],[...t,i]));for(const i of r)n.push(i);return n}function ji(e,t=[]){if(e==null||typeof e!="object")return[[...t,e]];if(e instanceof Date)return[[...t,e.toISOString()]];if(e instanceof Map)return[...e.entries()].flatMap(([n,r])=>ji(r,[...t,n]));if(e instanceof Set){const n=sR(e);return n.size===0?ji(new Map([["_",!1]]),t):ji(n,t)}return e instanceof Array?e.flatMap((n,r)=>ji(n,[...t,r])):Object.keys(e).flatMap(n=>ji(e[n],[...t,n]))}function oR(e){if(e==null||typeof e!="object")return e;if(e instanceof Date)return e.toISOString();throw new XE(e)}function Pb(e){const t={};for(const[n,r,i]of e)t[n]||(t[n]={}),r.reduce((s,o,u)=>u===r.length-1?(s[o]=i,s):(s[o]||(s[o]=typeof r[u+1]=="number"?[]:{}),s[o]),t[n]);return t}function Ua(e){return Object.entries(e).reduce((t,[n,r])=>(t[n]=[...r],t),{})}function pt(e,t){if(typeof e!="object"||e===null)return e;if(uR(e))return pt(e[0]);if(e instanceof Array)return e.map(i=>pt(i)).filter(i=>!!t||i!==void 0);if(e instanceof Map)return new Map(Array.from(e.entries()).map(([i,s])=>[i,pt(s)]));const n=Object.entries(e).map(([i,s])=>[i,pt(s)]).filter(([i,s])=>!!t||s!==void 0);return Object.fromEntries(n)}function uR(e){return e instanceof Array&&e.length===2&&e[1]instanceof Array&&e[1].length===2}function Pn(e,t){return!e&&!t?0:e?t?e[0]!==t[0]?e[0]<t[0]?-1:1:e[1]!==t[1]?e[1]<t[1]?-1:1:0:1:-1}var M=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Eb(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var df={},nl={},gi={};Object.defineProperty(gi,"__esModule",{value:!0});gi.getWrittenTuples=gi.iterateWrittenTuples=void 0;function*Rb(e){for(const{key:t}of e.set||[])yield t;for(const t of e.remove||[])yield t}gi.iterateWrittenTuples=Rb;function aR(e){return Array.from(Rb(e))}gi.getWrittenTuples=aR;var Ei={},cR=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))};function Mb(e,t,n){var r=function(s){return e.apply(void 0,cR([s],Array.from(t),!1))},i=n??e.lazy;return i===void 0?r:Object.assign(r,{lazy:i,lazyArgs:t})}function O(e,t,n){var r=e.length-t.length;if(r===0)return e.apply(void 0,Array.from(t));if(r===1)return Mb(e,t,n);throw new Error("Wrong number of arguments")}function lR(){return O(fR,arguments)}function fR(e,t){return e+t}var za=function(){return za=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},za.apply(this,arguments)};function dR(){return O(pR,arguments)}function pR(e,t,n){var r;return za(za({},e),(r={},r[t]=n,r))}function hR(){return O(mR,arguments)}function mR(e,t){return t.every(function(n){return n(e)})}function yR(){return O(gR,arguments)}function gR(e,t){return t.some(function(n){return n(e)})}var Qm=15;function fh(e){return function(t,n){if(n===0)return e(t);if(!Number.isInteger(n))throw new TypeError("precision must be an integer: ".concat(n));if(n>Qm||n<-Qm)throw new RangeError("precision must be between -15 and 15");if(Number.isNaN(t)||!Number.isFinite(t))return e(t);var r=Math.pow(10,n);return e(t*r)/r}}function wR(){return O(fh(Math.ceil),arguments)}function bR(){return O(_R,arguments)}function _R(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function vR(){return O(xR,arguments)}function xR(e,t){var n=t.min,r=t.max;return n!==void 0&&e<n?n:r!==void 0&&e>r?r:e}function Nb(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}function SR(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))}function Fb(e,t,n,r){function i(s){for(var o=t.length,u=0;u<o;){if(e===t[u])return n[u];u+=1}t[u+1]=e,n[u+1]=s;for(var a in e)s[a]=Fb(e[a],t,n);return s}switch(Nb(e)){case"Object":return i({});case"Array":return i([]);case"Date":return new Date(e.valueOf());case"RegExp":return SR(e);default:return e}}function OR(e){return e!=null&&typeof e.clone=="function"?e.clone():Fb(e,[],[])}function jb(e){return!!e}function $R(e){return e.filter(jb)}function TR(){return O(IR,arguments)}function IR(e,t){return e.concat(t)}var AR=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))};function kR(e,t,n){var r=Array.from(n);return e(n[0])?function(i){return t.apply(void 0,AR([i],r,!1))}:t.apply(void 0,r)}function od(){return kR(ER,PR,arguments)}function PR(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var s=i[r],o=s[0],u=s[1];if(o(e))return u(e)}throw new Error("conditional: data failed for all cases")}function ER(e){if(!Array.isArray(e))return!1;var t=e,n=t[0],r=t[1],i=t.slice(2);return typeof n=="function"&&n.length<=1&&typeof r=="function"&&r.length<=1&&i.length===0}(function(e){function t(n){return n===void 0&&(n=MR),[RR,n]}e.defaultCase=t})(od||(od={}));var RR=function(){return!0},MR=function(){};function NR(e){return function(){return e}}var Cb=function(e){return function(t,n){for(var r=0,i=0;i<t.length;i++){var s=t[i],o=e?n(s,i,t):n(s);r+=o?1:0}return r}};function ud(){return O(Cb(!1),arguments)}(function(e){function t(){return O(Cb(!0),arguments)}e.indexed=t})(ud||(ud={}));function dh(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];for(var i=e,s=n.map(function(g){return"lazy"in g?FR(g):void 0}),o=0;o<n.length;){var u=s[o];if(u===void 0||!jR(i)){var a=n[o];i=a(i),o+=1;continue}for(var c=[],l=o;l<n.length;l++){var f=s[l];if(f===void 0||(c.push(f),f.isSingle))break}for(var p=[],d=i[Symbol.iterator]();;){var m=d.next();if((t=m.done)!==null&&t!==void 0&&t)break;var y=Db(m.value,p,c);if(y)break}var b=c[c.length-1].isSingle;i=b?p[0]:p,o+=c.length}return i}function Db(e,t,n){var r;if(n.length===0)return t.push(e),!1;for(var i=e,s={done:!1,hasNext:!1},o=!1,u=0;u<n.length;u++){var a=n[u],c=a.isIndexed,l=a.index,f=a.items;if(f.push(i),s=c?a(i,l,f):a(i),a.index+=1,s.hasNext){if((r=s.hasMany)!==null&&r!==void 0&&r){for(var p=0,d=s.next;p<d.length;p++){var m=d[p],y=Db(m,t,n.slice(u+1));if(y)return!0}return!1}i=s.next}if(!s.hasNext)break;s.done&&(o=!0)}return s.hasNext&&t.push(i),!!o}function FR(e){var t=e.lazy,n=e.lazyArgs,r=t.apply(void 0,n??[]);return Object.assign(r,{isIndexed:t.indexed,isSingle:t.single,index:0,items:[]})}function jR(e){return typeof e=="string"||typeof e=="object"&&e!==null&&Symbol.iterator in e}var CR=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))};function DR(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(n){return dh.apply(void 0,CR([n],e,!1))}}function LR(e,t){var n=t.waitMs,r=t.timing,i=r===void 0?"trailing":r,s=t.maxWaitMs;if(s!==void 0&&n!==void 0&&s<n)throw new Error("debounce: maxWaitMs (".concat(s,") cannot be less than waitMs (").concat(n,")"));var o,u,a,c,l=function(){if(a!==void 0){if(u!==void 0){var d=u;u=void 0,clearTimeout(d)}var m=a;a=void 0,c=e.apply(void 0,m)}},f=function(){if(o!==void 0){var d=o;o=void 0,clearTimeout(d),a!==void 0&&l()}},p=function(d){a=d,s!==void 0&&u===void 0&&(u=setTimeout(l,s))};return{call:function(){for(var d,m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];if(o===void 0)i==="trailing"?p(m):c=e.apply(void 0,m);else{i!=="leading"&&p(m);var b=o;o=void 0,clearTimeout(b)}return o=setTimeout(f,(d=n??s)!==null&&d!==void 0?d:0),c},cancel:function(){if(o!==void 0){var d=o;o=void 0,clearTimeout(d)}if(u!==void 0){var d=u;u=void 0,clearTimeout(d)}a=void 0},flush:function(){return f(),c},get isPending(){return o!==void 0},get cachedValue(){return c}}}function xe(e,t,n){n===void 0&&(n=!1);for(var r=[],i=0;i<e.length;i++){var s=e[i],o=n?t(s,i,e):t(s);if(o.hasMany===!0?r.push.apply(r,o.next):o.hasNext&&r.push(o.next),o.done)break}return r}var BR={done:!0,hasNext:!1},UR=function(){return BR},zR=function(e){return{hasNext:!0,next:e,done:!1}};function Xo(){return O(WR,arguments,Xo.lazy)}function WR(e,t){var n=Xo.lazy(t);return xe(e,n)}(function(e){function t(r){var i=new Set(r);return function(s){return i.has(s)?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:s}}}e.lazy=t;function n(){return O(VR,arguments,Lb)}e.multiset=n})(Xo||(Xo={}));var VR=function(e,t){return xe(e,Lb(t))};function Lb(e){var t;if(e.length===0)return zR;for(var n=new Map,r=0,i=e;r<i.length;r++){var s=i[r];n.set(s,((t=n.get(s))!==null&&t!==void 0?t:0)+1)}return function(o){var u=n.get(o);return u===void 0||u===0?{done:!1,hasNext:!0,next:o}:(n.set(o,u-1),{done:!1,hasNext:!1})}}function Yo(){return O(qR,arguments,Yo.lazy)}function qR(e,t,n){var r=Yo.lazy(t,n);return xe(e,r)}(function(e){e.lazy=function(t,n){return function(r){return t.every(function(i){return!n(r,i)})?{done:!1,hasNext:!0,next:r}:{done:!1,hasNext:!1}}}})(Yo||(Yo={}));function JR(){return O(KR,arguments)}function KR(e,t){return e/t}function QR(){return HR}function HR(){}function Zo(){return O(GR,arguments,Zo.lazy)}function GR(e,t){return xe(e,Zo.lazy(t))}(function(e){function t(n){var r=n;return function(i){return r>0?(r-=1,{done:!1,hasNext:!1}):{done:!1,hasNext:!0,next:i}}}e.lazy=t})(Zo||(Zo={}));function ad(e,t,n){var r;r=[e[n],e[t]],e[t]=r[0],e[n]=r[1]}function eu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return O(XR,e)}var XR=function(e,t){return e.length>=t};function Bb(e,t){for(var n=Math.floor(e.length/2)-1;n>=0;n--)zb(e,n,t)}function Ub(e,t,n){if(eu(e,1)){var r=e[0];if(!(t(n,r)>=0))return e[0]=n,zb(e,0,t),r}}function zb(e,t,n){for(var r=t;r*2+1<e.length;){var i=r*2+1,s=n(e[r],e[i])<0?i:r,o=i+1;if(o<e.length&&n(e[s],e[o])<0&&(s=o),s===r)return;ad(e,r,s),r=s}}var Ui=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},Wb={asc:function(e,t){return e>t},desc:function(e,t){return e<t}};function ph(e,t){var n=Array.isArray(t)?t:Array.from(t),r=n[0],i=n.slice(1);if(!Vb(r)){var s=cd.apply(void 0,i);return e(r,s)}var o=cd.apply(void 0,Ui([r],i,!1));return function(u){return e(u,o)}}function rl(e,t){var n=Array.from(t),r=n[0],i=n[1],s=n.slice(2),o,u;return Vb(i)?(o=r,u=Ui([i],s,!0)):(o=i,u=Ui([r],s,!0)),ph(function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return e.apply(void 0,Ui(Ui([],a,!1),[o],!1))},u)}function cd(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=typeof e=="function"?e:e[0],s=typeof e=="function"?"asc":e[1],o=Wb,u=s,a=o[u],c=t===void 0?void 0:cd.apply(void 0,Ui([t],n,!1));return function(l,f){var p,d=i(l),m=i(f);return a(d,m)?1:a(m,d)?-1:(p=c==null?void 0:c(l,f))!==null&&p!==void 0?p:0}}function Vb(e){if(Hm(e))return!0;if(typeof e!="object"||!Array.isArray(e))return!1;var t=e,n=t[0],r=t[1],i=t.slice(2);return Hm(n)&&typeof r=="string"&&r in Wb&&i.length===0}var Hm=function(e){return typeof e=="function"&&e.length===1};function YR(){return rl(ZR,arguments)}function ZR(e,t,n){if(n>=e.length)return[];if(n<=0)return e.slice();var r=e.slice(0,n);Bb(r,t);for(var i=[],s=e.slice(n),o=0,u=s;o<u.length;o++){var a=u[o],c=Ub(r,t,a);i.push(c??a)}return i}function eM(){return O(tM,arguments)}function tM(e,t){var n=e.slice();return t>0&&n.splice(-t),n}function nM(){return O(rM,arguments)}function rM(e,t){for(var n=e.length-1;n>=0;n--)if(!t(e[n]))return e.slice(0,n+1);return[]}function iM(){return O(sM,arguments)}function sM(e,t){for(var n=0;n<e.length;n++)if(!t(e[n]))return e.slice(n);return[]}function ld(){return O(Object.entries,arguments)}(function(e){e.strict=e})(ld||(ld={}));function oM(){return O(fd,arguments)}function fd(e,t){if(e===t)return!0;if(typeof e=="number"&&typeof t=="number")return e!==e&&t!==t;if(typeof e!="object"||typeof t!="object"||e===null||t===null)return!1;var n=Array.isArray(e),r=Array.isArray(t);if(n&&r){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!fd(e[i],t[i]))return!1;return!0}if(n!==r)return!1;var s=e instanceof Date,o=t instanceof Date;if(s&&o)return e.getTime()===t.getTime();if(s!==o)return!1;var u=e instanceof RegExp,a=t instanceof RegExp;if(u&&a)return e.toString()===t.toString();if(u!==a)return!1;var c=Object.keys(e);if(c.length!==Object.keys(t).length)return!1;for(var l=0,f=c;l<f.length;l++){var p=f[l];if(!Object.prototype.hasOwnProperty.call(t,p)||!fd(e[p],t[p]))return!1}return!0}function ds(){return O(Object.entries,arguments)}(function(e){e.strict=e})(ds||(ds={}));var dd=function(){return dd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},dd.apply(this,arguments)};function uM(){return O(qb,arguments)}function qb(e,t){if(typeof e!="object"||e===null)return e;for(var n=dd({},e),r=0,i=ds.strict(t);r<i.length;r++){var s=i[r],o=s[0],u=s[1];o in n&&(n[o]=typeof u=="function"?u(n[o]):qb(n[o],u))}return n}var dr=function(e){return Object.assign(e,{indexed:!0})};function ps(){return O(Jb(!1),arguments,ps.lazy)}var Jb=function(e){return function(t,n){return xe(t,e?ps.lazyIndexed(n):ps.lazy(n),e)}},Gm=function(e){return function(t){return function(n,r,i){return(e?t(n,r,i):t(n))?{done:!1,hasNext:!0,next:n}:{done:!1,hasNext:!1}}}};(function(e){function t(){return O(Jb(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=Gm(!1),e.lazyIndexed=dr(Gm(!0))})(ps||(ps={}));var Wa=function(e){return Object.assign(e,{single:!0})};function Va(){return O(Kb(!1),arguments,Va.lazy)}var Kb=function(e){return function(t,n){return t.find(function(r,i,s){return e?n(r,i,s):n(r)})}},Xm=function(e){return function(t){return function(n,r,i){return(e?t(n,r,i):t(n))?{done:!0,hasNext:!0,next:n}:{done:!1,hasNext:!1}}}};(function(e){function t(){return O(Kb(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=Wa(Xm(!1)),e.lazyIndexed=Wa(dr(Xm(!0)))})(Va||(Va={}));function qa(){return O(Qb(!1),arguments,qa.lazy)}var Qb=function(e){return function(t,n){return t.findIndex(function(r,i,s){return e?n(r,i,s):n(r)})}},Ym=function(e){return function(t){var n=0;return function(r,i,s){return(e?t(r,i,s):t(r))?{done:!0,hasNext:!0,next:n}:(n+=1,{done:!1,hasNext:!1})}}};(function(e){function t(){return O(Qb(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=Wa(Ym(!1)),e.lazyIndexed=Wa(dr(Ym(!0)))})(qa||(qa={}));function pd(){return O(Hb(!1),arguments)}var Hb=function(e){return function(t,n){for(var r=t.length-1;r>=0;r--)if(e?n(t[r],r,t):n(t[r]))return t[r]}};(function(e){function t(){return O(Hb(!0),arguments)}e.indexed=t})(pd||(pd={}));function hd(){return O(Gb(!1),arguments)}var Gb=function(e){return function(t,n){for(var r=t.length-1;r>=0;r--)if(e?n(t[r],r,t):n(t[r]))return r;return-1}};(function(e){function t(){return O(Gb(!0),arguments)}e.indexed=t})(hd||(hd={}));function Ja(){return O(aM,arguments,Ja.lazy)}function aM(e){var t=e[0];return t}(function(e){function t(){return function(n){return{done:!0,hasNext:!0,next:n}}}e.lazy=t,function(n){n.single=!0}(t=e.lazy||(e.lazy={}))})(Ja||(Ja={}));function cM(){return ph(lM,arguments)}function lM(e,t){if(!eu(e,2))return e[0];for(var n=e[0],r=e.slice(1),i=0,s=r;i<s.length;i++){var o=s[i];t(o,n)<0&&(n=o)}return n}var Xb=1;function fM(e,t){return typeof e=="object"?Ka(e,t):Mb(Ka,arguments,dM)}var dM=function(e){return e===void 0&&(e=Xb),e<=0?pM:e===1?hM:function(t){return Array.isArray(t)?{next:Ka(t,e-1),hasNext:!0,hasMany:!0,done:!1}:{next:t,hasNext:!0,done:!1}}},pM=function(e){return{next:e,hasNext:!0,done:!1}},hM=function(e){return Array.isArray(e)?{next:e,hasNext:!0,hasMany:!0,done:!1}:{next:e,hasNext:!0,done:!1}};function Ka(e,t){if(t===void 0&&(t=Xb),t<=0)return e.slice();for(var n=[],r=0,i=e;r<i.length;r++){var s=i[r];Array.isArray(s)?n.push.apply(n,Ka(s,t-1)):n.push(s)}return n}function hs(){return O(mM,arguments,hs.lazy)}function mM(e){return xe(e,hs.lazy())}(function(e){e.lazy=function(){return function(t){return Array.isArray(t)?{done:!1,hasNext:!0,hasMany:!0,next:t}:{done:!1,hasNext:!0,next:t}}}})(hs||(hs={}));function Qa(){return O(yM,arguments,Qa.lazy)}function yM(e,t){return hs(e.map(function(n){return t(n)}))}(function(e){e.lazy=function(t){return function(n){var r=t(n);return Array.isArray(r)?{done:!1,hasNext:!0,hasMany:!0,next:r}:{done:!1,hasNext:!0,next:r}}}})(Qa||(Qa={}));function md(){return O(Yb(!1),arguments)}var Yb=function(e){return function(t,n){for(var r={},i=0;i<t.length;i++)for(var s=t[i],o=e?n(s,i,t):n(s),u=0,a=o;u<a.length;u++){var c=a[u],l=c[0],f=c[1];r[l]=f}return r}};(function(e){function t(){return O(Yb(!0),arguments)}e.indexed=t})(md||(md={}));function ms(){return O(gM,arguments,ms.lazy)}function gM(e){return xe(e,ms.lazy())}function wM(e){if(!Array.isArray(e))return e;for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];Array.isArray(i)?t.push.apply(t,ms(i)):t.push(i)}return t}(function(e){e.lazy=function(){return function(t){var n=wM(t);return Array.isArray(n)?{done:!1,hasNext:!0,hasMany:!0,next:n}:{done:!1,hasNext:!0,next:n}}}})(ms||(ms={}));function bM(){return O(fh(Math.floor),arguments)}function ys(){return O(Zb(!1),arguments,ys.lazy)}var Zb=function(e){return function(t,n){return xe(t,e?ys.lazyIndexed(n):ys.lazy(n),e)}},Zm=function(e){return function(t){return function(n,r,i){return e?t(n,r,i):t(n),{done:!1,hasNext:!0,next:n}}}};(function(e){function t(){return O(Zb(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=Zm(!1),e.lazyIndexed=dr(Zm(!0))})(ys||(ys={}));function yd(){return O(e0(!1),arguments)}var e0=function(e){return function(t,n){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=t,s=r,o=i[s];e?n(o,r,t):n(o)}return t}};(function(e){function t(){return O(e0(!0),arguments)}e.indexed=t})(yd||(yd={}));function Ha(){return O(_M,arguments)}function _M(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],s=i[0],o=i[1];t[s]=o}return t}(function(e){e.strict=e})(Ha||(Ha={}));function vM(){return O(xM,arguments)}function xM(e,t){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r];n[s]=t(s)}return n}function gd(){return O(SM,arguments)}function SM(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],s=i[0],o=i[1];t[s]=o}return t}(function(e){e.strict=e})(gd||(gd={}));function wd(){return O(t0(!1),arguments)}var t0=function(e){return function(t,n){for(var r={},i=0;i<t.length;i++){var s=t[i],o=e?n(s,i,t):n(s);if(o!==void 0){var u=String(o),a=r[u];a===void 0&&(a=[],r[u]=a),a.push(s)}}return r}};(function(e){function t(){return O(t0(!0),arguments)}e.indexed=t,e.strict=e})(wd||(wd={}));function n0(){return O(tu,arguments)}function tu(e,t){if(e===t)return!0;if(typeof e=="number"&&typeof t=="number")return e!==e&&t!==t;if(typeof e!="object"||typeof t!="object"||e===null||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;if(e instanceof Set)return $M(e,t);if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!tu(e[n],t[n]))return!1;return!0}if(e instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp)return e.toString()===t.toString();if(e instanceof Map)return OM(e,t);var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(var i=0,s=r;i<s.length;i++){var o=s[i];if(!Object.prototype.hasOwnProperty.call(t,o)||!tu(e[o],t[o]))return!1}return!0}function OM(e,t){if(e.size!==t.size)return!1;for(var n=Array.from(e.keys()),r=0,i=n;r<i.length;r++){var s=i[r];if(!t.has(s)||!tu(e.get(s),t.get(s)))return!1}return!0}function $M(e,t){if(e.size!==t.size)return!1;for(var n=Array.from(e.values()),r=Array.from(t.values()),i=0,s=n;i<s.length;i++){for(var o=s[i],u=!1,a=0;a<r.length;a++)if(tu(o,r[a])){u=!0,r.splice(a,1);break}if(!u)return!1}return!0}function TM(){return O(IM,arguments)}function IM(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];if(!Object.prototype.hasOwnProperty.call(e,i)||!n0(t[i],e[i]))return!1}return!0}function AM(e){return e}function bd(){return O(r0(!1),arguments)}var r0=function(e){return function(t,n){for(var r={},i=0;i<t.length;i++){var s=t[i],o=e?n(s,i,t):n(s),u=String(o);r[u]=s}return r}};function kM(){return O(PM,arguments)}function PM(e,t){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=t(s);n[o]=s}return n}(function(e){function t(){return O(r0(!0),arguments)}e.indexed=t,e.strict=kM})(bd||(bd={}));function nu(){return O(EM,arguments,nu.lazy)}function EM(e,t){var n=nu.lazy(t);return xe(e,n)}(function(e){function t(r){var i=new Set(r);return function(s){return i.has(s)?{done:!1,hasNext:!0,next:s}:{done:!1,hasNext:!1}}}e.lazy=t;function n(){return O(RM,arguments,i0)}e.multiset=n})(nu||(nu={}));var RM=function(e,t){return xe(e,i0(t))};function i0(e){var t;if(e.length===0)return UR;for(var n=new Map,r=0,i=e;r<i.length;r++){var s=i[r];n.set(s,((t=n.get(s))!==null&&t!==void 0?t:0)+1)}return function(o){var u=n.get(o);return u===void 0||u===0?{done:!1,hasNext:!1}:(u===1?n.delete(o):n.set(o,u-1),{hasNext:!0,next:o,done:n.size===0})}}function ru(){return O(MM,arguments,ru.lazy)}function MM(e,t,n){var r=ru.lazy(t,n);return xe(e,r)}(function(e){e.lazy=function(t,n){return function(r){return t.some(function(i){return n(r,i)})?{done:!1,hasNext:!0,next:r}:{done:!1,hasNext:!1}}}})(ru||(ru={}));function NM(){return O(FM,arguments)}function FM(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[e[n]]=n);return t}function s0(e){return Array.isArray(e)}function jM(e){return typeof e=="boolean"}function CM(e){return e instanceof Date}function _d(e){return e!=null}(function(e){function t(n){return n!==void 0}e.strict=t})(_d||(_d={}));function o0(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}function u0(e){return typeof e=="string"}function DM(e){return e===void 0?!0:s0(e)||u0(e)?e.length===0:o0(e)?Object.keys(e).length===0:!1}function LM(e){return e instanceof Error}function BM(e){return typeof e=="function"}function UM(e,t){if(t===void 0){var n=new Set(e);return function(r){return n.has(r)}}return t.indexOf(e)>=0}function zM(e){return e==null}function WM(e){return e!==null}function VM(e){return e!=null}function qM(e){return function(t){return!e(t)}}function JM(e){return e==null}function KM(e){return typeof e=="number"&&!isNaN(e)}var QM=function(e){return typeof e=="object"&&e!==null};function HM(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function GM(e){return e instanceof Promise}function XM(e){return typeof e=="symbol"}function YM(){return O(ZM,arguments)}var ZM=function(e,t){return e.join(t)};function iu(){return O(Object.keys,arguments)}(function(e){e.strict=e})(iu||(iu={}));function e2(){return O(t2,arguments)}function t2(e){return e[e.length-1]}function n2(){return O(r2,arguments)}function r2(e){return"length"in e?e.length:Array.from(e).length}function gs(){return O(a0(!1),arguments,gs.lazy)}var a0=function(e){return function(t,n){return xe(t,e?gs.lazyIndexed(n):gs.lazy(n),e)}},ey=function(e){return function(t){return function(n,r,i){return{done:!1,hasNext:!0,next:e?t(n,r,i):t(n)}}}};(function(e){function t(){return O(a0(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=ey(!1),e.lazyIndexed=dr(ey(!0)),e.strict=e})(gs||(gs={}));function i2(){return O(s2,arguments)}function s2(e,t){for(var n={},r=0,i=ds.strict(e);r<i.length;r++){var s=i[r],o=s[0],u=s[1];n[t(o,u)]=u}return n}function vd(){return O(c0(!1),arguments)}var c0=function(e){return function(t,n){for(var r={},i=0;i<t.length;i++){var s=t[i],o=e?n(s,i,t):n(s),u=o[0],a=o[1];r[u]=a}return r}};(function(e){function t(){return O(c0(!0),arguments)}e.indexed=t})(vd||(vd={}));function o2(){return O(u2,arguments)}function u2(e,t){for(var n={},r=0,i=ds.strict(e);r<i.length;r++){var s=i[r],o=s[0],u=s[1],a=t(u,o);n[o]=a}return n}function ws(){return O(l0(!1),arguments,ws.lazy)}var l0=function(e){return function(t,n,r){var i=e?ws.lazyIndexed:ws.lazy;return xe(t,i(n,r),e)}},ty=function(e){return function(t,n){var r=n;return function(i,s,o){return r=e?t(r,i,s,o):t(r,i),{done:!1,hasNext:!0,next:r}}}};(function(e){function t(){return O(l0(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=ty(!1),e.lazyIndexed=dr(ty(!0))})(ws||(ws={}));var f0=function(e){return function(t,n){for(var r,i,s=0;s<t.length;s++){var o=t[s],u=e?n(o,s,t):n(o);(i===void 0||u>i)&&(r=o,i=u)}return r}};function xd(){return O(f0(!1),arguments)}(function(e){function t(){return O(f0(!0),arguments)}e.indexed=t})(xd||(xd={}));var d0=function(e){return function(t,n){if(t.length===0)return NaN;for(var r=0,i=0;i<t.length;i++){var s=t[i];r+=e?n(s,i,t):n(s)}return r/t.length}};function Sd(){return O(d0(!1),arguments)}(function(e){function t(){return O(d0(!0),arguments)}e.indexed=t})(Sd||(Sd={}));var Ga=function(){return Ga=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ga.apply(this,arguments)};function a2(){return O(c2,arguments)}function c2(e,t){return Ga(Ga({},e),t)}var Xa=function(){return Xa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Xa.apply(this,arguments)};function l2(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t=Xa(Xa({},t),i)}return t}var Ya=function(){return Ya=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ya.apply(this,arguments)};function f2(){return O(p0,arguments)}function p0(e,t){var n=Ya(Ya({},e),t);for(var r in t)if(r in e){var i=e,s=r,o=i[s];if(ny(o)){var u=t,a=r,c=u[a];ny(c)&&(n[r]=p0(o,c))}}return n}function ny(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}var h0=function(e){return function(t,n){for(var r,i,s=0;s<t.length;s++){var o=t[s],u=e?n(o,s,t):n(o);(i===void 0||u<i)&&(r=o,i=u)}return r}};function Od(){return O(h0(!1),arguments)}(function(e){function t(){return O(h0(!0),arguments)}e.indexed=t})(Od||(Od={}));function d2(){return O(p2,arguments)}function p2(e,t){return e*t}var h2=function(){},m2=function(e,t,n){return t<0||t>=e.length?void 0:m0(e.slice(),0,e.length-1,t,n)};function m0(e,t,n,r,i){if(t===n)return e[t];var s=y2(e,t,n,i);return r===s?e[r]:m0(e,r<s?t:s+1,r<s?s-1:n,r,i)}function y2(e,t,n,r){for(var i=e[n],s=t,o=t;o<n;o++)r(e[o],i)<0&&(ad(e,s,o),s+=1);return ad(e,s,n),s}function g2(){return rl(w2,arguments)}var w2=function(e,t,n){return m2(e,n>=0?n:e.length+n,t)};function b2(){return O(_2,arguments)}function _2(e,t){var n;return n={},n[t]=e,n}var Za=function(){return Za=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Za.apply(this,arguments)},v2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};function x2(){return O(S2,arguments)}function S2(e,t){if(!eu(t,1))return Za({},e);if(!eu(t,2)){var n=t[0],r=e,i=n;r[i];var s=v2(r,[typeof i=="symbol"?i:i+""]);return s}if(!t.some(function(u){return u in e}))return Za({},e);var o=new Set(t);return Ha(Object.entries(e).filter(function(u){var a=u[0];return!o.has(a)}))}function O2(){return O($2,arguments)}function $2(e,t){if(e==null)return e;for(var n={},r=0,i=iu.strict(e);r<i.length;r++){var s=i[r];t(e[s],s)||(n[s]=e[s])}return n}function T2(e){var t=!1,n;return function(){return t||(n=e(),t=!0),n}}function I2(){return O(A2,arguments)}function A2(e){return e.length===1?e[0]:void 0}function $d(){return O(y0(!1),arguments)}var y0=function(e){return function(t,n){for(var r=[[],[]],i=0;i<t.length;i++){var s=t[i],o=e?n(s,i,t):n(s);r[o?0:1].push(s)}return r}};(function(e){function t(){return O(y0(!0),arguments)}e.indexed=t})($d||($d={}));function k2(){return O(P2,arguments)}function P2(e,t,n){for(var r=e,i=0,s=t;i<s.length;i++){var o=s[i];if(r==null)break;r=r[o]}return r??n}function E2(){return O(R2,arguments)}function R2(e,t){for(var n={},r=0,i=t;r<i.length;r++){var s=i[r];s in e&&(n[s]=e[s])}return n}function M2(){return O(N2,arguments)}function N2(e,t){if(e==null)return{};for(var n={},r=0,i=iu.strict(e);r<i.length;r++){var s=i[r];t(e[s],s)&&(n[s]=e[s])}return n}var F2=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))};function j2(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(n){return dh.apply(void 0,F2([n],e,!1))}}function C2(){return O(D2,arguments)}function D2(e){for(var t=1,n=0,r=e;n<r.length;n++){var i=r[n];t*=i}return t}var L2=function(e){return function(t){var n=e,r=t[n];return r}};function B2(){return O(U2,arguments)}function U2(e,t,n){for(var r={},i=0,s=e;i<s.length;i++){var o=s[i],u=t(o),a=n(o);r[u]=a}return r}function g0(){return O(z2,arguments)}function z2(e,t){if(e<0)throw new RangeError("n must be a non-negative number");for(var n=[],r=0;r<e;r++)n.push(t(r));return n}var ry="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function W2(){return O(V2,arguments)}function V2(e){return g0(e,q2).join("")}var q2=function(){return ry[Math.floor(Math.random()*ry.length)]};function J2(){return O(K2,arguments)}function K2(e,t){for(var n=[],r=e;r<t;r++)n.push(r);return n}function Q2(){return rl(H2,arguments)}function H2(e,t,n){for(var r=0,i=0,s=e;i<s.length;i++){var o=s[i];t(n,o)>0&&(r+=1)}return r}function Td(){return O(w0(!1),arguments)}var w0=function(e){return function(t,n,r){return t.reduce(function(i,s,o){return e?n(i,s,o,t):n(i,s)},r)}};(function(e){function t(){return O(w0(!0),arguments)}e.indexed=t})(Td||(Td={}));function bs(){return O(b0(!1),arguments,bs.lazy)}var b0=function(e){return function(t,n){return xe(t,e?bs.lazyIndexed(n):bs.lazy(n),e)}},iy=function(e){return function(t){return function(n,r,i){return(e?t(n,r,i):t(n))?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:n}}}};(function(e){function t(){return O(b0(!0),arguments,e.lazyIndexed)}e.indexed=t,e.lazy=iy(!1),e.lazyIndexed=dr(iy(!0))})(bs||(bs={}));function G2(){return O(X2,arguments)}function X2(e){return e.slice().reverse()}function Y2(){return O(fh(Math.round),arguments)}function Z2(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return O(eN,e)}function eN(e,t){if(t<0)throw new RangeError("sampleSize must cannot be negative: ".concat(t));if(!Number.isInteger(t))throw new TypeError("sampleSize must be an integer: ".concat(t));if(t>=e.length)return e.slice();if(t===0)return[];for(var n=Math.min(t,e.length-t),r=new Set;r.size<n;){var i=Math.floor(Math.random()*e.length);r.add(i)}return t===n?Array.from(r).sort(function(s,o){return s-o}).map(function(s){return e[s]}):e.filter(function(s,o){return!r.has(o)})}var ec=function(){return ec=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ec.apply(this,arguments)};function tN(){return O(nN,arguments)}function nN(e,t,n){var r;return ec(ec({},e),(r={},r[t]=n,r))}var tc=function(){return tc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},tc.apply(this,arguments)};function rN(){return O(nc,arguments)}function nc(e,t,n){var r,i=t[0],s=t.slice(1);if(i===void 0)return n;if(Array.isArray(e))return e.map(function(o,u){return u===i?nc(o,s,n):o});if(e==null)throw new Error("Path doesn't exist in object!");return tc(tc({},e),(r={},r[i]=nc(e[i],s,n),r))}function iN(){return O(sN,arguments)}function sN(e){for(var t=e.slice(),n=0;n<e.length;n++){var r=n+Math.floor(Math.random()*(e.length-n)),i=t[r];t[r]=t[n],t[n]=i}return t}var oN=function(e,t){return function(n){return n.slice(e,t)}};function Id(){return O(uN,arguments)}function uN(e,t){var n=e.slice();return n.sort(t),n}(function(e){e.strict=e})(Id||(Id={}));function Ad(){return ph(aN,arguments)}var aN=function(e,t){return e.slice().sort(t)};(function(e){e.strict=e})(Ad||(Ad={}));function Zs(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>>1,s=e[i];t(s,i)?n=i+1:r=i}return r}function cN(){return O(lN,arguments)}var lN=function(e,t){return Zs(e,function(n){return n<t})};function kd(){return O(_0,arguments)}(function(e){function t(){return O(_0,arguments)}e.indexed=t})(kd||(kd={}));function _0(e,t,n){var r=n(t);return Zs(e,function(i,s){return n(i,s)<r})}function Pd(){return O(Zs,arguments)}(function(e){function t(){return O(Zs,arguments)}e.indexed=t})(Pd||(Pd={}));function fN(){return O(dN,arguments)}var dN=function(e,t){return Zs(e,function(n){return n<=t})};function Ed(){return O(v0,arguments)}(function(e){function t(){return O(v0,arguments)}e.indexed=t})(Ed||(Ed={}));function v0(e,t,n){var r=n(t);return Zs(e,function(i,s){return n(i,s)<=r})}var pN=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))};function hN(){return O(mN,arguments)}function mN(e,t,n,r){var i=e.slice();return i.splice.apply(i,pN([t,n],r,!1)),i}function x0(){return O(yN,arguments)}function yN(e,t){var n=e.slice(),r=n.splice(t);return[n,r]}function gN(){return O(wN,arguments)}function wN(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return x0(e,n);return[e.slice(),[]]}var bN=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))};function _N(e){return S0(e)}function S0(e){var t;if(e.length===0)return[];var n=(t=/^\[(.+?)\](.*)$/u.exec(e))!==null&&t!==void 0?t:/^\.?([^.[\]]+)(.*)$/u.exec(e);if(n!==null){var r=n[1],i=n[2];return bN([r],S0(i),!0)}return[e]}function vN(){return O(xN,arguments)}function xN(e,t){return e-t}function SN(){return O(ON,arguments)}function ON(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];t+=i}return t}var O0=function(e){return function(t,n){for(var r=0,i=0;i<t.length;i++){var s=t[i],o=e?n(s,i,t):n(s);r+=o}return r}};function Rd(){return O(O0(!1),arguments)}(function(e){function t(){return O(O0(!0),arguments)}e.indexed=t})(Rd||(Rd={}));function $N(){return O(TN,arguments)}function TN(e,t,n){return typeof e=="string"?IN(e,t,n):$0(e,t,n)}function $0(e,t,n){var r=e.slice();if(isNaN(t)||isNaN(n))return r;var i=t<0?e.length+t:t,s=n<0?e.length+n:n;return i<0||i>e.length||s<0||s>e.length||(r[i]=e[s],r[s]=e[i]),r}function IN(e,t,n){var r=$0(e.split(""),t,n);return r.join("")}var rc=function(){return rc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},rc.apply(this,arguments)};function AN(){return O(kN,arguments)}function kN(e,t,n){var r,i=e,s=t,o=i[s],u=n,a=i[u];return rc(rc({},e),(r={},r[t]=a,r[n]=o,r))}function su(){return O(PN,arguments,su.lazy)}function PN(e,t){return xe(e,su.lazy(t))}(function(e){function t(n){if(n<=0)return function(){return{done:!0,hasNext:!1}};var r=n;return function(i){return r-=1,{done:r<=0,hasNext:!0,next:i}}}e.lazy=t})(su||(su={}));function EN(){return rl(RN,arguments)}function RN(e,t,n){if(n<=0)return[];if(n>=e.length)return e.slice();var r=e.slice(0,n);Bb(r,t);for(var i=e.slice(n),s=0,o=i;s<o.length;s++){var u=o[s];Ub(r,t,u)}return r}function MN(){return O(NN,arguments)}function NN(e,t){for(var n=e.length-1;n>=0;n--)if(!t(e[n]))return e.slice(n+1);return e.slice()}function FN(){return O(jN,arguments)}function jN(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var s=i[r];if(!t(s))break;n.push(s)}return n}function CN(){return O(DN,arguments)}function DN(e,t){return t(e),e}function ou(){return O(LN,arguments,ou.lazy)}function LN(e){return xe(e,ou.lazy())}(function(e){function t(){var n=new Set;return function(r){return n.has(r)?{done:!1,hasNext:!1}:(n.add(r),{done:!1,hasNext:!0,next:r})}}e.lazy=t})(ou||(ou={}));function BN(){return O(UN,arguments,T0)}function UN(e,t){return xe(e,T0(t))}function T0(e){var t=new Set;return function(n){var r=e(n);return t.has(r)?{done:!1,hasNext:!1}:(t.add(r),{done:!1,hasNext:!0,next:n})}}function uu(){return O(zN,arguments,uu.lazy)}function zN(e,t){var n=uu.lazy(t);return xe(e,n,!0)}var WN=function(e){return function(t,n,r){return r!==void 0&&r.findIndex(function(i){return e(t,i)})===n?{done:!1,hasNext:!0,next:t}:{done:!1,hasNext:!1}}};(function(e){e.lazy=dr(WN)})(uu||(uu={}));function au(){return O(VN,arguments,au.lazy)}function VN(e){return xe(e,au.lazy())}(function(e){function t(){var n=new Set;return function(r){return n.has(r)?{done:!1,hasNext:!1}:(n.add(r),{done:!1,hasNext:!0,next:r})}}e.lazy=t})(au||(au={}));function qN(){return O(JN,arguments,I0)}function JN(e,t){return xe(e,I0(t))}function I0(e){var t=new Set;return function(n){var r=e(n);return t.has(r)?{done:!1,hasNext:!1}:(t.add(r),{done:!1,hasNext:!0,next:n})}}function cu(){return O(KN,arguments,cu.lazy)}function KN(e,t){var n=cu.lazy(t);return xe(e,n,!0)}var QN=function(e){return function(t,n,r){return r!==void 0&&r.findIndex(function(i){return e(t,i)})===n?{done:!1,hasNext:!0,next:t}:{done:!1,hasNext:!1}}};(function(e){e.lazy=dr(QN)})(cu||(cu={}));function HN(){return O(Object.values,arguments)}function Md(){return O(GN,arguments)}function GN(e,t){for(var n=e.length>t.length?t.length:e.length,r=[],i=0;i<n;i++)r.push([e[i],t[i]]);return r}(function(e){e.strict=e})(Md||(Md={}));function XN(){return O(YN,arguments)}function YN(e,t){for(var n=e.length>t.length?t.length:e.length,r={},i=0;i<n;i++)r[e[i]]=t[i];return r}function ZN(e,t,n){if(typeof e=="function")return t===void 0?function(r,i){return pf(r,i,e)}:function(r){return pf(r,t,e)};if(t===void 0||n===void 0)throw new Error("zipWith: Missing arguments in dataFirst function call");return pf(e,t,n)}function pf(e,t,n){for(var r=e.length>t.length?t.length:e.length,i=[],s=0;s<r;s++)i.push(n(e[s],t[s]));return i}const eF=Object.freeze(Object.defineProperty({__proto__:null,_setPath:nc,add:lR,addProp:dR,allPass:hR,anyPass:yR,ceil:wR,chunk:bR,clamp:vR,clone:OR,compact:$R,concat:TR,get conditional(){return od},constant:NR,get countBy(){return ud},createPipe:DR,debounce:LR,get difference(){return Xo},get differenceWith(){return Yo},divide:JR,doNothing:QR,get drop(){return Zo},dropFirstBy:YR,dropLast:eM,dropLastWhile:nM,dropWhile:iM,get entries(){return ld},equals:oM,evolve:uM,get filter(){return ps},get find(){return Va},get findIndex(){return qa},get findLast(){return pd},get findLastIndex(){return hd},get first(){return Ja},firstBy:cM,flat:fM,get flatMap(){return Qa},get flatMapToObj(){return md},get flatten(){return hs},get flattenDeep(){return ms},floor:bM,get forEach(){return ys},get forEachObj(){return yd},get fromEntries(){return Ha},fromKeys:vM,get fromPairs(){return gd},get groupBy(){return wd},hasAtLeast:eu,hasSubObject:TM,identity:AM,get indexBy(){return bd},get intersection(){return nu},get intersectionWith(){return ru},invert:NM,isArray:s0,isBoolean:jM,isDate:CM,isDeepEqual:n0,get isDefined(){return _d},isEmpty:DM,isError:LM,isFunction:BM,isIncludedIn:UM,isNil:zM,isNonNull:WM,isNonNullish:VM,isNot:qM,isNullish:JM,isNumber:KM,isObject:o0,isObjectType:QM,isPlainObject:HM,isPromise:GM,isString:u0,isSymbol:XM,isTruthy:jb,join:YM,get keys(){return iu},last:e2,length:n2,get map(){return gs},mapKeys:i2,get mapToObj(){return vd},mapValues:o2,get mapWithFeedback(){return ws},get maxBy(){return xd},get meanBy(){return Sd},merge:a2,mergeAll:l2,mergeDeep:f2,get minBy(){return Od},multiply:d2,noop:h2,nthBy:g2,objOf:b2,omit:x2,omitBy:O2,once:T2,only:I2,get partition(){return $d},pathOr:k2,pick:E2,pickBy:M2,pipe:dh,piped:j2,product:C2,prop:L2,pullObject:B2,purry:O,randomString:W2,range:J2,rankBy:Q2,get reduce(){return Td},get reject(){return bs},reverse:G2,round:Y2,sample:Z2,set:tN,setPath:rN,shuffle:iN,sliceString:oN,get sort(){return Id},get sortBy(){return Ad},sortedIndex:cN,get sortedIndexBy(){return kd},get sortedIndexWith(){return Pd},sortedLastIndex:fN,get sortedLastIndexBy(){return Ed},splice:hN,splitAt:x0,splitWhen:gN,stringToPath:_N,subtract:vN,sum:SN,get sumBy(){return Rd},swapIndices:$N,swapProps:AN,get take(){return su},takeFirstBy:EN,takeLastWhile:MN,takeWhile:FN,tap:CN,times:g0,get toPairs(){return ds},type:Nb,get uniq(){return ou},uniqBy:BN,get uniqWith(){return uu},get unique(){return au},uniqueBy:qN,get uniqueWith(){return cu},values:HN,get zip(){return Md},zipObj:XN,zipWith:ZN},Symbol.toStringTag,{value:"Module"})),il=Eb(eF);var A0={},sl={},ol={};Object.defineProperty(ol,"__esModule",{value:!0});ol.default=nF;let ua;const tF=new Uint8Array(16);function nF(){if(!ua&&(ua=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ua))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ua(tF)}var Kr={},Ri={},ul={};Object.defineProperty(ul,"__esModule",{value:!0});ul.default=void 0;var rF=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ul.default=rF;Object.defineProperty(Ri,"__esModule",{value:!0});Ri.default=void 0;var iF=sF(ul);function sF(e){return e&&e.__esModule?e:{default:e}}function oF(e){return typeof e=="string"&&iF.default.test(e)}var uF=oF;Ri.default=uF;Object.defineProperty(Kr,"__esModule",{value:!0});Kr.default=void 0;Kr.unsafeStringify=k0;var aF=cF(Ri);function cF(e){return e&&e.__esModule?e:{default:e}}const je=[];for(let e=0;e<256;++e)je.push((e+256).toString(16).slice(1));function k0(e,t=0){return je[e[t+0]]+je[e[t+1]]+je[e[t+2]]+je[e[t+3]]+"-"+je[e[t+4]]+je[e[t+5]]+"-"+je[e[t+6]]+je[e[t+7]]+"-"+je[e[t+8]]+je[e[t+9]]+"-"+je[e[t+10]]+je[e[t+11]]+je[e[t+12]]+je[e[t+13]]+je[e[t+14]]+je[e[t+15]]}function lF(e,t=0){const n=k0(e,t);if(!(0,aF.default)(n))throw TypeError("Stringified UUID is invalid");return n}var fF=lF;Kr.default=fF;Object.defineProperty(sl,"__esModule",{value:!0});sl.default=void 0;var dF=hF(ol),pF=Kr;function hF(e){return e&&e.__esModule?e:{default:e}}let sy,hf,mf=0,yf=0;function mF(e,t,n){let r=t&&n||0;const i=t||new Array(16);e=e||{};let s=e.node||sy,o=e.clockseq!==void 0?e.clockseq:hf;if(s==null||o==null){const p=e.random||(e.rng||dF.default)();s==null&&(s=sy=[p[0]|1,p[1],p[2],p[3],p[4],p[5]]),o==null&&(o=hf=(p[6]<<8|p[7])&16383)}let u=e.msecs!==void 0?e.msecs:Date.now(),a=e.nsecs!==void 0?e.nsecs:yf+1;const c=u-mf+(a-yf)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||u>mf)&&e.nsecs===void 0&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");mf=u,yf=a,hf=o,u+=122192928e5;const l=((u&268435455)*1e4+a)%4294967296;i[r++]=l>>>24&255,i[r++]=l>>>16&255,i[r++]=l>>>8&255,i[r++]=l&255;const f=u/4294967296*1e4&268435455;i[r++]=f>>>8&255,i[r++]=f&255,i[r++]=f>>>24&15|16,i[r++]=f>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(let p=0;p<6;++p)i[r+p]=s[p];return t||(0,pF.unsafeStringify)(i)}var yF=mF;sl.default=yF;var al={},Cr={},zu={};Object.defineProperty(zu,"__esModule",{value:!0});zu.default=void 0;var gF=wF(Ri);function wF(e){return e&&e.__esModule?e:{default:e}}function bF(e){if(!(0,gF.default)(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=t&255,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=t&255,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=t&255,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=t&255,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=t&255,n}var _F=bF;zu.default=_F;Object.defineProperty(Cr,"__esModule",{value:!0});Cr.URL=Cr.DNS=void 0;Cr.default=$F;var vF=Kr,xF=SF(zu);function SF(e){return e&&e.__esModule?e:{default:e}}function OF(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}const P0="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Cr.DNS=P0;const E0="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Cr.URL=E0;function $F(e,t,n){function r(i,s,o,u){var a;if(typeof i=="string"&&(i=OF(i)),typeof s=="string"&&(s=(0,xF.default)(s)),((a=s)===null||a===void 0?void 0:a.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=n(c),c[6]=c[6]&15|t,c[8]=c[8]&63|128,o){u=u||0;for(let l=0;l<16;++l)o[u+l]=c[l];return o}return(0,vF.unsafeStringify)(c)}try{r.name=e}catch{}return r.DNS=P0,r.URL=E0,r}var cl={};Object.defineProperty(cl,"__esModule",{value:!0});cl.default=void 0;function TF(e){if(typeof e=="string"){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return IF(AF(kF(e),e.length*8))}function IF(e){const t=[],n=e.length*32,r="0123456789abcdef";for(let i=0;i<n;i+=8){const s=e[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);t.push(o)}return t}function R0(e){return(e+64>>>9<<4)+14+1}function AF(e,t){e[t>>5]|=128<<t%32,e[R0(t)-1]=t;let n=1732584193,r=-271733879,i=-1732584194,s=271733878;for(let o=0;o<e.length;o+=16){const u=n,a=r,c=i,l=s;n=Qe(n,r,i,s,e[o],7,-680876936),s=Qe(s,n,r,i,e[o+1],12,-389564586),i=Qe(i,s,n,r,e[o+2],17,606105819),r=Qe(r,i,s,n,e[o+3],22,-1044525330),n=Qe(n,r,i,s,e[o+4],7,-176418897),s=Qe(s,n,r,i,e[o+5],12,1200080426),i=Qe(i,s,n,r,e[o+6],17,-1473231341),r=Qe(r,i,s,n,e[o+7],22,-45705983),n=Qe(n,r,i,s,e[o+8],7,1770035416),s=Qe(s,n,r,i,e[o+9],12,-1958414417),i=Qe(i,s,n,r,e[o+10],17,-42063),r=Qe(r,i,s,n,e[o+11],22,-1990404162),n=Qe(n,r,i,s,e[o+12],7,1804603682),s=Qe(s,n,r,i,e[o+13],12,-40341101),i=Qe(i,s,n,r,e[o+14],17,-1502002290),r=Qe(r,i,s,n,e[o+15],22,1236535329),n=He(n,r,i,s,e[o+1],5,-165796510),s=He(s,n,r,i,e[o+6],9,-1069501632),i=He(i,s,n,r,e[o+11],14,643717713),r=He(r,i,s,n,e[o],20,-373897302),n=He(n,r,i,s,e[o+5],5,-701558691),s=He(s,n,r,i,e[o+10],9,38016083),i=He(i,s,n,r,e[o+15],14,-660478335),r=He(r,i,s,n,e[o+4],20,-405537848),n=He(n,r,i,s,e[o+9],5,568446438),s=He(s,n,r,i,e[o+14],9,-1019803690),i=He(i,s,n,r,e[o+3],14,-187363961),r=He(r,i,s,n,e[o+8],20,1163531501),n=He(n,r,i,s,e[o+13],5,-1444681467),s=He(s,n,r,i,e[o+2],9,-51403784),i=He(i,s,n,r,e[o+7],14,1735328473),r=He(r,i,s,n,e[o+12],20,-1926607734),n=Ge(n,r,i,s,e[o+5],4,-378558),s=Ge(s,n,r,i,e[o+8],11,-2022574463),i=Ge(i,s,n,r,e[o+11],16,1839030562),r=Ge(r,i,s,n,e[o+14],23,-35309556),n=Ge(n,r,i,s,e[o+1],4,-1530992060),s=Ge(s,n,r,i,e[o+4],11,1272893353),i=Ge(i,s,n,r,e[o+7],16,-155497632),r=Ge(r,i,s,n,e[o+10],23,-1094730640),n=Ge(n,r,i,s,e[o+13],4,681279174),s=Ge(s,n,r,i,e[o],11,-358537222),i=Ge(i,s,n,r,e[o+3],16,-722521979),r=Ge(r,i,s,n,e[o+6],23,76029189),n=Ge(n,r,i,s,e[o+9],4,-640364487),s=Ge(s,n,r,i,e[o+12],11,-421815835),i=Ge(i,s,n,r,e[o+15],16,530742520),r=Ge(r,i,s,n,e[o+2],23,-995338651),n=Xe(n,r,i,s,e[o],6,-198630844),s=Xe(s,n,r,i,e[o+7],10,1126891415),i=Xe(i,s,n,r,e[o+14],15,-1416354905),r=Xe(r,i,s,n,e[o+5],21,-57434055),n=Xe(n,r,i,s,e[o+12],6,1700485571),s=Xe(s,n,r,i,e[o+3],10,-1894986606),i=Xe(i,s,n,r,e[o+10],15,-1051523),r=Xe(r,i,s,n,e[o+1],21,-2054922799),n=Xe(n,r,i,s,e[o+8],6,1873313359),s=Xe(s,n,r,i,e[o+15],10,-30611744),i=Xe(i,s,n,r,e[o+6],15,-1560198380),r=Xe(r,i,s,n,e[o+13],21,1309151649),n=Xe(n,r,i,s,e[o+4],6,-145523070),s=Xe(s,n,r,i,e[o+11],10,-1120210379),i=Xe(i,s,n,r,e[o+2],15,718787259),r=Xe(r,i,s,n,e[o+9],21,-343485551),n=Tr(n,u),r=Tr(r,a),i=Tr(i,c),s=Tr(s,l)}return[n,r,i,s]}function kF(e){if(e.length===0)return[];const t=e.length*8,n=new Uint32Array(R0(t));for(let r=0;r<t;r+=8)n[r>>5]|=(e[r/8]&255)<<r%32;return n}function Tr(e,t){const n=(e&65535)+(t&65535);return(e>>16)+(t>>16)+(n>>16)<<16|n&65535}function PF(e,t){return e<<t|e>>>32-t}function ll(e,t,n,r,i,s){return Tr(PF(Tr(Tr(t,e),Tr(r,s)),i),n)}function Qe(e,t,n,r,i,s,o){return ll(t&n|~t&r,e,t,i,s,o)}function He(e,t,n,r,i,s,o){return ll(t&r|n&~r,e,t,i,s,o)}function Ge(e,t,n,r,i,s,o){return ll(t^n^r,e,t,i,s,o)}function Xe(e,t,n,r,i,s,o){return ll(n^(t|~r),e,t,i,s,o)}var EF=TF;cl.default=EF;Object.defineProperty(al,"__esModule",{value:!0});al.default=void 0;var RF=M0(Cr),MF=M0(cl);function M0(e){return e&&e.__esModule?e:{default:e}}const NF=(0,RF.default)("v3",48,MF.default);var FF=NF;al.default=FF;var fl={},dl={};Object.defineProperty(dl,"__esModule",{value:!0});dl.default=void 0;const jF=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var CF={randomUUID:jF};dl.default=CF;Object.defineProperty(fl,"__esModule",{value:!0});fl.default=void 0;var oy=N0(dl),DF=N0(ol),LF=Kr;function N0(e){return e&&e.__esModule?e:{default:e}}function BF(e,t,n){if(oy.default.randomUUID&&!t&&!e)return oy.default.randomUUID();e=e||{};const r=e.random||(e.rng||DF.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=r[i];return t}return(0,LF.unsafeStringify)(r)}var UF=BF;fl.default=UF;var pl={},hl={};Object.defineProperty(hl,"__esModule",{value:!0});hl.default=void 0;function zF(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function gf(e,t){return e<<t|e>>>32-t}function WF(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){const o=unescape(encodeURIComponent(e));e=[];for(let u=0;u<o.length;++u)e.push(o.charCodeAt(u))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const r=e.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(let o=0;o<i;++o){const u=new Uint32Array(16);for(let a=0;a<16;++a)u[a]=e[o*64+a*4]<<24|e[o*64+a*4+1]<<16|e[o*64+a*4+2]<<8|e[o*64+a*4+3];s[o]=u}s[i-1][14]=(e.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(e.length-1)*8&4294967295;for(let o=0;o<i;++o){const u=new Uint32Array(80);for(let d=0;d<16;++d)u[d]=s[o][d];for(let d=16;d<80;++d)u[d]=gf(u[d-3]^u[d-8]^u[d-14]^u[d-16],1);let a=n[0],c=n[1],l=n[2],f=n[3],p=n[4];for(let d=0;d<80;++d){const m=Math.floor(d/20),y=gf(a,5)+zF(m,c,l,f)+p+t[m]+u[d]>>>0;p=f,f=l,l=gf(c,30)>>>0,c=a,a=y}n[0]=n[0]+a>>>0,n[1]=n[1]+c>>>0,n[2]=n[2]+l>>>0,n[3]=n[3]+f>>>0,n[4]=n[4]+p>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var VF=WF;hl.default=VF;Object.defineProperty(pl,"__esModule",{value:!0});pl.default=void 0;var qF=F0(Cr),JF=F0(hl);function F0(e){return e&&e.__esModule?e:{default:e}}const KF=(0,qF.default)("v5",80,JF.default);var QF=KF;pl.default=QF;var ml={};Object.defineProperty(ml,"__esModule",{value:!0});ml.default=void 0;var HF="00000000-0000-0000-0000-000000000000";ml.default=HF;var yl={};Object.defineProperty(yl,"__esModule",{value:!0});yl.default=void 0;var GF=XF(Ri);function XF(e){return e&&e.__esModule?e:{default:e}}function YF(e){if(!(0,GF.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var ZF=YF;yl.default=ZF;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return o.default}});var t=l(sl),n=l(al),r=l(fl),i=l(pl),s=l(ml),o=l(yl),u=l(Ri),a=l(Kr),c=l(zu);function l(f){return f&&f.__esModule?f:{default:f}}})(A0);var j0={exports:{}},C0={exports:{}};(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(n,r){return n<<r|n>>>32-r},rotr:function(n,r){return n<<32-r|n>>>r},endian:function(n){if(n.constructor==Number)return t.rotl(n,8)&16711935|t.rotl(n,24)&4278255360;for(var r=0;r<n.length;r++)n[r]=t.endian(n[r]);return n},randomBytes:function(n){for(var r=[];n>0;n--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(n){for(var r=[],i=0,s=0;i<n.length;i++,s+=8)r[s>>>5]|=n[i]<<24-s%32;return r},wordsToBytes:function(n){for(var r=[],i=0;i<n.length*32;i+=8)r.push(n[i>>>5]>>>24-i%32&255);return r},bytesToHex:function(n){for(var r=[],i=0;i<n.length;i++)r.push((n[i]>>>4).toString(16)),r.push((n[i]&15).toString(16));return r.join("")},hexToBytes:function(n){for(var r=[],i=0;i<n.length;i+=2)r.push(parseInt(n.substr(i,2),16));return r},bytesToBase64:function(n){for(var r=[],i=0;i<n.length;i+=3)for(var s=n[i]<<16|n[i+1]<<8|n[i+2],o=0;o<4;o++)i*8+o*6<=n.length*8?r.push(e.charAt(s>>>6*(3-o)&63)):r.push("=");return r.join("")},base64ToBytes:function(n){n=n.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],i=0,s=0;i<n.length;s=++i%4)s!=0&&r.push((e.indexOf(n.charAt(i-1))&Math.pow(2,-2*s+8)-1)<<s*2|e.indexOf(n.charAt(i))>>>6-s*2);return r}};C0.exports=t})();var ej=C0.exports,Nd={utf8:{stringToBytes:function(e){return Nd.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(Nd.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}},uy=Nd;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var tj=function(e){return e!=null&&(D0(e)||nj(e)||!!e._isBuffer)};function D0(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function nj(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&D0(e.slice(0,0))}(function(){var e=ej,t=uy.utf8,n=tj,r=uy.bin,i=function(s,o){s.constructor==String?o&&o.encoding==="binary"?s=r.stringToBytes(s):s=t.stringToBytes(s):n(s)?s=Array.prototype.slice.call(s,0):!Array.isArray(s)&&s.constructor!==Uint8Array&&(s=s.toString());for(var u=e.bytesToWords(s),a=s.length*8,c=1732584193,l=-271733879,f=-1732584194,p=271733878,d=0;d<u.length;d++)u[d]=(u[d]<<8|u[d]>>>24)&16711935|(u[d]<<24|u[d]>>>8)&4278255360;u[a>>>5]|=128<<a%32,u[(a+64>>>9<<4)+14]=a;for(var m=i._ff,y=i._gg,b=i._hh,g=i._ii,d=0;d<u.length;d+=16){var v=c,x=l,S=f,A=p;c=m(c,l,f,p,u[d+0],7,-680876936),p=m(p,c,l,f,u[d+1],12,-389564586),f=m(f,p,c,l,u[d+2],17,606105819),l=m(l,f,p,c,u[d+3],22,-1044525330),c=m(c,l,f,p,u[d+4],7,-176418897),p=m(p,c,l,f,u[d+5],12,1200080426),f=m(f,p,c,l,u[d+6],17,-1473231341),l=m(l,f,p,c,u[d+7],22,-45705983),c=m(c,l,f,p,u[d+8],7,1770035416),p=m(p,c,l,f,u[d+9],12,-1958414417),f=m(f,p,c,l,u[d+10],17,-42063),l=m(l,f,p,c,u[d+11],22,-1990404162),c=m(c,l,f,p,u[d+12],7,1804603682),p=m(p,c,l,f,u[d+13],12,-40341101),f=m(f,p,c,l,u[d+14],17,-1502002290),l=m(l,f,p,c,u[d+15],22,1236535329),c=y(c,l,f,p,u[d+1],5,-165796510),p=y(p,c,l,f,u[d+6],9,-1069501632),f=y(f,p,c,l,u[d+11],14,643717713),l=y(l,f,p,c,u[d+0],20,-373897302),c=y(c,l,f,p,u[d+5],5,-701558691),p=y(p,c,l,f,u[d+10],9,38016083),f=y(f,p,c,l,u[d+15],14,-660478335),l=y(l,f,p,c,u[d+4],20,-405537848),c=y(c,l,f,p,u[d+9],5,568446438),p=y(p,c,l,f,u[d+14],9,-1019803690),f=y(f,p,c,l,u[d+3],14,-187363961),l=y(l,f,p,c,u[d+8],20,1163531501),c=y(c,l,f,p,u[d+13],5,-1444681467),p=y(p,c,l,f,u[d+2],9,-51403784),f=y(f,p,c,l,u[d+7],14,1735328473),l=y(l,f,p,c,u[d+12],20,-1926607734),c=b(c,l,f,p,u[d+5],4,-378558),p=b(p,c,l,f,u[d+8],11,-2022574463),f=b(f,p,c,l,u[d+11],16,1839030562),l=b(l,f,p,c,u[d+14],23,-35309556),c=b(c,l,f,p,u[d+1],4,-1530992060),p=b(p,c,l,f,u[d+4],11,1272893353),f=b(f,p,c,l,u[d+7],16,-155497632),l=b(l,f,p,c,u[d+10],23,-1094730640),c=b(c,l,f,p,u[d+13],4,681279174),p=b(p,c,l,f,u[d+0],11,-358537222),f=b(f,p,c,l,u[d+3],16,-722521979),l=b(l,f,p,c,u[d+6],23,76029189),c=b(c,l,f,p,u[d+9],4,-640364487),p=b(p,c,l,f,u[d+12],11,-421815835),f=b(f,p,c,l,u[d+15],16,530742520),l=b(l,f,p,c,u[d+2],23,-995338651),c=g(c,l,f,p,u[d+0],6,-198630844),p=g(p,c,l,f,u[d+7],10,1126891415),f=g(f,p,c,l,u[d+14],15,-1416354905),l=g(l,f,p,c,u[d+5],21,-57434055),c=g(c,l,f,p,u[d+12],6,1700485571),p=g(p,c,l,f,u[d+3],10,-1894986606),f=g(f,p,c,l,u[d+10],15,-1051523),l=g(l,f,p,c,u[d+1],21,-2054922799),c=g(c,l,f,p,u[d+8],6,1873313359),p=g(p,c,l,f,u[d+15],10,-30611744),f=g(f,p,c,l,u[d+6],15,-1560198380),l=g(l,f,p,c,u[d+13],21,1309151649),c=g(c,l,f,p,u[d+4],6,-145523070),p=g(p,c,l,f,u[d+11],10,-1120210379),f=g(f,p,c,l,u[d+2],15,718787259),l=g(l,f,p,c,u[d+9],21,-343485551),c=c+v>>>0,l=l+x>>>0,f=f+S>>>0,p=p+A>>>0}return e.endian([c,l,f,p])};i._ff=function(s,o,u,a,c,l,f){var p=s+(o&u|~o&a)+(c>>>0)+f;return(p<<l|p>>>32-l)+o},i._gg=function(s,o,u,a,c,l,f){var p=s+(o&a|u&~a)+(c>>>0)+f;return(p<<l|p>>>32-l)+o},i._hh=function(s,o,u,a,c,l,f){var p=s+(o^u^a)+(c>>>0)+f;return(p<<l|p>>>32-l)+o},i._ii=function(s,o,u,a,c,l,f){var p=s+(u^(o|~a))+(c>>>0)+f;return(p<<l|p>>>32-l)+o},i._blocksize=16,i._digestsize=16,j0.exports=function(s,o){if(s==null)throw new Error("Illegal argument "+s);var u=e.wordsToBytes(i(s,o));return o&&o.asBytes?u:o&&o.asString?r.bytesToString(u):e.bytesToHex(u)}})();var rj=j0.exports,ij=M&&M.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),sj=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),oj=M&&M.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&ij(t,e,n);return sj(t,e),t},uj=M&&M.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.randomId=void 0;const aj=il,ay=oj(A0),cj=uj(rj);function lj(e){if(e){const t=(0,cj.default)(e),n=(0,aj.chunk)(t,2).map(r=>parseInt(r.join(""),16));return ay.v4({random:n})}else return ay.v4()}Ei.randomId=lj;var Nn={},gl={};Object.defineProperty(gl,"__esModule",{value:!0});gl.mutableFilter=void 0;function fj(e,t){let n=0;for(;!(n>=e.length);){const r=e[n];t(r)?n++:e.splice(n,1)}}gl.mutableFilter=fj;var wl={};Object.defineProperty(wl,"__esModule",{value:!0});wl.outdent=void 0;const dj=2;function pj(e){return e.replace(/\t/g," ".repeat(dj))}function hj(e){let t=0;for(const n of e)if(n===" ")t+=1;else return t;return t}function mj(e){let t=e.split(`
`).map(pj);t[0].trim()===""&&(t=t.slice(1)),t[t.length-1].trim()===""&&(t=t.slice(0,t.length-1));const n=t.map(hj),r=Math.min(...n);return t.map(s=>s.slice(r)).join(`
`)}wl.outdent=mj;var Qr={},Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});Dr.MAX=Dr.MIN=void 0;Dr.MIN=null;Dr.MAX=!0;var Mt={},eo={};Object.defineProperty(eo,"__esModule",{value:!0});eo.isPlainObject=void 0;function yj(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}eo.isPlainObject=yj;var bl={};const L0=2047,B0=0xfffffffffffff;function gj({sign:e,exponent:t,mantissa:n}){if(e!==0&&e!==1)throw new Error(`Invalid value for sign: ${e}.`);if(typeof t!="number"||t<0||L0<t)throw new Error(`Invalid value for exponent: ${t}.`);if(typeof n!="number"||n<0||B0<n)throw new Error(`Invalid value for mantissa: ${n}.`);const r=new ArrayBuffer(8),i=new Float64Array(r),s=new Uint8Array(r);return _j(e,s),xj(t,s),Oj(n,s),i[0]}function wj(e){if(typeof e!="number")throw new Error(`Value is not of type number: ${e}.`);const t=new ArrayBuffer(8),n=new Float64Array(t),r=new Uint8Array(t);return n[0]=e,{sign:bj(r),exponent:vj(r),mantissa:Sj(r)}}function bj(e){return Jn(e[7],7)}function _j(e,t){t[7]|=qn(e,7)}function vj(e){let t=0;return t+=qn(e[7]&127,4),t+=Jn(e[6],4),t}function xj(e,t){t[7]|=Jn(e,4),t[6]|=qn(e&15,4)}function Sj(e){let t=0;return t+=qn(e[6]&15,48),t+=qn(e[5],40),t+=qn(e[4],32),t+=qn(e[3],24),t+=qn(e[2],16),t+=qn(e[1],8),t+=e[0],t}function Oj(e,t){t[6]|=Jn(e,48)&255,t[5]|=Jn(e,40)&255,t[4]|=Jn(e,32)&255,t[3]|=Jn(e,24)&255,t[2]|=Jn(e,16)&255,t[1]|=Jn(e,8)&255,t[0]|=e&255}function qn(e,t){return e*Math.pow(2,t)}function Jn(e,t){return Math.floor(e/Math.pow(2,t))}var $j={MAX_EXPONENT:L0,MAX_MANTISSA:B0,construct:gj,deconstruct:wj};/***
 * @license
 * https://github.com/ealmansi/elen
 * Copyright (c) 2017 Emilio Almansi
 * Distributed under the MIT software license, see the accompanying
 * file LICENSE or http://www.opensource.org/licenses/mit-license.php.
 */const Pr=$j,hh=";",U0=">",z0="<";function Tj(e){if(typeof e!="number")throw new Error(`Value is not of type number: ${e}.`);const{sign:t,exponent:n,mantissa:r}=Pr.deconstruct(e);let i="";return i+=t===1?z0:U0,i+=Fd(t===1?Pr.MAX_EXPONENT-n:n),i+=Fd(t===1?Pr.MAX_MANTISSA-r:r),i}function Fd(e){let t="";e>0&&(t+=hh);const n=e.toString();return n.length>1&&(t+=Fd(n.length)),t+=n,t}function Ij(e){if(typeof e!="string")throw new Error(`Value is not of type string: ${e}.`);const{signLength:t,sign:n}=Aj(e,0),{exponentLength:r,exponent:i}=kj(e,n,t),{mantissaLength:s,mantissa:o}=Pj(e,n,t+r);return ir(e.length===t+r+s,e),Pr.construct({sign:n,exponent:i,mantissa:o})}function Aj(e,t){if(ir(t<e.length,e),e[t]===U0)return{signLength:1,sign:0};if(e[t]===z0)return{signLength:1,sign:1};ir(!1,e)}function kj(e,t,n){if(ir(n<e.length,e),e[n]==="0")return{exponentLength:1,exponent:t===0?0:Pr.MAX_EXPONENT};let r=n,i=0,s,o;for(;e[r]===hh;)i=i+1,r=r+1;for(ir(i!==0,e),o=1;i>0;)s=o,o=Number.parseInt(e.substr(r,o)),ir(o>0,e),r=r+s,i=i-1;return{exponentLength:r-n,exponent:t===0?o:Pr.MAX_EXPONENT-o}}function Pj(e,t,n){if(ir(n<e.length,e),e[n]==="0")return{mantissaLength:1,mantissa:t===0?0:Pr.MAX_MANTISSA};let r=n,i=0,s,o;for(;e[r]===hh;)i=i+1,r=r+1;for(ir(i!==0,e),o=1;i>0;)s=o,o=Number.parseInt(e.substr(r,o)),ir(o>0,e),r=r+s,i=i-1;return{mantissaLength:r-n,mantissa:t===0?o:Pr.MAX_MANTISSA-o}}function ir(e,t){if(!e)throw new Error(`Input is not a valid ELEN-encoded number: ${t}.`)}var Ej={encode:Tj,decode:Ij},Wu={};Object.defineProperty(Wu,"__esModule",{value:!0});Wu.compare=void 0;function Rj(e,t){return e>t?1:e<t?-1:0}Wu.compare=Rj;var Vu={};Object.defineProperty(Vu,"__esModule",{value:!0});Vu.UnreachableError=void 0;class Mj extends Error{constructor(t,n){super((n+": "||"Unreachable: ")+t)}}Vu.UnreachableError=Mj;(function(e){var t=M&&M.__createBinding||(Object.create?function(g,v,x,S){S===void 0&&(S=x);var A=Object.getOwnPropertyDescriptor(v,x);(!A||("get"in A?!v.__esModule:A.writable||A.configurable))&&(A={enumerable:!0,get:function(){return v[x]}}),Object.defineProperty(g,S,A)}:function(g,v,x,S){S===void 0&&(S=x),g[S]=v[x]}),n=M&&M.__setModuleDefault||(Object.create?function(g,v){Object.defineProperty(g,"default",{enumerable:!0,value:v})}:function(g,v){g.default=v}),r=M&&M.__importStar||function(g){if(g&&g.__esModule)return g;var v={};if(g!=null)for(var x in g)x!=="default"&&Object.prototype.hasOwnProperty.call(g,x)&&t(v,g,x);return n(v,g),v};Object.defineProperty(e,"__esModule",{value:!0}),e.decodeTuple=e.encodeTuple=e.decodeValue=e.encodingTypeOf=e.encodeValue=e.encodingRank=e.encodingByte=void 0;const i=r(Ej),s=il,o=eo,u=Wu,a=Vu;e.encodingByte={null:"b",object:"c",array:"d",number:"e",string:"f",boolean:"g"},e.encodingRank=new Map((0,s.sortBy)(Object.entries(e.encodingByte),([g,v])=>v).map(([g],v)=>[g,v]));function c(g,v){if(g===null)return e.encodingByte.null;if(g===!0||g===!1)return e.encodingByte.boolean+g;if(typeof g=="string"){for(const x of(v==null?void 0:v.disallow)??[])if(g.includes(x))throw new Error(`Disallowed character found: ${x}.`);return e.encodingByte.string+g}if(typeof g=="number")return e.encodingByte.number+i.encode(g);if(Array.isArray(g))return e.encodingByte.array+d(g,v);if(typeof g=="object")return e.encodingByte.object+y(g,v);throw new a.UnreachableError(g,"Unknown value type")}e.encodeValue=c;function l(g){if(g===null)return"null";if(g===!0||g===!1)return"boolean";if(typeof g=="string")return"string";if(typeof g=="number")return"number";if(Array.isArray(g))return"array";if(typeof g=="object")return"object";throw new a.UnreachableError(g,"Unknown value type")}e.encodingTypeOf=l;const f=(0,s.invert)(e.encodingByte);function p(g,v){const x=f[g[0]],S=g.slice(1);if(x==="null")return null;if(x==="boolean")return JSON.parse(S);if(x==="string")return S;if(x==="number")return i.decode(S);if(x==="array")return m(S,v);if(x==="object")return b(S,v);throw new a.UnreachableError(x,"Invalid encoding byte")}e.decodeValue=p;function d(g,v){const x=(v==null?void 0:v.delimiter)??"\0",S=(v==null?void 0:v.escape)??"",A=new RegExp(`${S}`,"g"),U=new RegExp(`${x}`,"g");return g.map((K,ce)=>c(K,v).replace(A,S+S).replace(U,S+x)+x).join("")}e.encodeTuple=d;function m(g,v){if(g==="")return[];const x=(v==null?void 0:v.delimiter)??"\0",S=(v==null?void 0:v.escape)??"",A=new RegExp(`(${S}(${S}|${x})|${x})`,"g"),U=new RegExp(S+S,"g"),K=new RegExp(S+x,"g"),ce=[];let le=0;for(;;){const Ke=A.exec(g);if(Ke===null)return ce;if(Ke[0][0]===S)continue;const W=Ke.index,ee=g.slice(le,W);typeof ee!="string"&&console.log(ee);const at=ee.replace(U,S).replace(K,x),wn=p(at,v);ce.push(wn),le=W+1}}e.decodeTuple=m;function y(g,v){if(!(0,o.isPlainObject)(g))throw new Error("Cannot serialize this object.");const x=Object.entries(g).sort(([S],[A])=>(0,u.compare)(S,A)).filter(([S,A])=>A!==void 0);return d(x,v)}function b(g,v){const x=m(g,v),S={};for(const[A,U]of x)S[A]=U;return S}})(bl);Object.defineProperty(Mt,"__esModule",{value:!0});Mt.TupleToString=Mt.ValueToString=_l=Mt.compareTuple=Mt.compareValue=void 0;const wf=eo,aa=bl,zi=Wu,Nj=Vu;function ic(e,t){const n=(0,aa.encodingTypeOf)(e),r=(0,aa.encodingTypeOf)(t);if(n===r){if(n==="array")return W0(e,t);if(n==="object")return e===t?0:(0,wf.isPlainObject)(e)?(0,wf.isPlainObject)(t)?Fj(e,t):-1:((0,wf.isPlainObject)(t),1);if(n==="boolean")return(0,zi.compare)(e,t);if(n==="null")return 0;if(n==="number")return(0,zi.compare)(e,t);if(n==="string")return(0,zi.compare)(e,t);throw new Nj.UnreachableError(n)}return(0,zi.compare)(aa.encodingRank.get(n),aa.encodingRank.get(r))}Mt.compareValue=ic;function Fj(e,t){const n=Object.entries(e).filter(([s,o])=>o!==void 0).sort(([s],[o])=>(0,zi.compare)(s,o)),r=Object.entries(t).filter(([s,o])=>o!==void 0).sort(([s],[o])=>(0,zi.compare)(s,o)),i=Math.min(n.length,r.length);for(let s=0;s<i;s++){const[o,u]=n[s],[a,c]=r[s],l=ic(o,a);if(l===0){const f=ic(u,c);if(f===0)continue;return f}return l}return n.length>r.length?1:n.length<r.length?-1:0}function W0(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const i=ic(e[r],t[r]);if(i!==0)return i}return e.length>t.length?1:e.length<t.length?-1:0}var _l=Mt.compareTuple=W0;function V0(e){return e===null?"null":JSON.stringify(e)}Mt.ValueToString=V0;function jj(e){return`[${e.map(V0).join(",")}]`}Mt.TupleToString=jj;var Pt={},Er={};Object.defineProperty(Er,"__esModule",{value:!0});Er.binarySearchAssociativeList=Er.binarySearch=Er.generalizedBinarySearch=void 0;function mh(e,t){return function(n,r){for(var i=0,s=n.length-1;i<=s;){var o=s+i>>1,u=t(r,e(n[o]));if(u>0)i=o+1;else if(u<0)s=o-1;else return{found:o}}return{closest:i}}}Er.generalizedBinarySearch=mh;function Cj(e,t,n){return mh(r=>r,n)(e,t)}Er.binarySearch=Cj;function Dj(e,t,n){return mh(r=>r[0],n)(e,t)}Er.binarySearchAssociativeList=Dj;Object.defineProperty(Pt,"__esModule",{value:!0});Pt.scan=Pt.remove=Pt.exists=Pt.get=Pt.set=void 0;const _s=Er;function Lj(e,t,n){const r=(0,_s.binarySearch)(e,t,n);r.found!==void 0?e.splice(r.found,1,t):e.splice(r.closest,0,t)}Pt.set=Lj;function Bj(e,t,n){const r=(0,_s.binarySearch)(e,t,n);if(r.found!==void 0)return e[r.found]}Pt.get=Bj;function Uj(e,t,n){return(0,_s.binarySearch)(e,t,n).found!==void 0}Pt.exists=Uj;function zj(e,t,n){let{found:r}=(0,_s.binarySearch)(e,t,n);if(r!==void 0)return e.splice(r,1)[0]}Pt.remove=zj;function Wj(e,t,n){const r=t.gte||t.gt,i=t.lte||t.lt;if(r!==void 0&&i!==void 0&&n(r,i)>0)throw new Error("Invalid bounds.");let s,o;if(r===void 0)s=0;else{const c=(0,_s.binarySearch)(e,r,n);c.found===void 0?s=c.closest:t.gt?s=c.found+1:s=c.found}if(i===void 0)o=e.length;else{const c=(0,_s.binarySearch)(e,i,n);c.found===void 0?o=c.closest:t.lt?o=c.found:o=c.found+1}const u=t.reverse&&t.limit?Math.max(s,o-t.limit):s,a=!t.reverse&&t.limit?Math.min(s+t.limit,o):o;return t.reverse?e.slice(u,a).reverse():e.slice(u,a)}Pt.scan=Wj;(function(e){var t=M&&M.__createBinding||(Object.create?function(y,b,g,v){v===void 0&&(v=g);var x=Object.getOwnPropertyDescriptor(b,g);(!x||("get"in x?!b.__esModule:x.writable||x.configurable))&&(x={enumerable:!0,get:function(){return b[g]}}),Object.defineProperty(y,v,x)}:function(y,b,g,v){v===void 0&&(v=g),y[v]=b[g]}),n=M&&M.__setModuleDefault||(Object.create?function(y,b){Object.defineProperty(y,"default",{enumerable:!0,value:b})}:function(y,b){y.default=b}),r=M&&M.__importStar||function(y){if(y&&y.__esModule)return y;var b={};if(y!=null)for(var g in y)g!=="default"&&Object.prototype.hasOwnProperty.call(y,g)&&t(b,y,g);return n(b,y),b};Object.defineProperty(e,"__esModule",{value:!0}),e.scan=e.isTupleWithinBounds=e.getPrefixContainingBounds=e.normalizeTupleBounds=e.MaxTuple=e.remove=e.exists=e.set=void 0;const i=il,s=Dr,o=Mt,u=r(Pt);function a(y,b){return u.set(y,b,o.compareTuple)}e.set=a;function c(y,b){return u.exists(y,b,o.compareTuple)}e.exists=c;function l(y,b){return u.remove(y,b,o.compareTuple)}e.remove=l,e.MaxTuple=[s.MAX,s.MAX,s.MAX,s.MAX,s.MAX,s.MAX,s.MAX,s.MAX,s.MAX,s.MAX];function f(y){let b,g,v,x;return y.gte?y.prefix?b=[...y.prefix,...y.gte]:b=[...y.gte]:y.gt?y.prefix?g=[...y.prefix,...y.gt]:g=[...y.gt]:y.prefix&&(b=[...y.prefix]),y.lte?y.prefix?v=[...y.prefix,...y.lte]:v=[...y.lte]:y.lt?y.prefix?x=[...y.prefix,...y.lt]:x=[...y.lt]:y.prefix&&(v=[...y.prefix,...e.MaxTuple]),(0,i.omitBy)({gte:b,gt:g,lte:v,lt:x},S=>S===void 0)}e.normalizeTupleBounds=f;function p(y){const b=[],g=y.gt||y.gte||[],v=y.lt||y.lte||[],x=Math.min(g.length,v.length);for(let S=0;S<x&&g[S]===v[S];S++)b.push(g[S]);return b}e.getPrefixContainingBounds=p;function d(y,b){return!(b.gt&&(0,o.compareTuple)(y,b.gt)!==1||b.gte&&(0,o.compareTuple)(y,b.gte)===-1||b.lt&&(0,o.compareTuple)(y,b.lt)!==-1||b.lte&&(0,o.compareTuple)(y,b.lte)===1)}e.isTupleWithinBounds=d;function m(y,b={}){const{limit:g,reverse:v,...x}=b,S=f(x);return u.scan(y,{limit:g,reverse:v,...S},o.compareTuple)}e.scan=m})(Qr);Object.defineProperty(Nn,"__esModule",{value:!0});Nn.ConcurrencyLog=Nn.ReadWriteConflictError=void 0;const cy=gl,Vj=wl,bf=Qr;class q0 extends Error{constructor(t,n,r){const i=(0,Vj.outdent)(`
      ReadWriteConflictError: ${t}
      Write to tuple ${n}
      conflicted with a read at the bounds ${JSON.stringify(r)}
    `);super(i)}}Nn.ReadWriteConflictError=q0;class qj{constructor(){this.log=[]}read(t,n){this.log.push({type:"read",txId:t,bounds:n})}write(t,n){for(const r of this.log)if(r.type==="read"&&(0,bf.isTupleWithinBounds)(n,r.bounds)){this.log.push({type:"write",tuple:n,txId:t});break}}commit(t){try{const n=[];for(const r of this.log)if(r.type==="read")r.txId===t&&n.push(r.bounds);else if(r.type==="write"){for(const i of n)if((0,bf.isTupleWithinBounds)(r.tuple,i))throw new q0(r.txId,r.tuple,i)}}finally{this.cleanupReads(t),this.cleanupWrites()}}cancel(t){this.cleanupReads(t),this.cleanupWrites()}cleanupReads(t){(0,cy.mutableFilter)(this.log,n=>!(n.txId===t&&n.type==="read"))}cleanupWrites(){const t=[];(0,cy.mutableFilter)(this.log,n=>{if(n.type==="read")return t.push(n.bounds),!0;for(const r of t)if((0,bf.isTupleWithinBounds)(n.tuple,r))return!0;return!1})}}Nn.ConcurrencyLog=qj;var vl={},qu={};Object.defineProperty(qu,"__esModule",{value:!0});qu.maybePromiseAll=void 0;function Jj(e){return e.some(t=>t instanceof Promise)?Promise.all(e.map(t=>t instanceof Promise?t.catch(n=>console.error(n)):t)):e}qu.maybePromiseAll=Jj;var Kj=M&&M.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Qj=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Hj=M&&M.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Kj(t,e,n);return Qj(t,e),t};Object.defineProperty(vl,"__esModule",{value:!0});vl.AsyncReactivityTracker=void 0;const Gj=qu,ly=Hj(Qr);class Xj{constructor(){this.listeners=new Map}subscribe(t,n){return Zj(this.listeners,t,n)}computeReactivityEmits(t){return Yj(this.listeners,t)}async emit(t,n){let r=[];for(const[i,s]of t.entries())try{r.push(i(s,n))}catch(o){console.error(o)}return(0,Gj.maybePromiseAll)(r)}}vl.AsyncReactivityTracker=Xj;function Yj(e,t){const n=new Map;for(const[r,i]of e){const s=[],o=[];for(const u of t.set||[])ly.isTupleWithinBounds(u.key,i)&&s.push(u);for(const u of t.remove||[])ly.isTupleWithinBounds(u,i)&&o.push(u);(s.length>0||o.length>0)&&n.set(r,{set:s,remove:o})}return n}function Zj(e,t,n){return e.set(n,t),()=>{e.delete(n)}}Object.defineProperty(nl,"__esModule",{value:!0});nl.AsyncTupleDatabase=void 0;const eC=gi,tC=Ei,nC=Nn,rC=vl;class iC{constructor(t){this.storage=t,this.log=new nC.ConcurrencyLog,this.reactivity=new rC.AsyncReactivityTracker}async scan(t={},n){const{reverse:r,limit:i,...s}=t;return n&&this.log.read(n,s),this.storage.scan({...s,reverse:r,limit:i})}async subscribe(t,n){return this.reactivity.subscribe(t,n)}async commit(t,n){const r=this.reactivity.computeReactivityEmits(t);n&&this.log.commit(n);for(const i of(0,eC.iterateWrittenTuples)(t))this.log.write(n,i);return await this.storage.commit(t),this.reactivity.emit(r,n||(0,tC.randomId)())}async cancel(t){this.log.cancel(t)}async close(){await this.storage.close()}}nl.AsyncTupleDatabase=iC;var Un={},Ze={},sC=M&&M.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),oC=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),uC=M&&M.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&sC(t,e,n);return oC(t,e),t};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.scan=Ze.exists=Ze.get=Ze.remove=Ze.set=Ze.compareTupleValuePair=void 0;const J0=Mt,Ju=uC(Pt),aC=Qr;function to(e,t){return(0,J0.compareTuple)(e.key,t.key)}Ze.compareTupleValuePair=to;function xl(e,t){return(0,J0.compareTuple)(e.key,t.key)*-1}function cC(e,t,n,r=!1){return Ju.set(e,{key:t,value:n},r?xl:to)}Ze.set=cC;function lC(e,t,n=!1){return Ju.remove(e,{key:t,value:null},n?xl:to)}Ze.remove=lC;function fC(e,t,n=!1){const r=Ju.get(e,{key:t,value:null},n?xl:to);if(r!==void 0)return r.value}Ze.get=fC;function dC(e,t,n=!1){return Ju.exists(e,{key:t,value:null},n?xl:to)}Ze.exists=dC;function pC(e){const t=(0,aC.normalizeTupleBounds)(e),{gt:n,lt:r,gte:i,lte:s}=t;return{gt:n?{key:n,value:null}:void 0,gte:i?{key:i,value:null}:void 0,lt:r?{key:r,value:null}:void 0,lte:s?{key:s,value:null}:void 0}}function hC(e,t={}){const{limit:n,reverse:r,...i}=t,s=pC(i);return Ju.scan(e,{limit:n,reverse:r,...s},to)}Ze.scan=hC;var ft={};Object.defineProperty(ft,"__esModule",{value:!0});ft.normalizeSubspaceScanArgs=ft.removePrefixFromTupleValuePairs=ft.removePrefixFromTuple=ft.removePrefixFromWriteOps=ft.prependPrefixToWriteOps=ft.prependPrefixToTuple=void 0;const K0=il,mC=Qr;function yh(e,t){return e.length?[...e,...t]:t}ft.prependPrefixToTuple=yh;function yC(e,t){return e.length?t.map(n=>yh(e,n)):t}function gC(e,t){if(!e.length)return t;const{key:n,value:r}=t;return{key:yh(e,n),value:r}}function wC(e,t){return e.length?t.map(n=>gC(e,n)):t}function bC(e,t){if(!e.length)return t;const n=t.set?wC(e,t.set):void 0,r=t.remove?yC(e,t.remove):void 0;return{set:n,remove:r}}ft.prependPrefixToWriteOps=bC;function _C(e,t){if(!e.length)return t;const n=t.set?Q0(e,t.set):void 0,r=t.remove?vC(e,t.remove):void 0;return{set:n,remove:r}}ft.removePrefixFromWriteOps=_C;function gh(e,t){if(!e.length)return t;if(!(0,K0.equals)(t.slice(0,e.length),e))throw new Error("Invalid prefix: "+JSON.stringify({prefix:e,tuple:t}));return t.slice(e.length)}ft.removePrefixFromTuple=gh;function vC(e,t){return e.length?t.map(n=>gh(e,n)):t}function xC(e,t){if(!e.length)return t;const{key:n,value:r}=t;return{key:gh(e,n),value:r}}function Q0(e,t){return e.length?t.map(n=>xC(e,n)):t}ft.removePrefixFromTupleValuePairs=Q0;function SC(e,t){const n=t.prefix?[...e,...t.prefix]:e,r=(0,mC.normalizeTupleBounds)({...t,prefix:n}),{limit:i,reverse:s}=t;return(0,K0.omitBy)({...r,limit:i,reverse:s},o=>o===void 0)}ft.normalizeSubspaceScanArgs=SC;var fy;function G0(){if(fy)return Un;fy=1;var e=M&&M.__createBinding||(Object.create?function(f,p,d,m){m===void 0&&(m=d);var y=Object.getOwnPropertyDescriptor(p,d);(!y||("get"in y?!p.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return p[d]}}),Object.defineProperty(f,m,y)}:function(f,p,d,m){m===void 0&&(m=d),f[m]=p[d]}),t=M&&M.__setModuleDefault||(Object.create?function(f,p){Object.defineProperty(f,"default",{enumerable:!0,value:p})}:function(f,p){f.default=p}),n=M&&M.__importStar||function(f){if(f&&f.__esModule)return f;var p={};if(f!=null)for(var d in f)d!=="default"&&Object.prototype.hasOwnProperty.call(f,d)&&e(p,f,d);return t(p,f),p};Object.defineProperty(Un,"__esModule",{value:!0}),Un.AsyncTupleSubspaceTransaction=Un.AsyncTupleRootTransaction=Un.AsyncTupleDatabaseClient=void 0;const r=Ei,i=n(Qr),s=n(Ze),o=ft,u=wh();let a=class H0{constructor(p,d=[]){this.db=p,this.subspacePrefix=d}async scan(p={},d){const m=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p),y=await this.db.scan(m,d);return(0,o.removePrefixFromTupleValuePairs)(this.subspacePrefix,y)}async subscribe(p,d){const m=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p);return this.db.subscribe(m,(y,b)=>d((0,o.removePrefixFromWriteOps)(this.subspacePrefix,y),b))}async commit(p,d){const m=(0,o.prependPrefixToWriteOps)(this.subspacePrefix,p);await this.db.commit(m,d)}async cancel(p){return this.db.cancel(p)}async get(p,d){const m=await this.scan({gte:p,lte:p},d);if(m.length===0)return;if(m.length>1)throw new Error("Get expects only one value.");return m[0].value}async exists(p,d){const m=await this.scan({gte:p,lte:p},d);return m.length===0?!1:m.length>=1}subspace(p){const d=[...this.subspacePrefix,...p];return new H0(this.db,d)}transact(p,d){const m=p||(0,r.randomId)();return new c(this.db,this.subspacePrefix,m,d)}async close(){return this.db.close()}};Un.AsyncTupleDatabaseClient=a;class c{constructor(p,d,m,y){this.db=p,this.subspacePrefix=d,this.id=m,this.committed=!1,this.canceled=!1,this.setsDirty=!1,this.removesDirty=!1,this.writes={set:[],remove:[],...y}}cleanWrites(){this.cleanSets(),this.cleanRemoves()}cleanSets(){this.setsDirty&&(this.writes.set=this.writes.set.sort(s.compareTupleValuePair),this.setsDirty=!1)}cleanRemoves(){this.removesDirty&&(this.writes.remove=this.writes.remove.sort(u.compareTuple),this.removesDirty=!1)}checkActive(){if(this.committed)throw new Error("Transaction already committed");if(this.canceled)throw new Error("Transaction already canceled")}async scan(p={}){this.checkActive(),this.cleanWrites();const{limit:d,...m}=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p),y=s.scan(this.writes.set,m),b=i.scan(this.writes.remove,m),g=d?d+b.length:void 0,v=await this.db.scan({...m,limit:g},this.id),x=(0,o.removePrefixFromTupleValuePairs)(this.subspacePrefix,v);for(const{key:S,value:A}of y){const U=(0,o.removePrefixFromTuple)(this.subspacePrefix,S);s.set(x,U,A,m.reverse)}for(const S of b){const A=(0,o.removePrefixFromTuple)(this.subspacePrefix,S);s.remove(x,A,m.reverse)}return d&&x.length>d&&x.splice(d,x.length),x}async get(p){this.checkActive(),this.cleanWrites();const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);if(s.exists(this.writes.set,d))return s.get(this.writes.set,d);if(i.exists(this.writes.remove,d))return;const m=await this.db.scan({gte:d,lte:d},this.id);if(m.length===0)return;if(m.length>1)throw new Error("Get expects only one value.");return m[0].value}async exists(p){this.checkActive(),this.cleanWrites();const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);if(s.exists(this.writes.set,d))return!0;if(i.exists(this.writes.remove,d))return!1;const m=await this.db.scan({gte:d,lte:d},this.id);return m.length===0?!1:m.length>=1}set(p,d){this.checkActive(),this.cleanRemoves();const m=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return i.remove(this.writes.remove,m),this.writes.set.push({key:m,value:d}),this.setsDirty=!0,this}remove(p){this.checkActive(),this.cleanSets();const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return s.remove(this.writes.set,d),this.writes.remove.push(d),this.removesDirty=!0,this}write(p){this.checkActive();const{set:d,remove:m}=p;for(const y of m||[])this.remove(y);for(const{key:y,value:b}of d||[])this.set(y,b);return this}async commit(){return this.checkActive(),this.committed=!0,this.db.commit(this.writes,this.id)}async cancel(){return this.checkActive(),this.canceled=!0,this.db.cancel(this.id)}subspace(p){return this.checkActive(),new l(this,p)}}Un.AsyncTupleRootTransaction=c;class l{constructor(p,d){this.tx=p,this.subspacePrefix=d}async scan(p={}){const d=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p),m=await this.tx.scan(d);return(0,o.removePrefixFromTupleValuePairs)(this.subspacePrefix,m)}async get(p){const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.get(d)}async exists(p){const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.exists(d)}set(p,d){const m=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.set(m,d),this}remove(p){const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.remove(d),this}write(p){const{set:d,remove:m}=p;for(const y of m||[])this.remove(y);for(const{key:y,value:b}of d||[])this.set(y,b);return this}subspace(p){return new l(this.tx,[...this.subspacePrefix,...p])}}return Un.AsyncTupleSubspaceTransaction=l,Un}var X0={};Object.defineProperty(X0,"__esModule",{value:!0});var ao={},Ku={};Object.defineProperty(Ku,"__esModule",{value:!0});Ku.isEmptyWrites=void 0;function OC(e){var t,n;return!((t=e.remove)!=null&&t.length||(n=e.set)!=null&&n.length)}Ku.isEmptyWrites=OC;var Qu={};Object.defineProperty(Qu,"__esModule",{value:!0});Qu.Queue=void 0;class $C{enqueue(t){if(this.currentPromise){const r=this.currentPromise.then(t).then(i=>(this.currentPromise===r&&(this.currentPromise=void 0),i));return this.currentPromise=r,r}const n=t();if(n instanceof Promise){const r=n.then(i=>(this.currentPromise===r&&(this.currentPromise=void 0),i));return this.currentPromise=r,r}return n}}Qu.Queue=$C;var dy;function TC(){if(dy)return ao;dy=1,Object.defineProperty(ao,"__esModule",{value:!0}),ao.subscribeQueryAsync=void 0;const e=Ku,t=Qu,n=G0(),r=()=>{throw new Error};async function i(s,o,u){let a=!1;const c=new Set,l=()=>o(y),f=()=>{c.forEach(v=>v()),c.clear()};let p;const d=async v=>{if(a||v===p)return;p=v,f();const x=await l();u(x)},m=new t.Queue,y=new n.AsyncTupleDatabaseClient({scan:async(v,x)=>{const S=await s.subscribe(v,async(U,K)=>m.enqueue(()=>d(K)));return c.add(S),await s.scan(v)},cancel:async v=>{await s.cancel(v)},commit:async(v,x)=>{if(!(0,e.isEmptyWrites)(v))throw new Error("No writing in a subscribeQueryAsync.");await s.commit({},x)},subscribe:r,close:r});return{result:await l(),destroy:()=>{f(),a=!0}}}return ao.subscribeQueryAsync=i,ao}var Sl={},no={};Object.defineProperty(no,"__esModule",{value:!0});no.retry=void 0;const IC=Nn;function AC(e,t){for(;;)try{return t()}catch(n){if(e<=0||!(n instanceof IC.ReadWriteConflictError))throw n;e-=1}}no.retry=AC;Object.defineProperty(Sl,"__esModule",{value:!0});Sl.transactionalReadAsync=void 0;const kC=no;function PC(e=5){return function(t){return function(n,...r){return"transact"in n?(0,kC.retry)(e,()=>{const i=n.transact(),s=t(i,...r);return i.commit(),s}):t(n,...r)}}}Sl.transactionalReadAsync=PC;var vs={},Ol={};Object.defineProperty(Ol,"__esModule",{value:!0});Ol.retryAsync=void 0;const EC=Nn,RC=1e3,MC=10;async function NC(e,t,n={}){let r=0,i=0;const{exponentialBackoff:s,jitter:o}=n,u=n.backoffBase??MC,a=n.maxDelay??RC;for(;;)try{return i+=1,await t()}catch(c){if(e<=0||!(c instanceof EC.ReadWriteConflictError))throw c;s&&(r=Math.min(u*2**i,a)),o&&(r=FC(0,r||a)),e-=1,r&&await new Promise(f=>setTimeout(f,r))}}Ol.retryAsync=NC;function FC(e,t){return Math.floor(Math.random()*(t-e+1)+e)}Object.defineProperty(vs,"__esModule",{value:!0});vs.transactionalAsyncQuery=vs.transactionalReadWriteAsync=void 0;const jC=Ol;function Y0(e=5,t={}){return function(n){return async function(r,...i){return"transact"in r?await(0,jC.retryAsync)(e,async()=>{const s=r.transact(),o=await n(s,...i);return await s.commit(),o},t):n(r,...i)}}}vs.transactionalReadWriteAsync=Y0;vs.transactionalAsyncQuery=Y0;var co={},zn={},py;function e_(){if(py)return zn;py=1;var e=M&&M.__createBinding||(Object.create?function(f,p,d,m){m===void 0&&(m=d);var y=Object.getOwnPropertyDescriptor(p,d);(!y||("get"in y?!p.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return p[d]}}),Object.defineProperty(f,m,y)}:function(f,p,d,m){m===void 0&&(m=d),f[m]=p[d]}),t=M&&M.__setModuleDefault||(Object.create?function(f,p){Object.defineProperty(f,"default",{enumerable:!0,value:p})}:function(f,p){f.default=p}),n=M&&M.__importStar||function(f){if(f&&f.__esModule)return f;var p={};if(f!=null)for(var d in f)d!=="default"&&Object.prototype.hasOwnProperty.call(f,d)&&e(p,f,d);return t(p,f),p};Object.defineProperty(zn,"__esModule",{value:!0}),zn.TupleSubspaceTransaction=zn.TupleRootTransaction=zn.TupleDatabaseClient=void 0;const r=Ei,i=n(Qr),s=n(Ze),o=ft,u=wh();let a=class Z0{constructor(p,d=[]){this.db=p,this.subspacePrefix=d}scan(p={},d){const m=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p),y=this.db.scan(m,d);return(0,o.removePrefixFromTupleValuePairs)(this.subspacePrefix,y)}subscribe(p,d){const m=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p);return this.db.subscribe(m,(y,b)=>d((0,o.removePrefixFromWriteOps)(this.subspacePrefix,y),b))}commit(p,d){const m=(0,o.prependPrefixToWriteOps)(this.subspacePrefix,p);this.db.commit(m,d)}cancel(p){return this.db.cancel(p)}get(p,d){const m=this.scan({gte:p,lte:p},d);if(m.length===0)return;if(m.length>1)throw new Error("Get expects only one value.");return m[0].value}exists(p,d){const m=this.scan({gte:p,lte:p},d);return m.length===0?!1:m.length>=1}subspace(p){const d=[...this.subspacePrefix,...p];return new Z0(this.db,d)}transact(p,d){const m=p||(0,r.randomId)();return new c(this.db,this.subspacePrefix,m,d)}close(){return this.db.close()}};zn.TupleDatabaseClient=a;class c{constructor(p,d,m,y){this.db=p,this.subspacePrefix=d,this.id=m,this.committed=!1,this.canceled=!1,this.setsDirty=!1,this.removesDirty=!1,this.writes={set:[],remove:[],...y}}cleanWrites(){this.cleanSets(),this.cleanRemoves()}cleanSets(){this.setsDirty&&(this.writes.set=this.writes.set.sort(s.compareTupleValuePair),this.setsDirty=!1)}cleanRemoves(){this.removesDirty&&(this.writes.remove=this.writes.remove.sort(u.compareTuple),this.removesDirty=!1)}checkActive(){if(this.committed)throw new Error("Transaction already committed");if(this.canceled)throw new Error("Transaction already canceled")}scan(p={}){this.checkActive(),this.cleanWrites();const{limit:d,...m}=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p),y=s.scan(this.writes.set,m),b=i.scan(this.writes.remove,m),g=d?d+b.length:void 0,v=this.db.scan({...m,limit:g},this.id),x=(0,o.removePrefixFromTupleValuePairs)(this.subspacePrefix,v);for(const{key:S,value:A}of y){const U=(0,o.removePrefixFromTuple)(this.subspacePrefix,S);s.set(x,U,A,m.reverse)}for(const S of b){const A=(0,o.removePrefixFromTuple)(this.subspacePrefix,S);s.remove(x,A,m.reverse)}return d&&x.length>d&&x.splice(d,x.length),x}get(p){this.checkActive(),this.cleanWrites();const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);if(s.exists(this.writes.set,d))return s.get(this.writes.set,d);if(i.exists(this.writes.remove,d))return;const m=this.db.scan({gte:d,lte:d},this.id);if(m.length===0)return;if(m.length>1)throw new Error("Get expects only one value.");return m[0].value}exists(p){this.checkActive(),this.cleanWrites();const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);if(s.exists(this.writes.set,d))return!0;if(i.exists(this.writes.remove,d))return!1;const m=this.db.scan({gte:d,lte:d},this.id);return m.length===0?!1:m.length>=1}set(p,d){this.checkActive(),this.cleanRemoves();const m=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return i.remove(this.writes.remove,m),this.writes.set.push({key:m,value:d}),this.setsDirty=!0,this}remove(p){this.checkActive(),this.cleanSets();const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return s.remove(this.writes.set,d),this.writes.remove.push(d),this.removesDirty=!0,this}write(p){this.checkActive();const{set:d,remove:m}=p;for(const y of m||[])this.remove(y);for(const{key:y,value:b}of d||[])this.set(y,b);return this}commit(){return this.checkActive(),this.committed=!0,this.db.commit(this.writes,this.id)}cancel(){return this.checkActive(),this.canceled=!0,this.db.cancel(this.id)}subspace(p){return this.checkActive(),new l(this,p)}}zn.TupleRootTransaction=c;class l{constructor(p,d){this.tx=p,this.subspacePrefix=d}scan(p={}){const d=(0,o.normalizeSubspaceScanArgs)(this.subspacePrefix,p),m=this.tx.scan(d);return(0,o.removePrefixFromTupleValuePairs)(this.subspacePrefix,m)}get(p){const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.get(d)}exists(p){const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.exists(d)}set(p,d){const m=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.set(m,d),this}remove(p){const d=(0,o.prependPrefixToTuple)(this.subspacePrefix,p);return this.tx.remove(d),this}write(p){const{set:d,remove:m}=p;for(const y of m||[])this.remove(y);for(const{key:y,value:b}of d||[])this.set(y,b);return this}subspace(p){return new l(this.tx,[...this.subspacePrefix,...p])}}return zn.TupleSubspaceTransaction=l,zn}var hy;function CC(){if(hy)return co;hy=1,Object.defineProperty(co,"__esModule",{value:!0}),co.subscribeQuery=void 0;const e=Ku,t=Qu,n=e_(),r=()=>{throw new Error};function i(s,o,u){let a=!1;const c=new Set,l=()=>o(y),f=()=>{c.forEach(v=>v()),c.clear()};let p;const d=v=>{if(a||v===p)return;p=v,f();const x=l();u(x)},m=new t.Queue,y=new n.TupleDatabaseClient({scan:(v,x)=>{const S=s.subscribe(v,(U,K)=>m.enqueue(()=>d(K)));return c.add(S),s.scan(v)},cancel:v=>{s.cancel(v)},commit:(v,x)=>{if(!(0,e.isEmptyWrites)(v))throw new Error("No writing in a subscribeQuery.");s.commit({},x)},subscribe:r,close:r});return{result:l(),destroy:()=>{f(),a=!0}}}return co.subscribeQuery=i,co}var $l={};Object.defineProperty($l,"__esModule",{value:!0});$l.transactionalRead=void 0;const DC=no;function LC(e=5){return function(t){return function(n,...r){return"transact"in n?(0,DC.retry)(e,()=>{const i=n.transact(),s=t(i,...r);return i.commit(),s}):t(n,...r)}}}$l.transactionalRead=LC;var xs={},Tl={};Object.defineProperty(Tl,"__esModule",{value:!0});Tl.retry=void 0;const BC=Nn,UC=1e3,zC=10;function WC(e,t,n={}){let r=0,i=0;const{exponentialBackoff:s,jitter:o}=n,u=n.backoffBase??zC,a=n.maxDelay??UC;for(;;)try{return i+=1,t()}catch(c){if(e<=0||!(c instanceof BC.ReadWriteConflictError))throw c;s&&(r=Math.min(u*2**i,a)),o&&(r=VC(0,r||a)),e-=1,r&&new Promise(f=>setTimeout(f,r))}}Tl.retry=WC;function VC(e,t){return Math.floor(Math.random()*(t-e+1)+e)}Object.defineProperty(xs,"__esModule",{value:!0});xs.transactionalQuery=xs.transactionalReadWrite=void 0;const qC=Tl;function t_(e=5,t={}){return function(n){return function(r,...i){return"transact"in r?(0,qC.retry)(e,()=>{const s=r.transact(),o=n(s,...i);return s.commit(),o},t):n(r,...i)}}}xs.transactionalReadWrite=t_;xs.transactionalQuery=t_;var Il={},Al={},JC=M&&M.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),KC=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),QC=M&&M.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&JC(t,e,n);return KC(t,e),t};Object.defineProperty(Al,"__esModule",{value:!0});Al.ReactivityTracker=void 0;const HC=qu,my=QC(Qr);class GC{constructor(){this.listeners=new Map}subscribe(t,n){return YC(this.listeners,t,n)}computeReactivityEmits(t){return XC(this.listeners,t)}emit(t,n){let r=[];for(const[i,s]of t.entries())try{r.push(i(s,n))}catch(o){console.error(o)}return(0,HC.maybePromiseAll)(r)}}Al.ReactivityTracker=GC;function XC(e,t){const n=new Map;for(const[r,i]of e){const s=[],o=[];for(const u of t.set||[])my.isTupleWithinBounds(u.key,i)&&s.push(u);for(const u of t.remove||[])my.isTupleWithinBounds(u,i)&&o.push(u);(s.length>0||o.length>0)&&n.set(r,{set:s,remove:o})}return n}function YC(e,t,n){return e.set(n,t),()=>{e.delete(n)}}Object.defineProperty(Il,"__esModule",{value:!0});Il.TupleDatabase=void 0;const ZC=gi,eD=Ei,tD=Nn,nD=Al;class rD{constructor(t){this.storage=t,this.log=new tD.ConcurrencyLog,this.reactivity=new nD.ReactivityTracker}scan(t={},n){const{reverse:r,limit:i,...s}=t;return n&&this.log.read(n,s),this.storage.scan({...s,reverse:r,limit:i})}subscribe(t,n){return this.reactivity.subscribe(t,n)}commit(t,n){const r=this.reactivity.computeReactivityEmits(t);n&&this.log.commit(n);for(const i of(0,ZC.iterateWrittenTuples)(t))this.log.write(n,i);return this.storage.commit(t),this.reactivity.emit(r,n||(0,eD.randomId)())}cancel(t){this.log.cancel(t)}close(){this.storage.close()}}Il.TupleDatabase=rD;var n_={};Object.defineProperty(n_,"__esModule",{value:!0});var kl={};Object.defineProperty(kl,"__esModule",{value:!0});kl.transactionalWrite=void 0;const iD=no;function sD(e=5){return function(t){return function(n,...r){return"set"in n?t(n,...r):(0,iD.retry)(e,()=>{const i=n.transact(),s=t(i,...r);return i.commit(),s})}}}kl.transactionalWrite=sD;var r_={};Object.defineProperty(r_,"__esModule",{value:!0});var Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.namedTupleToObject=void 0;const oD=eo;function uD(e){return(0,oD.isPlainObject)(e)}function aD(e){return e.filter(uD).reduce((n,r)=>Object.assign(n,r),{})}Pl.namedTupleToObject=aD;var El={},cD=M&&M.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),lD=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),fD=M&&M.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&cD(t,e,n);return lD(t,e),t};Object.defineProperty(El,"__esModule",{value:!0});El.InMemoryTupleStorage=void 0;const _f=fD(Ze);class dD{constructor(t){this.data=t||[]}scan(t){return _f.scan(this.data,t)}commit(t){const{set:n,remove:r}=t;for(const i of r||[])_f.remove(this.data,i);for(const{key:i,value:s}of n||[])_f.set(this.data,i,s)}close(){}}El.InMemoryTupleStorage=dD;var yy;function wh(){return yy||(yy=1,function(e){var t=M&&M.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),n=M&&M.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&t(s,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),e.compareTuple=void 0,n(nl,e),n(G0(),e),n(X0,e),n(TC(),e),n(Sl,e),n(vs,e),n(CC(),e),n($l,e),n(xs,e),n(Il,e),n(e_(),e),n(n_,e),n(kl,e),n(r_,e),n(Pl,e),n(El,e),n(Dr,e);var r=Mt;Object.defineProperty(e,"compareTuple",{enumerable:!0,get:function(){return r.compareTuple}}),n(bl,e)}(df)),df}var q=wh();function Lr(e){return e instanceof Array&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"}function Fn(e){return e instanceof Object&&"mod"in e}function lr(e){return e instanceof Object&&"exists"in e}function Hu(e){return e instanceof Object&&"type"in e&&e.type==="relationshipExists"}function Rl(e){return typeof e=="boolean"}class Ml{constructor(t){I(this,"data",{});I(this,"triples",{});I(this,"tripleHistory",{});t&&(this.data=t.data??{},this.triples=t.triples.reduce((n,r)=>(n["/"+r.attribute.join("/")]=r,n),{}))}applyTriple(t){const{attribute:n,value:r,timestamp:i,expired:s}=t;let o=s?void 0:r;if(Array.isArray(o)&&(o=[...o]),n[0]==="_collection"){const f="/_collection";return xn.Set(this.data,f,o,i),this.triples[f]=t,this.tripleHistory[f]?this.tripleHistory[f].push(t):this.tripleHistory[f]=[t],!0}const[u,...a]=n,l="/"+a.map(f=>f.toString().replaceAll("/","~")).join("/");this.tripleHistory[l]?this.tripleHistory[l].push(t):this.tripleHistory[l]=[t];for(let f=0;f<a.length;f++)if(typeof a[f]=="number"){const d="/"+a.slice(0,f).join("/");xn.Get(this.data,d)||xn.Set(this.data,d,[],i)}{let f="/";for(let p=0;p<a.length;p++){f+=a[p];const d=xn.Get(this.data,f);if(d&&Pn(i,d[1])<0)return!1;f+="/"}}if(o==="{}"){const f=xn.Get(this.data,l);if(f===void 0)o={};else{const p=i_(f,i);p?o=p[0]:o={}}}return xn.Set(this.data,l,o,i),this.triples[l]=t,!0}}function i_(e,t){if(typeof e[0]=="object"&&e[0]!==null){const[n,r]=e;for(const i in n){const s=n[i];i_(s,t)||delete n[i]}return Object.keys(n).length===0&&Pn(r,t)===-1?void 0:[n,r]}if(Pn(e[1],t)!==-1)return e}var xn;(function(e){function t(u){return u.indexOf("~")===-1?u:u.replace(/~1/g,"/").replace(/~0/g,"~")}function*n(u){if(u==="")throw new Error(`Invalid pointer: "${u}"`);let[a,c]=[0,0];for(let l=0;l<u.length;l++)u.charAt(l)==="/"?(l===0||(c=l,yield t(u.slice(a,c))),a=l+1):c=l;yield t(u.slice(a))}e.Format=n;function r(u,a,c,l){if(a==="")throw new Error(`ValuePointerRootSetError - (${JSON.stringify(u)}, ${a}, ${JSON.stringify([c,l])})`);let[f,p,d]=[null,u,""];for(const m of n(a)){if(c===void 0&&p===void 0)return;p===void 0&&(p={},f[d][0]=p),p[m]===void 0&&(p[m]=[{},void 0]),f=p,p=p[m][0],d=m}f[d]=[c,l]}e.Set=r;function i(u,a){throw new Error("EntityPointer.Delete() is not implemented")}e.Delete=i;function s(u,a){throw new Error("EntityPointer.Has() is not implemented")}e.Has=s;function o(u,a){var f;if(a==="")return u;let c=u,l=!0;for(const p of n(a)){const d=l?c[p]:(f=c[0])==null?void 0:f[p];if(d===void 0)return;c=d,l=!1}return c}e.Get=o})(xn||(xn={}));function bh(e,t){return t.reduce((n,r)=>e.applyTriple(r)||n,!1)}function ro(e,t){return e.reduce((n,r)=>{const{id:i,timestamp:s}=r;if(t){const[u,a]=s;if(!t.has(a))return n;const c=t.get(a);if(c&&Pn(s,[c,a])>0)return n}const o=n.get(i)??new Ml;return o.applyTriple(r),n.set(i,o),n},new Map)}function Ss(e,t){return ro(e).get(t)}function pD(e,t){return{type:"relationshipExists",relationship:e,query:t}}function hD(e,t){if(!e&&!t)return 0;if(!e)return-1;if(!t)return 1;let n=e[0],r=t[0];return n instanceof Date&&(n=n.getTime()),r instanceof Date&&(r=r.getTime()),n!==r?q.encodeValue(n)>q.encodeValue(r)?1:-1:e[1]!==t[1]?e[1]>t[1]?1:-1:0}function mD(e){return jl(e)&&Symbol.asyncIterator in e}function yD(e){return jl(e)&&Symbol.iterator in e}function Gu(e){return jl(e)&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function gD(e){return e instanceof Promise}function Nl(e){return e instanceof Date&&Number.isFinite(e.getTime())}function Fl(e){return ArrayBuffer.isView(e)}function s_(e){return e instanceof globalThis.Uint8Array}function jl(e){return e!==null&&typeof e=="object"}function Hr(e){return Array.isArray(e)&&!ArrayBuffer.isView(e)}function Xn(e){return e===void 0}function _h(e){return e===null}function vh(e){return typeof e=="boolean"}function ei(e){return typeof e=="number"}function wD(e){return Number.isInteger(e)}function xh(e){return typeof e=="bigint"}function Cl(e){return typeof e=="string"}function bD(e){return typeof e=="function"}function ti(e){return typeof e=="symbol"}function o_(e){return xh(e)||vh(e)||_h(e)||ei(e)||Cl(e)||ti(e)||Xn(e)}var wi;(function(e){e.ExactOptionalPropertyTypes=!1,e.AllowArrayObject=!1,e.AllowNaN=!1,e.AllowNullVoid=!1;function t(o,u){return e.ExactOptionalPropertyTypes?u in o:o[u]!==void 0}e.IsExactOptionalProperty=t;function n(o){const u=jl(o);return e.AllowArrayObject?u:u&&!Hr(o)}e.IsObjectLike=n;function r(o){return n(o)&&!(o instanceof Date)&&!(o instanceof Uint8Array)}e.IsRecordLike=r;function i(o){return e.AllowNaN?ei(o):Number.isFinite(o)}e.IsNumberLike=i;function s(o){const u=Xn(o);return e.AllowNullVoid?u||o===null:u}e.IsVoidLike=s})(wi||(wi={}));class _D extends Dt{constructor(t){super(`Duplicate type kind '${t}' detected`)}}class vD extends Dt{constructor(t){super(`Duplicate string format '${t}' detected`)}}var gy;(function(e){function t(r,i){if(Kp(r))throw new _D(r);return cI(r,i),(s={})=>Tb({...s,[N]:r})}e.Type=t;function n(r,i){if(zw(r))throw new vD(r);return uI(r,i),r}e.Format=n})(gy||(gy={}));class xD extends Dt{constructor(t){super(`Unable to dereference schema with $id '${t.$id}'`),this.schema=t}}function SD(e,t){const n=t.find(r=>r.$id===e.$ref);if(n===void 0)throw new xD(e);return Sh(n,t)}function Sh(e,t){return e[N]==="This"||e[N]==="Ref"?SD(e,t):e}class OD extends Dt{constructor(t){super("Unable to hash value"),this.value=t}}var Ct;(function(e){e[e.Undefined=0]="Undefined",e[e.Null=1]="Null",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Object=5]="Object",e[e.Array=6]="Array",e[e.Date=7]="Date",e[e.Uint8Array=8]="Uint8Array",e[e.Symbol=9]="Symbol",e[e.BigInt=10]="BigInt"})(Ct||(Ct={}));let Wi=BigInt("14695981039346656037");const[$D,TD]=[BigInt("1099511628211"),BigInt("2")**BigInt("64")],ID=Array.from({length:256}).map((e,t)=>BigInt(t)),u_=new Float64Array(1),a_=new DataView(u_.buffer),c_=new Uint8Array(u_.buffer);function*AD(e){const t=e===0?1:Math.ceil(Math.floor(Math.log2(e)+1)/8);for(let n=0;n<t;n++)yield e>>8*(t-1-n)&255}function kD(e){ot(Ct.Array);for(const t of e)Os(t)}function PD(e){ot(Ct.Boolean),ot(e?1:0)}function ED(e){ot(Ct.BigInt),a_.setBigInt64(0,e);for(const t of c_)ot(t)}function RD(e){ot(Ct.Date),Os(e.getTime())}function MD(e){ot(Ct.Null)}function ND(e){ot(Ct.Number),a_.setFloat64(0,e);for(const t of c_)ot(t)}function FD(e){ot(Ct.Object);for(const t of globalThis.Object.getOwnPropertyNames(e).sort())Os(t),Os(e[t])}function jD(e){ot(Ct.String);for(let t=0;t<e.length;t++)for(const n of AD(e.charCodeAt(t)))ot(n)}function CD(e){ot(Ct.Symbol),Os(e.description)}function DD(e){ot(Ct.Uint8Array);for(let t=0;t<e.length;t++)ot(e[t])}function LD(e){return ot(Ct.Undefined)}function Os(e){if(Hr(e))return kD(e);if(vh(e))return PD(e);if(xh(e))return ED(e);if(Nl(e))return RD(e);if(_h(e))return MD();if(ei(e))return ND(e);if(Gu(e))return FD(e);if(Cl(e))return jD(e);if(ti(e))return CD(e);if(s_(e))return DD(e);if(Xn(e))return LD();throw new OD(e)}function ot(e){Wi=Wi^ID[e],Wi=Wi*$D%TD}function l_(e){return Wi=BigInt("14695981039346656037"),Os(e),Wi}var wy;(function(e){e[e.ArrayContains=0]="ArrayContains",e[e.ArrayMaxContains=1]="ArrayMaxContains",e[e.ArrayMaxItems=2]="ArrayMaxItems",e[e.ArrayMinContains=3]="ArrayMinContains",e[e.ArrayMinItems=4]="ArrayMinItems",e[e.ArrayUniqueItems=5]="ArrayUniqueItems",e[e.Array=6]="Array",e[e.AsyncIterator=7]="AsyncIterator",e[e.BigIntExclusiveMaximum=8]="BigIntExclusiveMaximum",e[e.BigIntExclusiveMinimum=9]="BigIntExclusiveMinimum",e[e.BigIntMaximum=10]="BigIntMaximum",e[e.BigIntMinimum=11]="BigIntMinimum",e[e.BigIntMultipleOf=12]="BigIntMultipleOf",e[e.BigInt=13]="BigInt",e[e.Boolean=14]="Boolean",e[e.DateExclusiveMaximumTimestamp=15]="DateExclusiveMaximumTimestamp",e[e.DateExclusiveMinimumTimestamp=16]="DateExclusiveMinimumTimestamp",e[e.DateMaximumTimestamp=17]="DateMaximumTimestamp",e[e.DateMinimumTimestamp=18]="DateMinimumTimestamp",e[e.DateMultipleOfTimestamp=19]="DateMultipleOfTimestamp",e[e.Date=20]="Date",e[e.Function=21]="Function",e[e.IntegerExclusiveMaximum=22]="IntegerExclusiveMaximum",e[e.IntegerExclusiveMinimum=23]="IntegerExclusiveMinimum",e[e.IntegerMaximum=24]="IntegerMaximum",e[e.IntegerMinimum=25]="IntegerMinimum",e[e.IntegerMultipleOf=26]="IntegerMultipleOf",e[e.Integer=27]="Integer",e[e.IntersectUnevaluatedProperties=28]="IntersectUnevaluatedProperties",e[e.Intersect=29]="Intersect",e[e.Iterator=30]="Iterator",e[e.Kind=31]="Kind",e[e.Literal=32]="Literal",e[e.Never=33]="Never",e[e.Not=34]="Not",e[e.Null=35]="Null",e[e.NumberExclusiveMaximum=36]="NumberExclusiveMaximum",e[e.NumberExclusiveMinimum=37]="NumberExclusiveMinimum",e[e.NumberMaximum=38]="NumberMaximum",e[e.NumberMinimum=39]="NumberMinimum",e[e.NumberMultipleOf=40]="NumberMultipleOf",e[e.Number=41]="Number",e[e.ObjectAdditionalProperties=42]="ObjectAdditionalProperties",e[e.ObjectMaxProperties=43]="ObjectMaxProperties",e[e.ObjectMinProperties=44]="ObjectMinProperties",e[e.ObjectRequiredProperty=45]="ObjectRequiredProperty",e[e.Object=46]="Object",e[e.Promise=47]="Promise",e[e.RegExp=48]="RegExp",e[e.StringFormatUnknown=49]="StringFormatUnknown",e[e.StringFormat=50]="StringFormat",e[e.StringMaxLength=51]="StringMaxLength",e[e.StringMinLength=52]="StringMinLength",e[e.StringPattern=53]="StringPattern",e[e.String=54]="String",e[e.Symbol=55]="Symbol",e[e.TupleLength=56]="TupleLength",e[e.Tuple=57]="Tuple",e[e.Uint8ArrayMaxByteLength=58]="Uint8ArrayMaxByteLength",e[e.Uint8ArrayMinByteLength=59]="Uint8ArrayMinByteLength",e[e.Uint8Array=60]="Uint8Array",e[e.Undefined=61]="Undefined",e[e.Union=62]="Union",e[e.Void=63]="Void"})(wy||(wy={}));class BD extends Dt{constructor(t){super("Unknown type"),this.schema=t}}function UD(e){return e[N]==="Any"||e[N]==="Unknown"}function Q(e){return e!==void 0}function zD(e,t,n){return!0}function WD(e,t,n){if(!Hr(n)||Q(e.minItems)&&!(n.length>=e.minItems)||Q(e.maxItems)&&!(n.length<=e.maxItems)||!n.every(s=>ze(e.items,t,s))||e.uniqueItems===!0&&!function(){const s=new Set;for(const o of n){const u=l_(o);if(s.has(u))return!1;s.add(u)}return!0}())return!1;if(!(Q(e.contains)||ei(e.minContains)||ei(e.maxContains)))return!0;const r=Q(e.contains)?e.contains:It(),i=n.reduce((s,o)=>ze(r,t,o)?s+1:s,0);return!(i===0||ei(e.minContains)&&i<e.minContains||ei(e.maxContains)&&i>e.maxContains)}function VD(e,t,n){return mD(n)}function qD(e,t,n){return!(!xh(n)||Q(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||Q(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||Q(e.maximum)&&!(n<=e.maximum)||Q(e.minimum)&&!(n>=e.minimum)||Q(e.multipleOf)&&n%e.multipleOf!==BigInt(0))}function JD(e,t,n){return vh(n)}function KD(e,t,n){return ze(e.returns,t,n.prototype)}function QD(e,t,n){return!(!Nl(n)||Q(e.exclusiveMaximumTimestamp)&&!(n.getTime()<e.exclusiveMaximumTimestamp)||Q(e.exclusiveMinimumTimestamp)&&!(n.getTime()>e.exclusiveMinimumTimestamp)||Q(e.maximumTimestamp)&&!(n.getTime()<=e.maximumTimestamp)||Q(e.minimumTimestamp)&&!(n.getTime()>=e.minimumTimestamp)||Q(e.multipleOfTimestamp)&&n.getTime()%e.multipleOfTimestamp!==0)}function HD(e,t,n){return bD(n)}function GD(e,t,n){return!(!wD(n)||Q(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||Q(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||Q(e.maximum)&&!(n<=e.maximum)||Q(e.minimum)&&!(n>=e.minimum)||Q(e.multipleOf)&&n%e.multipleOf!==0)}function XD(e,t,n){const r=e.allOf.every(i=>ze(i,t,n));if(e.unevaluatedProperties===!1){const i=new RegExp(Fm(e)),s=Object.getOwnPropertyNames(n).every(o=>i.test(o));return r&&s}else if(Ve(e.unevaluatedProperties)){const i=new RegExp(Fm(e)),s=Object.getOwnPropertyNames(n).every(o=>i.test(o)||ze(e.unevaluatedProperties,t,n[o]));return r&&s}else return r}function YD(e,t,n){return yD(n)}function ZD(e,t,n){return n===e.const}function e3(e,t,n){return!1}function t3(e,t,n){return!ze(e.not,t,n)}function n3(e,t,n){return _h(n)}function r3(e,t,n){return!(!wi.IsNumberLike(n)||Q(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||Q(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||Q(e.minimum)&&!(n>=e.minimum)||Q(e.maximum)&&!(n<=e.maximum)||Q(e.multipleOf)&&n%e.multipleOf!==0)}function i3(e,t,n){if(!wi.IsObjectLike(n)||Q(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||Q(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;const r=Object.getOwnPropertyNames(e.properties);for(const i of r){const s=e.properties[i];if(e.required&&e.required.includes(i)){if(!ze(s,t,n[i])||(Yc(s)||UD(s))&&!(i in n))return!1}else if(wi.IsExactOptionalProperty(n,i)&&!ze(s,t,n[i]))return!1}if(e.additionalProperties===!1){const i=Object.getOwnPropertyNames(n);return e.required&&e.required.length===r.length&&i.length===r.length?!0:i.every(s=>r.includes(s))}else return typeof e.additionalProperties=="object"?Object.getOwnPropertyNames(n).every(s=>r.includes(s)||ze(e.additionalProperties,t,n[s])):!0}function s3(e,t,n){return gD(n)}function o3(e,t,n){if(!wi.IsRecordLike(n)||Q(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||Q(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;const[r,i]=Object.entries(e.patternProperties)[0],s=new RegExp(r),o=Object.entries(n).every(([c,l])=>s.test(c)?ze(i,t,l):!0),u=typeof e.additionalProperties=="object"?Object.entries(n).every(([c,l])=>s.test(c)?!0:ze(e.additionalProperties,t,l)):!0,a=e.additionalProperties===!1?Object.getOwnPropertyNames(n).every(c=>s.test(c)):!0;return o&&u&&a}function u3(e,t,n){return ze(Sh(e,t),t,n)}function a3(e,t,n){const r=new RegExp(e.source,e.flags);return Q(e.minLength)&&!(n.length>=e.minLength)||Q(e.maxLength)&&!(n.length<=e.maxLength)?!1:r.test(n)}function c3(e,t,n){return!Cl(n)||Q(e.minLength)&&!(n.length>=e.minLength)||Q(e.maxLength)&&!(n.length<=e.maxLength)||Q(e.pattern)&&!new RegExp(e.pattern).test(n)?!1:Q(e.format)?zw(e.format)?aI(e.format)(n):!1:!0}function l3(e,t,n){return ti(n)}function f3(e,t,n){return Cl(n)&&new RegExp(e.pattern).test(n)}function d3(e,t,n){return ze(Sh(e,t),t,n)}function p3(e,t,n){if(!Hr(n)||e.items===void 0&&n.length!==0||n.length!==e.maxItems)return!1;if(!e.items)return!0;for(let r=0;r<e.items.length;r++)if(!ze(e.items[r],t,n[r]))return!1;return!0}function h3(e,t,n){return Xn(n)}function m3(e,t,n){return e.anyOf.some(r=>ze(r,t,n))}function y3(e,t,n){return!(!s_(n)||Q(e.maxByteLength)&&!(n.length<=e.maxByteLength)||Q(e.minByteLength)&&!(n.length>=e.minByteLength))}function g3(e,t,n){return!0}function w3(e,t,n){return wi.IsVoidLike(n)}function b3(e,t,n){return Kp(e[N])?lI(e[N])(e,n):!1}function ze(e,t,n){const r=Q(e.$id)?[...t,e]:t,i=e;switch(i[N]){case"Any":return zD();case"Array":return WD(i,r,n);case"AsyncIterator":return VD(i,r,n);case"BigInt":return qD(i,r,n);case"Boolean":return JD(i,r,n);case"Constructor":return KD(i,r,n);case"Date":return QD(i,r,n);case"Function":return HD(i,r,n);case"Integer":return GD(i,r,n);case"Intersect":return XD(i,r,n);case"Iterator":return YD(i,r,n);case"Literal":return ZD(i,r,n);case"Never":return e3();case"Not":return t3(i,r,n);case"Null":return n3(i,r,n);case"Number":return r3(i,r,n);case"Object":return i3(i,r,n);case"Promise":return s3(i,r,n);case"Record":return o3(i,r,n);case"Ref":return u3(i,r,n);case"RegExp":return a3(i,r,n);case"String":return c3(i,r,n);case"Symbol":return l3(i,r,n);case"TemplateLiteral":return f3(i,r,n);case"This":return d3(i,r,n);case"Tuple":return p3(i,r,n);case"Undefined":return h3(i,r,n);case"Union":return m3(i,r,n);case"Uint8Array":return y3(i,r,n);case"Unknown":return g3();case"Void":return w3(i,r,n);default:if(!Kp(i[N]))throw new BD(i);return b3(i,r,n)}}function by(...e){return e.length===3?ze(e[0],e[1],e[2]):ze(e[0],[],e[1])}class _3 extends Dt{constructor(t,n,r){super("Cannot set root value"),this.value=t,this.path=n,this.update=r}}class v3 extends Dt{constructor(t,n){super("Cannot delete root value"),this.value=t,this.path=n}}function _y(e){return e.indexOf("~")===-1?e:e.replace(/~1/g,"/").replace(/~0/g,"~")}function*Dl(e){if(e==="")return;let[t,n]=[0,0];for(let r=0;r<e.length;r++)e.charAt(r)==="/"?(r===0||(n=r,yield _y(e.slice(t,n))),t=r+1):n=r;yield _y(e.slice(t))}function x3(e,t,n){if(t==="")throw new _3(e,t,n);let[r,i,s]=[null,e,""];for(const o of Dl(t))i[o]===void 0&&(i[o]={}),r=i,i=i[o],s=o;r[s]=n}function f_(e,t){if(t==="")throw new v3(e,t);let[n,r,i]=[null,e,""];for(const s of Dl(t)){if(r[s]===void 0||r[s]===null)return;n=r,r=r[s],i=s}if(Array.isArray(n)){const s=parseInt(i);n.splice(s,1)}else delete n[i]}function S3(e,t){if(t==="")return!0;let[n,r,i]=[null,e,""];for(const s of Dl(t)){if(r[s]===void 0)return!1;n=r,r=r[s],i=s}return Object.getOwnPropertyNames(n).includes(i)}function Oh(e,t){if(t==="")return e;let n=e;for(const r of Dl(t)){if(n[r]===void 0)return;n=n[r]}return n}const O3=Ne({type:ve("insert"),path:jr(),value:Du()}),$3=Ne({type:ve("update"),path:jr(),value:Du()}),T3=Ne({type:ve("delete"),path:jr()});gt([O3,$3,T3]);class d_ extends Dt{constructor(t,n){super(n),this.value=t}}class ca extends d_{constructor(t){super(t,"Cannot diff objects with symbol keys"),this.value=t}}function lu(e,t){return{type:"update",path:e,value:t}}function p_(e,t){return{type:"insert",path:e,value:t}}function h_(e){return{type:"delete",path:e}}function*I3(e,t,n){if(!Gu(n))return yield lu(e,n);const r=[...globalThis.Object.keys(t),...globalThis.Object.getOwnPropertySymbols(t)],i=[...globalThis.Object.keys(n),...globalThis.Object.getOwnPropertySymbols(n)];for(const s of r){if(ti(s))throw new ca(s);Xn(n[s])&&i.includes(s)&&(yield lu(`${e}/${globalThis.String(s)}`,void 0))}for(const s of i)if(!(Xn(t[s])||Xn(n[s]))){if(ti(s))throw new ca(s);yield*Ll(`${e}/${globalThis.String(s)}`,t[s],n[s])}for(const s of i){if(ti(s))throw new ca(s);Xn(t[s])&&(yield p_(`${e}/${globalThis.String(s)}`,n[s]))}for(const s of r.reverse()){if(ti(s))throw new ca(s);Xn(n[s])&&!i.includes(s)&&(yield h_(`${e}/${globalThis.String(s)}`))}}function*A3(e,t,n){if(!Hr(n))return yield lu(e,n);for(let r=0;r<Math.min(t.length,n.length);r++)yield*Ll(`${e}/${r}`,t[r],n[r]);for(let r=0;r<n.length;r++)r<t.length||(yield p_(`${e}/${r}`,n[r]));for(let r=t.length-1;r>=0;r--)r<n.length||(yield h_(`${e}/${r}`))}function*k3(e,t,n){if(!Fl(n)||t.length!==n.length||globalThis.Object.getPrototypeOf(t).constructor.name!==globalThis.Object.getPrototypeOf(n).constructor.name)return yield lu(e,n);for(let r=0;r<Math.min(t.length,n.length);r++)yield*Ll(`${e}/${r}`,t[r],n[r])}function*P3(e,t,n){t!==n&&(yield lu(e,n))}function*Ll(e,t,n){if(Gu(t))return yield*I3(e,t,n);if(Hr(t))return yield*A3(e,t,n);if(Fl(t))return yield*k3(e,t,n);if(o_(t))return yield*P3(e,t,n);throw new d_(t,"Unable to create diff edits for unknown value")}function vf(e,t){return[...Ll("",e,t)]}function E3(e,t){if(!Gu(t))return!1;const n=[...Object.keys(e),...Object.getOwnPropertySymbols(e)],r=[...Object.keys(t),...Object.getOwnPropertySymbols(t)];return n.length!==r.length?!1:n.every(i=>Xu(e[i],t[i]))}function R3(e,t){return Nl(t)&&e.getTime()===t.getTime()}function M3(e,t){return!Hr(t)||e.length!==t.length?!1:e.every((n,r)=>Xu(n,t[r]))}function N3(e,t){return!Fl(t)||e.length!==t.length||Object.getPrototypeOf(e).constructor.name!==Object.getPrototypeOf(t).constructor.name?!1:e.every((n,r)=>Xu(n,t[r]))}function F3(e,t){return e===t}function Xu(e,t){if(Gu(e))return E3(e,t);if(Nl(e))return R3(e,t);if(Fl(e))return N3(e,t);if(Hr(e))return M3(e,t);if(o_(e))return F3(e,t);throw new Error("ValueEquals: Unable to compare value")}function j3(...e){return by.apply(by,e)}function C3(e,t){return Xu(e,t)}function m_(e){return l_(e)}function D3(e){return e._diff==="collectionAttribute"}function y_(e,t,n=[]){var u,a,c,l,f,p;if(e===void 0&&t===void 0)return[];const r=(e==null?void 0:e.properties)??{},i=(t==null?void 0:t.properties)??{},s=new Set([...Object.keys(r),...Object.keys(i)]),o=[];for(const d of s){if(!(d in r)){const m=[...n,d];o.push({type:"insert",attribute:m,metadata:{type:i[d].type,options:i[d].options,optional:((u=t==null?void 0:t.optional)==null?void 0:u.includes(d))??!1},isNewCollection:e===void 0});continue}if(!(d in i)){const m=[...n,d];o.push({type:"delete",attribute:m,metadata:{type:r[d].type,options:r[d].options,optional:((a=e==null?void 0:e.optional)==null?void 0:a.includes(d))??!1}});continue}if(d in r&&d in i){if(C3(r[d].toJSON(),i[d].toJSON())&&(((c=e==null?void 0:e.optional)==null?void 0:c.includes(d))??!1)===(((l=t==null?void 0:t.optional)==null?void 0:l.includes(d))??!1))continue;const m=[...n,d];if(r[d].type==="record"&&i[d].type==="record"){o.push(...y_(r[d],i[d],m));continue}const y={type:"update",attribute:m,changes:{options:{}}};r[d].type!==i[d].type&&(y.changes.type=i[d].type),r[d].type==="set"&&r[d].items.type!==i[d].items.type&&(y.changes.items={type:i[d].items.type});const b=((f=e==null?void 0:e.optional)==null?void 0:f.includes(d))??!1,g=((p=t==null?void 0:t.optional)==null?void 0:p.includes(d))??!1;b!==g&&(y.changes.optional=g),y.changes.options=L3(r[d].options??{},i[d].options??{}),o.push(y);continue}}return o}function L3(e,t){var s;const n={};e.nullable!==t.nullable&&(n.nullable=!!t.nullable),e.default!==t.default&&(n.default=t.default);const r=t.enum&&!e.enum,i=e.enum&&t.enum&&!((s=e.enum)!=null&&s.every(o=>{var u;return(u=t.enum)==null?void 0:u.includes(o)}));return(r||i)&&(n.enum=t.enum),n}function B3(e,t){const n=new Set([...Object.keys(e.collections),...Object.keys(t.collections)]),r=[];for(const s of n){const o=e.collections[s],u=t.collections[s];r.push(...y_(o==null?void 0:o.schema,u==null?void 0:u.schema).map(l=>({_diff:"collectionAttribute",collection:s,...l}))),vf(o==null?void 0:o.rules,u==null?void 0:u.rules).length>0&&r.push({_diff:"collectionRules",collection:s}),vf(o==null?void 0:o.permissions,u==null?void 0:u.permissions).length>0&&r.push({_diff:"collectionPermissions",collection:s})}return vf(e.roles,t.roles).length>0&&r.push({_diff:"roles"}),r}function U3(e){return e.reduce((t,n)=>{if(!D3(n))return t;const r=z3.find(i=>i.matchesDiff(n));return r&&t.push({issue:r.description,allowedIf:r.allowedIf,context:n,attributeCure:r.attributeCure}),t},[])}const z3=[{description:"removed an optional attribute",matchesDiff:e=>e.type==="delete"&&e.metadata.optional===!0,allowedIf:"attribute_is_empty",attributeCure:()=>null},{description:"removed a non-optional attribute",matchesDiff:e=>e.type==="delete",allowedIf:"collection_is_empty",attributeCure:(e,t)=>`make '${t.join(".")}' optional`},{description:"changed a attribute from optional to required",matchesDiff:e=>e.type==="update"?e.changes.optional===!1:!1,allowedIf:"attribute_has_no_undefined",attributeCure:()=>null},{description:"changed the type of an attribute",matchesDiff:e=>e.type==="update"?e.changes.type!==void 0:!1,allowedIf:"attribute_is_empty",attributeCure:(e,t)=>`revert the change to '${t.join(".")}' and create a different, optional, attribute with the new type`},{description:"changed the type of a set's items",matchesDiff:e=>e.type==="update"?e.changes.items!==void 0:!1,allowedIf:"attribute_is_empty",attributeCure:(e,t)=>`revert the change to '${t.join(".")}' and create a different, optional, attribute with the new type`},{description:"added an attribute where optional is not set",matchesDiff:e=>e.type==="insert"&&!e.isNewCollection&&e.metadata.optional===!1&&e.metadata.type!=="query",allowedIf:"collection_is_empty",attributeCure:(e,t)=>`make '${t.join(".")}' optional`},{description:"changed an attribute from nullable to non-nullable",matchesDiff:e=>{var t;return e.type==="update"?((t=e.changes.options)==null?void 0:t.nullable)===!1:!1},allowedIf:"attribute_has_no_null",attributeCure:()=>null},{description:"added an enum to an attribute or removed an option from an existing enum",matchesDiff:e=>e.type==="update"?e.changes.options.enum!==void 0:!1,allowedIf:"attribute_satisfies_enum",attributeCure:(e,t,n)=>`revert the change to '${t.join(".")}' and create a different, optional, attribute with the new enum OR ensure all values of '${t.join(".")} are in the new enum: ${n}`}];async function W3(e,t,n){return await q3[n](e,t.collection,t.attribute,(t==null?void 0:t.type)==="update"?t.changes.options.enum:void 0)}async function V3(e,t){const n=U3(t);return await Promise.all(n.map(async i=>{const s=!await W3(e,i.context,i.allowedIf),o=J3[i.allowedIf](i.context.collection,i.context.attribute),u=i.attributeCure(i.context.collection,i.context.attribute);return{...i,violatesExistingData:s,cure:u?u+" or "+o:o}}))}const q3={never:async()=>!1,collection_is_empty:X3,attribute_is_empty:H3,attribute_has_no_undefined:Q3,attribute_has_no_null:G3,attribute_satisfies_enum:K3},J3={never:()=>"This edit is never allowed",collection_is_empty:e=>`delete all entities in '${e}' to allow this edit`,attribute_is_empty:(e,t)=>`set all values of '${t.join(".")}' to undefined to allow this edit`,attribute_has_no_undefined:(e,t)=>`ensure all values of '${t.join(".")}' are not undefined to allow this edit`,attribute_has_no_null:(e,t)=>`ensure all values of '${t.join(".")}' are not null to allow this edit`,attribute_satisfies_enum:(e,t)=>`ensure all values of '${t.join(".")}' are in the enum to allow this edit`};async function K3(e,t,n,r){return(await e.fetch(e.db.query(t).select([n.join(".")]).where(n.join("."),"nin",r).build(),{skipRules:!0})).size===0}async function Q3(e,t,n){const r=await e.fetch(e.db.query(t).select([n.join(".")]).build(),{skipRules:!0});return!Array.from(r.values()).some(i=>Oh(i,"/"+n.join("/"))===void 0)}async function H3(e,t,n){const r=await e.fetch(e.db.query(t).select([n.join(".")]).build(),{skipRules:!0});return Array.from(r.values()).every(i=>Oh(i,"/"+n.join("/"))===void 0)}async function G3(e,t,n){return(await e.fetch(e.db.query(t).select([n.join(".")]).where(n.join("."),"=",null).limit(1).build(),{skipRules:!0})).size===0}async function X3(e,t){return(await e.fetch(e.db.query(t).select([]).limit(1).build(),{skipRules:!0})).size===0}class vr{constructor({stages:t,limit:n,takeWhile:r}={}){I(this,"limit",1/0);I(this,"stages");I(this,"takeWhileFilter");this.stages=t??[],this.limit=n??1/0,this.takeWhileFilter=r}map(t){return new vr({stages:this.stages.concat([["map",t]]),limit:this.limit})}tap(t){return new vr({stages:this.stages.concat([["map",async(n,r)=>(await t(n,r),n)]]),limit:this.limit})}takeWhile(t){return new vr({takeWhile:t,stages:this.stages,limit:this.limit})}filter(t){return new vr({stages:this.stages.concat([["filter",t]]),limit:this.limit})}take(t){return new vr({stages:this.stages,limit:t})}sort(t){return new vr({stages:this.stages.concat([["aggregate",async n=>n.slice().sort(t),{limit:this.limit,takeWhile:this.takeWhileFilter}]])})}async run(t){this.stages.push(["aggregate",async s=>s,{limit:this.limit,takeWhile:this.takeWhileFilter}]);const n=this.stages.reduce((s,o,u,a)=>{const c=a[u-1];return c&&c[0]==="aggregate"?s.push([o]):s.length===0?s.push([o]):s[s.length-1].push(o),s},[]);async function r(s,o,u){let a=[];const c=Math.min(s.length??1/0,u.limit);e:for(let l=0;l<s.length;l++){let f=s[l];t:for(const p of o){const[d,m]=p;if(d==="map"){f=await m(f,l);continue}if(d==="filter"){if(await m(f,l))continue t;continue e}}if(u.takeWhile&&!u.takeWhile(f,l)||(a.push(f),a.length>=c))break e}return a}let i=t;for(const s of n){const[o,u,a]=s.at(-1),c=s.slice(0,-1);i=await u(await r(i,c,a))}return i}}class g_{constructor(t){I(this,"db");I(this,"cache");this.db=t,this.cache=new Map}static canCacheQuery(t,n){if(t.limit!==void 0||t.where&&t.where.some(s=>!Lr(s))||t.include&&Object.keys(t.include).length>0||t.select&&t.select.some(s=>typeof s=="object"))return!1;const i=(t.where??[]).filter(Lr).filter(([,,s])=>typeof s=="string"&&s.startsWith("$"));return!(i.length!==1||!["=","<","<=",">",">=","!="].includes(i[0][1])||n&&Gi(n,i[0][0].split(".")).type==="set")}async createView(t,n){return new Promise(r=>{const i=this.viewQueryToId(t);P_(this.db,this.db.tripleStore,t,([s,o])=>{this.cache.set(i,{results:s,triples:o}),r()},s=>{console.error("error in view",s),this.cache.delete(i)},{schema:n,skipRules:!0})})}viewQueryToId(t){return m_(t)}async resolveFromCache(t,n,r,i){const{views:s,variableFilters:o}=this.queryToViews(t),u=this.viewQueryToId(s[0]);this.cache.has(u)||await this.createView(s[0],i.schema);const[a,c,l]=o[0],f=l.slice(1),d=E_(t,{systemVars:this.db.systemVars,roles:this.db.sessionRoles},r)[f],m=this.cache.get(u),y=[...m.results.entries()];let b,g;if(["=","<","<=",">",">="].includes(c)&&(b=la(y,d,([,x])=>x[a],"start",(x,S)=>c==="<"?x<S?0:1:c==="<="?x<=S?0:1:c===">"?x>S?0:-1:c===">="?x>=S?0:-1:x===S?0:x<S?-1:1),g=la(y,d,([,x])=>x[a],"end",(x,S)=>c==="<"?x<S?0:1:c==="<="?x<=S?0:1:c===">"?x>S?0:-1:c===">="?x>=S?0:-1:x===S?0:x<S?-1:1)),c==="!="){b=la(y,d,([,S])=>S[a],"start",(S,A)=>S===A?0:S<A?-1:1),g=la(y,d,([,S])=>S[a],"end",(S,A)=>S===A?0:S<A?-1:1);const x=[...y.slice(0,b+1),...y.slice(g)];return{results:new Map(x),triples:new Map(x.map(([S,A])=>[S,m.triples.get(S)]))}}if(b==null||g==null)throw new GE(`Queries with the operator ${c} in a where clause can't be stored in the query cache. Currently, supported operators are: ${["=","!=","<","<=",">",">="]}`);const v=y.slice(b,g+1);return{results:new Map(v),triples:new Map(v.map(([x,S])=>[x,m.triples.get(x)]))}}queryToViews(t){const n=[],r=t.where?t.where.filter(i=>{if(!(i instanceof Array))return!0;const[s,o,u]=i;return io(u)?(n.push([s,o,u]),!1):!0}):void 0;return{views:[{collectionName:t.collectionName,where:r,select:t.select,order:[...n.map(i=>[i[0],"ASC"]),...t.order??[]]}],variableFilters:n}}}function la(e,t,n,r="start",i=(s,o)=>s<o?-1:s>o?1:0){let s=0,o=e.length-1,u=-1;for(;s<=o;){const a=Math.floor((s+o)/2),c=n(e[a]);i(c,t)===0?(u=a,r==="start"?o=a-1:s=a+1):i(c,t)<0?s=a+1:o=a-1}return u}function Y3(e){return e&&"_collection"in e&&e._collection[0]==null}class nn{constructor(t){I(this,"query");this.query=t}build(){return this.query}select(t){return new nn({...this.query,select:t})}where(...t){return new nn({...this.query,where:Ir().where(this.query,...t)})}id(t){const n=[["id","=",t],...(this.query.where??[]).filter(r=>!Array.isArray(r)||r[0]!=="id")];return new nn({...this.query,where:n})}order(...t){return new nn({...this.query,order:Ir().order(this.query,...t)})}after(t,n){return new nn({...this.query,after:Ir().after(this.query,t,n)})}include(t,n){return new nn({...this.query,include:Ir().include(this.query,t,n)})}limit(t){return new nn({...this.query,limit:t})}vars(t){return new nn({...this.query,vars:t})}entityId(t){return this.id(t)}}const Ir=()=>({where:(e,...t)=>{let n=[];if(t[0]==null)return e.where??[];if(typeof t[0]=="boolean")n=[t[0]];else if(typeof t[0]=="string")n=[t];else if(t.length===1&&t[0]instanceof Array&&t[0].every(r=>typeof r=="object"))n=t[0];else if(t.every(r=>typeof r=="object"))n=t;else throw new lf("where",t);return[...e.where??[],...n]},order:(e,...t)=>{if(!t[0])return;let n=[];if(t.length===2&&t.every(r=>typeof r=="string"))n=[[...t]];else if(t.length===1&&t[0]instanceof Array&&t[0].every(r=>r instanceof Array))n=t[0];else if(t.every(r=>r instanceof Array))n=t;else throw new lf("order",t);return[...e.order??[],...n]},include(e,t,n){return{...e.include,[t]:n??null}},after(e,t,n){if(!t)return;if(!e.order)throw new YE(t);const r=e.order[0][0];if(t instanceof Array&&t.length===2)return[t,n??!1];if(typeof t=="object"&&!(t instanceof Array)&&Object.hasOwn(t,"id")&&Object.hasOwn(t,r))return[[t[r],t.id],n??!1];throw new lf("after",t)}});function Z3(e,t){return e.reduce(async(n,r,i,s)=>await n||await t(r,i,s),Promise.resolve(!1))}function eL(e,t){return e.reduce(async(n,r,i,s)=>await n&&await t(r,i,s),Promise.resolve(!0))}async function jd(e,t,n,r,i,s,o){if(Rl(o))return o;if(Fn(o)){const{mod:u,filters:a}=o;return u==="and"?await eL(a,c=>jd(e,t,n,r,i,s,c)):u==="or"?await Z3(a,c=>jd(e,t,n,r,i,s,c)):!1}if(lr(o))return await tL(e,t,n,r,i,s,o);if(Hu(o))throw new iR("Untranslated exists filter");return nL(n,i,s,o)}async function tL(e,t,n,r,i,s,o){const{exists:u}=o,a={...u,limit:1},{results:c,triples:l}=await $s(e,t,n,a,"one",r,i,s.entity);if(!!!c)return!1;for(const p of l.values())for(const d of p)s.existsFilterTriples.push(d);return!0}function nL(e,t,n,r){const{collectionName:i}=e,{schema:s}=t,{entity:o}=n,[u,a,c]=r,l=s?Ts(u.split("."),s,i):void 0;return l&&l.type==="set"?w_(o,u,a,c):b_(o,u,a,c)}function w_(e,t,n,r){const i="/"+t.replaceAll(".","/"),s=xn.Get(e,i);if(Array.isArray(s)&&s[0]===void 0)return!1;const o=pt(s);if(!o)return!1;const u=Object.entries(o).filter(([a,c])=>c);return n==="has"?u.some(([a])=>a===r):n==="!has"?u.every(([a])=>a!==r):u.some(([a])=>__(n,a,r))}function b_(e,t,n,r){const i=xn.Get(e,"/"+t.replaceAll(".","/")),s=!!i&&i instanceof Array&&i.length===2,o=!!i&&s&&(typeof i[0]!="object"||i[0]===null);if(i&&(!s||!o))return console.warn(`Received an unexpected value at path '${t}' in entity ${JSON.stringify(e)} which could not be interpreted as a register when reading filter ${JSON.stringify([t,n,r])}. This is likely caused by (1) the database not properly loading its schema and attempting to interpret a value that is not a regsiter as a register, (2) a schemaless database attempting to interpret a value that is not properly formatted as a register, or (3) a query with a path that does not lead to a leaf attribute in the entity.`),!1;const[u,a]=i??[void 0,void 0];return __(n,u,r)}function __(e,t,n){switch(e){case"=":return t==n;case"!=":return t!==n;case">":return t>n;case">=":return t>=n;case"<":return t<n;case"<=":return t<=n;case"like":return vy(t,n);case"nlike":return!vy(t,n);case"in":return new Set(n).has(t);case"nin":return!new Set(n).has(t);default:throw new Sa(`The operator ${e} is not recognized.`)}}function vy(e,t){return t=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),t=t.replace(/%/g,".*"),t=t.replace(/_/g,"."),new RegExp(`^${t}$`,"i").test(e)}function v_(e){if(lr(e))return"relational";if(Fn(e)){const{filters:t}=e;if(t.map(r=>v_(r)).includes("relational"))return"relational"}return"basic"}function rL(e){const{where:t=[]}=e,n=[],r=[];for(let i=0;i<t.length;i++){const s=t[i];v_(s)==="relational"?r.push(i):n.push(i)}return[...n,...r]}function iL(e){return typeof e=="string"&&e.startsWith("$")}function x_(e,t){const n={};for(const r in e){const i=e[r],s=t[r];if(s===void 0)return;if(typeof i=="object"){const o=x_(i,s);if(o===void 0)return;Object.assign(n,o);continue}if(iL(i)){const o=i.slice(1);n[o]=s;continue}if(i!==s)return}return n}function sL(e,t){if(!e)return;const n=e.roles;if(!n)return[];const r=[];for(const[i,s]of Object.entries(n)){const o=x_(s.match,t);o!==void 0&&r.push({key:i,roleVars:o})}return r}function S_(e,t){if(!e)return;const n=e[t];if(n)return n.permissions}function un(e,t,n,r={}){let i={...e};uL(i,t);const s=oL(i,t),o=aL(i,t,n,r),u=cL(i,t,n,r),a=fL(i,t),c=dL(i);return{...i,select:s,include:o,where:u,order:a,after:c,vars:{...i.vars??{}}}}function oL(e,t,n){if(!e.select)return e.select;if(!t)return[...e.select];for(const r of e.select){const{valid:i,path:s,reason:o}=$h(r,t,e.collectionName,(u,a,c)=>u?u.type==="query"?{valid:!1,reason:"Cannot select into relationships, please use 'include' instead"}:{valid:!0}:{valid:!1,reason:"Path not found"});if(!i)throw new rR(`Select field ${r} is not valid: ${o} at path ${s}`)}return[...e.select]}function Cd(e){return e==="_metadata"}function uL(e,t){const n=e.collectionName;if(!(typeof n=="string"))throw new Ba(n,"Collection name must be a string");if(t&&!t[n]&&!Cd(n))throw new Ba(n,`Collection '${n}' does not exist in the schema`)}function aL(e,t,n,r){if(!t||!e.include)return e.include;const i={};for(const[s,o]of Object.entries(e.include)){const u=Ts(s.split("."),t,e.collectionName);if(u&&u.type==="query"){let a=o;const c=hL({...u.query},a),l={subquery:un(c,t,n,r),cardinality:u.cardinality};i[s]=l}else if(o!=null&&o.subquery)i[s]=o;else throw u?new VE(s,e.collectionName):new WE(s,e.collectionName)}return i}function cL(e,t,n,r){var o;const i=e.where?[...e.where]:[];if(e.entityId&&i.push(["id","=",e.entityId]),t&&!Cd(e.collectionName)&&!r.skipRules){const u=lL(t,e.collectionName);(u==null?void 0:u.length)>0&&i.push(...u);const a=S_(t,e.collectionName);if(a){let c=[],l=!1;if(n.roles)for(const f of n.roles){const p=(o=a[f.key])==null?void 0:o.read;p!=null&&p.filter&&(l=!0,Array.isArray(p.filter)&&c.push(...p.filter))}l||(c=[!1]),i.push(...c)}}const s=pL(t,e.collectionName);return O_(i,u=>{if(s(u),Hu(u)){const{relationship:f,query:p}=u;if(!t)throw new Sa("A schema is required to execute an exists filter");const d=f.split("."),[m,...y]=d,b=y.length>0,g=Ts([m],t,e.collectionName);if(!g)throw new Sa(`Could not find property '${f}' in the schema`);if(g.type!=="query")throw new Sa("Cannot execute an exists filter on a non-relation property");const v={...g.query},x=b?[pD(y.join("."),p)]:p==null?void 0:p.where;return v.where=[...g.query.where??[],...x??[]],{exists:un(v,t,n,r)}}if(!Array.isArray(u))return u;let[a,c,l]=u;if(t&&!Cd(e.collectionName)){const f=Ts([a.split(".")[0]],t,e.collectionName);if(f.type==="query"){const[p,...d]=a.split("."),m={...f.query};return io(l)&&(l="$"+LL(l.slice(1))),m.where=[...m.where,[d.join("."),c,l]],{exists:un(m,t,n,r)}}}return[a,c,l instanceof Date?l.toISOString():l]})}function lL(e,t){var n,r,i;return(r=(n=e==null?void 0:e[t])==null?void 0:n.rules)!=null&&r.read?Object.values(((i=e[t].rules)==null?void 0:i.read)??{}).flatMap(s=>s.filter):[]}function fL(e,t,n){if(!e.order)return e.order;if(!t)return[...e.order];for(const[r,i]of e.order){const{valid:s,path:o,reason:u}=$h(r,t,e.collectionName,(a,c,l)=>a?c===l.length-1&&(a.type==="query"||a.type==="set"||a.type==="record")?{valid:!1,reason:"Order by field is not sortable"}:a.type==="query"&&a.cardinality!=="one"?{valid:!1,reason:"Order by field is a query with cardinality not equal to one"}:{valid:!0}:{valid:!1,reason:"Path not found"});if(!s)throw new tR(`Order by field ${r} is not valid: ${u} at path ${o}`)}return[...e.order]}function dL(e,t,n){if(!e.after)return e.after;if(!e.order||e.order.length===0)throw new R("Cannot use after without an order clause");const[r,i]=e.after;return[[r[0]instanceof Date?r[0].toISOString():r[0],st(e.collectionName,r[1])],i]}function pL(e,t){return n=>{if(!e||t==="_metadata"||lr(n)||Hu(n)||Fn(n)||Rl(n))return!0;const[r,i,s]=n,{valid:o,path:u,reason:a}=$h(r,e,t,(c,l,f)=>c?l===f.length-1&&(c.type==="query"||c.type==="record")?{valid:!1,reason:"Where filter is not operable"}:{valid:!0}:{valid:!1,reason:"Path not found"});if(!o)throw new nR(`Where filter ${JSON.stringify([r,i,s])} is not valid: ${a} at path ${u}`);return!0}}function hL(e,t){if(!t)return e;const n=[...e.where??[],...t.where??[]],r=[...e.select??[],...t.select??[]];return{...e,...t,where:n,select:r}}function O_(e,t){return e.map(n=>Fn(n)?(n.filters=O_(n.filters,t),n):t(n))}function $h(e,t,n,r){let i=Vl(t,n);const s=e.split(".");let o=[];for(let u=0;u<s.length;u++){const a=s[u];i=i.get(a),o.push(a);const{valid:c,reason:l}=r(i.current,u,s);if(!c)return{valid:c,path:o.join("."),reason:l}}return{valid:!0}}function $_(e,t){const n={collectionName:e,...t};return new nn(n)}function mL(e){const{where:t,collectionName:n}=e,r=(t??[]).filter(Lr).filter(i=>i[0]==="id"&&i[1]==="=");return r.length>0?st(n,r[0][2]):null}async function yL(e,t,n,r){const{order:i,after:s}=t;if(!(i!=null&&i.length))return;const o=i.length===1,[u,a]=i[0],c=u.split(".");let l=!1,f=!1;if(n){const p=U_(c,n,t.collectionName);for(const d of p){if(!d){f=!0;break}if(d.type==="query"){l=!0;break}}}if(!l&&!f){const[p,d]=s??[void 0,!1],m=o&&a==="ASC"?p:void 0,y=o&&a==="DESC"?p:void 0;r.after=s?!!m||!!y:!0,r.order[0]=!0;const b={direction:a,greaterThanCursor:d?void 0:m,greaterThanOrEqualCursor:d?m:void 0,lessThanCursor:d?void 0:y,lessThanOrEqualCursor:d?y:void 0},g=await e.findValuesInRange([t.collectionName,...c],b),v=new Map,x=new Set;for(let S of g){const A=[S.id,...S.attribute].join("-");if(!v.has(A))v.set(A,S.timestamp),x.add(S.id);else{const U=v.get(A);Pn(S.timestamp,U)>0&&(v.set(A,S.timestamp),x.delete(S.id),x.add(S.id))}}return x}}async function gL(e,t,n,r){const{where:i}=t,[s,o,u]=SL(t,n);if(s===-1)return;const a=i[s];if(o==="range"){r.where[s]=!0;let c;const l=xL(t,a[0],s,Bl.includes(a[1])?"lt":"gt");return l!==-1&&(c=i[l],r.where[l]=!0),new Set((await _L(e,t,[a,c])).map(f=>f.id))}if(o==="equality")return r.where[s]=!0,new Set((await vL(e,t,a,u)).map(c=>c.id))}const wL=["="],Bl=[">",">="],Th=["<","<="],bL=[...Bl,...Th];async function _L(e,t,n){const{collectionName:r}=t,[i,s]=n,o=i[0].split("."),u=Bl.includes(i[1])?i:s,a=Th.includes(i[1])?i:s,c={greaterThan:(u==null?void 0:u[1])===">"?go(u[2]):void 0,greaterThanOrEqual:(u==null?void 0:u[1])===">="?go(u[2]):void 0,lessThan:(a==null?void 0:a[1])==="<"?go(a[2]):void 0,lessThanOrEqual:(a==null?void 0:a[1])==="<="?go(a[2]):void 0};return await e.findValuesInRange([r,...o],c)}function go(e){return e instanceof Date?e.toISOString():Array.isArray(e)?JSON.stringify(e.map(go)):e}async function vL(e,t,n,r){return(r==null?void 0:r.type)==="query"||(r==null?void 0:r.type)==="record"?[]:(r==null?void 0:r.type)==="set"?await $L(e,t,n):await OL(e,t,n)}function xL(e,t,n,r){const{where:i}=e;if(!i)return-1;for(let s=n+1;s<i.length;s++){const o=i[s];if(Rl(o)||lr(o)||Fn(o)||Hu(o))continue;const[u,a,c]=o;if(u===t&&(r==="gt"&&Bl.includes(a)||r==="lt"&&Th.includes(a)))return s}return-1}function SL(e,t){const{where:n,collectionName:r}=e;function i(s,o,u){if(!o)return;const a=Ts(s.split("."),o,u);if(a&&!(a.type==="query"||a.type==="record"))return a}if(n)for(let s=0;s<n.length;s++){const o=n[s];if(Rl(o)||lr(o)||Fn(o)||Hu(o))continue;const[u,a,c]=o;if(wL.includes(a))return[s,"equality",i(u,t,r)];if(bL.includes(a))return[s,"range",i(u,t,r)]}return[-1,void 0,void 0]}async function OL(e,t,n){return await e.findByAVE([[t.collectionName,...n[0].split(".")],n[2]])}async function $L(e,t,n){return await e.findByAVE([[t.collectionName,...n[0].split("."),n[2]],!0])}async function TL(e,t){return Array.from(new Set((await e.findByAVE([["_collection"],t.collectionName])).map(n=>n.id)))}async function IL(e,t,n){const r={where:t.where?new Array(t.where.length).fill(!1):[],order:t.order?new Array(t.order.length).fill(!1):[],after:!t.after},i=mL(t);if(i)return{candidates:[i],fulfilled:r};const s=await gL(e,t,n,r);if(s)return{candidates:Array.from(s),fulfilled:r};const o=await yL(e,t,n,r);return o?{candidates:Array.from(o),fulfilled:r}:{candidates:await TL(e,t),fulfilled:r}}function AL(e,t,n){return!!I_(e,t,n).length}function T_(e,t,n){var u;let r=Vl(t,n);const i=e.split("."),s=[],o={};for(const a of i)s.push(a),r=r.get(a),((u=r.current)==null?void 0:u.type)==="query"&&(o[s.join(".")]=r.current);return o}function I_(e,t,n){return Object.keys(T_(e,t,n))}function kL(e,t,n){const r={};for(const i of e){const s=I_(i,t,n);if(!s.length)continue;const o=s.shift();r[o]||(r[o]=new Set);for(let u of s)u=u.slice(o.length+1),r[o].add(u)}return r}function xy(e,t){return ro(e,t&&t.size>0?t:void 0)}async function PL(e,t){const n=[],r=await e.findAllClientIds(),i=new Map(r.map(s=>[s,t.get(s)??0]));for(const[s,o]of i){const u=await e.findByClientTimestamp(s,"gt",[o,s]);for(const a of u)n.push(a)}return n}async function Sy(e,t,n,r,i,s={}){var l,f,p;const o=EL(await kh(e,t,n,i,s)),u=r.reduce((d,m)=>(d.has(m.id)||d.set(m.id,[]),d.get(m.id).push(m),d),new Map),a=[],c=r.reduce((d,m)=>{const[y,b]=m.timestamp;return(!d.has(b)||y<d.get(b)+1)&&d.set(b,Math.max(y-1,0)),d},new Map);for(const d of u.keys()){const m=await t.findByEntity(d),y=(l=xy(m,c).get(d))==null?void 0:l.data,b=xy(m).get(d),g=b==null?void 0:b.data;for(const v of o){if(v.collectionName!==Wt(d)[0])continue;const x=!!y&&fu(y,v.where,s.schema&&((f=s.schema[v.collectionName])==null?void 0:f.schema)),S=!!g&&fu(g,v.where,s.schema&&((p=s.schema[v.collectionName])==null?void 0:p.schema));if(!x&&!S)continue;const A=(v.where??[]).filter(le=>lr(le));let U=x;if(x&&A.length>0)for(const{exists:le}of A){const{results:Ke}=await $s(e,t,v,le,"one",i,s,y);if(Ke===null){U=!1;continue}}const K=[];let ce=S;if(S&&A.length>0)for(const{exists:le}of A){const Ke=await $s(e,t,v,le,"one",i,s,g);if(Ke.results===null){ce=!1;continue}for(const W of Ke.triples.values())for(const ee of W)K.push(ee)}if(!(!U&&!ce)){if(!U){if(A.length===0){const le=u.get(d),Ke=new Set(le.map(ee=>ee.id+JSON.stringify(ee.attribute)+JSON.stringify(ee.timestamp))),W=Object.values(b.triples).flat().filter(ee=>!Ke.has(ee.id+JSON.stringify(ee.attribute)+JSON.stringify(ee.timestamp)));for(const ee of W)K.push(ee)}for(const le of K)a.push(le)}for(const le of u.get(d))a.push(le)}}}return a}function EL(e){const t=[];for(const n of k_(e))t.push(A_(n.slice().reverse()));return t}function A_(e,t=[]){const[n,...r]=e;if(r.length===0)return{...n,where:[...n.where??[],...t]};const i=(n.where??[]).filter(Lr).filter(u=>$y(u[2])),s=(n.where??[]).filter(Lr).filter(u=>!$y(u[2])),o=A_(r,i.map(ML));return{...n,where:[...s,...t,{exists:o}]}}function*k_(e,t=[]){yield[...t,e];const n=(e.where??[]).filter(s=>lr(s)),r=Object.values(e.include??{}),i=[...n.map(s=>s.exists),...r.map(s=>s.subquery)];for(const s of i){const o={...e,where:(e.where??[]).filter(u=>!lr(u)||u.exists!==s)};yield*k_(s,[...t,o])}}const RL={"=":"=","!=":"!=","<":">",">":"<","<=":">=",">=":"<=",in:"has",nin:"!has",has:"in","!has":"nin"};function ML(e){const[t,n,r]=e;if(!io(r))throw new R(`Expected filter value to be a relation variable, but got ${r}`);return[r.slice(1),RL[n],"$"+t]}function NL(e){return async t=>{var s;const n=await e.findByEntity(t),r=(s=ro(n).get(t))==null?void 0:s.data;return[Vi(t),{triples:n,entity:r,relationships:{},existsFilterTriples:[]}]}}function FL(e,t,n,r,i){const{where:s}=n,o=rL(n);return async([u,a])=>{const{entity:c}=a;if(!c)return!1;if(!s)return!0;for(const l of o){const f=s[l];if(!await jd(e,t,n,r,i,a,f))return!1}return!0}}function jL(e){const{order:t,after:n,collectionName:r}=e;let i=!1,s=!1,o=!1;return async([u,{entity:a}])=>{if(!n)return!0;const[c,l]=n;if(i&&o||s)return!0;const[f,p]=t&&t.length>0?t[0]:["id","ASC"],d=a[f][0],[m,y]=c,b=q.encodeValue(m),g=q.encodeValue(d);return g===b?(i=!0,st(r,u)===y&&(o=!0)):(p==="ASC"?g>b:g<b)&&(s=!0),l&&(i&&o||s)}}function CL(e,t,n,r,i){const{order:s,collectionName:o}=n,{schema:u,skipRules:a,cache:c,stateVector:l}=i,f=u?kL((s??[]).map(p=>p[0]),u,o):{};return async([p,{entity:d,relationships:m,triples:y,existsFilterTriples:b}])=>{if(!Object.keys(f).length)return[p,{entity:d,relationships:m,triples:y,existsFilterTriples:b}];for(const[g,v]of Object.entries(f)){if(m[g])continue;const x=u?Ts(g.split("."),u,n.collectionName):void 0;if(!x||(x==null?void 0:x.type)!=="query")throw new R(`Could not find relationship info for ${g} in the schema.`);const S=x.query,A=Array.from(v.values()).reduce((ce,le)=>(ce[le]=null,ce),{});let U={...S,include:{...S.include??{},...A}};const K=await $s(e,t,n,U,x.cardinality,r,i,d);d[g]=K.results,m[g]=Array.from(K.triples.values()).flat()}return[p,{entity:d,relationships:m,triples:y,existsFilterTriples:b}]}}function DL(e,t,n,r,i){const{include:s}=n,o=Object.entries(s??{});return async([u,{entity:a,relationships:c,triples:l,existsFilterTriples:f}])=>{for(const[p,{subquery:d,cardinality:m}]of o){if(c[p])continue;const y=await $s(e,t,n,d,m,r,i,a);a[p]=y.results,c[p]=Array.from(y.triples.values()).flat()}return[u,{entity:a,triples:l,relationships:c,existsFilterTriples:f}]}}function LL(e){const t=e.indexOf(".");if(t===-1)return e;const[n,r]=[e.slice(0,t),e.slice(t+1)],i=parseInt(n);return isNaN(i)?e:`${i+1}.${r}`}async function $s(e,t,n,r,i,s,o,u){const{schema:a}=o,c=qL(u,a,n.collectionName);s.queriedDataStack=[...s.queriedDataStack,c];let l={...r,vars:{...n.vars??{},...r.vars??{}}};l=un(l,a,{roles:e.sessionRoles},{skipRules:o.skipRules});const f=i==="one"?await Ah(e,t,l,s,o):await sr(e,t,l,s,o);return s.queriedDataStack.pop(),f}function Gt(){return{queriedDataStack:[]}}function BL(e){return e==="_collection"}async function sr(e,t,n,r,i={}){var S;const{schema:s,cache:o}=i,u=(S=s==null?void 0:s[n.collectionName])==null?void 0:S.schema;if(o&&g_.canCacheQuery(n,u))return o.resolveFromCache(n,e.systemVars,r,i);const a=await kh(e,t,n,r,i),{order:c,limit:l,select:f,where:p,collectionName:d,after:m}=a,{candidates:y,fulfilled:b}=await IL(t,a,s),g=new Map;let v=new vr().map(NL(t)).filter(FL(e,t,a,r,i)).tap(async([A,{triples:U}])=>{g.has(A)?g.set(A,g.get(A).concat(U)):g.set(A,U)}).filter(async([,{entity:A}])=>!Y3(A));c&&!b.order.every(A=>A)&&(v=v.map(CL(e,t,n,r,i)).sort(([A,{entity:U}],[K,{entity:ce}])=>Ih(n)(U,ce))),m&&!b.after&&(v=v.filter(jL(n)),b.after=!0),l&&(v=v.take(l)),(!f||f.length>0||n.include&&Object.keys(n.include).length>0)&&(v=v.map(DL(e,t,n,r,i)).map(async([A,{entity:U,relationships:K,triples:ce,existsFilterTriples:le}])=>{const Ke=f||(s&&n.collectionName!=="_metadata"?Object.entries(s[n.collectionName].schema.properties).filter(([at,wn])=>wn.type!=="query").map(([at])=>at):Object.keys(U).filter(at=>!BL(at))),W=Object.keys(n.include??{}),ee=Ke.concat(W).reduce(JL(U),{});return[A,{entity:ee,relationships:K,triples:ce,existsFilterTriples:le}]})),v=v.tap(([A,{relationships:U,existsFilterTriples:K}])=>{g.has(A)||g.set(A,[]);for(const ce of Object.values(U))g.set(A,g.get(A).concat(ce));g.set(A,g.get(A).concat(K))}).map(([A,{entity:U}])=>[A,U]);const x=await v.run(y);return{results:new Map(x),triples:g}}function UL(e,t){e.order&&t.sort((n,r)=>Ih(e)(n[1],r[1]))}function Ih(e){return(t,n)=>{var r,i;for(const[s,o]of e.order){const u=(r=Oy(t,s.split(".")))==null?void 0:r[0],a=(i=Oy(n,s.split(".")))==null?void 0:i[0],c=q.encodeValue(u??q.MIN),l=q.encodeValue(a??q.MIN),f=c<l?-1:c>l?1:0;if(f!==0)return o==="ASC"?f:f*-1}return 0}}function Oy(e,t){return t.reduce((n,r)=>n[r],e)}async function Ah(e,t,n,r,i={}){n={...n,limit:1};const s=await sr(e,t,n,r,i),{results:o,triples:u}=s;return{results:[...o.values()][0]??null,triples:u}}function fu(e,t,n){if(!t)return!0;const r=t.filter(Lr),i=t.filter(Fn).filter(c=>c.mod==="or"),s=t.filter(Fn).filter(c=>c.mod==="and");return!(!zL(e,r,n)||!i.every(({filters:c})=>c.some(l=>fu(e,[l],n)))||!s.every(({filters:c})=>fu(e,c,n)))}function zL(e,t,n){const r=t.reduce((i,s)=>{const[o,u,a]=s;return i.has(o)?i.get(o).push([u,a]):i.set(o,[[u,a]]),i},new Map);return r.size===0||[...r.entries()].every(([i,s])=>{const o=n&&Gi(n,i.split("."));return s.every(([u,a])=>o&&o.type==="set"?w_(e,i,u,a):b_(e,i,u,a))})}function P_(e,t,n,r,i,s={}){const{select:o,order:u,limit:a,include:c}=n,l=Gt(),p=(async()=>{let d=new Map,m=new Map,y=()=>{};try{const b=await sr(e,t,n,l,s);d=b.results,m=b.triples;const{where:g}=await kh(e,t,n,l,s);y=t.onWrite(async v=>{var S;try{if(g&&GL(g,W=>lr(W))||c&&Object.keys(c).length>0||u&&u.some(W=>s.schema&&AL(W[0],s.schema,n.collectionName))){const W=await sr(e,t,n,Gt(),{schema:s.schema,skipRules:s.skipRules,cache:s.cache});d=W.results,m=W.triples,await r([new Map([...d].map(([ee,at])=>[ee,Rr(at,s.schema,n.collectionName)])),m]);return}const A=Object.values(v).flatMap(W=>W.inserts),U=Object.values(v).flatMap(W=>W.deletes);let K=new Map(d);const ce=new Map,le=new Set([...A,...U].map(({id:W})=>Wt(W)).filter(([W,ee])=>W===n.collectionName).map(([W,ee])=>ee));if(!le.size)return;let Ke=!1;for(const W of le){let at=function(Mi,Gr){var Kh;if(!Gr.after||!((Kh=Gr.order)!=null&&Kh.length))return!0;const qh=Gr.order[0][0],hv=Gr.order[0][1],[mv,Jh]=Gr.after,[ea,ta]=mv,na=Mi[qh][0];return hv==="ASC"?na===ea?Jh?Mi.id[0]>=Vi(ta):Mi.id[0]>Vi(ta):na>ea:na===ea?Jh?Mi.id[0]<=Vi(ta):Mi.id[0]<Vi(ta):na<ea};var x=at;const ee=await t.findByEntity(st(n.collectionName,W)),wn=new Ml;bh(wn,ee);const Bn=wn.data,pv=Bn._collection&&Bn._collection[0]===n.collectionName&&fu(Bn,g??[],s.schema&&((S=s.schema[n.collectionName])==null?void 0:S.schema))&&at(Bn,n);let Vh=!0;if(u&&a&&K.size>=a){const Gr=[...K.values()].at(-1);Vh=Ih(n)(Bn,Gr)<1}pv&&Vh?(!K.has(W)||!Xu(K.get(W),Bn))&&(K.set(W,Bn),ce.set(W,Object.values(wn.triples)),Ke=!0):K.has(W)&&(K.delete(W),ce.set(W,Object.values(wn.triples)),Ke=!0)}if(!Ke)return;if(u||a){const W=[...K];if(a&&W.length<a){const ee=W.at(W.length-1),at=ee&&st(n.collectionName,ee[0]),wn={...n,limit:a-W.length,after:at?[[u?ee[1][u[0][0]][0]:at,at],!1]:void 0},Bn=await sr(e,t,wn,Gt(),{schema:s.schema,skipRules:s.skipRules,cache:s.cache});for(const Wh of Bn.results)W.push(Wh)}u&&UL(n,W),K=new Map(W.slice(0,a))}d=K,m=ce,await r([new Map([...d].map(([W,ee])=>[W,Rr(ee,s.schema,n.collectionName)])),m])}catch(A){console.error(A),i&&await i(A)}}),await r([new Map([...d].map(([v,x])=>[v,Rr(x,s.schema,n.collectionName)])),m])}catch(b){console.error(b),i&&await i(b)}return y})();return async()=>{(await p)()}}function WL(e,t,n,r,i,s={}){return P_(e,t,n,([o])=>r(o),i,s)}function VL(e,t,n,r,i,s={}){const u=(async()=>{let a=new Map;try{if(s.stateVector&&s.stateVector.size>0){const l=await PL(t,s.stateVector);a=(await Sy(e,t,n,l,Gt(),s)).reduce((p,d)=>(p.has(d.id)?p.get(d.id).push(d):p.set(d.id,[d]),p),new Map)}else a=(await sr(e,t,n,Gt(),{schema:s.schema,stateVector:s.stateVector,cache:s.cache})).triples;const c=t.onWrite(async l=>{const f=Object.values(l).flatMap(m=>m.inserts),d=(await Sy(e,t,n,f,Gt(),s)).reduce((m,y)=>(m.has(y.id)?m.get(y.id).push(y):m.set(y.id,[y]),m),new Map);d.size>0&&r(d)});return await r(a),c}catch(c){console.error(c),i&&await i(c)}return()=>{}})();return async()=>{(await u)()}}function qL(e,t,n){var i;let r={};if(t){const s=(i=t[n])==null?void 0:i.schema;r={...Object.entries(s.properties).reduce((u,[a,c])=>(c.type==="query"||(u[a]=void 0),u),{}),...Rr(e,t,n)}}else r={...pt(e,!0)};return r._collection=n,r}function JL(e){return(t,n)=>{const r=n.split("."),i=r.pop();let s=t,o=e;for(const u of r)s[u]=s[u]??{},s=s[u],o=e[u][0];return s[i]=o[i],t}}async function kh(e,t,n,r,i){const s=(n.where??[]).filter(Lr);for(const a of s){const[c,l,f]=a;io(f)&&await KL(f,e,t,r,i)}const o=E_(n,{systemVars:e.systemVars,roles:e.sessionRoles},r),u=n.where?R_(n.where,o):void 0;return{...n,where:u}}function E_(e,t,n){var s,o,u,a,c;const r={...((s=t.systemVars)==null?void 0:s.global)??{},...((o=t.systemVars)==null?void 0:o.session)??{},...e.vars??{},...((n==null?void 0:n.queriedDataStack)??[]).reduce((l,f)=>({...l,...f}),{})},i={global:((u=t.systemVars)==null?void 0:u.global)??{},session:((a=t.systemVars)==null?void 0:a.session)??{},query:e.vars??{},role:e.collectionName==="_metadata"||(c=t.roles)==null?void 0:c.reduce((l,f)=>({...l,...f.roleVars}),{}),...((n==null?void 0:n.queriedDataStack)??[]).reduce((l,f,p,d)=>({...l,[d.length-p]:f}),{})};return{...r,...i}}async function KL(e,t,n,r,i){if(!i.schema)return;const[s,o]=Ph(e),u=parseInt(s??"");if(!isNaN(u)){const a=r.queriedDataStack.length-u,c=r.queriedDataStack[a],l=T_(o,i.schema,c._collection),f=Object.entries(l);if(f.length>0){const p=f.at(0),m=f.at(-1)[0],y=p[1],b=m.split(".");if(y.cardinality!=="one")throw new R('Cannot load variables with cardinality "many"');const g=b.slice(1).reverse().reduce((S,A)=>({[A]:S}),null);let v={...y.query};g!==null&&(v.include=g);const{results:x}=await $s(t,n,{collectionName:c._collection},v,y.cardinality,Gt(),i,c);c[b[0]]=pt(x)}}}function Rr(e,t,n){var s;const r=pt(e);delete r._collection;const i=(s=t==null?void 0:t[n])==null?void 0:s.schema;return i?i.convertDBValueToJS(r,t):r}const du="#";function QL(e){if(!e)return new Vm(e,"id cannot be undefined.");if(String(e).includes(du))return new Vm(e,`Id cannot include ${du}.`)}function st(e,t){return`${e}${du}${t}`}function Wt(e){const t=e.split(du);if(t.length!==2)throw new FE(`Malformed ID: ${e} should only include one separator(${du})`);return[t[0],t[1]]}function Vi(e){const[t,n]=Wt(e);return n}function R_(e,t){return e.map(n=>{if(Fn(n))return{...n,filters:R_(n.filters,t)};if(Lr(n)){const r=HL(n[2],t);return[n[0],n[1],r]}return n})}function HL(e,t={}){if(!io(e))return e;const[n,r]=Ph(e);if(n){const i=t[n],s=r.split(".");let o=i;for(const u of s){if(o==null)throw new Wm(e);o=o[u]}return o}else{if(r in t)return t[r];throw new Wm(e)}}function*M_(e){for(const t of e)Fn(t)?yield*M_(t.filters):yield t}function GL(e,t){for(const n of M_(e))if(t(n))return!0;return!1}async function N_(e){return e.findByEntity(st("_metadata","_schema"))}async function Dd(e){const t=await N_(e);return{schema:t.length>0?vB(t):void 0,schemaTriples:t}}async function XL(e,t){if(!t)return{successful:!1,issues:[]};const n=await e.transact(async r=>{const i=await r.getSchema();let s=[];if(i){const l=B3(i,t);if(l.length===0)return{successful:!0,issues:s};if(s=await V3(r,l),s.length>0&&s.some(f=>f.violatesExistingData))return{successful:!1,issues:s};l.length>0&&e.logger.info(`applying ${l.length} changes to schema`)}const o=await r.storeTx.findByEntity(st("_metadata","_schema"));await r.storeTx.deleteTriples(o);const u=_B(t),a=await r.storeTx.clock.getNextTimestamp(),c=u.map(([l,f,p])=>({id:l,attribute:f,value:p,timestamp:a,expired:!1}));return await r.storeTx.insertTriples(c),{successful:!0,issues:s}},{dangerouslyBypassSchemaInitialization:!0});return(n==null?void 0:n.output)??{successful:!1,issues:[]}}function YL(e,t,n){const r=n??console,i=`Found ${t.length} backwards incompatible schema changes.`;t.length>0?r.warn(i):r.info(i),e?r.info("Schema update successful"):(r.error("Schema update failed. Please resolve the following issues:"),t.filter(u=>u.violatesExistingData).reduce((u,a)=>{const c=a.context.collection,l=u.get(c)??[];return u.set(c,[...l,a]),u},new Map).forEach((u,a)=>{r.error(`
Collection: '${a}'`),u.forEach(({issue:c,violatesExistingData:l,context:f,cure:p})=>{l&&r.error(`	'${f.attribute.join(".")}'
		Issue: ${c}
		Fix:   ${p}`)})}),r.info(""))}function ZL(e,t,n){var a;if(e==null)throw new UE("Unable to run triple validation due to missing schema. This is unexpected and likely a bug.");const[r,...i]=t;if(r==="_collection"||r==="_metadata")return;const s=e[r];if(!s)throw new To(r,e);const o=Gi(s.schema,i);if(n==="{}"&&["record","set"].includes(o.type))return;const u=Zc.includes(o.type);if(!(!u&&["record","set"].includes(o.type)&&((a=o.options)==null?void 0:a.nullable)===!0&&n===null)){if(!u)throw new qt(i,"Cannot set a non-value type to a value. For example, you may be attempting to set a value on a record type.");if(!o.validateTripleValue(n))throw new BE(r,t,n)}}function F_(e,t,n){return e.forEach((r,i)=>{e.set(i,Rr(r,t,n))}),e}function io(e){return typeof e=="string"&&e.startsWith("$")}function $y(e){if(!io(e))return!1;const[t,n]=Ph(e);return t===void 0&&n!=="SESSION_USER_ID"?!0:!isNaN(parseInt(t??""))}const eB=["global","session","role","query"];function Ph(e){const t=e.slice(1).split(".");if(t.length<1)throw new R(`Invalid variable: ${e}`);return t.length===1?[void 0,t[0]]:tB(t[0])?[t[0],t.slice(1).join(".")]:[void 0,t.join(".")]}function tB(e){return eB.includes(e??"")||!isNaN(parseInt(e??""))}let pu=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");function Ul(e,t,n){return`Expected a ${e} value${t.nullable?" or null":""}, but got ${typeof n} instead.`}const nB=["=","!=","like","nlike","in","nin"];function Ld(e={}){if(e&&!zl(e))throw new el(e);return{type:"string",supportedOperations:nB,context:{},options:e,toJSON(){return{type:this.type,options:this.options}},convertInputToDBValue(t){const n=this.validateInput(t);if(n)throw new Xs("string",t,n);return t},convertDBValueToJS(t){return t},convertJSONToJS(t){if(e.nullable&&t===null)return null;if(typeof t!="string")throw new Ys("string",t);return t},convertJSToJSON(t){return t},defaultInput(){return Wl(e)},validateInput(t){if(!(e.nullable&&t===null)){if(typeof t!="string")return Ul("string",e,t);if(e.enum&&!e.enum.includes(t))return rB(e.enum,t)}},validateTripleValue(t){return typeof t=="string"&&(!e.enum||e.enum.includes(t))||!!e.nullable&&t===null},fromString(t){return t}}}function rB(e,t){return`Expected a value in the enum [${e.join(", ")}], but got ${t} instead.`}const iB=/t|\s/i;function sB(e){const t=e.split(iB);return t.length===2&&cB(t[0])&&fB(t[1],!0)}function oB(e){return e%4===0&&(e%100!==0||e%400===0)}const uB=/^[\+\-]?([\d]{4,6})-(\d\d)-(\d\d)$/,aB=[0,31,28,31,30,31,30,31,31,30,31,30,31];function cB(e){const t=uB.exec(e);if(!t)return!1;const n=+t[1],r=+t[2],i=+t[3];return r>=1&&r<=12&&i>=1&&i<=(r===2&&oB(n)?29:aB[r])}const lB=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function fB(e,t){const n=lB.exec(e);if(!n)return!1;const r=+n[1],i=+n[2],s=+n[3],o=n[5];return(r<=23&&i<=59&&s<=59||r===23&&i===59&&s===60)&&(!t||o!=="")}const dB=["=","!=","<",">","<=",">="];function j_(e={}){if(!zl(e))throw new el(e);return{type:"date",supportedOperations:dB,context:{},options:e,toJSON(){return{type:this.type,options:this.options}},convertInputToDBValue(t){const n=this.validateInput(t);if(n)throw new Xs("date",t,n);return t?new Date(t).toISOString():null},convertDBValueToJS(t){return t?new Date(t):null},convertJSONToJS(t){if(e.nullable&&t===null)return null;if(typeof t!="string")throw new Ys("date",t);return new Date(t)},convertJSToJSON(t){return t===null?t:t.toISOString()},defaultInput(){const t=Wl(e);return t==null?t:new Date(t)},validateInput(t){const n=t instanceof Date&&!Number.isNaN(t.getTime()),r=typeof t=="string"&&!Number.isNaN(Date.parse(t)),i=e.nullable&&t===null;if(!(n||r||i))return Ul("date",e,t)},validateTripleValue(t){return e.nullable&&t===null?!0:typeof t!="string"?!1:sB(t)},fromString(t){return new Date(t)}}}function C_(e){const t=(Object.entries(e).filter(([r,i])=>!!i.context.optional).map(([r,i])=>r)||[]).sort();function n(r){return t.includes(r)}return{type:"record",supportedOperations:[],context:{},properties:e,optional:t,toJSON(){const r=Object.fromEntries(Object.entries(e).map(([s,o])=>[s,o.toJSON()])),i={type:this.type,properties:r};return t.length>0&&(i.optional=t),i},convertInputToDBValue(r){const i=this.validateInput(r);if(i)throw new Xs("record",JSON.stringify(r),i);return Object.fromEntries(Object.entries(e).filter(([s,o])=>{const u=o.type==="query",a=n(s)&&r[s]===void 0;return!u&&!a}).map(([s,o])=>[s,o.convertInputToDBValue(r[s])]))},convertDBValueToJS(r,i){const s={};for(const o in r)if(Object.prototype.hasOwnProperty.call(r,o)){const u=r[o];if(u===void 0)continue;if(!e[o]){s[o]=u;continue}s[o]=e[o].convertDBValueToJS(u,i)}return s},convertJSONToJS(r,i){if(typeof r!="object")throw new Ys("record",r);return Object.fromEntries(Object.entries(r).map(([s,o])=>{const u=e[s];if(!u)throw new R(`Invalid property ${s} for record`);return[s,u.convertJSONToJS(o,i)]}))},convertJSToJSON(r,i){return Object.fromEntries(Object.entries(e).filter(([s,o])=>!(n(s)&&r[s]===void 0)).map(([s,o])=>[s,o.convertJSToJSON(r[s],i)]))},defaultInput(){if(!this.context.optional)return Object.fromEntries(Object.entries(e).map(([r,i])=>[r,i.defaultInput()]).filter(([r,i])=>i!==void 0))},validateInput(r){if(r===null)return"value cannot be null";if(typeof r!="object")return"value must be an object";const i=Object.entries(e).filter(([u,a])=>!n(u)&&a.type!=="query"&&a.defaultInput()===void 0),s=new Set(Object.keys(r)),o=i.filter(([u,a])=>!s.has(u)).map(([u,a])=>u);if(o.length>0)return`missing properties: ${o.join(", ")}`;for(const u in r)if(e[u]){const a=e[u];if(n(u)&&r[u]===void 0)continue;const c=a.validateInput(r[u]);if(c)return`invalid value for ${u} (${c})`}else return`invalid property ${u}`},validateTripleValue(r){return!0}}}const pB=["=","!=","<",">","<=",">=","in","nin"];function D_(e={}){if(e&&!zl(e))throw new el(e);return{type:"number",supportedOperations:pB,context:{},options:e,toJSON(){return{type:this.type,options:this.options}},convertInputToDBValue(t){const n=this.validateInput(t);if(n)throw new Xs("number",t,n);return t},convertDBValueToJS(t){return t},convertJSONToJS(t){if(e.nullable&&t===null)return null;if(typeof t!="number")throw new Ys("number",t);return t},convertJSToJSON(t){return t},defaultInput(){return Wl(e)},validateInput(t){if(!(typeof t=="number"||e.nullable&&t===null))return Ul("number",e,t)},validateTripleValue(t){return typeof t=="number"||!!e.nullable&&t===null},fromString(t){return parseFloat(t)}}}const hB=["=","!="];function Eh(e={}){if(!zl(e))throw new el(e);return{type:"boolean",supportedOperations:hB,context:{},options:e,toJSON(){return{type:this.type,options:this.options}},convertInputToDBValue(t){const n=this.validateInput(t);if(n)throw new Xs("boolean",t,n);return t},convertDBValueToJS(t){return t},convertJSONToJS(t){if(e.nullable&&t===null)return null;if(typeof t!="boolean")throw new Ys("boolean",t);return t},convertJSToJSON(t){return t},defaultInput(){return Wl(e)},validateInput(t){if(!(typeof t=="boolean"||e.nullable&&t===null))return Ul("boolean",e,t)},validateTripleValue(t){return typeof t=="boolean"||!!e.nullable&&t===null},fromString(t){return t==="true"}}}const mB=["=","!=","has","!has"];function L_(e,t={}){var n;if(!Zc.includes(e.type))throw new zE(e.type);if((n=e.options)!=null&&n.nullable)throw new ZE("Set types cannot contain nullable types");return{type:"set",supportedOperations:mB,context:{},items:e,options:t,toJSON(){return{type:this.type,items:this.items.toJSON(),options:this.options}},convertInputToDBValue(r){const i=this.validateInput(r);if(i)throw new Xs(`set<${e.type}>`,r,i);return t.nullable&&r===null?null:[...r.values()].reduce((s,o)=>({...s,[o]:!0}),{})},convertJSONToJS(r){if(t.nullable&&r===null)return null;if(!Array.isArray(r))throw new Ys(`set<${this.items.type}>`,r);return new Set(r)},defaultInput(){if(!this.context.optional)return new Set},convertDBValueToJS(r){return t.nullable&&r===null?null:new Set(Object.entries(r).filter(([i,s])=>!!s).map(([i,s])=>this.items.fromString(i)))},convertJSToJSON(r){if(t.nullable&&r===null)return null;if(!(r instanceof Set)&&!(r instanceof Array))throw new eR(`set<${this.items.type}>`,r);return[...r.values()]},validateInput(r){if(t.nullable===!0&&r===null)return;if(!(r instanceof Set)&&!(r instanceof Array))return`Expected Set, got ${yB(r)}`;const i=Array.from(r.values());if(i.includes(null))return"Set cannot contain null values";const s=i.reduce((o,u)=>{if(o)return o;const a=this.items.validateInput(u);if(a)return[u,a]},void 0);if(s)return`Invalid value ${s[0]} for set<${e.type}>. Reason: ${s[1]}.`},validateTripleValue(r){throw new kb("Set validation")}}}function yB(e){return e===null?"null":Array.isArray(e)?"array":e instanceof Set?"set":e instanceof Map?"map":typeof e}class gB{constructor(t,n,r){I(this,"changeTracker");I(this,"prefix");I(this,"schema");this.changeTracker=t,this.prefix=n,this.schema=r}add(t){const n=this.schema.items.convertInputToDBValue(t);this.changeTracker.set([...this.prefix.split("/"),n].join("/"),!0)}clear(){B_(this.changeTracker,this.prefix).forEach(n=>{this.changeTracker.set([...this.prefix.split("/"),n].join("/"),!1)})}delete(t){const n=this.schema.items.convertInputToDBValue(t);this.changeTracker.get([...this.prefix.split("/"),n].join("/"))&&this.changeTracker.set([...this.prefix.split("/"),n].join("/"),!1)}}function B_(e,t){const n=e.get(t);if(!n)return new Set;const r=Object.entries(n).filter(([i,s])=>!!s).map(([i,s])=>i);return new Set(r)}function wB(e,t,n){const r=B_(e,t),i=new Set([...r].map(o=>n.items.convertDBValueToJS(o))),s=new gB(e,t,n);return new Proxy(i,{get(o,u){return typeof o[u]=="function"?function(...a){return s[u]&&s[u](...a),o[u](...a)}:Reflect.get(o,u)}})}function wo(e,t="many"){return{type:"query",supportedOperations:[],context:{},cardinality:t,query:e,toJSON(){return{type:this.type,query:e,cardinality:t}},convertInputToDBValue(n){throw new R("Invalid Operation - Inserting relational data is not supported")},convertDBValueToJS(n,r){var s;if(!r)throw new R("A schema is required to convert DB value to JS");const i=(s=r==null?void 0:r[e.collectionName])==null?void 0:s.schema;if(!i)throw new To(e.collectionName,r);if(!n)return n;if(t==="one")return i.convertDBValueToJS(n,r);if(t==="many")return new Map(Array.from(n.entries()).map(([o,u])=>[o,i.convertDBValueToJS(u,r)]));throw new ff(t)},convertJSONToJS(n,r){var s;if(!r)throw new R("A schema is required to convert JSON value to JS");const i=(s=r==null?void 0:r[e.collectionName])==null?void 0:s.schema;if(!i)throw new To(e.collectionName,r);if(!n)return n;if(t==="one")return i.convertJSONToJS(n,r);if(t==="many")return new Map(n.map(([o,u])=>[o,i.convertJSONToJS(u,r)]));throw new ff(t)},convertJSToJSON(n,r){var s;if(!r)throw new R("A schema is required to convert JSON value to JS");const i=(s=r==null?void 0:r[e.collectionName])==null?void 0:s.schema;if(!i)throw new To(e.collectionName,r);if(!n)return n;if(t==="one")return i.convertJSToJSON(n,r);if(t==="many")return Array.from(n.entries()).map(([o,u])=>[o,i.convertJSToJSON(u,r)]);throw new ff(t)},defaultInput(){},validateInput(n){},validateTripleValue(n){return!1}}}function zl(e){return j3(NE,e)}Oe.Readonly(Oe.Tuple([Oe.Number(),Oe.String()]));function Wl(e){let t=e.default;if(t!==void 0){if(typeof t!="object"||t===null)return t;{const{args:n,func:r}=t;if(r==="uuid")return n&&typeof n[0]=="number"?pu(n[0]):pu();if(r==="now")return new Date().toISOString()}}}function sc(e,t={}){if(!e)throw new QE("Failed to parse this schema definition from its serialized form because it is undefined.");let n;switch(e.type){case"string":n=Ld(e.options);break;case"number":n=D_(e.options);break;case"boolean":n=Eh(e.options);break;case"date":n=j_(e.options);break;case"set":n=L_(sc(e.items),e.options);break;case"query":n=wo(e.query,e.cardinality);break;case"record":const r=e.optional||[];n=C_(Object.fromEntries(Object.entries(e.properties).map(([i,s])=>[i,sc(s,{optional:r.includes(i)})])));break;default:throw new HE(e.type)}for(const r in t)n.context[r]=t[r];return n}function Gi(e,t){if(t.length===0)throw new qt([]);let n=e.properties[t[0]];if(!n)throw new qt(t);for(let r=1;r<t.length;r++){if(!n)throw new qt(t);if(n.type==="query")return n;if(n.type==="set")n=Eh();else if(n.type==="record"){const i=t[r];n=n.properties[i]}else throw new qt(t)}if(!n)throw new qt(t);return n}function U_(e,t,n){let r=0,i=Vl(t,n);return{next(){if(r>=e.length)return{done:!0,value:i.current};const o=e[r];return i=i.get(o),r++,{done:!1,value:i.current}},[Symbol.iterator](){return this}}}function Vl(e,t){var i,s;let n=(i=e[t])==null?void 0:i.schema;const r=o=>{let u=n;if((n==null?void 0:n.type)==="record")u=n.properties[o];else if((n==null?void 0:n.type)==="query"){const{query:a}=n;return Vl(e,a.collectionName).get(o)}else u=void 0;return n=u,{get:r,current:n}};return{get:r,current:(s=e[t])==null?void 0:s.schema}}function Ts(e,t,n){let r=U_(e,t,n),i=r.next();for(;!i.done;)i=r.next();return i.value}function bB(e,t){return t?t.convertInputToDBValue(e):e}function z_(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,{...n,schema:sc(n.schema)}]))}function _B(e){const t=Rh(e),n=tl(t),r=st("_metadata","_schema");return[[r,["_collection"],"_metadata"],[r,["_metadata","id"],"_schema"],...n.map(o=>[r,["_metadata",...o[0]],o[1]])]}function vB(e){const t=Ss(e,st("_metadata","_schema"));if(t)return Bd(t.data)}function Bd(e){const t=pt(e);delete t._collection,delete t.id;const n=t.version||0,r=t.collections||{};return xB({...t,version:n,collections:r})}function xB(e){if(!e)return;const t=z_(e.collections);return{...e,version:e.version,collections:t}}function Rh(e){if(!e)return;const t={};for(const[n,r]of Object.entries(e.collections)){const i=SB(r);t[n]=i}return{...e,version:e.version,collections:t}}function SB(e){const t=e.rules?{rules:e.rules}:{},n=e.permissions?{permissions:e.permissions}:{};return{schema:e.schema.toJSON(),...t,...n}}function OB(e){return e.schema.defaultInput()}function $B(e){if(!e)return;const n=ji(e).map(r=>JSON.stringify(r)).sort().join("");return TB(n)}function TB(e,t=31,n=1000000009){let r=0;for(let i=0;i<e.length;i++)r=(r*t+e.charCodeAt(i))%n;return r}var ql={},an={},IB=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(an,"__esModule",{value:!0});an.EmptyBTree=an.asSet=an.simpleComparator=an.defaultComparator=void 0;function W_(e,t){if(Number.isFinite(e)&&Number.isFinite(t))return e-t;var n=typeof e,r=typeof t;if(n!==r)return n<r?-1:1;if(n==="object"){if(e===null)return t===null?0:-1;if(t===null)return 1;if(e=e.valueOf(),t=t.valueOf(),n=typeof e,r=typeof t,n!==r)return n<r?-1:1}return e<t?-1:e>t?1:e===t?0:Number.isNaN(e)?Number.isNaN(t)?0:-1:Number.isNaN(t)?1:Array.isArray(e)?0:Number.NaN}an.defaultComparator=W_;function AB(e,t){return e>t?1:e<t?-1:0}an.simpleComparator=AB;var jn=function(){function e(t,n,r){this._root=xf,this._size=0,this._maxNodeSize=r>=4?Math.min(r,256):32,this._compare=n||W_,t&&this.setPairs(t)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._size===0},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this._root=xf,this._size=0},e.prototype.forEach=function(t,n){var r=this;return n!==void 0&&(t=t.bind(n)),this.forEachPair(function(i,s){return t(s,i,r)})},e.prototype.forEachPair=function(t,n){var r=this.minKey(),i=this.maxKey();return this.forRange(r,i,!0,t,n)},e.prototype.get=function(t,n){return this._root.get(t,n,this)},e.prototype.set=function(t,n,r){this._root.isShared&&(this._root=this._root.clone());var i=this._root.set(t,n,r,this);return i===!0||i===!1?i:(this._root=new PB([this._root,i]),!0)},e.prototype.has=function(t){return this.forRange(t,t,!0,void 0)!==0},e.prototype.delete=function(t){return this.editRange(t,t,!0,Ty)!==0},e.prototype.with=function(t,n,r){var i=this.clone();return i.set(t,n,r)||r?i:this},e.prototype.withPairs=function(t,n){var r=this.clone();return r.setPairs(t,n)!==0||n?r:this},e.prototype.withKeys=function(t,n){for(var r=this.clone(),i=!1,s=0;s<t.length;s++)i=r.set(t[s],void 0,!1)||i;return n&&!i?this:r},e.prototype.without=function(t,n){return this.withoutRange(t,t,!0,n)},e.prototype.withoutKeys=function(t,n){var r=this.clone();return r.deleteKeys(t)||!n?r:this},e.prototype.withoutRange=function(t,n,r,i){var s=this.clone();return s.deleteRange(t,n,r)===0&&i?this:s},e.prototype.filter=function(t,n){var r=this.greedyClone(),i;return r.editAll(function(s,o,u){if(!t(s,o,u))return i=q_}),!i&&n?this:r},e.prototype.mapValues=function(t){var n={},r=this.greedyClone();return r.editAll(function(i,s,o){return n.value=t(s,i,o),n}),r},e.prototype.reduce=function(t,n){for(var r=0,i=n,s=this.entries(this.minKey(),lo),o;!(o=s.next()).done;)i=t(i,o.value,r++,this);return i},e.prototype.entries=function(t,n){var r=this.findPath(t);if(r===void 0)return Ni();var i=r.nodequeue,s=r.nodeindex,o=r.leaf,u=n!==void 0?1:0,a=t===void 0?-1:o.indexOf(t,0,this._compare)-1;return Ni(function(){e:for(;;)switch(u){case 0:if(++a<o.keys.length)return{done:!1,value:[o.keys[a],o.values[a]]};u=2;continue;case 1:if(++a<o.keys.length)return n[0]=o.keys[a],n[1]=o.values[a],{done:!1,value:n};u=2;case 2:for(var c=-1;;){if(++c>=i.length){u=3;continue e}if(++s[c]<i[c].length)break}for(;c>0;c--)i[c-1]=i[c][s[c]].children,s[c-1]=0;o=i[0][s[0]],a=-1,u=n!==void 0?1:0;continue;case 3:return{done:!0,value:void 0}}})},e.prototype.entriesReversed=function(t,n,r){if(t===void 0&&(t=this.maxKey(),r=void 0,t===void 0))return Ni();var i=this.findPath(t)||this.findPath(this.maxKey()),s=i.nodequeue,o=i.nodeindex,u=i.leaf;At(!s[0]||u===s[0][o[0]],"wat!");var a=u.indexOf(t,0,this._compare);!r&&a<u.keys.length&&this._compare(u.keys[a],t)<=0&&a++;var c=n!==void 0?1:0;return Ni(function(){e:for(;;)switch(c){case 0:if(--a>=0)return{done:!1,value:[u.keys[a],u.values[a]]};c=2;continue;case 1:if(--a>=0)return n[0]=u.keys[a],n[1]=u.values[a],{done:!1,value:n};c=2;case 2:for(var l=-1;;){if(++l>=s.length){c=3;continue e}if(--o[l]>=0)break}for(;l>0;l--)s[l-1]=s[l][o[l]].children,o[l-1]=s[l-1].length-1;u=s[0][o[0]],a=u.keys.length,c=n!==void 0?1:0;continue;case 3:return{done:!0,value:void 0}}})},e.prototype.findPath=function(t){var n=this._root,r,i;if(n.isLeaf)r=Iy,i=Iy;else{r=[],i=[];for(var s=0;!n.isLeaf;s++){if(r[s]=n.children,i[s]=t===void 0?0:n.indexOf(t,0,this._compare),i[s]>=r[s].length)return;n=r[s][i[s]]}r.reverse(),i.reverse()}return{nodequeue:r,nodeindex:i,leaf:n}},e.prototype.diffAgainst=function(t,n,r,i){if(t._compare!==this._compare)throw new Error("Tree comparators are not the same.");if(this.isEmpty||t.isEmpty)return this.isEmpty&&t.isEmpty?void 0:this.isEmpty?r===void 0?void 0:e.stepToEnd(e.makeDiffCursor(t),r):n===void 0?void 0:e.stepToEnd(e.makeDiffCursor(this),n);for(var s=this._compare,o=e.makeDiffCursor(this),u=e.makeDiffCursor(t),a=!0,c=!0,l=e.compare(o,u,s);a&&c;){var f=e.compare(o,u,s),p=o.leaf,d=o.internalSpine,m=o.levelIndices,y=u.leaf,b=u.internalSpine,g=u.levelIndices;if(p||y){if(l!==0){if(f===0){if(p&&y&&i){var v=p.values[m[m.length-1]],x=y.values[g[g.length-1]];if(!Object.is(v,x)){var S=i(o.currentKey,v,x);if(S&&S.break)return S.break}}}else if(f>0){if(y&&r){var A=y.values[g[g.length-1]],S=r(u.currentKey,A);if(S&&S.break)return S.break}}else if(n&&p&&l!==0){var v=p.values[m[m.length-1]],S=n(o.currentKey,v);if(S&&S.break)return S.break}}}else if(!p&&!y&&f===0){var U=d.length-1,K=b.length-1,ce=d[U][m[U]],le=b[K][g[K]];if(le===ce){l=0,a=e.step(o,!0),c=e.step(u,!0);continue}}l=f,f<0?a=e.step(o):c=e.step(u)}if(a&&n)return e.finishCursorWalk(o,u,s,n);if(c&&r)return e.finishCursorWalk(u,o,s,r)},e.finishCursorWalk=function(t,n,r,i){var s=e.compare(t,n,r);if(s===0){if(!e.step(t))return}else s<0&&At(!1,"cursor walk terminated early");return e.stepToEnd(t,i)},e.stepToEnd=function(t,n){for(var r=!0;r;){var i=t.leaf,s=t.levelIndices,o=t.currentKey;if(i){var u=i.values[s[s.length-1]],a=n(o,u);if(a&&a.break)return a.break}r=e.step(t)}},e.makeDiffCursor=function(t){var n=t._root,r=t.height;return{height:r,internalSpine:[[n]],levelIndices:[0],leaf:void 0,currentKey:n.maxKey()}},e.step=function(t,n){var r=t.internalSpine,i=t.levelIndices,s=t.leaf;if(n===!0||s){var o=i.length;if(n===!0||i[o-1]===0){var u=r.length;if(u===0)return!1;for(var a=u-1,c=a;c>=0;){if(i[c]>0)return c<o-1&&(t.leaf=void 0,i.pop()),c<a&&(t.internalSpine=r.slice(0,c+1)),t.currentKey=r[c][--i[c]].maxKey(),!0;c--}return!1}else{var l=--i[o-1];return t.currentKey=s.keys[l],!0}}else{var f=r.length,p=f-1,d=r[p][i[p]];if(d.isLeaf){t.leaf=d;var l=i[f]=d.values.length-1;t.currentKey=d.keys[l]}else{var m=d.children;r[f]=m;var y=m.length-1;i[f]=y,t.currentKey=m[y].maxKey()}return!0}},e.compare=function(t,n,r){var i=t.height,s=t.currentKey,o=t.levelIndices,u=n.height,a=n.currentKey,c=n.levelIndices,l=r(a,s);if(l!==0)return l;var f=i<u?i:u,p=o.length-(i-f),d=c.length-(u-f);return p-d},e.prototype.keys=function(t){var n=this.entries(t,lo);return Ni(function(){var r=n.next();return r.value&&(r.value=r.value[0]),r})},e.prototype.values=function(t){var n=this.entries(t,lo);return Ni(function(){var r=n.next();return r.value&&(r.value=r.value[1]),r})},Object.defineProperty(e.prototype,"maxNodeSize",{get:function(){return this._maxNodeSize},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this._root.minKey()},e.prototype.maxKey=function(){return this._root.maxKey()},e.prototype.clone=function(){this._root.isShared=!0;var t=new e(void 0,this._compare,this._maxNodeSize);return t._root=this._root,t._size=this._size,t},e.prototype.greedyClone=function(t){var n=new e(void 0,this._compare,this._maxNodeSize);return n._root=this._root.greedyClone(t),n._size=this._size,n},e.prototype.toArray=function(t){t===void 0&&(t=2147483647);var n=this.minKey(),r=this.maxKey();return n!==void 0?this.getRange(n,r,!0,t):[]},e.prototype.keysArray=function(){var t=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,function(n,r){t.push(n)}),t},e.prototype.valuesArray=function(){var t=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,function(n,r){t.push(r)}),t},e.prototype.toString=function(){return this.toArray().toString()},e.prototype.setIfNotPresent=function(t,n){return this.set(t,n,!1)},e.prototype.nextHigherPair=function(t,n){return n=n||[],t===void 0?this._root.minPair(n):this._root.getPairOrNextHigher(t,this._compare,!1,n)},e.prototype.nextHigherKey=function(t){var n=this.nextHigherPair(t,lo);return n&&n[0]},e.prototype.nextLowerPair=function(t,n){return n=n||[],t===void 0?this._root.maxPair(n):this._root.getPairOrNextLower(t,this._compare,!1,n)},e.prototype.nextLowerKey=function(t){var n=this.nextLowerPair(t,lo);return n&&n[0]},e.prototype.getPairOrNextLower=function(t,n){return this._root.getPairOrNextLower(t,this._compare,!0,n||[])},e.prototype.getPairOrNextHigher=function(t,n){return this._root.getPairOrNextHigher(t,this._compare,!0,n||[])},e.prototype.changeIfPresent=function(t,n){return this.editRange(t,t,!0,function(r,i){return{value:n}})!==0},e.prototype.getRange=function(t,n,r,i){i===void 0&&(i=67108863);var s=[];return this._root.forRange(t,n,r,!1,this,0,function(o,u){return s.push([o,u]),s.length>i?EB:void 0}),s},e.prototype.setPairs=function(t,n){for(var r=0,i=0;i<t.length;i++)this.set(t[i][0],t[i][1],n)&&r++;return r},e.prototype.forRange=function(t,n,r,i,s){var o=this._root.forRange(t,n,r,!1,this,s||0,i);return typeof o=="number"?o:o.break},e.prototype.editRange=function(t,n,r,i,s){var o=this._root;o.isShared&&(this._root=o=o.clone());try{var u=o.forRange(t,n,r,!0,this,s||0,i);return typeof u=="number"?u:u.break}finally{for(var a=void 0;o.keys.length<=1&&!o.isLeaf;)a||(a=o.isShared),this._root=o=o.keys.length===0?xf:o.children[0];a&&(o.isShared=!0)}},e.prototype.editAll=function(t,n){return this.editRange(this.minKey(),this.maxKey(),!0,t,n)},e.prototype.deleteRange=function(t,n,r){return this.editRange(t,n,r,Ty)},e.prototype.deleteKeys=function(t){for(var n=0,r=0;n<t.length;n++)this.delete(t[n])&&r++;return r},Object.defineProperty(e.prototype,"height",{get:function(){for(var t=this._root,n=-1;t;)n++,t=t.isLeaf?void 0:t.children[0];return n},enumerable:!1,configurable:!0}),e.prototype.freeze=function(){var t=this;t.clear=t.set=t.editRange=function(){throw new Error("Attempted to modify a frozen BTree")}},e.prototype.unfreeze=function(){delete this.clear,delete this.set,delete this.editRange},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.hasOwnProperty("editRange")},enumerable:!1,configurable:!0}),e.prototype.checkValid=function(){var t=this._root.checkValid(0,this,0);At(t===this.size,"size mismatch: counted ",t,"but stored",this.size)},e}();an.default=jn;function kB(e){return e}an.asSet=kB;Symbol&&Symbol.iterator&&(jn.prototype[Symbol.iterator]=jn.prototype.entries);jn.prototype.where=jn.prototype.filter;jn.prototype.setRange=jn.prototype.setPairs;jn.prototype.add=jn.prototype.set;function Ni(e){e===void 0&&(e=function(){return{done:!0,value:void 0}});var t={next:e};return Symbol&&Symbol.iterator&&(t[Symbol.iterator]=function(){return this}),t}var V_=function(){function e(t,n){t===void 0&&(t=[]),this.keys=t,this.values=n||Fe,this.isShared=void 0}return Object.defineProperty(e.prototype,"isLeaf",{get:function(){return this.children===void 0},enumerable:!1,configurable:!0}),e.prototype.maxKey=function(){return this.keys[this.keys.length-1]},e.prototype.indexOf=function(t,n,r){for(var i=this.keys,s=0,o=i.length,u=o>>1;s<o;){var a=r(i[u],t);if(a<0)s=u+1;else if(a>0)o=u;else{if(a===0)return u;if(t===t)return i.length;throw new Error("BTree: NaN was used as a key")}u=s+o>>1}return u^n},e.prototype.minKey=function(){return this.keys[0]},e.prototype.minPair=function(t){if(this.keys.length!==0)return t[0]=this.keys[0],t[1]=this.values[0],t},e.prototype.maxPair=function(t){if(this.keys.length!==0){var n=this.keys.length-1;return t[0]=this.keys[n],t[1]=this.values[n],t}},e.prototype.clone=function(){var t=this.values;return new e(this.keys.slice(0),t===Fe?t:t.slice(0))},e.prototype.greedyClone=function(t){return this.isShared&&!t?this:this.clone()},e.prototype.get=function(t,n,r){var i=this.indexOf(t,-1,r._compare);return i<0?n:this.values[i]},e.prototype.getPairOrNextLower=function(t,n,r,i){var s=this.indexOf(t,-1,n),o=s<0?~s-1:r?s:s-1;if(o>=0)return i[0]=this.keys[o],i[1]=this.values[o],i},e.prototype.getPairOrNextHigher=function(t,n,r,i){var s=this.indexOf(t,-1,n),o=s<0?~s:r?s:s+1,u=this.keys;if(o<u.length)return i[0]=u[o],i[1]=this.values[o],i},e.prototype.checkValid=function(t,n,r){var i=this.keys.length,s=this.values.length;return At(this.values===Fe?i<=s:i===s,"keys/values length mismatch: depth",t,"with lengths",i,s,"and baseIndex",r),At(t==0||i>0,"empty leaf at depth",t,"and baseIndex",r),i},e.prototype.set=function(t,n,r,i){var s=this.indexOf(t,-1,i._compare);if(s<0){if(s=~s,i._size++,this.keys.length<i._maxNodeSize)return this.insertInLeaf(s,t,n,i);var o=this.splitOffRightSide(),u=this;return s>this.keys.length&&(s-=this.keys.length,u=o),u.insertInLeaf(s,t,n,i),o}else return r!==!1&&(n!==void 0&&this.reifyValues(),this.keys[s]=t,this.values[s]=n),!1},e.prototype.reifyValues=function(){return this.values===Fe?this.values=this.values.slice(0,this.keys.length):this.values},e.prototype.insertInLeaf=function(t,n,r,i){if(this.keys.splice(t,0,n),this.values===Fe){for(;Fe.length<i._maxNodeSize;)Fe.push(void 0);if(r===void 0)return!0;this.values=Fe.slice(0,this.keys.length-1)}return this.values.splice(t,0,r),!0},e.prototype.takeFromRight=function(t){var n=this.values;t.values===Fe?n!==Fe&&n.push(void 0):(n=this.reifyValues(),n.push(t.values.shift())),this.keys.push(t.keys.shift())},e.prototype.takeFromLeft=function(t){var n=this.values;t.values===Fe?n!==Fe&&n.unshift(void 0):(n=this.reifyValues(),n.unshift(t.values.pop())),this.keys.unshift(t.keys.pop())},e.prototype.splitOffRightSide=function(){var t=this.keys.length>>1,n=this.keys.splice(t),r=this.values===Fe?Fe:this.values.splice(t);return new e(n,r)},e.prototype.forRange=function(t,n,r,i,s,o,u){var a=s._compare,c,l;if(n===t){if(!r||(l=(c=this.indexOf(t,-1,a))+1,c<0))return o}else c=this.indexOf(t,0,a),l=this.indexOf(n,-1,a),l<0?l=~l:r===!0&&l++;var f=this.keys,p=this.values;if(u!==void 0)for(var d=c;d<l;d++){var m=f[d],y=u(m,p[d],o++);if(y!==void 0){if(i===!0){if(m!==f[d]||this.isShared===!0)throw new Error("BTree illegally changed or cloned in editRange");y.delete?(this.keys.splice(d,1),this.values!==Fe&&this.values.splice(d,1),s._size--,d--,l--):y.hasOwnProperty("value")&&(p[d]=y.value)}if(y.break!==void 0)return y}}else o+=l-c;return o},e.prototype.mergeSibling=function(t,n){if(this.keys.push.apply(this.keys,t.keys),this.values===Fe){if(t.values===Fe)return;this.values=this.values.slice(0,this.keys.length)}this.values.push.apply(this.values,t.reifyValues())},e}(),PB=function(e){IB(t,e);function t(n,r){var i=this;if(!r){r=[];for(var s=0;s<n.length;s++)r[s]=n[s].maxKey()}return i=e.call(this,r)||this,i.children=n,i}return t.prototype.clone=function(){for(var n=this.children.slice(0),r=0;r<n.length;r++)n[r].isShared=!0;return new t(n,this.keys.slice(0))},t.prototype.greedyClone=function(n){if(this.isShared&&!n)return this;for(var r=new t(this.children.slice(0),this.keys.slice(0)),i=0;i<r.children.length;i++)r.children[i]=r.children[i].greedyClone(n);return r},t.prototype.minKey=function(){return this.children[0].minKey()},t.prototype.minPair=function(n){return this.children[0].minPair(n)},t.prototype.maxPair=function(n){return this.children[this.children.length-1].maxPair(n)},t.prototype.get=function(n,r,i){var s=this.indexOf(n,0,i._compare),o=this.children;return s<o.length?o[s].get(n,r,i):void 0},t.prototype.getPairOrNextLower=function(n,r,i,s){var o=this.indexOf(n,0,r),u=this.children;if(o>=u.length)return this.maxPair(s);var a=u[o].getPairOrNextLower(n,r,i,s);return a===void 0&&o>0?u[o-1].maxPair(s):a},t.prototype.getPairOrNextHigher=function(n,r,i,s){var o=this.indexOf(n,0,r),u=this.children,a=u.length;if(!(o>=a)){var c=u[o].getPairOrNextHigher(n,r,i,s);return c===void 0&&o<a-1?u[o+1].minPair(s):c}},t.prototype.checkValid=function(n,r,i){var s=this.keys.length,o=this.children.length;At(s===o,"keys/children length mismatch: depth",n,"lengths",s,o,"baseIndex",i),At(s>1||n>0,"internal node has length",s,"at depth",n,"baseIndex",i);for(var u=0,a=this.children,c=this.keys,l=0,f=0;f<o;f++)u+=a[f].checkValid(n+1,r,i+u),l+=a[f].keys.length,At(u>=l,"wtf",i),At(f===0||a[f-1].constructor===a[f].constructor,"type mismatch, baseIndex:",i),a[f].maxKey()!=c[f]&&At(!1,"keys[",f,"] =",c[f],"is wrong, should be ",a[f].maxKey(),"at depth",n,"baseIndex",i),f===0||r._compare(c[f-1],c[f])<0||At(!1,"sort violation at depth",n,"index",f,"keys",c[f-1],c[f]);var p=l===0;return(p||l>r.maxNodeSize*o)&&At(!1,p?"too few":"too many","children (",l,u,") at depth",n,"maxNodeSize:",r.maxNodeSize,"children.length:",o,"baseIndex:",i),u},t.prototype.set=function(n,r,i,s){var o=this.children,u=s._maxNodeSize,a=s._compare,c=Math.min(this.indexOf(n,0,a),o.length-1),l=o[c];if(l.isShared&&(o[c]=l=l.clone()),l.keys.length>=u){var f;c>0&&(f=o[c-1]).keys.length<u&&a(l.keys[0],n)<0?(f.isShared&&(o[c-1]=f=f.clone()),f.takeFromRight(l),this.keys[c-1]=f.maxKey()):(f=o[c+1])!==void 0&&f.keys.length<u&&a(l.maxKey(),n)<0&&(f.isShared&&(o[c+1]=f=f.clone()),f.takeFromLeft(l),this.keys[c]=o[c].maxKey())}var p=l.set(n,r,i,s);if(p===!1)return!1;if(this.keys[c]=l.maxKey(),p===!0)return!0;if(this.keys.length<u)return this.insert(c+1,p),!0;var d=this.splitOffRightSide(),m=this;return a(p.maxKey(),this.maxKey())>0&&(m=d,c-=this.keys.length),m.insert(c+1,p),d},t.prototype.insert=function(n,r){this.children.splice(n,0,r),this.keys.splice(n,0,r.maxKey())},t.prototype.splitOffRightSide=function(){var n=this.children.length>>1;return new t(this.children.splice(n),this.keys.splice(n))},t.prototype.takeFromRight=function(n){this.keys.push(n.keys.shift()),this.children.push(n.children.shift())},t.prototype.takeFromLeft=function(n){this.keys.unshift(n.keys.pop()),this.children.unshift(n.children.pop())},t.prototype.forRange=function(n,r,i,s,o,u,a){var c=o._compare,l=this.keys,f=this.children,p=this.indexOf(n,0,c),d=p,m=Math.min(r===n?p:this.indexOf(r,0,c),l.length-1);if(s){if(d<=m)try{for(;d<=m;d++){f[d].isShared&&(f[d]=f[d].clone());var y=f[d].forRange(n,r,i,s,o,u,a);if(l[d]=f[d].maxKey(),typeof y!="number")return y;u=y}}finally{var b=o._maxNodeSize>>1;for(p>0&&p--,d=m;d>=p;d--)f[d].keys.length<=b&&(f[d].keys.length!==0?this.tryMerge(d,o._maxNodeSize):(l.splice(d,1),f.splice(d,1)));f.length!==0&&f[0].keys.length===0&&At(!1,"emptiness bug")}}else for(;d<=m;d++){var y=f[d].forRange(n,r,i,s,o,u,a);if(typeof y!="number")return y;u=y}return u},t.prototype.tryMerge=function(n,r){var i=this.children;return n>=0&&n+1<i.length&&i[n].keys.length+i[n+1].keys.length<=r?(i[n].isShared&&(i[n]=i[n].clone()),i[n].mergeSibling(i[n+1],r),i.splice(n+1,1),this.keys.splice(n+1,1),this.keys[n]=i[n].maxKey(),!0):!1},t.prototype.mergeSibling=function(n,r){var i=this.keys.length;this.keys.push.apply(this.keys,n.keys);var s=n.children;if(this.children.push.apply(this.children,s),n.isShared&&!this.isShared)for(var o=0;o<s.length;o++)s[o].isShared=!0;this.tryMerge(i-1,r)},t}(V_),Fe=[],q_={delete:!0},Ty=function(){return q_},EB={break:!0},xf=function(){var e=new V_;return e.isShared=!0,e}(),Iy=[],lo=[];function At(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!e)throw t.unshift("B+ tree"),new Error(t.join(" "))}an.EmptyBTree=function(){var e=new jn;return e.freeze(),e}();var RB=M&&M.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ql,"__esModule",{value:!0});var oc=ql.MemoryBTreeStorage=void 0;const Sf=RB(an),Ay=Dr,Of=Mt,ky=Sf.default.default?Sf.default.default:Sf.default;class MB{constructor(){this.btree=new ky(void 0,Of.compareTuple)}scan(t){const n=(t==null?void 0:t.gte)??(t==null?void 0:t.gt)??Ay.MIN,r=(t==null?void 0:t.lte)??(t==null?void 0:t.lt)??Ay.MAX,i=[];return this.btree.forRange(n,r,(t==null?void 0:t.lte)!=null,(s,o,u)=>{if(!(t!=null&&t.gt&&(0,Of.compareTuple)(s,t.gt)===0)&&(i.push({key:s,value:o}),(t==null?void 0:t.reverse)!==!0&&i.length>=((t==null?void 0:t.limit)??1/0)))return{break:!0}}),t!=null&&t.reverse&&i.reverse(),t!=null&&t.limit?i.slice(0,t.limit):i}commit(t){const{set:n,remove:r}=t;for(const i of r||[])this.btree.delete(i);for(const{key:i,value:s}of n||[])this.btree.set(i,s,!0)}close(){}wipe(){this.btree=new ky(void 0,Of.compareTuple)}}oc=ql.MemoryBTreeStorage=MB;const J_=new Set(["_metadata"]);async function fa(e,t,n,r,i){if(!r)return;const[s,o]=Wt(n);if(J_.has(s))return;const u=e.db.sessionRoles,a=S_(r.collections,s);if(!a)return;let c=[],l=!1;if(u)for(const d of u){const m=a[d.key],y=m==null?void 0:m[i];y&&y.filter&&(l=!0,Array.isArray(y.filter)&&c.push(...y.filter))}if(!l){if(i==="postUpdate")return;c=[!1]}const f=un({collectionName:s,where:[["id","=",o],...c]},r.collections,{roles:e.db.sessionRoles},{skipRules:!0}),{results:p}=await Ah(e.db,t,f,Gt(),{schema:r.collections});if(!p)throw new JE(s,o,i,u??[])}async function $f(e,t,n,r){var c;const[i,s]=Wt(n);if(J_.has(i))return;const o=r==null?void 0:r.collections;if(!o)return;const u=r==null?void 0:r.collections[i];if(!u)return;const a=Object.values(((c=u==null?void 0:u.rules)==null?void 0:c.write)??{});if(a.length){const l=a.flatMap(d=>d.filter),f=un({collectionName:i,where:[["id","=",s],...l]},o,{roles:e.db.sessionRoles},{skipRules:!1}),{results:p}=await Ah(e.db,t,f,Gt(),{schema:o});if(!p)throw new Ab("Update does not match write rules")}}function NB(e){const t=Array.from(ro(e).entries()),n={inserts:[],updates:[],deletes:[]};for(const[r,i]of t){let s="update";"_collection"in i.data&&(i.data._collection[0]===void 0?s="delete":s="insert"),s==="insert"?n.inserts.push([r,i.data]):s==="update"?n.updates.push([r,i.data]):s==="delete"&&n.deletes.push([r,i.data])}return n}async function Py(e,t){const n=Array.from(ro(e).entries()),r={inserts:[],updates:[],deletes:[]};for(const[i,s]of n){let o="update";"_collection"in s.data&&(s.data._collection[0]===void 0?o="delete":o="insert");const u=Ss(await t.findByEntity(i),i);if(u)switch(o){case"insert":r.inserts.push([i,pt(u.data)]);break;case"update":r.updates.push([i,pt(u.data)]);break;case"delete":const[a,c]=Wt(i);r.deletes.push([i,{id:c,_collection:a,...pt(u.data)}]);break}}return r}class Ey{constructor(t,n,r,i={}){I(this,"db");I(this,"storeTx");I(this,"hooks");I(this,"options");I(this,"schema");I(this,"_schema");I(this,"_permissionCache",new Map);I(this,"logger");I(this,"PreWriteCheckPermissions",async(t,n)=>{const r=NB(t);for(const[i,s]of r.updates)await fa(this,n,i,this.schema,"update")});I(this,"PostCheckWritePermissions",async(t,n)=>{for(const[r,i]of Object.entries(t)){const s=new Set,o=new Set([...i.map(a=>a.id)]),u=new Set;for(const a of i)if(!(u.has(a.id)||s.has(a.id))){if(a.attribute[0]==="_collection"&&a.expired){o.delete(a.id),u.add(a.id);continue}if(a.attribute[0]==="_collection"&&!a.expired){s.add(a.id),o.delete(a.id);continue}}for(const a of o)await $f(this,n,a,this.schema),await fa(this,n,a,this.schema,"postUpdate");for(const a of s)await $f(this,n,a,this.schema),await fa(this,n,a,this.schema,"insert");for(const a of u)await $f(this,this.db.tripleStore,a,this.schema),await fa(this,this.db.tripleStore,a,this.schema,"delete")}});I(this,"ValidateTripleSchema",async t=>{if(this.schema)for(const n of t)n.attribute[0]!=="_metadata"&&n.attribute[0]!=="_collection"&&(n.expired||ZL(this.schema.collections,n.attribute,n.value))});I(this,"UpdateLocalSchema",async(t,n)=>{const r=t.filter(({attribute:s})=>s[0]==="_metadata");if(r.length===0)return;if(!this._schema){const{schemaTriples:s}=await Dd(n);r.unshift(...s)}this._schema=this._schema??new Ml,bh(this._schema,r);const i=pt(this._schema.data);this.schema={version:(i==null?void 0:i.version)??0,collections:(i==null?void 0:i.collections)&&z_(i.collections)}});I(this,"CallBeforeCommitDBHooks",async(t,n)=>{var o;if(!(this.hooks.beforeCommit.length>0||this.hooks.beforeInsert.length>0||this.hooks.beforeUpdate.length>0||this.hooks.beforeDelete.length>0)||!((o=t[bo])!=null&&o.length))return;const i=t[bo],s=await Py(i,this.storeTx);if(s.inserts.length)for(const[u,a]of this.hooks.beforeInsert){const c=s.inserts.filter(([l])=>Wt(l)[0]===a.collectionName);for(const[l,f]of c)await u({entity:f,tx:this,db:this.db})}if(s.updates.length)for(const[u,a]of this.hooks.beforeUpdate){const c=s.updates.filter(([l])=>Wt(l)[0]===a.collectionName);for(const[l,f]of c)await u({entity:f,tx:this,db:this.db})}if(s.deletes.length)for(const[u,a]of this.hooks.beforeDelete){const c=s.deletes.filter(([l])=>Wt(l)[0]===a.collectionName);for(const[l,f]of c)await u({entity:f,tx:this,db:this.db})}for(const[u,a]of this.hooks.beforeCommit){const c=s.inserts,l=s.updates,f=s.deletes;!c.length&&!l.length&&!f.length||await u({opSet:{inserts:c,updates:l,deletes:f},tx:this,db:this.db})}});I(this,"CallAfterCommitDBHooks",async(t,n)=>{var o;if(!(this.hooks.afterCommit.length>0||this.hooks.afterInsert.length>0||this.hooks.afterUpdate.length>0||this.hooks.afterDelete.length>0)||!((o=t[bo])!=null&&o.length))return;const i=t[bo],s=await Py(i,this.db.tripleStore);if(s.inserts.length)for(const[u,a]of this.hooks.afterInsert){const c=s.inserts.filter(([l])=>Wt(l)[0]===a.collectionName);for(const[l,f]of c)await u({entity:f,tx:this,db:this.db})}if(s.updates.length)for(const[u,a]of this.hooks.afterUpdate){const c=s.updates.filter(([l])=>Wt(l)[0]===a.collectionName);for(const[l,f]of c)await u({entity:f,tx:this,db:this.db})}if(s.deletes.length)for(const[u,a]of this.hooks.afterDelete){const c=s.deletes.filter(([l])=>Wt(l)[0]===a.collectionName);for(const[l,f]of c)await u({entity:f,tx:this,db:this.db})}for(const[u,a]of this.hooks.afterCommit){const c=s.inserts,l=s.updates,f=s.deletes;!c.length&&!l.length&&!f.length||await u({opSet:{inserts:c,updates:l,deletes:f},tx:this,db:this.db})}});I(this,"METADATA_COLLECTION_NAME","_metadata");this.db=t,this.storeTx=n,this.hooks=r,this.options=i,this.logger=i.logger??t.logger,this.schema=i.schema,this.storeTx.beforeInsert(this.ValidateTripleSchema),i!=null&&i.skipRules||(this.storeTx.beforeInsert(this.PreWriteCheckPermissions),this.storeTx.beforeCommit(this.PostCheckWritePermissions)),this.storeTx.beforeInsert(this.UpdateLocalSchema),this.storeTx.beforeCommit(this.CallBeforeCommitDBHooks),this.storeTx.afterCommit(this.CallAfterCommitDBHooks)}async getSchema(){return this.schema}async commit(){await this.storeTx.commit()}async cancel(){await this.storeTx.cancel()}async insert(t,n){var y;if(!t)throw new Ba(t,"Collection name must be defined");if(!n)throw new zm("The document being inserted is undefined");if(typeof n!="object"||Array.isArray(n))throw new zm("The document being inserted must be an object.");this.logger.debug("insert START",t,n);const r=(y=await this.getSchema())==null?void 0:y.collections,i=r==null?void 0:r[t],o={...i?OB(i):{},...n},u=bB(o,i==null?void 0:i.schema);!i&&u.id===void 0&&(u.id=pu());const a=QL(u.id);if(a)throw a;const c=await this.storeTx.getTransactionTimestamp(),l=tl(u),f=st(t,u.id),p=l.map(([b,g])=>({id:f,attribute:[t,...b],value:g,timestamp:c,expired:!1}));p.push({id:f,attribute:["_collection"],value:t,timestamp:c,expired:!1}),await this.storeTx.insertTriples(p);const d=Ss(p,f);if(!d)throw new Error("Malformed id");const m=Rr(d.data,r,t);return this.logger.debug("insert END",t,m),m}async update(t,n,r){var s;this.logger.debug("update START",t,n);const i=(s=await this.getSchema())==null?void 0:s.collections;await this.updateRaw(t,n,async o=>{const u=new K_(o),a=t==="_metadata"?uc(u,o):uc(u,o,i,t);return await r(a),u.getTuples()}),this.logger.debug("update END",t,n)}async updateRaw(t,n,r){this.logger.debug("updateRaw START");const i=st(t,n),s=await this.storeTx.findByEntity(i),o=Ss(s,i),u=pt(o.data);if(t!=="_metadata"&&!(u!=null&&u._collection))throw new LE(n,t,"Cannot perform an update on an entity that doesn't exist");const a=await r(u);for(const[l,f]of a)if(l.at(0)==="id")throw new Ib(`Attempted to update the id of an entity in the ${t} from ${u.id} to ${f}. The 'id' attribute of an entity is immutable and cannot be updated.`);const c=[];for(let l of a){const[f,p]=l,d=[t,...f];(p===void 0||p==="{}")&&await this.storeTx.expireEntityAttributes([{id:i,attribute:d}]),p!==void 0&&c.push([i,d,p])}await this.storeTx.setValues(c),this.logger.debug("updateRaw END",c)}async delete(t,n){if(!t)throw new Ba(t,"Collection name must be defined");this.logger.debug("delete START",t,n);const r=st(t,n);await this.storeTx.expireEntity(r),this.logger.debug("delete END",t,n)}async fetch(t,n={}){var o;const r=(o=await this.getSchema())==null?void 0:o.collections,i=un(t,r,{roles:this.db.sessionRoles},{skipRules:n.skipRules}),{results:s}=await sr(this.db,this.storeTx,i,Gt(),{schema:r});return F_(s,r,i.collectionName)}query(t,n){return $_(t,n)}async fetchById(t,n,r={}){const i=this.query(t).id(n).build();return this.fetchOne(i,r)}async fetchOne(t,n={}){t={...t,limit:1};const i=[...(await this.fetch(t,n)).values()][0];return i||null}async checkOrCreateSchema(){await this.fetchById(this.METADATA_COLLECTION_NAME,"_schema")||await this.insert(this.METADATA_COLLECTION_NAME,{id:"_schema"})}async createCollection(t){await this.checkOrCreateSchema();const{name:n,schema:r,rules:i,optional:s}=t;await this.update(this.METADATA_COLLECTION_NAME,"_schema",async o=>{o.collections||(o.collections={});const u=s?s.slice().sort():void 0,c={schema:sc({type:"record",properties:r,optional:u}).toJSON()};i&&(c.rules=i),o.collections[n]=c})}async dropCollection(t){const{name:n}=t;await this.update(this.METADATA_COLLECTION_NAME,"_schema",async r=>{r.collections||(r.collections={}),delete r.collections[n]})}async addAttribute(t){const{collection:n,path:r,attribute:i,optional:s}=t;po(r),await this.update(this.METADATA_COLLECTION_NAME,"_schema",async o=>{ho(o.collections,n);const u=r.slice(0,-1),a=r[r.length-1],c=fo(u,o.collections[n]);Ci(c,r),c.properties[a]=i,Tf(c,a,s??!1)})}async dropAttribute(t){const{collection:n,path:r}=t;po(r),await this.update(this.METADATA_COLLECTION_NAME,"_schema",async i=>{ho(i.collections,n);const s=r.slice(0,-1),o=r[r.length-1],u=fo(s,i.collections[n]);Ci(u,r),delete u.properties[o],Tf(u,o,!1)})}async alterAttributeOption(t){const{collection:n,path:r,options:i}=t;po(r),await this.update(this.METADATA_COLLECTION_NAME,"_schema",async s=>{ho(s.collections,n);const o=r.slice(0,-1),u=r[r.length-1],a=fo(o,s.collections[n]);Ci(a,r);const c=a.properties[u];if(!c)throw new qt(r,"Could not traverse this path");for(const[l,f]of Object.entries(i))c.options||(c.options={}),c.options[l]=f})}async dropAttributeOption(t){const{collection:n,path:r,option:i}=t;po(r),await this.update(this.METADATA_COLLECTION_NAME,"_schema",async s=>{ho(s.collections,n);const o=r.slice(0,-1),u=r[r.length-1],a=fo(o,s.collections[n]);Ci(a,r);const c=a.properties[u];if(!c)throw new qt(r,"Could not traverse this path");c.options&&delete c.options[i]})}async addRule(t){const{collection:n,scope:r,id:i,rule:s}=t;await this.update(this.METADATA_COLLECTION_NAME,"_schema",async o=>{const u=o.collections[n];u.rules||(u.rules={}),u.rules[r]||(u.rules[r]={}),u.rules[r][i]=s})}async dropRule(t){const{collection:n,scope:r,id:i}=t;await this.update(this.METADATA_COLLECTION_NAME,"_schema",async s=>{const o=s.collections[n];delete o.rules[r][i]})}async setAttributeOptional(t){const{collection:n,path:r,optional:i}=t;po(r),await this.update(this.METADATA_COLLECTION_NAME,"_schema",async s=>{ho(s.collections,n);const o=r.slice(0,-1),u=r[r.length-1],a=fo(o,s.collections[n]);if(Ci(a,r),!a.properties[u])throw new qt(r,"Could not traverse this path");Tf(a,u,i)})}}function Tf(e,t,n){if(!e.optional&&n&&(e.optional=[t]),e.optional)if(!e.optional.includes(t)&&n){const r=[];for(let i=0;i<e.optional.length;i++)r.push(e.optional[i]);e.optional=[...r,t].sort()}else e.optional.includes(t)&&!n&&(e.optional=e.optional.filter(r=>r!==t).sort())}function fo(e,t){return e.reduce((n,r)=>(Ci(n,e),n.properties[r]),t.schema)}function Ci(e,t){if(!e)throw new qt(t,"Could not traverse this path");if(!e.properties)throw new qt(t,"This path terminated at a non-record type.")}function po(e){if(e.length===0)throw new qt(e,"The provided path is empty. Paths must be at least one level deep.")}function ho(e,t){const n=e[t];if(!(n!=null&&n.schema))throw new To(t,e)}class K_{constructor(t){I(this,"tuplesTracker",{});I(this,"changes",{});this.changes=t}set(t,n){x3(this.changes,t,n);const r=tl(n,t.slice(1).split("/"));for(const i of r){const[s,o]=i;this.tuplesTracker[s.join("/")]=o}}delete(t){f_(this.changes,t)}get(t){return Oh(this.changes,t)}has(t){return S3(this.changes,t)}getChanges(){return this.changes}getTuples(){return Object.entries(this.tuplesTracker).map(([t,n])=>[t.split("/"),n])}}function uc(e,t,n,r,i=""){var a;function s(c){const l=[i,c].join("/");return e.set(l,void 0),f_(t,c),!0}const o=(a=n==null?void 0:n[r])==null?void 0:a.schema,u=Rr(t,n,r);return new Proxy(u,{set:(c,l,f)=>{if(typeof l=="symbol")return!0;const p=[i,l].join("/");if(!o)return f===void 0?s(l):(e.set(p,f),!0);const d=p.slice(1).split("/"),m=Gi(o,d);if(!m)throw new KE(p,f);if(m.context.optional&&f===void 0)return s(l);const y=m.convertInputToDBValue(f);return e.set(p,y),!0},deleteProperty:(c,l)=>{if(typeof l=="symbol")return!0;if(o){const p=[i,l].join("/").slice(1).split("/");if(!Gi(o,p).context.optional)throw new Ib(`Cannot delete property ${l} because it is not optional. Please mark this property optional in your schema. If the property is nullable you may also set it to null.`)}return s(l)},get:(c,l)=>{if(typeof l=="symbol")return;const f=[i,l].join("/"),p=e.get(f);if(p===void 0)return;if(p===null)return null;const d=o&&Gi(o,f.slice(1).split("/"));return d&&d.type==="set"?wB(e,f,d):typeof p=="object"&&p!==null?uc(e,p,n,r,f):d?d.convertDBValueToJS(p):p}})}function Xi(e,t=[]){const n=e.key.slice(0+((t==null?void 0:t.length)??0)),r=n[0];let i,s,o,u;switch(r){case"EAT":[,i,s,u]=n,o=e.value[0];break;case"AVE":[,s,o,i,u]=n;break;case"clientTimestamp":[,,u,i,s,o]=n;break;default:throw new DE(r)}return{id:i,attribute:s,value:o,timestamp:u,expired:r==="EAT"?e.value[1]:r==="AVE"?!1:e.value.expired}}async function Yu(e,...t){return(await e.scan(...t)).map(Xi)}async function Q_(e,t,n){return Yu(e,{prefix:["EAT"],gte:[t],lt:[t+q.MAX],reverse:n==="DESC"})}async function Jl(e,[t,n]=[],r){const i={prefix:["EAT"],gte:[t??q.MIN,n??q.MIN],lt:[t??q.MAX,[...n??[],q.MAX],q.MAX],reverse:r==="DESC"};return Yu(e,i)}function Mh(e,[t,n,r]=[],i){return Yu(e,{prefix:["AVE"],gte:[t??q.MIN,n??q.MIN,r??q.MIN],lt:[[...t??[],...n?[]:[q.MAX]],n??q.MAX,q.MAX],reverse:i==="DESC"})}function H_(e,t,n={}){const r=["AVE",t],i=5,s=n.greaterThanCursor?n.greaterThanCursor:n.greaterThan?[n.greaterThan,q.MAX]:void 0,o=n.greaterThanOrEqualCursor?n.greaterThanOrEqualCursor:n.greaterThanOrEqual?[n.greaterThanOrEqual,q.MIN]:void 0,u=n.lessThanCursor?n.lessThanCursor:n.lessThan?[n.lessThan,q.MIN]:void 0,a=n.lessThanOrEqualCursor?n.lessThanOrEqualCursor:n.lessThanOrEqual?[n.lessThanOrEqual,q.MAX]:void 0,c={prefix:r,gt:s&&[...s,...new Array(i-r.length-s.length).fill(q.MAX)],gte:o&&[...o,...new Array(i-r.length-o.length).fill(q.MIN)],lt:u&&[...u,...new Array(i-r.length-u.length).fill(q.MIN)],lte:a&&[...a,...new Array(i-r.length-a.length).fill(q.MAX)],reverse:n.direction==="DESC"};return Yu(e,c)}async function G_(e,t){return Jl(e,[t])}async function X_(e,t,n){return Jl(e,[t,n])}async function Y_(e,t){return Mh(e,[t])}function Z_(e){const[t,n,...r]=e.key;return[n,r,e.value]}async function e1(e,t,n,r){if(!r&&!n.startsWith("gt"))return[];let i;switch(n){case"lt":i={lt:[r]};break;case"lte":i={lte:[[...r,q.MAX]]};break;case"gt":i={gt:[[...r??[],q.MIN]]};break;case"gte":i={gte:[[...r??[]]]};break;case"eq":i={gte:[r],lt:[[...r,q.MAX]]};break;default:throw new CE(`Cannot perform a scan with direction ${n}.`)}return await Yu(e,{prefix:["clientTimestamp",t],...i})}async function t1(e,t){var r;return(r=(await e.scan({prefix:["clientTimestamp",t],reverse:!0,limit:1}))[0])==null?void 0:r.key[2]}async function n1(e){const t=new Set;let n=q.MIN;for(;;){const r=await e.scan({prefix:["clientTimestamp"],gt:[n,q.MAX,q.MAX,q.MAX,q.MAX],limit:1});if(r.length===0)break;const i=r[0],s=i.key[1];if(!s)throw new Error("Empty client ID found in clientTimestamp index");if(t.has(s))throw new Error("Duplicate client ID found in clientTimestamp index");t.add(i.key[1]),n=s}return Array.from(t)}class ac{constructor({storage:t,storageScope:n,hooks:r,reactivity:i}){I(this,"storageScope");I(this,"storage");I(this,"hooks");I(this,"reactivity");this.storage=t,this.storageScope=n,this.hooks=r??{beforeCommit:[],beforeInsert:[],beforeScan:[],afterCommit:[]},this.reactivity=i??new r1}getStorageClients(t){return t&&this.storageScope&&this.storageScope[t]?this.storageScope[t].map(n=>this.storage[n]):Object.values(this.storage)}getStorageClientsEntries(t){return t&&this.storageScope&&this.storageScope[t]?this.storageScope[t].map(n=>[n,this.storage[n]]):Object.entries(this.storage)}beforeInsert(t){this.hooks.beforeInsert.push(t)}beforeCommit(t){this.hooks.beforeCommit.push(t)}afterCommit(t){this.hooks.afterCommit.push(t)}beforeScan(t){this.hooks.beforeScan.push(t)}async scan(t,n){const r=this.getStorageClients("read"),i=(s,o)=>_l(s.key,o.key)*(t!=null&&t.reverse?-1:1);return Nh(await Promise.all(r.map(s=>s.scan(t,n))),i)}subscribe(t,n){const r=this.getStorageClientsEntries("read").map(([i,s])=>s.subscribe(t,(o,u)=>{const a=this.reactivity.getReactivityId(i,u);if(!a){console.warn("Not tracking reactivity for",i,u);return}this.reactivity.updateCallback(a,n,o,i,u)}));return()=>{Promise.all(r).then(i=>i.forEach(s=>s()))}}async exists(t,n){return(await Promise.all(this.getStorageClients("read").map(r=>r.exists(t,n)))).some(r=>r)}subspace(t){const n=Object.fromEntries(Object.entries(this.storage).map(([r,i])=>[r,i.subspace(t)]));return new ac({storage:n,storageScope:this.storageScope,hooks:{beforeCommit:[...this.hooks.beforeCommit],beforeInsert:[...this.hooks.beforeInsert],beforeScan:[...this.hooks.beforeScan],afterCommit:[...this.hooks.afterCommit]},reactivity:this.reactivity})}transact(t){return new FB({scope:t??this.storageScope,store:this,hooks:{beforeCommit:[...this.hooks.beforeCommit],beforeInsert:[...this.hooks.beforeInsert],beforeScan:[...this.hooks.beforeScan],afterCommit:[...this.hooks.afterCommit]}})}async autoTransact(t,n){try{return await q.transactionalReadWriteAsync(5,{exponentialBackoff:!0,jitter:!0})(t)(n?new ac({storage:this.storage,storageScope:n,hooks:{beforeCommit:[...this.hooks.beforeCommit],beforeInsert:[...this.hooks.beforeInsert],beforeScan:[...this.hooks.beforeScan],afterCommit:[...this.hooks.afterCommit]},reactivity:this.reactivity}):this)}catch(r){throw r}}async clear(){await this.autoTransact(async t=>{(await t.scan()).forEach(r=>t.remove(r.key))},this.storageScope)}close(){throw new kb("MultiTupleStore.close() method")}}class Ry{constructor({txScope:t,hooks:n}){I(this,"txScope");I(this,"hooks");this.txScope=t,this.hooks=n}async scan(t){const n=(r,i)=>_l(r.key,i.key)*(t!=null&&t.reverse?-1:1);return Nh(await Promise.all(this.txScope.read.map(r=>r.scan(t))),n)}async exists(t){return(await Promise.all(this.txScope.read.map(n=>n.exists(t)))).some(n=>n)}remove(t){this.txScope.write.forEach(n=>n.remove(t))}async set(t,n){for(const r of this.hooks.beforeInsert)await r({key:t,value:n},this);this.txScope.write.forEach(r=>r.set(t,n))}}function Nh(e,t){const n=e.map(()=>0),r=e.reduce((o,u)=>o+u.length,0),i=new Array(r);let s=0;for(;s<r;){let o=null;for(let u=0;u<e.length;u++){const a=e[u][n[u]];if(a){if(o==null){o=u;continue}t(a,e[o][n[o]])<0&&(o=u)}}if(o==null)throw new jE("While merging scan results, could not select a result set to take from. This should never happen.");i[s++]=e[o][n[o]++]}return i}class FB extends Ry{constructor({store:n,scope:r,hooks:i}){const s=Object.entries(n.storage).map(([c,l])=>[c,l.transact()]),o=Object.fromEntries(s),u=(r==null?void 0:r.read)??Object.keys(n.storage),a=(r==null?void 0:r.write)??Object.keys(n.storage);super({txScope:{read:u.map(c=>o[c]),write:a.map(c=>o[c])},hooks:i});I(this,"txs");I(this,"store");I(this,"isCanceled",!1);I(this,"hooks");I(this,"id",Math.random().toString(36).slice(2));for(const[c,l]of s)n.reactivity.trackSubTx(c,l.id,this.id);this.txs=o,this.store=n,this.hooks=i}get writes(){return Object.fromEntries(Object.entries(this.txs).map(([n,r])=>[n,r.writes]))}beforeScan(n){this.hooks.beforeScan.push(n)}async scan(n){for(const i of this.hooks.beforeScan)await i(n,this);const r=(i,s)=>_l(i.key,s.key)*(n!=null&&n.reverse?-1:1);return Nh(await Promise.all(this.txScope.read.map(i=>i.scan(n))),r)}withScope(n){const r=n.read??Object.keys(this.store.storage),i=n.write??Object.keys(this.store.storage);return new Ry({txScope:{read:r.map(s=>this.txs[s]),write:i.map(s=>this.txs[s])},hooks:this.hooks})}async commit(){if(this.isCanceled){console.warn("Cannot commit already canceled transaction.");return}for(const n of this.hooks.beforeCommit)await n(this);await Promise.all(Object.values(this.txs).map(n=>n.commit()));for(const n of this.hooks.afterCommit)await n(this);this.store.reactivity.emit(this.id)}async cancel(){if(this.isCanceled){console.warn("Attempted to cancel already canceled transaction.");return}await Promise.all(Object.values(this.txs).map(n=>n.cancel())),this.isCanceled=!0}}class r1{constructor(){I(this,"txCallbacks",{});I(this,"subTxReactivityIds",{});I(this,"taskQueue",new jB)}trackSubTx(t,n,r){this.subTxReactivityIds[`${t}_${n}`]=r}getReactivityId(t,n){return this.subTxReactivityIds[`${t}_${n}`]}updateCallback(t,n,r,i,s){this.txCallbacks[t]||(this.txCallbacks[t]={callbacks:new Set,args:{},subTxs:[]}),this.txCallbacks[t].callbacks.add(n),this.txCallbacks[t].args[i]=r,this.txCallbacks[t].subTxs.push(s)}emit(t){const n=this.txCallbacks[t];if(n){this.taskQueue.schedule(Array.from(n.callbacks),n.args);for(const r of n.subTxs)delete this.subTxReactivityIds[r];delete this.txCallbacks[t]}}}class jB{constructor(){I(this,"queue",[]);I(this,"isRunning",!1)}async schedule(t,n){if(this.isRunning){setTimeout(()=>{this.queue.push(...t.map(r=>[r,n])),this.run()});return}this.queue.push(...t.map(r=>[r,n])),this.run()}async run(){if(!this.isRunning){for(this.isRunning=!0;this.queue.length;){const t=this.queue.shift();if(!t)break;const[n,r]=t;await n(r)}this.isRunning=!1}}}class CB{constructor({clientId:t,tick:n}={}){I(this,"clientId");I(this,"tick");this.clientId=t??pu(),this.tick=n??0}async assignToStore(t){const n=await t.findMaxClientTimestamp(this.clientId);n&&this.setTick(n[0]),t.onInsert(r=>{Object.values(r).flat().forEach(({timestamp:s})=>{this.tick<s[0]&&this.setTick(s[0])})})}getCurrentTimestamp(){return new Promise(t=>t([this.tick,this.clientId]))}getNextTimestamp(){const t=[++this.tick,this.clientId];return new Promise(n=>n(t))}setTick(t){return this.tick=t,new Promise(n=>n())}}function da(e){return Object.fromEntries(Object.entries(e.txs).map(([t,n])=>[t,n.writes.set.filter(r=>r.key[1]==="EAT").map(r=>Xi(r,["client"]))]))}class Fh{constructor({tupleTx:t,clock:n,hooks:r}){I(this,"tupleTx");I(this,"txMetadataListeners",new Set);I(this,"assignedTimestamp");I(this,"clock");I(this,"hooks");this.tupleTx=t,this.clock=n,this.hooks=r,this.hooks.beforeCommit.forEach(i=>{this.tupleTx.hooks.beforeCommit.push(s=>{const o=da(s);return i(o,this)})}),this.hooks.afterCommit.forEach(i=>{this.tupleTx.hooks.afterCommit.push(s=>{const o=da(s);return i(o,this)})})}async getTransactionTimestamp(){return this.assignedTimestamp||(this.assignedTimestamp=await this.clock.getNextTimestamp()),this.assignedTimestamp}async findByCollection(t,n){return Q_(this.tupleTx,t,n)}async findValuesInRange(t,n){return H_(this.tupleTx,t,n)}async findByEAT(t,n){return Jl(this.tupleTx,t,n)}findByAVE(t,n){return Mh(this.tupleTx,t,n)}async findByEntity(t){return G_(this.tupleTx,t)}async findByEntityAttribute(t,n){return X_(this.tupleTx,t,n)}async findByAttribute(t){return Y_(this.tupleTx,t)}findMaxClientTimestamp(t){return t1(this.tupleTx,t)}findByClientTimestamp(t,n,r){return e1(this.tupleTx,t,n,r)}findAllClientIds(){return n1(this.tupleTx)}async insertTriple(t){await this.insertTriples([t])}async insertTriples(t){if(t.length){for(const n of this.hooks.beforeInsert)await n(t,this);for(const n of t){if(n.value===void 0)throw new qm(void 0);await this.addTripleToIndex(this.tupleTx,n)}}}async addTripleToIndex(t,n){const{id:r,attribute:i,value:s,timestamp:o,expired:u}=n;t.set(["EAT",r,i,o],[s,u])}async deleteTriple(t){await this.deleteTriples([t])}async deleteTriples(t){const n=this.tupleTx;for(const r of t){const{id:i,attribute:s,value:o,timestamp:u}=r;n.remove(["EAT",i,s,u]),n.remove(["AVE",s,o,i,u]),n.remove(["clientTimestamp",u[1],u,i,s,o])}}async readMetadataTuples(t,n){return(await this.tupleTx.scan({prefix:["metadata",t,...n??[]]})).map(Z_)}async updateMetadataTuples(t){for(const[n,r,i]of t)this.tupleTx.set(["metadata",n,...r],i);await Promise.all([...this.txMetadataListeners].map(n=>n({updates:t,deletes:[]})))}async deleteMetadataTuples(t){for(const[n,r]of t)(await this.tupleTx.scan({prefix:["metadata",n,...r??[]]})).forEach(i=>this.tupleTx.remove(i.key));await Promise.all([...this.txMetadataListeners].map(n=>n({updates:[],deletes:t})))}onMetadataChange(t){return this.txMetadataListeners.add(t),()=>{this.txMetadataListeners.delete(t)}}async setValue(t,n,r){return await this.setValues([[t,n,r]])}async setValues(t){if(!t.length)return;const n=await this.getTransactionTimestamp(),r=[];for(const i of t){const[s,o,u]=i;if(u===void 0)throw new qm(void 0);(await this.findByEntityAttribute(s,o)).filter(({timestamp:l})=>Pn(l,n)===1).length===0&&r.push({id:s,attribute:o,value:u,timestamp:n,expired:!1})}await this.insertTriples(r)}async expireEntity(t){var i;const n=await this.findByEntity(t),r=new Map;for(const s of n){const o=JSON.stringify(s.attribute),u=(i=r.get(o))==null?void 0:i.timestamp;(!u||Pn(s.timestamp,u)>0)&&r.set(o,s)}await this.expireEntityAttributes([...r.values()].map(({attribute:s,id:o})=>({id:o,attribute:s})))}async expireEntityAttribute(t,n){return this.expireEntityAttributes([{id:t,attribute:n}])}async expireEntityAttributes(t){const n=[];for(const{id:i,attribute:s}of t){const o=await this.findByEntityAttribute(i,s);for(const u of o)n.push(u)}const r=await this.getTransactionTimestamp();await this.deleteTriples(n.filter(i=>Pn(i.timestamp,r)===0)),await this.insertTriples(n.map(({id:i,attribute:s})=>({id:i,attribute:s,value:null,timestamp:r,expired:!0})))}async commit(){await this.tupleTx.commit()}async cancel(){await this.tupleTx.cancel()}withScope(t){return new Fh({tupleTx:this.tupleTx.withScope(t),clock:this.clock,hooks:Ua(this.hooks)})}beforeInsert(t){this.hooks.beforeInsert.push(t)}beforeCommit(t){this.tupleTx.hooks.beforeCommit.push(n=>t(da(n),this))}afterCommit(t){this.tupleTx.hooks.afterCommit.push(n=>t(da(n),this))}}const DB=[async function(t){const n=await t.scan({prefix:["EAV"]});if(n.length===0)return;const r=[];for(const i of n){const[s,o,u,a,c]=i.key,{expired:l}=i.value;r.push({key:["EAT",o,u,c],value:[a,l]})}await t.autoTransact(async i=>{for(const s of n)i.remove(s.key);for(const s of r)await i.set(s.key,s.value)},void 0)}];function LB(e){return typeof e!="object"?!1:["close","commit","scan"].every(n=>n in e)}async function My(e){for(const[t,n]of Object.entries(e.writes)){const{set:r=[]}=n;if(r.length===0)continue;const i=e.withScope({read:[t],write:[t]});let s=[];for(const{key:o,value:u}of r.slice()){const[a,c,...l]=o;if(c!=="EAT")continue;const[f,p,d]=l,[m,y]=u;y?s.push(["AVE",p,m,f,d]):i.set(["AVE",p,m,f,d],{expired:y}),i.set(["clientTimestamp",d[1],d,f,p,m],{expired:y})}for(const o of s)i.remove(o)}}class jh{constructor({storage:t,stores:n,tenantId:r,clock:i,reactivity:s,storageScope:o=[],enableGarbageCollection:u=!1}){I(this,"stores");I(this,"storageScope");I(this,"tupleStore");I(this,"clock");I(this,"tenantId");I(this,"hooks");I(this,"reactivity");if(this.hooks={beforeCommit:[],beforeInsert:[],afterCommit:[]},!n&&!t)throw new Jm("Must provide either storage or stores");if(n&&t)throw new Jm("Cannot provide both storage and stores");this.storageScope=o;let a;if(n)a=n;else{const c=t;a=LB(c)?{primary:new q.AsyncTupleDatabaseClient(new q.AsyncTupleDatabase(c))}:Object.fromEntries(Object.entries(c).map(([l,f])=>[l,new q.AsyncTupleDatabaseClient(new q.AsyncTupleDatabase(f))]))}this.stores=a,this.tenantId=r??"client",this.reactivity=s??new r1,this.tupleStore=new ac({storage:a,reactivity:this.reactivity}).subspace([this.tenantId]),this.clock=i??new CB,this.clock.assignToStore(this),this.tupleStore.beforeCommit(My),u&&this.afterCommit(BB(()=>{this.collectGarbage()},1e3))}async ensureStorageIsMigrated(){for(const t of DB)await t(this.tupleStore)}beforeInsert(t){this.hooks.beforeInsert.push(t)}beforeCommit(t){this.hooks.beforeCommit.push(t)}afterCommit(t){this.hooks.afterCommit.push(t)}findByCollection(t,n){return Q_(this.tupleStore,t,n)}findByEAT([t,n],r){return Jl(this.tupleStore,[t,n],r)}findByAVE([t,n,r],i){return Mh(this.tupleStore,[t,n,r],i)}findByEntity(t){return G_(this.tupleStore,t)}findByEntityAttribute(t,n){return X_(this.tupleStore,t,n)}findByAttribute(t){return Y_(this.tupleStore,t)}async findValuesInRange(t,n){return H_(this.tupleStore,t,n)}findMaxClientTimestamp(t){return t1(this.tupleStore,t)}findAllClientIds(){return n1(this.tupleStore)}findByClientTimestamp(t,n,r){return e1(this.tupleStore,t,n,r)}async transact(t,n){let r=!1;const{tx:i,output:s}=await this.tupleStore.autoTransact(async o=>{o.beforeScan(async(c,l)=>{c.prefix[0]!=="EAT"&&await My(l)});const u=new Fh({tupleTx:o,clock:this.clock,hooks:Ua(this.hooks)});let a;if(r)return{tx:u,output:a};try{a=await t(u)}catch(c){throw c instanceof Ab&&(r=!0,await u.cancel()),c}return{tx:u,output:a}},n);return{txId:i.assignedTimestamp?JSON.stringify(i.assignedTimestamp):void 0,output:s}}setStorageScope(t){return new jh({stores:Object.fromEntries(Object.entries(this.stores).filter(([n])=>t.includes(n))),storageScope:t,tenantId:this.tenantId,clock:this.clock,reactivity:this.reactivity})}async setValue(t,n,r){await this.transact(async i=>{await i.setValue(t,n,r)})}async setValues(t){await this.transact(async n=>{await n.setValues(t)})}async expireEntity(t){await this.transact(async n=>{await n.expireEntity(t)})}async expireEntityAttribute(t,n){await this.transact(async r=>{await r.expireEntityAttribute(t,n)})}async expireEntityAttributes(t){await this.transact(async n=>{await n.expireEntityAttributes(t)})}async insertTriple(t){await this.transact(async n=>{await n.insertTriple(t)})}async insertTriples(t){await this.transact(async n=>{await n.insertTriples(t)})}onInsert(t){async function n(i){const s=Object.fromEntries(Object.entries(i).filter(([o,u])=>{const{set:a=[]}=u;return a.length>0}).map(([o,u])=>{const{set:a=[]}=u,c=a.map(l=>Xi(l));return[o,c]}));await t(s)}const r=this.tupleStore.subscribe({prefix:["EAT"]},n);return()=>{r()}}onWrite(t){async function n(i){const s=Object.fromEntries(Object.entries(i).filter(([o,u])=>{const{set:a=[],remove:c=[]}=u;return a.length>0||c.length>0}).map(([o,u])=>{const{set:a=[],remove:c=[]}=u,l=a.map(p=>Xi(p)),f=c.map(p=>Xi({key:p,value:{expired:!1}}));return[o,{inserts:l,deletes:f}]}));await t(s)}return this.tupleStore.subscribe({prefix:["EAT"]},n)}async deleteTriple(t){await this.transact(async n=>{await n.deleteTriples([t])})}async deleteTriples(t){await this.transact(async n=>{await n.deleteTriples(t)})}async readMetadataTuples(t,n){return(await this.tupleStore.scan({prefix:["metadata",t,...n??[]]})).map(Z_)}async updateMetadataTuples(t){await this.transact(async n=>{await n.updateMetadataTuples(t)})}async deleteMetadataTuples(t){await this.transact(async n=>{await n.deleteMetadataTuples(t)})}async clear(){await this.tupleStore.clear()}async collectGarbage(){const t=await this.findByEAT([]),n=[];let r=null,i=[];for(let s=t.length-1;s>=0;s--){const o=t[s];if(o.id===r&&q.compareTuple(o.attribute,i)===0){n.push(o);continue}r=o.id,i=o.attribute}await this.deleteTriples(n)}}function BB(e,t){let n=!1,r=!1;function i(){r?(e(),r=!1,setTimeout(i,t)):n=!1}return function(){n?r=!0:(e(),n=!0,setTimeout(i,t))}}const If=!0,bo="default";class i1{constructor({schema:t,source:n,sources:r,tenantId:i,migrations:s,clock:o,variables:u,logger:a}={}){I(this,"tripleStore");I(this,"systemVars");I(this,"cache");I(this,"storageReady");I(this,"schemaInitialized");I(this,"isSchemaInitialized",!1);I(this,"ready");I(this,"_schema");I(this,"schema");I(this,"onSchemaChangeCallbacks");I(this,"hooks",{afterCommit:[],afterInsert:[],afterUpdate:[],afterDelete:[],beforeCommit:[],beforeInsert:[],beforeUpdate:[],beforeDelete:[]});I(this,"_pendingSchemaRequest");I(this,"logger");this.logger=a??{info:console.info,warn:console.warn,error:console.error,debug:()=>{},scope:()=>this.logger},this.systemVars={global:u??{},session:{}};const c=r??{[bo]:n??new oc};if(Object.keys(c).length===0)throw new Km("No triple stores provided.");if(t&&s)throw new Km("Cannot provide both schema and migrations");const l=t?{...t,version:t.version??0,collections:t.collections}:void 0;this._pendingSchemaRequest=null,this.tripleStore=new jh({storage:c,tenantId:i,clock:o}),this.cache=new g_(this);const f=p=>this.schema=p;this.onSchemaChangeCallbacks=new Set([f]),this.logger.debug("Initializing",{schema:t,migrations:s,tripleStoreSchema:l}),this.storageReady=this.tripleStore.ensureStorageIsMigrated(),this.schemaInitialized=l?this.storageReady.then(()=>{this.setupSchemaListener()}).then(()=>this.initializeDBWithSchema(l)):s?this.storageReady.then(()=>this.initializeDBWithMigrations(s)).then(()=>{this.setupSchemaListener()}):this.storageReady.then(()=>{this.setupSchemaListener()}),this.schemaInitialized.then(()=>this.isSchemaInitialized=!0).catch(()=>{}),this.ready=Promise.all([this.storageReady,this.schemaInitialized]).then(()=>this.logger.debug("Ready"))}get sessionRoles(){const t=this.getSchemaSync(!0);return sL(t,this.systemVars.session)}getSchemaSync(t=!1){if(!t&&!this.isSchemaInitialized)throw new R("Schema not initialized");return this.schema}initializeDBWithMigrations(t){return t?Array.isArray(t)?this.migrate(t,"up"):this.migrate(t.definitions,"up",t.scopes):Promise.resolve()}initializeDBWithSchema(t){return t?this.overrideSchema(t).then(()=>{}):Promise.resolve()}setupSchemaListener(){return this.tripleStore.tupleStore.subscribe({prefix:["EAT",st("_metadata","_schema")]},async t=>{Object.values(t).some(i=>{var s;return!!((s=i.remove)!=null&&s.length)})&&(this.schema=void 0,this._schema=void 0);const n=Object.values(t).flatMap(i=>{var s;return((s=i.set)==null?void 0:s.map(o=>Xi(o)))??[]});if(!n.length)return;this._schema||await this.loadSchemaData(),bh(this._schema,n);const r=Bd(this._schema.data);for(const i of this.onSchemaChangeCallbacks)i(r)})}addTrigger(t,n){switch(t.when){case"afterCommit":this.hooks.afterCommit.push([n,t]);break;case"afterInsert":this.hooks.afterInsert.push([n,t]);break;case"afterUpdate":this.hooks.afterUpdate.push([n,t]);break;case"afterDelete":this.hooks.afterDelete.push([n,t]);break;case"beforeCommit":this.hooks.beforeCommit.push([n,t]);break;case"beforeInsert":this.hooks.beforeInsert.push([n,t]);break;case"beforeUpdate":this.hooks.beforeUpdate.push([n,t]);break;case"beforeDelete":this.hooks.beforeDelete.push([n,t]);break}}withSessionVars(t){return zB(this,t)}async getClientId(){return(await this.tripleStore.clock.getCurrentTimestamp())[1]}async loadSchemaData(){const t=await N_(this.tripleStore);this._schema=Ss(t,st("_metadata","_schema"))??new Ml,t.length&&(this.schema=Bd(this._schema.data))}async getSchema(t=!1){return await(t?this.storageReady:this.schemaInitialized),this._pendingSchemaRequest&&await this._pendingSchemaRequest,this._schema||(this._pendingSchemaRequest=this.loadSchemaData(),await this._pendingSchemaRequest,this._pendingSchemaRequest=null),this.schema}async transact(t,n={}){this.logger.debug("transact START",{options:n}),await this.storageReady;const r=await this.getSchema(n.dangerouslyBypassSchemaInitialization);try{const i=await this.tripleStore.transact(async s=>{const o=new Ey(this,s,Ua(this.hooks),{schema:r,skipRules:n.skipRules,logger:this.logger.scope("tx")});return await t(o)},n.storeScope);return this.logger.debug("transact RESULT",i),i}catch(i){throw this.logger.error("transact ERROR",i),i}finally{this.logger.debug("transact END")}}updateGlobalVariables(t){this.systemVars.global={...this.systemVars.global,...t}}async overrideSchema(t){const{successful:n,issues:r}=await XL(this,t);return YL(n,r,this.logger),{successful:n,issues:r}}async fetch(t,n={}){var u;this.logger.debug("fetch START",{query:t}),await this.storageReady;const r=(u=await this.getSchema())==null?void 0:u.collections,i=un(t,r,{roles:this.sessionRoles},{skipRules:n.skipRules}),s=n.noCache===void 0?If:n.noCache,{results:o}=await sr(this,n.scope?this.tripleStore.setStorageScope(n.scope):this.tripleStore,i,Gt(),{schema:r,cache:s?void 0:this.cache,skipRules:n.skipRules});return this.logger.debug("fetch END",{query:t,result:o}),F_(o,r,i.collectionName)}async fetchTriples(t,n={}){var s;await this.storageReady;const r=(s=await this.getSchema())==null?void 0:s.collections,i=un(t,r,{roles:this.sessionRoles},{skipRules:n.skipRules});return[...(await sr(this,n.scope?this.tripleStore.setStorageScope(n.scope):this.tripleStore,i,Gt(),{schema:r,stateVector:n.stateVector})).triples.values()].flat()}async fetchById(t,n,r={}){const i=this.query(t).id(n).build();return this.fetchOne(i,r)}async fetchOne(t,n={}){t={...t,limit:1};const i=[...(await this.fetch(t,n)).values()][0];return i||null}async insert(t,n,r={}){return this.transact(async i=>await i.insert(t,n),r)}async delete(t,n,r={}){return this.transact(async i=>{await i.delete(t,n)},r)}subscribe(t,n,r,i={}){let s=!1;const u=(async()=>{var p;await this.storageReady;const a=(p=await this.getSchema())==null?void 0:p.collections;let c=un(t,a,{roles:this.sessionRoles},{skipRules:i.skipRules});this.logger.debug("subscribe START",{query:t});const l=i.noCache===void 0?If:i.noCache;return WL(this,i.scope?this.tripleStore.setStorageScope(i.scope):this.tripleStore,c,(...d)=>{s||(this.logger.debug("subscribe RESULTS",{query:t,results:d}),n(...d))},(...d)=>{s||r==null||r(...d)},{schema:a,cache:l?void 0:this.cache,skipRules:i.skipRules,stateVector:i.stateVector})})();return async()=>(s=!0,this.logger.debug("subscribe END",{query:t}),(await u)())}subscribeTriples(t,n,r,i={}){const o=(async()=>{var f;await this.storageReady;const u=(f=await this.getSchema())==null?void 0:f.collections;let a=un(t,u,{roles:this.sessionRoles},{skipRules:i.skipRules});const c=i.noCache===void 0?If:i.noCache;return VL(this,i.scope?this.tripleStore.setStorageScope(i.scope):this.tripleStore,a,p=>n([...p.values()].flat()),r,{schema:u,skipRules:i.skipRules,stateVector:i.stateVector,cache:c?void 0:this.cache})})();return async()=>(await o)()}async update(t,n,r,i={}){return await this.transact(async s=>{await s.update(t,n,r)},i)}query(t,n){return $_(t,n)}async createCollection(t){await this.transact(async n=>{await n.createCollection(t)})}async dropCollection(t){await this.transact(async n=>{await n.dropCollection(t)})}async addAttribute(t){await this.transact(async n=>{await n.addAttribute(t)})}async dropAttribute(t){await this.transact(async n=>{await n.dropAttribute(t)})}async alterAttributeOption(t){await this.transact(async n=>{await n.alterAttributeOption(t)})}async dropAttributeOption(t){await this.transact(async n=>{await n.dropAttributeOption(t)})}async addRule(t){await this.transact(async n=>{await n.addRule(t)})}async dropRule(t){await this.transact(async n=>{await n.dropRule(t)})}async setAttributeOptional(t){await this.transact(async n=>{await n.setAttributeOptional(t)})}async applySchemaMigration(t,n,r){const i=t[n],{schema:s}=await Dd(this.tripleStore);await this.tripleStore.transact(async o=>{const u=new Ey(this,o,Ua(this.hooks),{schema:s});for(const a of i)switch(a[0]){case"create_collection":await u.createCollection(a[1]);break;case"drop_collection":await u.dropCollection(a[1]);break;case"add_attribute":await u.addAttribute(a[1]);break;case"drop_attribute":await u.dropAttribute(a[1]);break;case"alter_attribute_option":await u.alterAttributeOption(a[1]);break;case"drop_attribute_option":await u.dropAttributeOption(a[1]);break;case"add_rule":await u.addRule(a[1]);break;case"drop_rule":await u.dropRule(a[1]);break;case"set_attribute_optional":await u.setAttributeOptional(a[1]);break;default:throw new qE(`The operation ${a[0]} is not recognized.`)}await o.insertTriples([{id:st("_metadata","_schema"),attribute:["_metadata","version"],value:n==="up"?t.version:t.parent,timestamp:await o.clock.getNextTimestamp(),expired:!1}]),n==="up"?await o.updateMetadataTuples([["migrations",[`${t.version}`,"id"],t.version],["migrations",[`${t.version}`,"parent"],t.parent],["migrations",[`${t.version}`,"name"],t.name],["migrations",[`${t.version}`,"applied"],new Date().toISOString()]]):n==="down"&&await o.deleteMetadataTuples([["migrations",[`${t.version}`]]])},r?{read:r,write:r}:void 0)}async migrate(t,n,r){const i=t.sort((s,o)=>(s.version-o.version)*(n==="up"?1:-1));for(const s of i){const{schema:o}=await Dd(this.tripleStore),u=(o==null?void 0:o.version)??0;if(UB(s,n,u))try{await this.applySchemaMigration(s,n,r)}catch(a){throw console.error(`Error applying ${n} migration with verison`,s.version,a),a}else console.info("skipping migration",s)}}async getAppliedMigrations(){const t=await this.tripleStore.readMetadataTuples("migrations");return Pb(t).migrations||{}}async getLatestMigrationId(){const t=await this.getAppliedMigrations();return Object.values(t).reduce((r,i)=>Math.max(r||0,i.id),void 0)}async getCollectionStats(){const t=await this.tripleStore.findByAttribute(["_collection"]),n=new Map;for(let r of t){if(r.expired)continue;const i=r.value;n.set(i,(n.get(i)??0)+1)}return n}async clear({full:t}={}){t?await this.tripleStore.clear():await this.tripleStore.transact(async n=>{const i=(await n.findByEntity()).filter(({id:s})=>!s.includes("_metadata"));await n.deleteTriples(i)})}onSchemaChange(t){return this.onSchemaChangeCallbacks.add(t),()=>this.onSchemaChangeCallbacks.delete(t)}}I(i1,"ABORT_TRANSACTION",Symbol("abort transaction"));function UB(e,t,n){return t==="up"?e.parent===n:e.version===n}function zB(e,t){const n={global:e.systemVars.global,session:t};return new Proxy(e,{get(r,i,s){return i==="systemVars"?n:Reflect.get(r,i,s)},set:Reflect.set,deleteProperty:Reflect.deleteProperty})}const bt=class bt{static Schema(...t){return this.Record(...t)}static get Default(){return{uuid:t=>({func:"uuid",args:t?[t]:null}),now:()=>({func:"now",args:null})}}static Optional(t){return t.context.optional=!0,t}};I(bt,"Id",()=>Ld({nullable:!1,default:bt.Default.uuid()})),I(bt,"String",Ld),I(bt,"Number",D_),I(bt,"Boolean",Eh),I(bt,"Date",j_),I(bt,"Record",C_),I(bt,"Set",L_),I(bt,"Query",wo),I(bt,"RelationMany",(t,n)=>wo({collectionName:t,...n},"many")),I(bt,"RelationOne",(t,n)=>wo({collectionName:t,...n,limit:1},"one")),I(bt,"RelationById",(t,n)=>wo({collectionName:t,where:[["id","=",n]]},"one"));let Y=bt;class WB{constructor(t,n){I(this,"clock");I(this,"scope");I(this,"scopedStore");I(this,"clockReady");I(this,"readyCallbacks");I(this,"assigned");I(this,"clientId");this.scope=t,this.clientId=n||pu(),this.clockReady=new Promise(async(r,i)=>{this.readyCallbacks=[r,i]})}async assignToStore(t){if(this.assigned)return;this.assigned=!0;const[n,r]=this.readyCallbacks;try{this.scopedStore=this.scope?t.setStorageScope([this.scope]):t;const i=await this.scopedStore.readMetadataTuples("clock");if(i.length===0)this.clock=[0,this.clientId],await this.scopedStore.updateMetadataTuples([["clock",["tick"],this.clock[0]],["clock",["clientId"],this.clock[1]]]);else{const{clock:s}=Pb(i);this.clock=[s.tick,s.clientId]}n()}catch(i){return console.error(i),r(i)}t.onInsert(async i=>{const o=Object.values(i).flat().reduce((u,a)=>Pn(a.timestamp,u)>0?a.timestamp:u,void 0);await this.clockReady,Pn(o,this.clock)>0&&(this.clock=[o[0],this.clock[1]],this.scopedStore.updateMetadataTuples([["clock",["tick"],this.clock[0]],["clock",["clientId"],this.clock[1]]]))})}async getCurrentTimestamp(){return await this.clockReady,this.clock}async getNextTimestamp(){const[t,n]=await this.getCurrentTimestamp();return[t+1,n]}async setTick(t){await this.clockReady,this.clock=[t,this.clock[1]],this.scopedStore.updateMetadataTuples([["clock",["tick"],t]])}}function Ny(e,t){const n=VB(e);return n?((t==null?void 0:t.split("."))??[]).reduce((s,o)=>{if(s&&s[o])return s[o]},n)["x-triplit-user-id"]:void 0}function VB(e){var t=e.split(".")[1],n=t.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(n).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}class qB extends R{constructor(t,...n){super(...n),this.name="UnrecognizedFetchPolicyError",this.baseMessage="The fetch policy "+t+" is not recognized.",this.status=L["Bad Request"]}}class JB extends R{constructor(...t){super(...t),this.name="MissingConnectionInformationError",this.baseMessage="Missing connection information. A token and server must be provided.",this.status=L["Internal Server Error"]}}class Fy extends R{constructor(t,...n){super(...n),this.name="RemoteSyncFailedError",this.baseMessage="Remote sync failed for query: "+JSON.stringify(t,null,2),this.status=L["Internal Server Error"]}}class pa extends R{constructor(t,...n){super(...n),this.name="RemoteFetchFailedError",this.baseMessage="Remote fetch failed for query: "+JSON.stringify(t,null,2),this.status=L["Internal Server Error"]}}var Ch={},Kl={};const Ud=(e,t)=>t.some(n=>e instanceof n);let jy,Cy;function KB(){return jy||(jy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function QB(){return Cy||(Cy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const s1=new WeakMap,zd=new WeakMap,o1=new WeakMap,Af=new WeakMap,Ql=new WeakMap;function HB(e){const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{n(En(e.result)),i()},o=()=>{r(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",o)});return t.then(n=>{n instanceof IDBCursor&&s1.set(n,e)}).catch(()=>{}),Ql.set(t,e),t}function GB(e){if(zd.has(e))return;const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)});zd.set(e,t)}let Wd={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return zd.get(e);if(t==="objectStoreNames")return e.objectStoreNames||o1.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return En(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function u1(e){Wd=e(Wd)}function XB(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(Io(this),t,...n);return o1.set(r,t.sort?t.sort():[t]),En(r)}:QB().includes(e)?function(...t){return e.apply(Io(this),t),En(s1.get(this))}:function(...t){return En(e.apply(Io(this),t))}}function YB(e){return typeof e=="function"?XB(e):(e instanceof IDBTransaction&&GB(e),Ud(e,KB())?new Proxy(e,Wd):e)}function En(e){if(e instanceof IDBRequest)return HB(e);if(Af.has(e))return Af.get(e);const t=YB(e);return t!==e&&(Af.set(e,t),Ql.set(t,e)),t}const Io=e=>Ql.get(e);function ZB(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),u=En(o);return r&&o.addEventListener("upgradeneeded",a=>{r(En(o.result),a.oldVersion,a.newVersion,En(o.transaction),a)}),n&&o.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),u.then(a=>{s&&a.addEventListener("close",()=>s()),i&&a.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),u}function eU(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",r=>t(r.oldVersion,r)),En(n).then(()=>{})}const tU=["get","getKey","getAll","getAllKeys","count"],nU=["put","add","delete","clear"],kf=new Map;function Dy(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(kf.get(t))return kf.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=nU.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||tU.includes(n)))return;const s=async function(o,...u){const a=this.transaction(o,i?"readwrite":"readonly");let c=a.store;return r&&(c=c.index(u.shift())),(await Promise.all([c[n](...u),i&&a.done]))[0]};return kf.set(t,s),s}u1(e=>({...e,get:(t,n,r)=>Dy(t,n)||e.get(t,n,r),has:(t,n)=>!!Dy(t,n)||e.has(t,n)}));const rU=["continue","continuePrimaryKey","advance"],Ly={},Vd=new WeakMap,a1=new WeakMap,iU={get(e,t){if(!rU.includes(t))return e[t];let n=Ly[t];return n||(n=Ly[t]=function(...r){Vd.set(this,a1.get(this)[t](...r))}),n}};async function*sU(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,iU);for(a1.set(n,t),Ql.set(n,Io(t));t;)yield n,t=await(Vd.get(n)||t.continue()),Vd.delete(n)}function By(e,t){return t===Symbol.asyncIterator&&Ud(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Ud(e,[IDBIndex,IDBObjectStore])}u1(e=>({...e,get(t,n,r){return By(t,n)?sU:e.get(t,n,r)},has(t,n){return By(t,n)||e.has(t,n)}}));const oU=Object.freeze(Object.defineProperty({__proto__:null,deleteDB:eU,openDB:ZB,unwrap:Io,wrap:En},Symbol.toStringTag,{value:"Module"})),uU=Eb(oU);Object.defineProperty(Kl,"__esModule",{value:!0});Kl.IndexedDbTupleStorage=void 0;const aU=uU,Xr=bl,cU=1,Pf="tupledb";class lU{constructor(t){this.dbName=t,this.db=(0,aU.openDB)(t,cU,{upgrade(n){n.createObjectStore(Pf)}})}async scan(t){const r=(await this.db).transaction(Pf,"readonly",{durability:"relaxed"}),i=r.store,s=(t==null?void 0:t.gt)||(t==null?void 0:t.gte),o=!!(t!=null&&t.gte),u=(t==null?void 0:t.lt)||(t==null?void 0:t.lte),a=!!(t!=null&&t.lte);let c;u?s?c=IDBKeyRange.bound((0,Xr.encodeTuple)(s),(0,Xr.encodeTuple)(u),!o,!a):c=IDBKeyRange.upperBound((0,Xr.encodeTuple)(u),!a):s?c=IDBKeyRange.lowerBound((0,Xr.encodeTuple)(s),!o):c=null;const l=t!=null&&t.reverse?"prev":"next",f=(t==null?void 0:t.limit)||1/0;let p=[];for await(const d of i.iterate(c,l))if(p.push({key:(0,Xr.decodeTuple)(d.key),value:d.value}),p.length>=f)break;return await r.done,p}async commit(t){const r=(await this.db).transaction(Pf,"readwrite",{durability:"relaxed"});for(const{key:i,value:s}of t.set||[])r.store.put(s,(0,Xr.encodeTuple)(i));for(const i of t.remove||[])r.store.delete((0,Xr.encodeTuple)(i));await r.done}async close(){(await this.db).close()}}Kl.IndexedDbTupleStorage=lU;Object.defineProperty(Ch,"__esModule",{value:!0});var qd=Ch.CachedIndexedDbStorage=void 0;const fU=Kl,dU=ql;class pU{constructor(t,n={cache:!0}){this.dbName=t,this.options=n,this._cacheReadyForReads=!1,this._indexedDB=new fU.IndexedDbTupleStorage(t),this._cache=new dU.MemoryBTreeStorage,n.cache&&this.initializeCacheFromIndexedDB()}async initializeCacheFromIndexedDB(){const t=await this._indexedDB.scan();this._cache.commit({set:t}),this._cacheReadyForReads=!0}async scan(t){return this.options.cache&&this._cacheReadyForReads?this._cache.scan(t):this._indexedDB.scan(t)}async commit(t){this.options.cache?(this._cache.commit(t),await this._indexedDB.commit(t)):await this._indexedDB.commit(t)}async close(){this._cache&&this._cache.close(),await this._indexedDB.close()}}qd=Ch.CachedIndexedDbStorage=pU;var Jd=function(e,t){return Jd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Jd(e,t)};function Hl(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Jd(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Kd(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qd(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(u){o={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Hd(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}function or(e){return typeof e=="function"}function c1(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ef=c1(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Gd(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Gl=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var u=Kd(o),a=u.next();!a.done;a=u.next()){var c=a.value;c.remove(this)}}catch(y){t={error:y}}finally{try{a&&!a.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}else o.remove(this);var l=this.initialTeardown;if(or(l))try{l()}catch(y){s=y instanceof Ef?y.errors:[y]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var p=Kd(f),d=p.next();!d.done;d=p.next()){var m=d.value;try{Uy(m)}catch(y){s=s??[],y instanceof Ef?s=Hd(Hd([],Qd(s)),Qd(y.errors)):s.push(y)}}}catch(y){r={error:y}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new Ef(s)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Uy(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&Gd(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&Gd(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),l1=Gl.EMPTY;function f1(e){return e instanceof Gl||e&&"closed"in e&&or(e.remove)&&or(e.add)&&or(e.unsubscribe)}function Uy(e){or(e)?e():e.unsubscribe()}var d1={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},p1={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Hd([e,t],Qd(n)))},clearTimeout:function(e){var t=p1.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function hU(e){p1.setTimeout(function(){throw e})}function zy(){}function Oa(e){e()}var h1=function(e){Hl(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,f1(n)&&n.add(r)):r.destination=wU,r}return t.create=function(n,r,i){return new Xd(n,r,i)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Gl),mU=Function.prototype.bind;function Rf(e,t){return mU.call(e,t)}var yU=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){ha(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){ha(r)}else ha(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){ha(n)}},e}(),Xd=function(e){Hl(t,e);function t(n,r,i){var s=e.call(this)||this,o;if(or(n)||!n)o={next:n??void 0,error:r??void 0,complete:i??void 0};else{var u;s&&d1.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=function(){return s.unsubscribe()},o={next:n.next&&Rf(n.next,u),error:n.error&&Rf(n.error,u),complete:n.complete&&Rf(n.complete,u)}):o=n}return s.destination=new yU(o),s}return t}(h1);function ha(e){hU(e)}function gU(e){throw e}var wU={closed:!0,next:zy,error:gU,complete:zy},bU=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function _U(e){return e}function vU(e){return e.length===0?_U:e.length===1?e[0]:function(n){return e.reduce(function(r,i){return i(r)},n)}}var Wy=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var i=this,s=SU(t)?t:new Xd(t,n,r);return Oa(function(){var o=i,u=o.operator,a=o.source;s.add(u?u.call(s,a):a?i._subscribe(s):i._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=Vy(n),new n(function(i,s){var o=new Xd({next:function(u){try{t(u)}catch(a){s(a),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[bU]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return vU(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=Vy(t),new t(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},e.create=function(t){return new e(t)},e}();function Vy(e){var t;return(t=e??d1.Promise)!==null&&t!==void 0?t:Promise}function xU(e){return e&&or(e.next)&&or(e.error)&&or(e.complete)}function SU(e){return e&&e instanceof h1||xU(e)&&f1(e)}var OU=c1(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Yd=function(e){Hl(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new qy(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new OU},t.prototype.next=function(n){var r=this;Oa(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Kd(r.currentObservers),u=o.next();!u.done;u=o.next()){var a=u.value;a.next(n)}}catch(c){i={error:c}}finally{try{u&&!u.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(n){var r=this;Oa(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},t.prototype.complete=function(){var n=this;Oa(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,u=i.observers;return s||o?l1:(this.currentObservers=null,u.push(n),new Gl(function(){r.currentObservers=null,Gd(u,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},t.prototype.asObservable=function(){var n=new Wy;return n.source=this,n},t.create=function(n,r){return new qy(n,r)},t}(Wy),qy=function(e){Hl(t,e);function t(n,r){var i=e.call(this)||this;return i.destination=n,i.source=r,i}return t.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},t.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:l1},t}(Yd);const $U=1024*1024/2;class TU{constructor(t={}){I(this,"options");I(this,"ws");I(this,"connectionListeners",new Set);this.options=t,this.options.messagePayloadSizeLimit=this.options.messagePayloadSizeLimit==null?$U:this.options.messagePayloadSizeLimit}get isOpen(){return!!this.ws&&this.ws.readyState===this.ws.OPEN}get connectionStatus(){return this.ws?m1(this.ws):"CLOSED"}onOpen(t){this.ws&&(this.ws.onopen=t)}sendMessage(t){if(!this.ws||!this.isOpen)return;const n=JSON.stringify(t),r=IU(n);if(this.options.messagePayloadSizeLimit&&r>this.options.messagePayloadSizeLimit){const i=AU(n,Math.ceil(r/this.options.messagePayloadSizeLimit)),s=(Math.random()+1).toString(36).substring(7);for(let o=0;o<i.length;o++)this.ws.send(JSON.stringify({type:"CHUNK",payload:{data:i[o],total:i.length,index:o,id:s}}));return}this.ws.send(JSON.stringify(t))}connect(t){this.ws&&this.isOpen&&this.close();const{token:n,clientId:r,schema:i,syncSchema:s,server:o,secure:u}=t,a=[];if(!n||!r||!o){n||a.push("token"),r||a.push("clientId"),o||a.push("server"),console.warn(`Missing required params: [${a.join(", ")}]. Skipping sync connection.`);return}const c=new URLSearchParams;i&&c.set("schema",i.toString()),c.set("sync-schema",String(s)),c.set("client",r),c.set("token",n);const l=`${u?"wss":"ws"}://${o}?${c.toString()}`;this.ws=new WebSocket(l),this.ws.onconnectionchange=f=>{this.connectionListeners.forEach(p=>p(f))}}onMessage(t){this.ws&&(this.ws.onmessage=t)}onError(t){this.ws&&(this.ws.onerror=t)}close(t){this.ws&&this.ws.close(1e3,JSON.stringify(t))}onClose(t){this.ws&&(this.ws.onclose=t)}onConnectionChange(t){return this.connectionListeners.add(t),()=>{this.connectionListeners.delete(t)}}}function IU(e){var t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t+=r<128?1:r<2048?2:r<65536?3:4}return t}function AU(e,t){let n=[];const r=Math.ceil(e.length/t);for(let i=0;i<e.length;i+=r)n.push(e.slice(i,i+r));return n}function m1(e){switch(e.readyState){case e.CONNECTING:return"CONNECTING";case e.OPEN:return"OPEN";case e.CLOSING:return"CLOSING";case e.CLOSED:default:return"CLOSED"}}var ug;if(typeof WebSocket<"u"&&typeof self<"u"&&((ug=Object.getOwnPropertyDescriptor(self,"WebSocket"))!=null&&ug.writable)){var kU=new Proxy(WebSocket,{construct:function(e,t){const n=new e(...t);function r(){n.dispatchEvent(new Event("connectionchange")),n.onconnectionchange&&typeof n.onconnectionchange=="function"&&n.onconnectionchange(m1(n))}setTimeout(function(){r()},0);const i=()=>{r()},s=()=>{r(),n.removeEventListener("open",i),n.removeEventListener("close",s)};return n.addEventListener("open",i),n.addEventListener("close",s),n}});WebSocket=kU}const Jy="query-state";class PU{constructor(t,n){I(this,"transport");I(this,"queries",new Map);I(this,"reconnectTimeoutDelay",250);I(this,"reconnectTimeout");I(this,"client");I(this,"syncOptions");I(this,"connectionChangeHandlers",new Set);I(this,"queryFulfillmentCallbacks");I(this,"txCommits$",new Yd);I(this,"txFailures$",new Yd);I(this,"messageReceivedSubscribers",new Set);I(this,"messageSentSubscribers",new Set);I(this,"awaitingAck",new Set);I(this,"logger");I(this,"commitCallbacks",new Map);I(this,"failureCallbacks",new Map);this.client=t,this.logger=n.logger,this.syncOptions=n,this.syncOptions.secure=n.secure??!0,this.syncOptions.syncSchema=n.syncSchema??!1,this.transport=n.transport??new TU,this.txCommits$.subscribe(i=>{const s=this.commitCallbacks.get(i);if(s){for(const o of s)o();this.commitCallbacks.delete(i),this.failureCallbacks.delete(i)}}),this.txFailures$.subscribe(({txId:i,error:s})=>{const o=this.failureCallbacks.get(i);if(o)for(const u of o)u(s)}),this.queryFulfillmentCallbacks=new Map;const r=EU(()=>this.signalOutboxTriples(),100);this.db.tripleStore.setStorageScope(["outbox"]).onInsert(i=>{var s;(s=i.outbox)!=null&&s.length&&r()})}get token(){return this.syncOptions.token}get db(){return this.client.db}get httpUri(){return this.syncOptions.server?`${this.syncOptions.secure?"https":"http"}://${this.syncOptions.server}`:void 0}onSyncMessageReceived(t){return this.messageReceivedSubscribers.add(t),()=>{this.messageReceivedSubscribers.delete(t)}}onSyncMessageSent(t){return this.messageSentSubscribers.add(t),()=>{this.messageSentSubscribers.delete(t)}}async getConnectionParams(){var r;const t=await this.db.getClientId(),n=$B((r=Rh(await this.db.getSchema()))==null?void 0:r.collections);return{clientId:t,schema:n,syncSchema:this.syncOptions.syncSchema,token:this.syncOptions.token,server:this.syncOptions.server,secure:this.syncOptions.secure}}async getQueryState(t){const n=await this.db.tripleStore.readMetadataTuples(Jy,[t]);return n.length===0?void 0:JSON.parse(n[0][2])}async isFirstTimeFetchingQuery(t){await this.db.ready;const n=this.getQueryHash(t);return await this.getQueryState(n)===void 0}async setQueryState(t,n){await this.db.tripleStore.updateMetadataTuples([[Jy,[t],JSON.stringify(n)]])}getQueryHash(t){const{id:n,...r}=t;return m_(r).toString()}subscribe(t,n){const r=this.getQueryHash(t);return this.getQueryState(r).then(i=>{this.sendMessage({type:"CONNECT_QUERY",payload:{id:r,params:t,state:i}}),this.queries.set(r,{params:t,fulfilled:!1}),this.onQueryFulfilled(r,s=>{const{triples:o}=s;if(o.length>0){const u=this.triplesToStateVector(o),a=new Map((i??[]).map(([c,l])=>[l,c]));u.forEach(([c,l])=>{const f=a.get(l);(!f||c>f)&&a.set(l,c)}),this.setQueryState(r,[...a.entries()].map(([c,l])=>[l,c]))}this.queries.set(r,{params:t,fulfilled:!0}),n&&n()})}),()=>{this.disconnectQuery(r)}}triplesToStateVector(t){const n=new Map;return t.forEach(r=>{const[i,s]=r.timestamp,o=n.get(s);(!o||i>o)&&n.set(s,i)}),[...n.entries()].map(([r,i])=>[i,r])}onQueryFulfilled(t,n){this.queryFulfillmentCallbacks.set(t,n)}hasQueryBeenFulfilled(t){var n;return((n=this.queries.get(t))==null?void 0:n.fulfilled)??!1}disconnectQuery(t){this.sendMessage({type:"DISCONNECT_QUERY",payload:{id:t}}),this.queries.delete(t)}onTxCommit(t,n){var r;return this.commitCallbacks.has(t)?(r=this.commitCallbacks.get(t))==null||r.add(n):this.commitCallbacks.set(t,new Set([n])),()=>{var i;(i=this.commitCallbacks.get(t))==null||i.delete(n)}}onTxFailure(t,n){var r;return this.failureCallbacks.has(t)?(r=this.failureCallbacks.get(t))==null||r.add(n):this.failureCallbacks.set(t,new Set([n])),()=>{var i;(i=this.failureCallbacks.get(t))==null||i.delete(n)}}signalOutboxTriples(){this.sendMessage({type:"TRIPLES_PENDING",payload:{}})}async connect(){this.transport.connectionStatus!=="CLOSED"&&this.closeConnection({type:"CONNECTION_OVERRIDE",retry:!1});const t=await this.getConnectionParams();this.transport.connect(t),this.transport.onMessage(async n=>{const r=JSON.parse(n.data);this.logger.debug("received",r);for(const i of this.messageReceivedSubscribers)i(r);if(r.type==="ERROR"&&await this.handleErrorMessage(r),r.type==="TRIPLES"){const{payload:i}=r,s=i.triples,o=i.forQueries;for(const u of o){const a=this.queryFulfillmentCallbacks.get(u);a&&a(i)}s.length!==0&&await this.db.transact(async u=>{await u.storeTx.withScope({read:["cache"],write:["cache"]}).insertTriples(s)},{skipRules:!0})}if(r.type==="TRIPLES_ACK"){const{payload:i}=r,{txIds:s,failedTxIds:o}=i;try{const u=new Set(o);await this.db.tripleStore.transact(async c=>{const l=c.withScope({read:["outbox"],write:["outbox"]}),f=c.withScope({read:["cache"],write:["cache"]});for(const p of s){const d=JSON.parse(p),m=await l.findByClientTimestamp(await this.db.getClientId(),"eq",d);m.length>0&&(await f.insertTriples(m),await l.deleteTriples(m))}});for(const c of s)this.txCommits$.next(c);(await this.getTriplesToSend(this.db.tripleStore.setStorageScope(["outbox"]))).filter(c=>!u.has(JSON.stringify(c.timestamp))).length&&this.signalOutboxTriples()}finally{for(const u of s)this.awaitingAck.delete(u);for(const u of o)this.awaitingAck.delete(u)}}if(r.type==="TRIPLES_REQUEST"){const i=await this.getTriplesToSend(this.db.tripleStore.setStorageScope(["outbox"]));this.sendTriples(i)}if(r.type==="CLOSE"){const{payload:i}=r;this.logger.info(`Closing connection${i!=null&&i.message?`: ${i.message}`:"."}`);const{type:s,retry:o}=i;this.closeConnection({type:s,retry:o})}}),this.transport.onOpen(async()=>{this.logger.info("sync connection has opened"),this.resetReconnectTimeout(),!!(await this.getTriplesToSend(this.db.tripleStore.setStorageScope(["outbox"]))).length&&this.signalOutboxTriples();for(const[i,s]of this.queries)this.getQueryState(i).then(o=>{this.sendMessage({type:"CONNECT_QUERY",payload:{id:i,params:s.params,state:o}})})}),this.transport.onClose(n=>{if(this.awaitingAck=new Set,n.reason){let i,s;try{const{type:o,retry:u}=JSON.parse(n.reason);i=o,s=u}catch{i="UNKNOWN",s=!0}if(i==="SCHEMA_MISMATCH"&&this.logger.error("The server has closed the connection because the client schema does not match the server schema. Please update your client schema."),!s){this.logger.warn("Connection will not automatically retry.");return}}const r=this.connect.bind(this);this.reconnectTimeout=setTimeout(r,this.reconnectTimeoutDelay),this.reconnectTimeoutDelay=Math.min(3e4,this.reconnectTimeoutDelay*2)}),this.transport.onError(n=>{this.logger.error("transport error",n),this.transport.close()}),this.transport.onConnectionChange(n=>{for(const r of this.connectionChangeHandlers)r(n)})}get connectionStatus(){return this.transport.connectionStatus}updateConnection(t){Object.keys(t).some(r=>this.syncOptions[r]!==t[r])&&(this.disconnect(),this.syncOptions={...this.syncOptions,...t},this.connect())}disconnect(){this.closeConnection({type:"MANUAL_DISCONNECT",retry:!1})}async handleErrorMessage(t){const{error:n,metadata:r}=t.payload;switch(this.logger.error(n.name,r),n.name){case"MalformedMessagePayloadError":case"UnrecognizedMessageTypeError":this.logger.warn("You sent a malformed message to the server. This might occur if your client is not up to date with the server. Please ensure your client is updated.");break;case"TriplesInsertError":const i=(r==null?void 0:r.failures)??[];for(const o of i){const{txId:u,error:a}=o;this.txFailures$.next({txId:u,error:a})}case"QuerySyncError":const s=r==null?void 0:r.queryKey;s&&this.disconnectQuery(s)}}sendTriples(t){const n=this.syncOptions.syncSchema?t:t.filter(({id:r})=>!r.includes("_metadata#_schema"));n.length!==0&&(n.forEach(r=>this.awaitingAck.add(JSON.stringify(r.timestamp))),this.sendMessage({type:"TRIPLES",payload:{triples:n}}))}sendMessage(t){this.transport.sendMessage(t),this.logger.debug("sent",t);for(const n of this.messageSentSubscribers)n(t)}async retry(t){const n=JSON.parse(t),r=await this.db.tripleStore.setStorageScope(["outbox"]).findByClientTimestamp(await this.db.getClientId(),"eq",n);r.length>0&&this.sendTriples(r)}async rollback(t){const n=Array.isArray(t)?t:[t];await this.db.transact(async r=>{const i=r.storeTx.withScope({read:["outbox"],write:["outbox"]});for(const s of n){const o=JSON.parse(s),u=await i.findByClientTimestamp(await this.db.getClientId(),"eq",o);await i.deleteTriples(u)}},{skipRules:!0})}onConnectionStatusChange(t,n=!1){return this.connectionChangeHandlers.add(t),n&&t(this.transport.connectionStatus),()=>{this.connectionChangeHandlers.delete(t)}}closeConnection(t){this.transport&&this.transport.close(t)}resetReconnectTimeout(){clearTimeout(this.reconnectTimeout),this.reconnectTimeoutDelay=250}async syncQuery(t){try{const n=await this.getRemoteTriples(t);await this.db.transact(async r=>{await r.storeTx.withScope({read:["cache"],write:["cache"]}).insertTriples(n)},{skipRules:!0})}catch(n){throw n instanceof R?n:n instanceof Error?new Fy(t,n.message):new Fy(t,"An unknown error occurred.")}}async fetchQuery(t){var n;try{const r=await this.getRemoteTriples(t),i=ro(r),s=(n=await this.db.getSchema())==null?void 0:n.collections;return new Map([...i].map(([o,u])=>[Vi(o),Rr(u.data,s)]))}catch(r){throw r instanceof R?r:r instanceof Error?new pa(t,r.message):new pa(t,"An unknown error occurred.")}}async getRemoteTriples(t){const n=await this.fetchFromServer("/queryTriples",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!n.ok){let r;try{r=await n.json()}catch{throw new pa(t,`The server responded with an error: ${await n.text()}`)}const i=r.message??JSON.stringify(r);throw new pa(t,i)}return await n.json()}fetchFromServer(t,n){if(!this.httpUri||!this.token){const r=[];throw this.httpUri||r.push("No server specified."),this.token||r.push("No token specified."),new JB(r.join(" "))}return fetch(`${this.httpUri}${t}`,{...n,headers:{Authorization:`Bearer ${this.token}`,...n==null?void 0:n.headers}})}async getTriplesToSend(t){return(await t.findByEntity()).filter(n=>this.shouldSendTriple(n))}shouldSendTriple(t){return!this.awaitingAck.has(JSON.stringify(t.timestamp))&&(this.syncOptions.syncSchema||!t.id.includes("_metadata#_schema"))}}function EU(e,t){let n=!1,r=!1;function i(){r?(e(),r=!1,setTimeout(i,t)):n=!1}return function(){n?r=!0:(e(),n=!0,setTimeout(i,t))}}function RU(e,t){const n={collectionName:e,...t};return new tn(n)}class tn{constructor(t){I(this,"query");this.query=t}build(){return this.query}select(t){return new tn({...this.query,select:t})}where(...t){return new tn({...this.query,where:Ir().where(this.query,...t)})}id(t){const n=[["id","=",t],...(this.query.where??[]).filter(r=>!Array.isArray(r)||r[0]!=="id")];return new tn({...this.query,where:n})}order(...t){return new tn({...this.query,order:Ir().order(this.query,...t)})}after(t,n){return new tn({...this.query,after:Ir().after(this.query,t,n)})}include(t,n){return new tn({...this.query,include:Ir().include(this.query,t,n)})}limit(t){return new tn({...this.query,limit:t})}vars(t){return new tn({...this.query,vars:t})}entityId(t){return this.id(t)}syncStatus(t){return new tn({...this.query,syncStatus:t})}}function MU(e,t){const n={collectionName:e,...t};return new nn(n)}function NU(e){try{const t=JSON.parse(e);return R.fromJson(t)}catch{return new R(`Failed to parse remote error response: ${e}`)}}class FU{constructor(t){I(this,"options");this.options=t}async schema(){var t,n;return this.options.schema||await((n=(t=this.options).schemaFactory)==null?void 0:n.call(t))}updateOptions(t){this.options={...this.options,...t}}async sendRequest(t,n,r,i={isFile:!1}){if(!this.options.server)throw new R("No server url provided");if(!this.options.token)throw new R("No token provided");const s={Authorization:"Bearer "+this.options.token,"Content-Type":"application/json"},o=JSON.stringify(r);let u;i.isFile&&(u=new FormData,u.append("data",o),delete s["Content-Type"]);const a=await fetch(this.options.server+t,{method:n,headers:s,body:i.isFile?u:o});return a.ok?{data:await a.json(),error:void 0}:{data:void 0,error:NU(await a.text())}}async fetch(t){const{data:n,error:r}=await this.sendRequest("/fetch","POST",{query:t});if(r)throw r;return Ky(t,n.result,await this.schema())}async queryTriples(t){const{data:n,error:r}=await this.sendRequest("/queryTriples","POST",{query:t});if(r)throw r;return n}async fetchOne(t){t={...t,limit:1};const{data:n,error:r}=await this.sendRequest("/fetch","POST",{query:t});if(r)throw r;const s=[...Ky(t,n.result,await this.schema()).values()][0];return s||null}async fetchById(t,n){const r=this.query(t).id(n).build();return this.fetchOne(r)}async insert(t,n){var a;const r=await this.schema(),i=(a=r==null?void 0:r[t])==null?void 0:a.schema,s=i?Object.fromEntries(Object.entries(n).map(([c,l])=>[c,i.properties[c].convertJSToJSON(l,r)])):n,{data:o,error:u}=await this.sendRequest("/insert","POST",{collectionName:t,entity:s});if(u)throw u;return o}async bulkInsert(t){const n=await this.schema(),r=n?Object.fromEntries(Object.entries(t).map(([o,u])=>[o,u==null?void 0:u.map(a=>Object.fromEntries(Object.entries(a).map(([c,l])=>{var f;return[c,(f=n[o])==null?void 0:f.schema.properties[c].convertJSToJSON(l,n)]})))])):t,{data:i,error:s}=await this.sendRequest("/bulk-insert-file","POST",r,{isFile:!0});if(s)throw s;return i}async insertTriples(t){const{data:n,error:r}=await this.sendRequest("/insert-triples","POST",{triples:t});if(r)throw r;return n}async deleteTriples(t){const{data:n,error:r}=await this.sendRequest("/delete-triples","POST",{entityAttributes:t});if(r)throw r;return n}async update(t,n,r){var y;const i=await this.schema();(y=i==null?void 0:i[t])==null||y.schema;const s=this.query(t).id(n).build(),o=await this.queryTriples(s),u=Ss(o,st(t,n)),a=pt(u==null?void 0:u.data),c=new K_(a),l=uc(c,a,i,t);await r(l);const p=c.getTuples().map(b=>b[1]===void 0?["delete",b[0]]:["set",b[0],b[1]]),{data:d,error:m}=await this.sendRequest("/update","POST",{collectionName:t,entityId:n,patches:p});if(m)throw m;return d}async delete(t,n){const{data:r,error:i}=await this.sendRequest("/delete","POST",{collectionName:t,entityId:n});if(i)throw i;return r}query(t){return MU(t)}}function Ky(e,t,n){return new Map(t.map(r=>[r[0],jU(e,r[1],n)]))}function jU(e,t,n){var u;const{include:r,collectionName:i}=e,s=(u=n==null?void 0:n[i])==null?void 0:u.schema;return s?s.convertJSONToJS(t,n):t}class CU{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,n){this.keyToValue.set(t,n),this.valueToKey.set(n,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class y1{constructor(t){this.generateIdentifier=t,this.kv=new CU}register(t,n){this.kv.getByValue(t)||(n||(n=this.generateIdentifier(t)),this.kv.set(n,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}}class DU extends y1{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,n){typeof n=="object"?(n.allowProps&&this.classToAllowedProps.set(t,n.allowProps),super.register(t,n.identifier)):super.register(t,n)}getAllowedProps(t){return this.classToAllowedProps.get(t)}}function LU(e){if("values"in Object)return Object.values(e);const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function BU(e,t){const n=LU(e);if("find"in n)return n.find(t);const r=n;for(let i=0;i<r.length;i++){const s=r[i];if(t(s))return s}}function Is(e,t){Object.entries(e).forEach(([n,r])=>t(r,n))}function $a(e,t){return e.indexOf(t)!==-1}function Qy(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(t(r))return r}}class UU{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return BU(this.transfomers,n=>n.isApplicable(t))}findByName(t){return this.transfomers[t]}}const zU=e=>Object.prototype.toString.call(e).slice(8,-1),g1=e=>typeof e>"u",WU=e=>e===null,hu=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,Zd=e=>hu(e)&&Object.keys(e).length===0,Br=e=>Array.isArray(e),VU=e=>typeof e=="string",qU=e=>typeof e=="number"&&!isNaN(e),JU=e=>typeof e=="boolean",KU=e=>e instanceof RegExp,mu=e=>e instanceof Map,yu=e=>e instanceof Set,w1=e=>zU(e)==="Symbol",QU=e=>e instanceof Date&&!isNaN(e.valueOf()),HU=e=>e instanceof Error,Hy=e=>typeof e=="number"&&isNaN(e),GU=e=>JU(e)||WU(e)||g1(e)||qU(e)||VU(e)||w1(e),XU=e=>typeof e=="bigint",YU=e=>e===1/0||e===-1/0,ZU=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),e5=e=>e instanceof URL,b1=e=>e.replace(/\./g,"\\."),Mf=e=>e.map(String).map(b1).join("."),Ao=e=>{const t=[];let n="";for(let i=0;i<e.length;i++){let s=e.charAt(i);if(s==="\\"&&e.charAt(i+1)==="."){n+=".",i++;continue}if(s==="."){t.push(n),n="";continue}n+=s}const r=n;return t.push(r),t};function bn(e,t,n,r){return{isApplicable:e,annotation:t,transform:n,untransform:r}}const _1=[bn(g1,"undefined",()=>null,()=>{}),bn(XU,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),bn(QU,"Date",e=>e.toISOString(),e=>new Date(e)),bn(HU,"Error",(e,t)=>{const n={name:e.name,message:e.message};return t.allowedErrorProps.forEach(r=>{n[r]=e[r]}),n},(e,t)=>{const n=new Error(e.message);return n.name=e.name,n.stack=e.stack,t.allowedErrorProps.forEach(r=>{n[r]=e[r]}),n}),bn(KU,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),n=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,n)}),bn(yu,"set",e=>[...e.values()],e=>new Set(e)),bn(mu,"map",e=>[...e.entries()],e=>new Map(e)),bn(e=>Hy(e)||YU(e),"number",e=>Hy(e)?"NaN":e>0?"Infinity":"-Infinity",Number),bn(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),bn(e5,"URL",e=>e.toString(),e=>new URL(e))];function Xl(e,t,n,r){return{isApplicable:e,annotation:t,transform:n,untransform:r}}const v1=Xl((e,t)=>w1(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,n)=>{const r=n.symbolRegistry.getValue(t[1]);if(!r)throw new Error("Trying to deserialize unknown symbol");return r}),t5=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),x1=Xl(ZU,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const n=t5[t[1]];if(!n)throw new Error("Trying to deserialize unknown typed array");return new n(e)});function S1(e,t){return e!=null&&e.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}const O1=Xl(S1,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const n=t.classRegistry.getAllowedProps(e.constructor);if(!n)return{...e};const r={};return n.forEach(i=>{r[i]=e[i]}),r},(e,t,n)=>{const r=n.classRegistry.getValue(t[1]);if(!r)throw new Error("Trying to deserialize unknown class - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564");return Object.assign(Object.create(r.prototype),e)}),$1=Xl((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,n)=>{const r=n.customTransformerRegistry.findByName(t[1]);if(!r)throw new Error("Trying to deserialize unknown custom value");return r.deserialize(e)}),n5=[O1,v1,$1,x1],Gy=(e,t)=>{const n=Qy(n5,i=>i.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation(e,t)};const r=Qy(_1,i=>i.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation}},T1={};_1.forEach(e=>{T1[e.annotation]=e});const r5=(e,t,n)=>{if(Br(t))switch(t[0]){case"symbol":return v1.untransform(e,t,n);case"class":return O1.untransform(e,t,n);case"custom":return $1.untransform(e,t,n);case"typed-array":return x1.untransform(e,t,n);default:throw new Error("Unknown transformation: "+t)}else{const r=T1[t];if(!r)throw new Error("Unknown transformation: "+t);return r.untransform(e,n)}},qi=(e,t)=>{const n=e.keys();for(;t>0;)n.next(),t--;return n.next().value};function I1(e){if($a(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if($a(e,"prototype"))throw new Error("prototype is not allowed as a property");if($a(e,"constructor"))throw new Error("constructor is not allowed as a property")}const i5=(e,t)=>{I1(t);for(let n=0;n<t.length;n++){const r=t[n];if(yu(e))e=qi(e,+r);else if(mu(e)){const i=+r,s=+t[++n]==0?"key":"value",o=qi(e,i);switch(s){case"key":e=o;break;case"value":e=e.get(o);break}}else e=e[r]}return e},ep=(e,t,n)=>{if(I1(t),t.length===0)return n(e);let r=e;for(let s=0;s<t.length-1;s++){const o=t[s];if(Br(r)){const u=+o;r=r[u]}else if(hu(r))r=r[o];else if(yu(r)){const u=+o;r=qi(r,u)}else if(mu(r)){if(s===t.length-2)break;const a=+o,c=+t[++s]==0?"key":"value",l=qi(r,a);switch(c){case"key":r=l;break;case"value":r=r.get(l);break}}}const i=t[t.length-1];if(Br(r)?r[+i]=n(r[+i]):hu(r)&&(r[i]=n(r[i])),yu(r)){const s=qi(r,+i),o=n(s);s!==o&&(r.delete(s),r.add(o))}if(mu(r)){const s=+t[t.length-2],o=qi(r,s);switch(+i==0?"key":"value"){case"key":{const a=n(o);r.set(a,r.get(o)),a!==o&&r.delete(o);break}case"value":{r.set(o,n(r.get(o)));break}}}return e};function tp(e,t,n=[]){if(!e)return;if(!Br(e)){Is(e,(s,o)=>tp(s,t,[...n,...Ao(o)]));return}const[r,i]=e;i&&Is(i,(s,o)=>{tp(s,t,[...n,...Ao(o)])}),t(r,n)}function s5(e,t,n){return tp(t,(r,i)=>{e=ep(e,i,s=>r5(s,r,n))}),e}function o5(e,t){function n(r,i){const s=i5(e,Ao(i));r.map(Ao).forEach(o=>{e=ep(e,o,()=>s)})}if(Br(t)){const[r,i]=t;r.forEach(s=>{e=ep(e,Ao(s),()=>e)}),i&&Is(i,n)}else Is(t,n);return e}const u5=(e,t)=>hu(e)||Br(e)||mu(e)||yu(e)||S1(e,t);function a5(e,t,n){const r=n.get(e);r?r.push(t):n.set(e,[t])}function c5(e,t){const n={};let r;return e.forEach(i=>{if(i.length<=1)return;t||(i=i.map(u=>u.map(String)).sort((u,a)=>u.length-a.length));const[s,...o]=i;s.length===0?r=o.map(Mf):n[Mf(s)]=o.map(Mf)}),r?Zd(n)?[r]:[r,n]:Zd(n)?void 0:n}const A1=(e,t,n,r,i=[],s=[],o=new Map)=>{const u=GU(e);if(!u){a5(e,i,t);const d=o.get(e);if(d)return r?{transformedValue:null}:d}if(!u5(e,n)){const d=Gy(e,n),m=d?{transformedValue:d.value,annotations:[d.type]}:{transformedValue:e};return u||o.set(e,m),m}if($a(s,e))return{transformedValue:null};const a=Gy(e,n),c=(a==null?void 0:a.value)??e,l=Br(c)?[]:{},f={};Is(c,(d,m)=>{if(m==="__proto__"||m==="constructor"||m==="prototype")throw new Error(`Detected property ${m}. This is a prototype pollution risk, please remove it from your object.`);const y=A1(d,t,n,r,[...i,m],[...s,e],o);l[m]=y.transformedValue,Br(y.annotations)?f[m]=y.annotations:hu(y.annotations)&&Is(y.annotations,(b,g)=>{f[b1(m)+"."+g]=b})});const p=Zd(f)?{transformedValue:l,annotations:a?[a.type]:void 0}:{transformedValue:l,annotations:a?[a.type,f]:f};return u||o.set(e,p),p};function k1(e){return Object.prototype.toString.call(e).slice(8,-1)}function Xy(e){return k1(e)==="Array"}function l5(e){if(k1(e)!=="Object")return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function f5(e,t,n,r,i){const s={}.propertyIsEnumerable.call(r,t)?"enumerable":"nonenumerable";s==="enumerable"&&(e[t]=n),i&&s==="nonenumerable"&&Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0,configurable:!0})}function np(e,t={}){if(Xy(e))return e.map(i=>np(i,t));if(!l5(e))return e;const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertySymbols(e);return[...n,...r].reduce((i,s)=>{if(Xy(t.props)&&!t.props.includes(s))return i;const o=e[s],u=np(o,t);return f5(i,s,u,e,t.nonenumerable),i},{})}class ae{constructor({dedupe:t=!1}={}){this.classRegistry=new DU,this.symbolRegistry=new y1(n=>n.description??""),this.customTransformerRegistry=new UU,this.allowedErrorProps=[],this.dedupe=t}serialize(t){const n=new Map,r=A1(t,n,this,this.dedupe),i={json:r.transformedValue};r.annotations&&(i.meta={...i.meta,values:r.annotations});const s=c5(n,this.dedupe);return s&&(i.meta={...i.meta,referentialEqualities:s}),i}deserialize(t){const{json:n,meta:r}=t;let i=np(n);return r!=null&&r.values&&(i=s5(i,r.values,this)),r!=null&&r.referentialEqualities&&(i=o5(i,r.referentialEqualities)),i}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,n){this.classRegistry.register(t,n)}registerSymbol(t,n){this.symbolRegistry.register(t,n)}registerCustom(t,n){this.customTransformerRegistry.register({name:n,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}}ae.defaultInstance=new ae;ae.serialize=ae.defaultInstance.serialize.bind(ae.defaultInstance);ae.deserialize=ae.defaultInstance.deserialize.bind(ae.defaultInstance);ae.stringify=ae.defaultInstance.stringify.bind(ae.defaultInstance);ae.parse=ae.defaultInstance.parse.bind(ae.defaultInstance);ae.registerClass=ae.defaultInstance.registerClass.bind(ae.defaultInstance);ae.registerSymbol=ae.defaultInstance.registerSymbol.bind(ae.defaultInstance);ae.registerCustom=ae.defaultInstance.registerCustom.bind(ae.defaultInstance);ae.allowErrorProps=ae.defaultInstance.allowErrorProps.bind(ae.defaultInstance);const Nf=["error","warn","info","debug"];class Dh{constructor(t){I(this,"onLog");I(this,"logScope");I(this,"levelIndex");this.logScope=t.scope,this.onLog=t.onLog??(()=>{}),this.level=t.level??"info",this.levelIndex=Nf.indexOf(this.level)}set level(t){this.levelIndex=Nf.indexOf(t)}get level(){return Nf[this.levelIndex]}constructLogObj(t,n,...r){const i={args:r.map(ae.serialize),scope:this.logScope,message:n,timestamp:Date.now(),level:t};return this.onLog(i),i}scope(t){return new Dh({scope:t,onLog:this.onLog,level:this.level})}info(t,...n){const r=this.constructLogObj("info",t,...n);this.levelIndex<2||console.info(`%c${r.scope}`,"color: #888",t,n)}warn(t,...n){const r=this.constructLogObj("warn",t,...n);this.levelIndex<1||console.warn(r.scope,t,n)}error(t,...n){const r=n.length===1&&n[0]instanceof R?n[0].toJSON():n,i=this.constructLogObj("error",t,...n);console.error(i.scope,i.message,r)}debug(t,...n){const r=this.constructLogObj("debug",t,...n);if(!(this.levelIndex<3)){if(r.scope==="sync"){if(r.message==="sent"){console.debug("%c OUT ","background: #228; color: #51acff",n[0].type,n[0].payload);return}if(r.message==="received"){console.debug("%c IN ","background: #ccc; color: #333",n[0].type,n[0].payload);return}}console.debug(`%c${r.scope}`,"color: rgba(255,255,200,0.5)",r.message,n)}}}const Yr=!0;function Yy(e){const{syncStatus:t}=e;if(!t)return["cache","outbox"];switch(t){case"all":return["cache","outbox"];case"confirmed":return["cache"];case"pending":return["outbox"]}}function d5(e){if(typeof e=="object"&&("cache"in e||"outbox"in e)){if(!("cache"in e)||!("outbox"in e))throw new Error("Must define both outbox and client.");return e}if(e==="memory")return{cache:new oc,outbox:new oc};if(e==="indexeddb")return{cache:new qd("triplit-cache"),outbox:new qd("triplit-outbox")}}const p5="memory",h5={policy:"local-first"};class m5{constructor(t){I(this,"db");I(this,"syncEngine");I(this,"authOptions");I(this,"remote");I(this,"http");I(this,"defaultFetchOptions");I(this,"logger");I(this,"logs",[]);const{schema:n,token:r,claimsPath:i,serverUrl:s,syncSchema:o,transport:u,migrations:a,clientId:c,variables:l,storage:f,defaultQueryOptions:p,logger:d,logLevel:m="info"}=t??{};this.logger=d??new Dh({scope:"client",level:m,onLog:m==="debug"?x=>this.logs.push(x):()=>{}});const y=(t==null?void 0:t.autoConnect)??!0,b=new WB("cache",c);this.authOptions={token:r,claimsPath:i};const g=n?{collections:n,version:0}:void 0;this.db=new i1({clock:b,schema:g,migrations:a?{definitions:a,scopes:["cache"]}:void 0,variables:l,sources:d5(f??p5),logger:this.logger.scope("db")}),this.defaultFetchOptions={fetch:h5,...p};const v={syncSchema:o,transport:u,logger:this.logger.scope("sync"),...s?Zy(s):{}};if(this.http=this.remote=new FU({server:s,token:r,schemaFactory:async()=>{var x;return(x=await this.db.getSchema())==null?void 0:x.collections}}),this.db.onSchemaChange(x=>{this.http.updateOptions({schema:x==null?void 0:x.collections})}),this.authOptions.token){v.token=this.authOptions.token;const x=Ny(this.authOptions.token,this.authOptions.claimsPath);this.db=this.db.withSessionVars({SESSION_USER_ID:x})}this.syncEngine=new PU(this,v),this.db.ready.then(()=>{y&&this.syncEngine.connect()})}async getSchema(){return Rh(await this.db.getSchema())}async transact(t){this.logger.debug("transact START");const n=await this.db.transact(t,{skipRules:Yr,storeScope:{read:["outbox","cache"],write:["outbox"]}});return this.logger.debug("transact END",n),n}query(t){return RU(t)}async fetch(t,n){t=Ff(t);const r={...this.defaultFetchOptions.fetch,...n??{}};if(r.policy==="local-only")return this.fetchLocal(t,r);if(r.policy==="local-first"){const i=await this.fetchLocal(t,r);if(i.size>0)return i;try{await this.syncEngine.syncQuery(t)}catch(s){ma(s)}return this.fetchLocal(t,r)}if(r.policy==="remote-first"){try{await this.syncEngine.syncQuery(t)}catch(i){ma(i)}return this.fetchLocal(t,r)}if(r.policy==="remote-only")return this.syncEngine.fetchQuery(t);if(r.policy==="local-and-remote"){const i=r.timeout??0;return await Promise.race([this.syncEngine.syncQuery(t),new Promise(s=>setTimeout(s,i))]).catch(ma),this.fetchLocal(t,r)}throw new qB(r.policy)}async fetchLocal(t,n){const r=Yy(t);this.logger.debug("fetchLocal START",t,r);const i=await this.db.fetch(t,{scope:r,skipRules:Yr,...n??{}});return this.logger.debug("fetchLocal END",i),i}async fetchById(t,n,r){this.logger.debug("fetchById START",t,n,r);const i=this.query(t).id(n).build(),s=await this.fetchOne(i,r);return this.logger.debug("fetchById END",t,n,r),s}clear(t={}){return this.db.clear(t)}async fetchOne(t,n){t=Ff(t),t={...t,limit:1};const i=[...(await this.fetch(t,n)).values()][0];return i||null}async insert(t,n){this.logger.debug("insert START",t,n);const r=await this.db.insert(t,n,{skipRules:Yr,storeScope:{read:["outbox","cache"],write:["outbox"]}});return this.logger.debug("insert END",r),r}async update(t,n,r){this.logger.debug("update START",t,n);const i=await this.db.update(t,n,r,{skipRules:Yr,storeScope:{read:["outbox","cache"],write:["outbox"]}});return this.logger.debug("update END",i),i}async updateRaw(t,n,r){this.logger.debug("updateRaw START",t,n);const i=await this.db.transact(async s=>{await s.updateRaw(t,n,r)},{skipRules:!0,storeScope:{read:["outbox","cache"],write:["outbox"]}});return this.logger.debug("updateRaw END",i),i}async delete(t,n){this.logger.debug("delete START",t,n);const r=await this.db.delete(t,n,{skipRules:Yr,storeScope:{read:["outbox","cache"],write:["outbox"]}});return this.logger.debug("delete END",r),r}subscribe(t,n,r,i){let s=!1;const o={localOnly:!1,...i??{}};t=Ff(t);const u=Yy(t);if(this.logger.debug("subscribe start",t,u),o.localOnly)try{return this.db.subscribe(t,b=>n(b,{hasRemoteFulfilled:!1}),r,{scope:u,skipRules:Yr,...o})}catch(b){return r?r(b):ma(b),()=>{}}let a=()=>{},c=()=>{},l=!1,f=null,p;const d=n,m=r;n=(b,g)=>{s||d(b,g)},r=m?b=>{s||m(b)}:void 0;const y=b=>{p=b,this.logger.debug("subscribe RESULTS",p),n(p,{hasRemoteFulfilled:l})};if(a=this.db.subscribe(t,y,r,{scope:u,skipRules:Yr,...o}),u.includes("cache")){const b=()=>{l=!0,f!==null&&clearTimeout(f),f=setTimeout(()=>{var g;y(p),(g=o.onRemoteFulfilled)==null||g.call(o)},250)};c=this.syncEngine.subscribe(t,b)}return()=>{s=!0,a(),c()}}subscribeWithPagination(t,n,r,i){const s={},o=t.limit;let u=(f,p)=>{n(f,{...p,hasNextPage:!1,hasPreviousPage:!1})};s.nextPage=()=>{console.warn("There is no limit set on the query, so nextPage() is a no-op")},s.prevPage=()=>{console.warn("There is no limit set on the query, so prevPage() is a no-op")};let a,c,l="forward";return t.limit&&(t={...t},t.limit=o+1+(t.after?1:0),u=(f,p)=>{var U,K,ce;const d=(K=(U=t.order)==null?void 0:U[0])==null?void 0:K[0];if(!d)throw new R("No cursor attribute found in query order");let m=Array.from(f.entries());const y=m.at(0),b=!!t.after&&!!y&&hD(t.after[0],[y[1][d],y[0]])>-1,g=f.size>=t.limit,v=l==="reversed"?g:b,x=l==="forward"?g:b;m=m.slice(b?1:0,g?-1:void 0);const S=m.at(0),A=m.at(o-1);a=S?[S[1][d],S[0]]:void 0,c=A?[A[1][d],A[0]]:void 0,l==="reversed"&&(m=m.reverse()),!v&&t.after?((ce=s.unsubscribe)==null||ce.call(s),t={...t},t.after=void 0,t.limit=o+1,l==="reversed"&&(t.order=jf(t.order)),l="forward",s.unsubscribe=this.subscribe(t,u,r,i)):n(new Map(m),{...p,hasNextPage:x,hasPreviousPage:v})},s.nextPage=()=>{var f;(f=s.unsubscribe)==null||f.call(s),t={...t},l==="reversed"?(t.order=jf(t.order),t.after=a?[a,!0]:void 0):(t.after||(t.limit=t.limit+1),t.after=c?[c,!0]:void 0),l="forward",s.unsubscribe=this.subscribe(t,u,r,i)},s.prevPage=()=>{var f;(f=s.unsubscribe)==null||f.call(s),t={...t},l==="forward"?(t.order=jf(t.order),t.after=a?[a,!0]:void 0):t.after=c?[c,!0]:void 0,l="reversed",s.unsubscribe=this.subscribe(t,u,r,i)}),s.unsubscribe=this.subscribe(t,u,r,i),s}subscribeWithExpand(t,n,r,i){const s={};let o=(u,a)=>{n(u,{...a,hasMore:!1})};if(s.loadMore=()=>{console.warn("There is no limit set on the query, so loadMore is a no-op")},t.limit){const u=t.limit;t={...t},t.limit=t.limit+1,o=(a,c)=>{const l=a.size>=t.limit;let f=Array.from(a.entries());l&&(f=f.slice(0,-1)),n(new Map(f),{hasRemoteFulfilled:c.hasRemoteFulfilled,hasMore:l})},s.loadMore=a=>{var c;(c=s.unsubscribe)==null||c.call(s),t={...t},t.limit=(t.limit??1)+(a??u),s.unsubscribe=this.subscribe(t,o,r,i)}}return s.unsubscribe=this.subscribe(t,o,r,i),s}updateOptions(t){const{token:n,serverUrl:r}=t,i=t.hasOwnProperty("token"),s=t.hasOwnProperty("serverUrl");let o={};if(i){this.authOptions={...this.authOptions,token:n};const{claimsPath:u}=this.authOptions,a=n?Ny(n,u):void 0;this.db=this.db.withSessionVars({SESSION_USER_ID:a}),o={...o,token:n}}if(s){const{server:u,secure:a}=r?Zy(r):{server:void 0,secure:void 0};o={...o,server:u,secure:a}}(i||s)&&(this.syncEngine.updateConnection(o),this.http.updateOptions(o))}updateToken(t){this.updateOptions({token:t})}updateServerUrl(t){this.updateOptions({serverUrl:t})}onTxCommitRemote(...t){return this.syncEngine.onTxCommit(...t)}onTxFailureRemote(t,n){return this.syncEngine.onTxFailure(t,n)}onConnectionStatusChange(...t){return this.syncEngine.onConnectionStatusChange(...t)}connect(){return this.syncEngine.connect()}disconnect(){return this.syncEngine.disconnect()}get token(){return this.syncEngine.token}onSyncMessageReceived(...t){return this.syncEngine.onSyncMessageReceived(...t)}onSyncMessageSent(...t){return this.syncEngine.onSyncMessageSent(...t)}retry(...t){return this.syncEngine.retry(...t)}rollback(...t){return this.syncEngine.rollback(...t)}get connectionStatus(){return this.syncEngine.connectionStatus}isFirstTimeFetchingQuery(...t){return this.syncEngine.isFirstTimeFetchingQuery(...t)}}function Ff(e){return{id:Math.random().toString().slice(2),...e}}function Zy(e){const t=new URL(e),n=t.protocol==="https:";return{server:t.host,secure:n}}function ma(e){e instanceof R?console.warn(e.toJSON()):console.warn(e)}function jf(e){if(e)return e.map(t=>[t[0],t[1]==="ASC"?"DESC":"ASC"])}const y5={recipes:{schema:Y.Schema({id:Y.Id(),slug:Y.String(),title:Y.String(),cook_time:Y.Number(),prep_time:Y.Number(),serves:Y.Number(),author:Y.Optional(Y.String()),source:Y.Optional(Y.String()),ingredients:Y.Optional(Y.String()),method_steps:Y.Optional(Y.String()),tags:Y.Optional(Y.String()),shortlisted:Y.Optional(Y.Boolean())})},tag_options:{schema:Y.Schema({id:Y.Id(),name:Y.Optional(Y.String()),options:Y.Optional(Y.String())})},plan:{schema:Y.Schema({id:Y.Id(),date:Y.Number(),planned_meals:Y.Optional(Y.String())})}},Rn=new m5({storage:"indexeddb",schema:y5,serverUrl:"https://912d44e1-48a6-46b7-b6b9-7bc0fcd59a81.triplit.io",token:"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ4LXRyaXBsaXQtdG9rZW4tdHlwZSI6ImFub24iLCJ4LXRyaXBsaXQtcHJvamVjdC1pZCI6IjkxMmQ0NGUxLTQ4YTYtNDZiNy1iNmI5LTdiYzBmY2Q1OWE4MSIsImlhdCI6MTcyMTU2ODg2OX0.mLTejtnhczt5RxdYK1cnnNbeQ7vevO5z7oQD23MJA6AIfiyYS9S5F1il5PcCyLwJyObGomOJE9qIJbfwoHsBzs1QQEg3HOjgMBJAIRhbaWhOJn1BZZ8h2eaZWKpwBQuUpHi37-T0uTnABP7WUTZEFshHWEv5JlUYczehBvUFA8AulNjZDJJrJuEqHNgL3e0OaUZbstWArftiJpoR0htiZ7_HzFRHm5nivgsVO5zSBVeURM5Eygf67N6y6krLxK7jNHIjP0EbFu2DvC2nB9wrfjebChf-x6FRDFZpnMsrMuGn9-gWoyTapMjm-q4br1Sns7oIFbKKhJI1-9LzqifwYaflWrwLEroXvkoG9fJwJConmEPE9HWR20s_75wH7B7-g3ihgHP9I820qQ1WpWuVCF6xIIG3_RwDgt-T_b08HPMAQdo5H5fHxcxSeY-pSua1TUKFeDZjKNdtZhexWfHxAGJP9gKdS2sTY4pz43dRKvIahUGRsoQ5jOMv0jONsT2z8iMnXPsmOiyLZd36Ba6FKaltJBgpoM22GkdsMFd8OIYAa-ROjgKkF1ku2WX78V53AkdAEika26-zdNv3LAK1b40tebvt58imnmR2H2PPx62wAWgsXTTuMSVhm4dMDb1zeKGXOsQCHkNUw-DsgY-3bvj0-TMG8WPU3GPpvBIj_l8",logLevel:"debug"});typeof window<"u"&&(window.client=Rn);async function g5(){const e=Rn.query("recipes").build(),t=await Rn.fetch(e);return console.log("do_get_recipes result: ",t),t}async function w5(){const e=Rn.query("tag_options").build(),t=await Rn.fetch(e);return console.log("do_get_tagoptions result: ",t),t}async function b5(e){const t={...e.id!==""?{id:e.id}:{},slug:e.slug,title:e.title,cook_time:e.cook_time,prep_time:e.prep_time,serves:e.serves,...Object.hasOwn(e,"author")?{author:e.author}:{},...Object.hasOwn(e,"source")?{source:e.source}:{},tags:e.tags,ingredients:e.ingredients,method_steps:e.method_steps,...Object.hasOwn(e,"shortlisted")?{shortlisted:e.shortlisted}:{}};return console.log("do_save_recipe obj: ",t),await Rn.insert("recipes",t)}async function _5(e,t){console.log(Rn);const n=Rn.query("plan").where([["date",">=",e],["date","<=",t]]).build(),r=await Rn.fetch(n,{policy:"local-and-remote"});return console.log("do_get_plan result: ",r),r}async function v5(e){return await Rn.transact(async t=>{for(const n of e){console.log("do_save_plan day: ",{id:n.date.toString(),...n});const r=await t.insert("plan",{id:n.date.toString(),...n});console.log("do_save_plan result: ",r)}}),e}class P1 extends w{constructor(t){super(),this[0]=t}}class E1 extends w{constructor(t){super(),this[0]=t}}class x5 extends w{constructor(t){super(),this[0]=t}}class rp extends w{constructor(t){super(),this[0]=t}}let S5=class extends w{constructor(t,n,r){super(),this.recipes=t,this.tag_options=n,this.group_by=r}};class R1 extends w{constructor(t,n,r,i,s,o,u,a,c,l,f,p){super(),this.id=t,this.title=n,this.slug=r,this.cook_time=i,this.prep_time=s,this.serves=o,this.author=u,this.source=a,this.tags=c,this.ingredients=l,this.method_steps=f,this.shortlisted=p}}class O5 extends w{constructor(t,n,r){super(),this.id=t,this.name=n,this.options=r}}class ko extends w{constructor(t){super(),this.step_text=t}}class Yi extends w{constructor(t,n){super(),this.name=t,this.value=n}}class cc extends w{constructor(t,n,r,i){super(),this.name=t,this.ismain=n,this.quantity=r,this.units=i}}function $5(e,t){return t.withFields({recipes:(()=>{let n=t.recipes,r=V(n,o=>[o.id,o]),i=Ot(r),s=FS(i,Ot(h([[e.id,e]])));return ln(s)})()})}function T5(e){return bi(h([["name",sn(fe(e.name,""))],["quantity",sn(fe(e.quantity,""))],["units",sn(fe(e.units,""))],["ismain",sn(jg(fe(e.ismain,!1)))]]))}function I5(e){let n=rt(e),r=V(n,i=>[k(i[0]),T5(i[1])]);return bi(r)}function A5(e){return bi(h([["step_text",sn(e.step_text)]]))}function k5(e){let n=rt(e),r=V(n,i=>[k(i[0]),A5(i[1])]);return bi(r)}function P5(e){return bi(h([["name",sn(e.name)],["value",sn(e.value)]]))}function E5(e){let n=rt(e),r=V(n,i=>[k(i[0]),P5(i[1])]);return bi(r)}function R5(e){let t=r=>{let i=Le(r),s=J(i,o=>Dg(o,pp(Le)));return rT(s,iT)};return Mx((r,i,s)=>new O5(r,i,s),Rx("id",Le),Ye("name",Le),Ye("options",t))(e)}function ip(){return Ht(e=>{let t=w5(),n=on(t,vu),r=on(n,bc(Le,R5)),i=on(r,o=>J(o,ln)),s=on(i,o=>J(o,u=>new E1(u)));Pp(s,o=>J(o,e))})}function Ta(e){let t=r=>Ru(e,r);return Mu(et,r=>{let i=Dg(r,t);if(i.isOk()){let s=i[0];return dt(s)}else return Rp("Expected a json string")})}function M1(){return Mu(et,t=>dt(t==="True"||t==="true"?!0:t==="1"))}function Lh(){return Mu(et,t=>{let n=Vt(t);if(n.isOk()){let r=n[0];return dt(r)}else return Rp("Expected a stringed int")})}function M5(){let e=(()=>{let t=dt(s=>o=>u=>a=>new cc(s,o,u,a)),n=he(t,"name",kt(et)),r=he(n,"ismain",kt(M1())),i=he(r,"quantity",kt(et));return he(i,"units",kt(et))})();return Ep(Lh(),e)}function N5(){let e=(()=>{let t=dt(r=>i=>new Yi(r,i)),n=he(t,"name",et);return he(n,"value",et)})();return Ep(Lh(),e)}function F5(){let e=(()=>{let t=dt(n=>new ko(n));return he(t,"step_text",et)})();return Ep(Lh(),e)}function j5(e){let t=dt(m=>y=>b=>g=>v=>x=>S=>A=>U=>K=>ce=>le=>new R1(m,y,b,g,v,x,S,A,U,K,ce,le)),n=he(t,"id",kt(et)),r=he(n,"title",et),i=he(r,"slug",et),s=he(i,"cook_time",va),o=he(s,"prep_time",va),u=he(o,"serves",va),a=he(u,"author",kt(et)),c=he(a,"source",kt(et)),l=he(c,"tags",kt(Ta(N5()))),f=he(l,"ingredients",kt(Ta(M5()))),p=he(f,"method_steps",kt(Ta(F5()))),d=he(p,"shortlisted",kt(wT));return Ru(d,e)}function N1(){return Ht(e=>{let t=g5(),n=on(t,bc(Le,j5)),r=on(n,vu),i=on(r,o=>J(o,ln)),s=on(i,o=>J(o,u=>new P1(u)));Pp(s,o=>J(o,e))})}class Zu extends w{constructor(t,n){super(),this.date=t,this.planned_meals=n}}class C5 extends w{constructor(t,n){super(),this.date=t,this.planned_meals=n}}class F1 extends w{constructor(t,n,r){super(),this.for=t,this.title=n,this.complete=r}}class j1 extends w{constructor(t,n,r){super(),this[0]=t,this[1]=n,this[2]=r}}class C1 extends w{constructor(t,n,r){super(),this[0]=t,this[1]=n,this[2]=r}}class D5 extends w{constructor(t){super(),this[0]=t}}class Bh extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class D1 extends w{constructor(t){super(),this[0]=t}}class L1 extends w{}let lc=class extends w{constructor(t,n,r){super(),this.plan_week=t,this.recipe_list=n,this.start_date=r}};class so extends w{}class Uh extends w{}function L5(e,t,n,r){return CS(e,t,i=>new Zu(t,(()=>{if(i instanceof $){let s=i[0];if(r===""){let o=s.planned_meals;return ns(o,u=>!_e(u.for,n))}else{let o=s.planned_meals;return V(o,u=>_e(u.for,n)?u.withFields({title:new $(r)}):u)}}else return h([new F1(n,new $(r),new C)])})()))}function B5(e,t,n,r){return gr(e,t,i=>new Zu(t,(()=>{let s=i.planned_meals;return V(s,o=>_e(o.for,n)?o.withFields({complete:new $(r)}):o)})()))}function B1(e){let t=(()=>{let c=rt(e),l=V(c,f=>Vv(f,p=>br(p)));return Ot(l)})(),n=(()=>{let c=_t(t,new as),l=J(c,f=>wr(f.date));return se(l,"")})(),r=(()=>{let c=_t(t,new Tu),l=J(c,f=>wr(f.date));return se(l,"")})(),i=(()=>{let c=_t(t,new Iu),l=J(c,f=>wr(f.date));return se(l,"")})(),s=(()=>{let c=_t(t,new Au),l=J(c,f=>wr(f.date));return se(l,"")})(),o=(()=>{let c=_t(t,new ku),l=J(c,f=>wr(f.date));return se(l,"")})(),u=(()=>{let c=_t(t,new Pu),l=J(c,f=>wr(f.date));return se(l,"")})(),a=(()=>{let c=_t(t,new Ap),l=J(c,f=>wr(f.date));return se(l,"")})();return mt(h([D(h([_("subgrid-cols md:col-start-1 row-start-1 subgrid-rows col-span-full md:row-span-full md:col-span-1 sticky left-[-.25rem] top-[-.25rem] outline outline-1 outline-ecru-white-50 border  border-ecru-white-50 bg-ecru-white-50 min-h-full min-w-full")]),h([D(h([_("md:row-start-2 md:col-start-1 font-mono col-start-2 flex justify-center items-center border border-ecru-white-950 [box-shadow:1px_1px_0_#ff776a] sticky left-0 top-0 bg-ecru-white-50")]),h([_n(h([_("mx-2 ")]),h([E("Lunch")]))])),D(h([_("md:row-start-3 md:col-start-1 font-mono col-start-3 flex justify-center items-center border border-ecru-white-950  [box-shadow:1px_1px_0_#ff776a] sticky left-0 top-0 bg-ecru-white-50")]),h([_n(h([_("mx-2 ")]),h([E("Dinner")]))]))])),D(h([_("md:col-start-2 md:row-start-1 font-mono row-start-2 border border-ecru-white-950 flex justify-center items-center shadow-orange")]),h([_n(h([vt(h([["--shortMon","'Mon "+n+"'"],["--longMon","'Monday "+n+"'"]])),_("text-center  before:content-[var(--shortMon)] before:sm:content-[var(--longMon)]")]),h([]))])),D(h([_("md:col-start-3 md:row-start-1 font-mono row-start-3  border border-ecru-white-950   flex justify-center items-center [box-shadow:1px_1px_0_#ff776a]")]),h([_n(h([vt(h([["--shortTue","'Tue "+r+"'"],["--longTue","'Tuesday "+r+"'"]])),_("text-center  before:content-[var(--shortTue)] before:sm:content-[var(--longTue)]")]),h([]))])),D(h([_("md:col-start-4 md:row-start-1 font-mono row-start-4  border border-ecru-white-950   flex justify-center items-center [box-shadow:1px_1px_0_#ff776a]")]),h([_n(h([vt(h([["--shortWed","'Wed "+i+"'"],["--longWed","'Wednesday "+i+"'"]])),_("text-center  before:content-[var(--shortWed)] before:sm:content-[var(--longWed)]")]),h([]))])),D(h([_("md:col-start-5 md:row-start-1 font-mono row-start-5  border border-ecru-white-950   flex justify-center items-center [box-shadow:1px_1px_0_#ff776a]")]),h([_n(h([vt(h([["--shortThu","'Thu "+s+"'"],["--longThu","'Thursday "+s+"'"]])),_("text-center  before:content-[var(--shortThu)] before:sm:content-[var(--longThu)]")]),h([]))])),D(h([_("md:col-start-6 md:row-start-1 font-mono row-start-6  border border-ecru-white-950   flex justify-center items-center [box-shadow:1px_1px_0_#ff776a]")]),h([_n(h([vt(h([["--shortFri","'Fri "+o+"'"],["--longFri","'Friday "+o+"'"]])),_("text-center  before:content-[var(--shortFri)] before:sm:content-[var(--longFri)]")]),h([]))])),D(h([_("md:col-start-7 md:row-start-1 font-mono row-start-7  border border-ecru-white-950  flex justify-center items-center [box-shadow:1px_1px_0_#ff776a]")]),h([_n(h([vt(h([["--shortSat","'Sat "+u+"'"],["--longSat","'Saturday "+u+"'"]])),_("text-center  before:content-[var(--shortSat)] before:sm:content-[var(--longSat)]")]),h([]))])),D(h([_("md:col-start-8 md:row-start-1 font-mono row-start-8 border border-ecru-white-950   flex justify-center items-center [box-shadow:1px_1px_0_#ff776a]")]),h([_n(h([vt(h([["--shortSun","'Sun "+a+"'"],["--longSun","'Sunday "+a+"'"]])),_("text-center  before:content-[var(--shortSun)] before:sm:content-[var(--longSun)]")]),h([]))]))]))}function U5(e,t){let n=t.title,r=t.complete;return D(h([_("flex justify-center w-11/12 h-11/12 flex-col justify-between m-1 sm:m-2 overflow-hidden")]),h([_n(h([_("text-xl text-wrap"),vt(h([["text-decoration",is(fe(r,!1),"line-through",()=>"none")]]))]),h([E(fe(n,""))])),D(h([_("flex justify-end place-self-start sm:mx-2")]),h([Ut(h([$e("checkbox"),ww(i=>new C1(e,t.for,i)),Ug(fe(t.complete,!1))]))]))]))}function eg(e,t,n){let r=n instanceof so?"col-start-2 md:row-start-2":"col-start-3 md:row-start-3",i=is(_e(e.planned_meals,h([])),tr(),()=>{let s=ns(e.planned_meals,u=>_e(u.for,n)),o=V(s,u=>U5(e.date,u));return mt(o)});return D(h([_(`flex outline-1 outline-ecru-white-950 outline outline-offset-[-1px]
                row-start-[var(--dayPlacement)]
                md:col-start-[var(--dayPlacement)] 
                snap-start scroll-p-[-40px] `+r),vt(h([["--dayPlacement",k(t+2)]]))]),h([i]))}function z5(e){let t=Rc(e.start_date,new Eu),n=i=>se(_t(e.plan_week,i),new Zu(i,h([]))),r=Ot(h([[t,n(t)],[te(t,1,new pe),n(te(t,1,new pe))],[te(t,2,new pe),n(te(t,2,new pe))],[te(t,3,new pe),n(te(t,3,new pe))],[te(t,4,new pe),n(te(t,4,new pe))],[te(t,5,new pe),n(te(t,5,new pe))],[te(t,6,new pe),n(te(t,6,new pe))]]));return mt(h([ss(h([_("grid grid-cols-12 col-start-[main-start] grid-rows-[fit-content(65px)] gap-y-2")]),h([xi("Week of "+_w(t),"underline-orange"),Ms(h([_("flex flex-col justify-start items-middle col-span-1 col-start-12 text-base md:text-lg mt-4")]),h([Ue(h([Be("/"),_("text-center")]),h([E("ð ")])),Ue(h([Be("/planner/edit?date="+Hi(t)),_("text-center")]),h([E("âï¸")])),D(h([_("flex flex-row justify-evenly px-1")]),h([Ue(h([Be("/planner?date="+Hi(te(t,-1,new cs))),_("text-center")]),h([E("â¬ï¸")])),Ue(h([Be("/planner?date="+Hi(te(t,1,new cs))),_("text-center")]),h([E("â¡ï¸")]))]))]))])),ss(h([ye("active-week"),_(`mb-2 text-sm p-1 min-h-[70vh]
            overflow-x-hidden overflow-y-scroll md:overflow-x-scroll md:overflow-y-hidden snap-mandatory snap-always
            col-span-full row-start-2 grid gap-1 
            grid-cols-[minmax(0,15%)_minmax(0,45%)_minmax(0,45%)] grid-rows-[fit-content(10%)_repeat(7,20%)]
            snap-y scroll-pt-[9%]
            md:col-start-[full-start] md:col-end-[full-end]
            md:text-base md:grid-cols-[fit-content(10%)_repeat(7,_15vw)] md:grid-rows-[fit-content(20%)_minmax(20vh,1fr)_minmax(20vh,1fr)]
            md:snap-x md:scroll-pl-[9%] md:scroll-pt-0
            xl:grid-cols-[fit-content(10%)_repeat(7,_11.5vw)]`)]),h([B1(r),mt((()=>{let i=ln(r),s=Kt(i,(o,u)=>Bo(o.date,u.date));return di(s,(o,u)=>eg(o,u,new so))})()),mt((()=>{let i=ln(r),s=Kt(i,(o,u)=>Bo(o.date,u.date));return di(s,(o,u)=>eg(o,u,new Uh))})())]))]))}function Cf(e,t,n,r){return D(h([_("flex justify-center w-11/12 h-11/12 flex-col justify-between m-1 sm:m-2 overflow-hidden")]),h([aT(h([cT(r),lT(n),dn("typeahead-change",i=>{let s=i,o=Ye("detail",Le)(s);return J(o,u=>new j1(e,t,u))})]))]))}function tg(e,t,n,r){let i=n instanceof so?"col-start-2 md:row-start-2":"col-start-3 md:row-start-3",s=is(_e(e.planned_meals,h([])),Cf(e.date,n,"",r),()=>is(_e(ns(e.planned_meals,o=>_e(o.for,n)),h([])),Cf(e.date,n,"",r),()=>{let o=ns(e.planned_meals,a=>_e(a.for,n)),u=V(o,a=>Cf(e.date,n,fe(a.title,""),r));return mt(u)}));return D(h([_(`flex outline-1 outline-ecru-white-950 outline outline-offset-[-1px]
                row-start-[var(--dayPlacement)]
                md:col-start-[var(--dayPlacement)] 
                snap-start scroll-p-[-40px] `+i),vt(h([["--dayPlacement",k(t+2)]]))]),h([s]))}function W5(e){let t=Rc(e.start_date,new Eu),n=i=>se(_t(e.plan_week,i),new Zu(i,h([]))),r=Ot(h([[t,n(t)],[te(t,1,new pe),n(te(t,1,new pe))],[te(t,2,new pe),n(te(t,2,new pe))],[te(t,3,new pe),n(te(t,3,new pe))],[te(t,4,new pe),n(te(t,4,new pe))],[te(t,5,new pe),n(te(t,5,new pe))],[te(t,6,new pe),n(te(t,6,new pe))]]));return mt(h([ss(h([_("grid grid-cols-12 col-start-[main-start] grid-rows-[fit-content(65px)] gap-y-2")]),h([xi("Week of "+_w(t),"underline-orange"),Ms(h([_("flex flex-col justify-start items-middle col-span-1 col-start-12 text-base md:text-lg mt-4")]),h([Ue(h([Be("/"),_("text-center")]),h([E("ð ")])),D(h([_("flex flex-row justify-evenly px-1")]),h([Ue(h([Be("/planner?date="+Hi(t)),_("text-center")]),h([E("â")])),ar(h([$e("submit"),Z("form","active-week"),_("")]),h([E("ð¾")]))])),D(h([_("flex flex-row justify-evenly px-1")]),h([Ue(h([Be("/planner/edit?date="+Hi(te(t,-1,new cs))),_("text-center")]),h([E("â¬ï¸")])),Ue(h([Be("/planner/edit?date="+Hi(te(t,1,new cs))),_("text-center")]),h([E("â¡ï¸")]))]))]))])),Kg(h([ye("active-week"),_(`mb-2 text-sm p-1 min-h-[70vh]
            overflow-x-hidden overflow-y-scroll md:overflow-x-scroll md:overflow-y-hidden snap-mandatory snap-always  
            col-span-full row-start-2 grid gap-1 
            grid-cols-[minmax(0,15%)_minmax(0,45%)_minmax(0,45%)] grid-rows-[fit-content(10%)_repeat(7,20%)]
            snap-y scroll-pt-[9%]
            md:col-start-[full-start] md:col-end-[full-end]
            md:text-base md:grid-cols-[fit-content(10%)_repeat(7,_15vw)] md:grid-rows-[fit-content(20%)_minmax(20vh,1fr)_minmax(20vh,1fr)]
            md:snap-x md:scroll-pl-[9%] md:scroll-pt-0
            xl:grid-cols-[fit-content(10%)_repeat(7,_11.5vw)]`),bw(new L1)]),h([B1(r),mt((()=>{let i=ln(r),s=Kt(i,(o,u)=>Bo(o.date,u.date));return di(s,(o,u)=>tg(o,u,new so,e.recipe_list))})()),mt((()=>{let i=ln(r),s=Kt(i,(o,u)=>Bo(o.date,u.date));return di(s,(o,u)=>tg(o,u,new Uh,e.recipe_list))})())]))]))}function V5(e){let n=Le(e),r=J(n,Vt);return J(r,i=>fw(se(i,0)))}function q5(){let e=Mu(et,r=>r==="lunch"?dt(new so):r==="dinner"?dt(new Uh):Rp("PlannedMealWithStatus")),t=(()=>{let n=dt(s=>o=>u=>new F1(s,o,u)),r=he(n,"for",e),i=he(r,"title",kt(et));return he(i,"complete",kt(M1()))})();return bT(t)}function J5(e){let t=dt(i=>s=>new Zu(i,s)),n=he(t,"date",Mu(va,s=>dt(fw(s)))),r=he(n,"planned_meals",Ta(q5()));return Ru(r,e)}function U1(e){return Ht(t=>{let n=_5(Hf(e),Hf(te(e,1,new cs))),r=on(n,bc(V5,J5)),i=on(r,s=>J(s,o=>new Bh(o,e)));Pp(i,s=>J(s,t))})}function K5(e){return bi(h([["title",sn(fe(e.title,""))],["for",sn(e.for instanceof so?"lunch":"dinner")],["complete",sn(jg(fe(e.complete,!1)))]]))}function Q5(e){return lO(e,K5)}function H5(e){return new C5(Hf(e.date),ya(Q5(e.planned_meals)))}function ng(e){return Ht(t=>{v5(V(ln(e),H5));let n=(()=>{let s=kS(e),o=Kt(s,Bo);return fg(o)})(),r=se(n,_r()),i=new D1(r);return t(i)})}function G5(e,t){if(vu(t),t instanceof j1){let n=t[0],r=t[1],i=t[2],s=L5(e.plan_week,n,r,i);return[e.withFields({plan_week:s}),P()]}else if(t instanceof C1){let n=t[0],r=t[1],i=t[2],s=B5(e.plan_week,n,r,i);return[e.withFields({plan_week:s}),ng(s)]}else{if(t instanceof L1)return[e,ng(e.plan_week)];if(t instanceof D5){let n=t[0];return[e.withFields({start_date:n}),U1(n)]}else return t instanceof Bh?[e,P()]:[e,P()]}}function en(e,t){return t===""?e:j(t,e)}function X5(e){return Aa(e)!==e}function Y5(e,t,n,r){for(;;){let i=e,s=t,o=n,u=r;if(i.hasLength(0)&&o==="")return nt(u);if(i.hasLength(0))return nt(en(u,o));if(i.atLeastLength(1)&&i.head===`
`)e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head==="	")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head==="!")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head==="?")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head==="#")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head===".")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head==="-")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head==="_")e=i.tail,t=!1,n="",r=en(u,o);else if(i.atLeastLength(1)&&i.head===" ")e=i.tail,t=!1,n="",r=en(u,o);else{let a=i.head,c=i.tail,l=X5(a);l?l&&s?(e=c,t=s,n=o+a,r=u):(e=c,t=!0,n=a,r=en(u,o)):(e=c,t=!1,n=o+a,r=u)}}}function Z5(e){let n=vc(e);return Y5(n,!1,"",h([]))}function e4(e){let n=Z5(e),r=Ix(n,"-");return Aa(r)}class z1 extends w{constructor(t){super(),this[0]=t}}class W1 extends w{constructor(t){super(),this[0]=t}}class V1 extends w{constructor(t){super(),this[0]=t}}class q1 extends w{constructor(t){super(),this[0]=t}}class J1 extends w{constructor(t){super(),this[0]=t}}class K1 extends w{constructor(t){super(),this[0]=t}}class Q1 extends w{constructor(t){super(),this[0]=t}}class H1 extends w{constructor(t){super(),this[0]=t}}class G1 extends w{constructor(t){super(),this[0]=t}}class X1 extends w{constructor(t){super(),this[0]=t}}class Y1 extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class Z1 extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class ev extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class tv extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class nv extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class rv extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class iv extends w{constructor(t){super(),this[0]=t}}class sv extends w{constructor(t){super(),this[0]=t}}class ov extends w{constructor(t,n){super(),this[0]=t,this[1]=n}}class uv extends w{constructor(t){super(),this[0]=t}}class av extends w{constructor(t){super(),this[0]=t}}class cv extends w{constructor(t){super(),this[0]=t}}class lv extends w{constructor(t){super(),this[0]=t}}class t4 extends w{constructor(t,n,r,i,s,o,u,a,c,l,f,p){super(),this.id=t,this.title=n,this.slug=r,this.cook_time=i,this.prep_time=s,this.serves=o,this.author=u,this.source=a,this.tags=c,this.ingredients=l,this.method_steps=f,this.shortlisted=p}}function n4(e){let t=new t4(fe(e.id,""),e.title,e.slug,e.cook_time,e.prep_time,e.serves,fe(e.author,""),fe(e.source,""),(()=>{let n=e.tags,r=sf(n,E5);return ya(r)})(),(()=>{let n=e.ingredients,r=sf(n,I5);return ya(r)})(),(()=>{let n=e.method_steps,r=sf(n,k5);return ya(r)})(),fe(e.shortlisted,!1));return Ht(n=>{b5(t);let r=new lv(e);return n(r)})}function r4(e,t){if(t instanceof z1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({title:n})),P()]}else return[e,P()]}else if(t instanceof W1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({author:new $(n)})),P()]}else return[e,P()]}else if(t instanceof V1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({source:new $(n)})),P()]}else return[e,P()]}else if(t instanceof q1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({prep_time:(()=>{let s=Vt(n),o=J(s,u=>u*60+Et(r.prep_time,60));return se(o,0)})()})),P()]}else return[e,P()]}else if(t instanceof J1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({prep_time:(()=>{let s=Vt(n),o=J(s,u=>r.prep_time-Et(r.prep_time,60)+u);return se(o,0)})()})),P()]}else return[e,P()]}else if(t instanceof K1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({cook_time:(()=>{let s=Vt(n),o=J(s,u=>u*60+Et(r.cook_time,60));return se(o,0)})()})),P()]}else return[e,P()]}else if(t instanceof Q1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({cook_time:(()=>{let s=Vt(n),o=J(s,u=>r.cook_time-Et(r.cook_time,60)+u);return se(o,0)})()})),P()]}else return[e,P()]}else if(t instanceof H1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({serves:(()=>{let s=Vt(n);return se(s,0)})()})),P()]}else return[e,P()]}else if(t instanceof Y1){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({tags:(()=>{let s=i.tags;return Pe(s,o=>gr(o,n,u=>new Yi(r,"")))})()})),P()]}else return[e,P()]}else if(t instanceof Z1){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({tags:(()=>{let s=i.tags;return Pe(s,o=>gr(o,n,u=>u.withFields({value:r})))})()})),P()]}else return[e,P()]}else if(t instanceof G1)if(e instanceof $){let n=e[0];return[new $(n.withFields({tags:(()=>{let r=n.tags;if(r instanceof $){let i=r[0];return new $(Qt(i,nf(i),new Yi("","")))}else return new $(Ot(h([[0,new Yi("","")]])))})()})),P()]}else return[e,P()];else if(t instanceof X1){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({tags:(()=>{let i=r.tags,s=Pe(i,o=>rf(o,h([n])));return Pe(s,af)})()})),P()]}else return[e,P()]}else if(t instanceof ev){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({ingredients:(()=>{let s=i.ingredients;return Pe(s,o=>gr(o,n,u=>u.withFields({name:new $(r)})))})()})),P()]}else return[e,P()]}else if(t instanceof tv){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({ingredients:(()=>{let s=i.ingredients;return Pe(s,o=>gr(o,n,u=>u.withFields({ismain:new $(r)})))})()})),P()]}else return[e,P()]}else if(t instanceof nv){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({ingredients:(()=>{let s=i.ingredients;return Pe(s,o=>gr(o,n,u=>u.withFields({quantity:new $(r)})))})()})),P()]}else return[e,P()]}else if(t instanceof rv){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({ingredients:(()=>{let s=i.ingredients;return Pe(s,o=>gr(o,n,u=>u.withFields({units:new $(r)})))})()})),P()]}else return[e,P()]}else if(t instanceof iv)if(e instanceof $){let n=e[0];return[new $(n.withFields({ingredients:(()=>{let r=n.ingredients;if(r instanceof $){let i=r[0];return new $(Qt(i,nf(i),new cc(new C,new C,new C,new C)))}else return new $(Ot(h([[0,new cc(new C,new C,new C,new C)]])))})()})),P()]}else return[e,P()];else if(t instanceof sv){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({ingredients:(()=>{let i=r.ingredients,s=Pe(i,o=>rf(o,h([n])));return Pe(s,af)})()})),P()]}else return[e,P()]}else if(t instanceof uv)if(e instanceof $){let n=e[0];return[new $(n.withFields({method_steps:(()=>{let r=n.method_steps;if(r instanceof $){let i=r[0];return new $(Qt(i,nf(i),new ko("")))}else return new $(Ot(h([[0,new ko("")]])))})()})),P()]}else return[e,P()];else if(t instanceof av){let n=t[0];if(e instanceof $){let r=e[0];return[new $(r.withFields({method_steps:(()=>{let i=r.method_steps,s=Pe(i,o=>rf(o,h([n])));return Pe(s,af)})()})),P()]}else return[e,P()]}else if(t instanceof ov){let n=t[0],r=t[1];if(e instanceof $){let i=e[0];return[new $(i.withFields({method_steps:(()=>{let s=i.method_steps;return Pe(s,o=>gr(o,n,u=>new ko(r)))})()})),P()]}else return[e,P()]}else if(t instanceof cv){let n=t[0];return[new $(n),n4(n.withFields({slug:e4(n.title)}))]}else{let n=t[0];return[new $(n),P()]}}function i4(e,t){if(t instanceof P1){let n=t[0];return[e.withFields({recipes:n}),P()]}else if(t instanceof E1){let n=t[0];return[e.withFields({tag_options:n}),P()]}else{let n=t[0],r=e.group_by;return r instanceof $&&r[0]instanceof rp&&r[0][0]===n?(r[0][0],[e.withFields({group_by:new C}),P()]):[e.withFields({group_by:new $(new rp(n))}),P()]}}function s4(e){let t=(()=>{let n=e.recipes,r=V(n,i=>{let s=i.tags;if(s instanceof $){let o=s[0];return V(ln(o),u=>u.name)}else return h([])});return Lf(r)})();return(()=>{let n=e.recipes,r=V(n,i=>{let s=i.author;if(s instanceof $){let o=s[0];return h([o])}else return h([])});return Lf(r)})(),V(t,n=>ar(h([_("font-mono bg-ecru-white-100 border border-ecru-white-950 px-1 text-xs"),Nr(new x5(n))]),h([E(n)])))}function fv(e,t){return D(h([_("col-span-full  text-xl flex flex-wrap items-baseline justify-start"),_(t)]),h([de("hr",h([_("w-[1ch] mr-2 self-center")]),h([])),Ue(h([Be(Tx("/recipes/",e.slug))]),h([xt(h([]),h([E(e.title)])),xt(h([_("text-sm")]),h([E(" â¢ "),e.prep_time+e.cook_time>59?E((()=>{let r=Mo(e.prep_time+e.cook_time,60),i=se(r,0);return k(i)})()+"h"):tr(),E((()=>{let n=Et(e.prep_time+e.cook_time,60);return k(n)})()),E("m")]))]))]))}function o4(e,t){let r=rx(e,s=>{let o=s.tags;if(o instanceof $){let u=o[0],a=ns(ln(u),f=>f.name===t),c=V(a,f=>f.value),l=fg(c);return se(l,"")}else return""}),i=US(r,(s,o)=>DO(h([_("contents")]),h([LO(h([_("col-start-1 col-span-full flex gap-2  text-base cursor-pointer marker:content-none")]),h([E("ð"),xt(h([_("font-mono")]),h([E(s)])),de("hr",h([_("flex-grow mx-2 self-center")]),h([]))])),mt(V(o,u=>fv(u,"ml-2 text-lg")))])));return ln(i)}function u4(e){return ss(h([_("grid grid-cols-12 col-start-[main-start] grid-rows-[fit-content(100px)_fit-content(100px)_fit-content(100px)_fit-content(100px)_fit-content(100px)_fit-content(100px)_1fr] gap-y-2")]),h([xi("Recipe List","underline-green"),Ms(h([_("flex flex-col justify-start items-middle col-span-1 col-start-12 text-base md:text-lg mt-4")]),h([Ue(h([Be("/"),_("text-center")]),h([E("ð ")]))])),D(h([_("col-span-full flex flex-wrap items-center justify-start gap-3")]),s4(e)),(()=>{let t=e.group_by;if(t instanceof $&&t[0]instanceof rp){let n=t[0][0];return mt(o4(e.recipes,n))}else return mt(V(e.recipes,n=>fv(n,"")))})()]))}function a4(e){let t=(()=>{let n=e.ismain;return n instanceof $&&n[0]?" font-bold":""})();return D(h([_("flex justify-start col-span-6 items-baseline")]),h([D(h([_("flex-grow-[2] text-left flex justify-start"+t)]),h([fe(Pe(e.name,n=>E(n)),tr())])),D(h([_("col-span-1 text-sm")]),h([fe(Pe(e.quantity,n=>E(n)),tr())])),D(h([_("col-span-1 text-sm")]),h([fe(Pe(e.units,n=>E(n)),tr())]))]))}function c4(e){return Jg(h([_("w-full justify-self-start list-decimal text-left ml-8 pr-2 mb-2")]),h([E(e.step_text)]))}function l4(e){return D(h([_("flex")]),h([D(h([_("font-mono bg-ecru-white-100 border border-ecru-white-950 px-1 text-xs")]),h([E(e.name)])),D(h([_("font-mono bg-ecru-white-50 border border-l-0 border-ecru-white-950  px-1 text-xs")]),h([E(e.value)]))]))}function f4(e){return ss(h([_("grid grid-cols-12 col-start-[main-start] grid-rows-[fit-content(100px)_fit-content(100px)_fit-content(100px)_1fr] gap-y-2")]),h([xi(e.title,"underline-green"),Ms(h([_("flex flex-col justify-start items-middle col-span-1 col-start-12 row-span-2 text-base md:text-lg mt-4")]),h([Ue(h([Be("/"),_("text-center")]),h([E("ð ")])),Ue(h([Be("/recipes/"+e.slug+"/edit"),_("text-center")]),h([E("âï¸")]))])),Ce(h([_("flex gap-1 items-baseline col-span-11 row-start-2 row-span-1")]),Lf(h([(()=>{let t=e.author;if(t instanceof $){let n=t[0];return h([xt(h([_("text-sm")]),h([E("ð§¾")])),xt(h([_("text-base"),cn(n)>19?_("w-["+k(cn(n))+"]"):_("w-[19ch]")]),h([E(n)]))])}else return h([])})(),(()=>{let t=e.source;if(t instanceof $){let n=t[0];return h([xt(h([_("text-sm")]),h([E("ð")])),xt(h([_("text-base")]),h([E(n)]))])}else return h([])})()]))),Ce(h([_("flex flex-row row-start-3 gap-2 col-span-full sm:row-start-3 sm:col-span-5 sm:col-start-1")]),h([Ce(h([_("flex flex-wrap justify-start items-baseline")]),h([On(h([Sr("prep_time"),_("font-mono ")]),h([E("Prep:")])),D(h([_("text-base ml-2")]),h([E((e.prep_time>59?(()=>{let n=Mo(e.prep_time,60),r=se(n,0),i=k(r);return Ia(i,"0","")})()+"h ":"")+(()=>{let t=Et(e.prep_time,60);return k(t)})()+"m")]))])),Ce(h([_("flex flex-wrap justify-start items-baseline")]),h([On(h([Sr("cook_time"),_("font-mono ")]),h([E("Cook:")])),D(h([_("text-base ml-2")]),h([E((e.cook_time>59?(()=>{let n=Mo(e.cook_time,60),r=se(n,0),i=k(r);return Ia(i,"0","")})()+"h ":"")+(()=>{let t=Et(e.cook_time,60);return k(t)})()+"m")]))])),Ce(h([_("flex flex-wrap justify-start items-baseline")]),h([On(h([Sr("cook_time"),_("font-mono ")]),h([E("Serves:")])),D(h([_("mr-2 sm:mr-4 ml-2 text-base")]),h([E(k(e.serves))]))]))])),Ce(h([_("sm:ml-1 col-span-full row-start-4 sm:row-start-3 content-start sm:col-start-6 sm:col-span-7 sm:mt-2 flex flex-wrap gap-1 items-baseline gap-3")]),h([(()=>{let t=e.tags;if(t instanceof $){let n=t[0],r=(()=>{let s=rt(n),o=Kt(s,(u,a)=>Ar(me(u),me(a)));return V(o,u=>[k(me(u)),l4(oi(u))])})();return Qi(i=>D(h([_("contents")]),i),r)}else return tr()})()])),Ce(h([_("col-span-full text-base my-1 pt-1 pb-2 px-2 border-ecru-white-950 border-[1px] rounded-[1px] sm:row-span-2 sm:col-span-5 [box-shadow:1px_1px_0_#a3d2ab] mr-1")]),h([Ma(h([_("mx-2 px-1 text-lg font-mono ")]),h([E("Ingredients")])),(()=>{let t=e.ingredients;if(t instanceof $){let n=t[0],r=(()=>{let s=rt(n),o=Kt(s,(u,a)=>Ar(me(u),me(a)));return V(o,u=>[k(me(u)),a4(oi(u))])})();return Qi(i=>D(h([_("contents")]),i),r)}else return tr()})()])),Ce(h([_("flex justify-start flex-wrap col-span-full my-1 pt-1 mr-1 sm:mr-2 ml-1 pb-2 px-2 border-ecru-white-950 border-[1px] rounded-[1px] sm:row-span-2 sm:col-span-7 [box-shadow:1px_1px_0_#a3d2ab]")]),h([Ma(h([_("mx-2 px-1 font-mono ")]),h([E("Method")])),jO(h([_("flex flex-wrap w-full mb-1 list-decimal marker:text-sm marker:font-mono text-base items-baseline col-span-full")]),h([(()=>{let t=e.method_steps;if(t instanceof $){let n=t[0],r=(()=>{let s=rt(n),o=Kt(s,(u,a)=>Ar(me(u),me(a)));return V(o,u=>[k(me(u)),c4(oi(u))])})();return Qi(i=>D(h([_("contents")]),i),r)}else return tr()})()]))]))]))}function d4(e){if(e instanceof $){let t=e[0];return f4(t)}else return xi("Recipe not found","")}function rg(e,t,n){let r=Zr((u,a)=>new Y1(u,a)),i=Zr((u,a)=>new Z1(u,a)),s=V(e,u=>u.name),o=fe(n,new Yi("",""));return Ce(h([ye("tag-input-"+k(t)),_("flex col-span-6 sm:col-span-4 min-w-0")]),h([am(h([vt(h([(()=>{let u=cn(o.name);return u>0?["width",k(u+1)+"ch"]:["width","5ch"]})()])),_("inline bg-ecru-white-100 col-span-4 row-span-1 pl-1 p-0 text-xs font-mono custom-select"),ye("tag-name-selector"),ct("tag-name-"+k(t)),De(o.name),lt(r(t))]),h([ia(h([_("text-xs font-mono custom-select input-focus bg-ecru-white-100"),Z("hidden",""),sm(!0),De(""),ra(Xh(o.name))]),""),mt(V(s,u=>ia(h([De(u),ra(u===o.name),_("text-xs font-mono custom-select input-focus bg-ecru-white-50")]),u)))])),am(h([vt(h([(()=>{let u=cn(o.value);return u>0?["width",k(u+1)+"ch"]:["width","5ch"]})()])),_("inline bg-ecru-white-50 col-span-4 row-span-1 pl-1 p-0 text-xs font-mono custom-select"),lt(i(t)),De(o.value)]),h([ia(h([_("text-xs font-mono custom-select input-focus bg-ecru-white-50"),Z("hidden",""),sm(!0),De(""),ra(Xh(o.value))]),""),(()=>{let u=p=>p.name===o.name,a=p=>V(p.options,d=>ia(h([De(d),ra(d===o.value),_("text-xs font-mono custom-select input-focus bg-ecru-white-50")]),d)),c=mg(e,u),l=J(c,a),f=se(l,h([tr()]));return mt(f)})()])),ar(h([_("col-span-1 mb-1 text-ecru-white-950 text-xs"),ye("remove-tag-input"),$e("button"),Nr(new X1(t))]),h([E("â")])),ar(h([_("col-span-1 mb-1 text-ecru-white-950 text-xs"),ye("add-tag-input"),$e("button"),Nr(new G1(t))]),h([E("â")]))]))}function Df(e,t){let n=Zr((o,u)=>new ev(o,u)),r=Zr((o,u)=>new tv(o,u)),i=Zr((o,u)=>new nv(o,u)),s=Zr((o,u)=>new rv(o,u));return D(h([_("my-0.5 w-full flex justify-between items-baseline  text-base")]),h([Ut(h([Z("aria-label","Enter ingredient name"),ct("ingredient-name-"+k(e)),$e("text"),of("Ingredient"),_("w-[16ch] xxs:w-[23ch] xs:w-[28ch] sm:w-[16ch] md:w-[23ch] lg:w-[28ch] text-base input-base input-focus bg-ecru-white-100"),De((()=>{if(t instanceof $){let o=t[0];return fe(o.name,"")}else return""})()),lt(n(e))])),D(h([_("flex justify-end gap-1 items-baseline")]),h([Ut(h([Z("aria-label","Enter ingredient quanitity"),ct("ingredient-qty-"+k(e)),$e("text"),of("Qty"),_("pt-0.5 w-[4ch] text-sm input-focus bg-ecru-white-100"),De((()=>{if(t instanceof $){let o=t[0];return fe(o.quantity,"")}else return""})()),lt(i(e))])),Ut(h([Z("aria-label","Enter ingredient units"),ct("ingredient-units-"+k(e)),$e("text"),of("Units"),_("pt-0.5 w-[5ch] text-sm mr-0 input-focus bg-ecru-white-100"),De((()=>{if(t instanceof $){let o=t[0];return fe(o.units,"")}else return""})()),lt(s(e))])),D(h([_("flex text-xs items-baseline")]),h([On(h([_("ingredient-toggle"),Z("aria-label","Toggle main ingredient")]),h([Ut(h([Ug((()=>{if(t instanceof $){let o=t[0];return fe(o.ismain,!1)}else return!1})()),ct("`ingredient-main-"+k(e)),$e("checkbox"),ww(r(e))])),xt(h([]),h([]))])),ar(h([_("text-ecru-white-950"),$e("button"),ye("remove-ingredient-input"),Nr(new sv(e))]),h([E("â")])),ar(h([_("text-ecru-white-950"),$e("button"),ye("add-ingredient-input"),Nr(new iv(e))]),h([E("â")]))]))]))]))}function p4(e,t){let n=Zr((r,i)=>new ov(r,i));return D(h([_("flex w-full items-baseline col-span-full px-1 mb-1 text-base")]),h([On(h([_("font-mono text-sm")]),h([E((()=>{let r=e+1;return k(r)})()+".")])),Op(h([ct("method-step-"+k(e)),ye("method-step-"+k(e)),_("mx-3 bg-ecru-white-100 w-full input-focus text-base resize-none"),Z("rows","3"),lt(n(e))]),t instanceof $?t[0].step_text:""),ar(h([_("text-ecru-white-950 text-xs"),$e("button"),ye("remove-ingredient-input"),Nr(new av(e))]),h([E("â")])),ar(h([_("text-ecru-white-950 text-xs"),$e("button"),ye("add-ingredient-input"),Nr(new uv(e))]),h([E("â")]))]))}function dv(e,t){return Kg(h([_("grid grid-cols-12 col-start-[main-start] grid-rows-[fit-content(100px)_fit-content(100px)_fit-content(100px)_1fr] gap-y-2"),ye("create_recipe_form"),bw(new cv(e))]),h([Op(h([ye("page-title-input"),ct("title"),_("[field-sizing:_content;] mt-4 mr-2 col-start-1 col-span-11 placeholder:underline-blue underline-blue min-h-[56px] max-h-[140px] overflow-x-hidden overflow-y-hidden px-0 pb-2 input-base w-full input-focus font-transitional resize-none font-bold italic text-ecru-white-950 text-7xl bg-ecru-white-100"),_((()=>{let n=cn(e.title);return n>38?"text-4xl":n>17?"text-5.5xl":"text-7xl"})()),Z("title","recipe title"),lt(n=>new z1(n))]),e.title),Ms(h([_("flex flex-col justify-start items-middle col-span-1 col-start-12 row-span-2 text-base md:text-lg mt-4")]),h([Ue(h([Be("/"),_("text-center")]),h([E("ð ")])),Ue(h([Be("/recipes/"+e.slug),_("text-center")]),h([E("â")])),ar(h([$e("submit"),_("")]),h([E("ð¾")]))])),Ce(h([_("flex gap-1 items-baseline col-span-11 row-start-2 row-span-1")]),h([D(h([_("justify-self-start")]),h([On(h([_("justify-self-start font-mono text-sm"),Sr("author")]),h([E("ð§¾")])),Ut(h([ye("author"),_("bg-ecru-white-100 input-base input-focus pr-0.5 w-[20ch] text-left text-base"),$e("text"),ct("author"),Z("title","author"),De((()=>{let n=e.author;return fe(n,"")})()),lt(n=>new W1(n))]))])),D(h([_("justify-self-start")]),h([On(h([_("justify-self-start font-mono text-sm"),Sr("author")]),h([E("ð")])),Ut(h([ye("source"),_("bg-ecru-white-100 input-base input-focus pr-0.5 w-[20ch] text-left text-base"),$e("text"),ct("source"),Z("title","source"),De((()=>{let n=e.source;return fe(n,"")})()),lt(n=>new V1(n))]))]))])),Ce(h([_("flex flex-row row-start-3 gap-2 col-span-full sm:row-start-3 sm:col-span-5 sm:col-start-1")]),h([Ce(h([_("flex flex-wrap justify-between items-baseline")]),h([On(h([_("justify-self-start font-mono "),Sr("prep_time")]),h([E("Prep:")])),D(h([_("justify-self-start")]),h([D(h([_("after:content-['h'] after:text-base inline-block")]),h([Ut(h([ye("prep_time_hrs"),_("bg-ecru-white-100 input-base input-focus pr-0.5 mr-0.5 w-[2ch] text-right text-base"),$e("number"),ct("prep_time_hrs"),Z("title","prep time in hours"),De((()=>{let n=Mo(e.prep_time,60),r=se(n,0),i=k(r);return Ia(i,"0","")})()),lt(n=>new q1(n))]))])),D(h([_("after:content-['m'] after:text-base inline-block")]),h([Ut(h([ye("prep_time_mins"),_("bg-ecru-white-100 input-base input-focus pr-0.5 mr-0.5 w-[3ch] text-right text-base"),$e("number"),ct("prep_time_mins"),Z("title","prep time in minutes"),De((()=>{let n=Et(e.prep_time,60);return k(n)})()),lt(n=>new J1(n))]))]))]))])),Ce(h([_("flex flex-wrap justify-between items-baseline")]),h([On(h([_("justify-self-start font-mono "),Sr("prep_time")]),h([E("Cook:")])),D(h([_("justify-self-start")]),h([D(h([_("after:content-['h'] after:text-base inline-block")]),h([Ut(h([ye("cook_time_hrs"),_("bg-ecru-white-100 input-base input-focus pr-0.5 w-[2ch] text-right text-base"),$e("number"),ct("cook_time_hrs"),Z("title","cook time in hours"),De((()=>{let n=Mo(e.cook_time,60),r=se(n,0),i=k(r);return Ia(i,"0","")})()),lt(n=>new K1(n))]))])),D(h([_("after:content-['m'] after:text-base inline-block")]),h([Ut(h([ye("cook_time_mins"),_("bg-ecru-white-100 input-base input-focus pr-0.5 w-[3ch] text-right text-base"),$e("number"),ct("cook_time_mins"),Z("title","cook time in minutes"),De((()=>{let n=Et(e.cook_time,60);return k(n)})()),lt(n=>new Q1(n))]))]))]))])),Ce(h([_("flex flex-wrap justify-between items-baseline")]),h([On(h([_("justify-self-start font-mono "),Sr("serves")]),h([E("Serves:")])),Ut(h([ye("serves"),_("pr-0.5 mr-2 sm:mr-4  justify-self-start col-span-3 input-base input-focus w-[3ch] text-right text-base bg-ecru-white-100"),$e("number"),ct("serves"),De((()=>{let n=e.serves;return k(n)})()),lt(n=>new H1(n))]))]))])),Ce(h([_("sm:ml-1 col-span-full row-start-4 sm:row-start-3 content-start sm:col-start-6 sm:col-span-7 sm:mt-2 flex flex-wrap gap-1 items-baseline gap-3")]),h([(()=>{let n=e.tags;if(n instanceof $){let r=n[0],i=(()=>{let o=rt(r),u=Kt(o,(a,c)=>Ar(me(a),me(c)));return V(u,a=>[k(me(a)),rg(t,me(a),new $(oi(a)))])})();return Qi(s=>D(h([_("contents")]),s),i)}else return rg(t,0,new C)})()])),Ce(h([_("col-span-full my-1 mb-6 pt-1 pb-2 px-2 mr-1 border-ecru-white-950 border-[1px] rounded-[1px] sm:row-span-2 sm:col-span-5 [box-shadow:1px_1px_0_#9edef1]")]),h([Ma(h([_("mx-2 px-1 font-mono ")]),h([E("Ingredients")])),(()=>{let n=e.ingredients;if(n instanceof $){let r=n[0],i=(()=>{let o=rt(r),u=Kt(o,(a,c)=>Ar(me(a),me(c)));return V(u,a=>[k(me(a)),Df(me(a),new $(oi(a)))])})();return Qi(s=>D(h([_("contents")]),s),i)}else return Df(0,new C)})()])),Ce(h([_("col-span-full my-1 mb-6 pt-1 pb-2 px-2 ml-1 mr-1 border-ecru-white-950 border-[1px] rounded-[1px] sm:row-span-2 sm:col-span-7 [box-shadow:1px_1px_0_#9edef1]")]),h([Ma(h([_("mx-2 px-1 font-mono ")]),h([E("Method")])),(()=>{let n=e.method_steps;if(n instanceof $){let r=n[0],i=(()=>{let o=rt(r),u=Kt(o,(a,c)=>Ar(me(a),me(c)));return V(u,a=>[k(me(a)),p4(me(a),new $(oi(a)))])})();return Qi(s=>D(h([_("contents")]),s),i)}else return Df(0,new C)})()]))]))}function h4(e,t){if(e instanceof $){let n=e[0];return dv(n,t)}else return xi("Recipe not found","")}class m4 extends w{constructor(t,n,r,i){super(),this.current_route=t,this.current_recipe=n,this.recipes=r,this.planner=i}}class fc extends w{}class Po extends w{constructor(t){super(),this.slug=t}}class Sn extends w{constructor(t){super(),this[0]=t}}class dc extends w{}class ni extends w{constructor(t){super(),this.start_date=t}}class Ji extends w{constructor(t){super(),this.start_date=t}}class ri extends w{constructor(t){super(),this.slug=t}}class sp extends w{constructor(t){super(),this.recipe=t}}class we extends w{constructor(t){super(),this[0]=t}}class Zi extends w{constructor(t){super(),this[0]=t}}class Or extends w{constructor(t){super(),this[0]=t}}class Ki extends w{constructor(t){super(),this[0]=t}}function ig(e,t){return op(mg(e.recipes.recipes,n=>n.slug===t))}function y4(e,t){if(vu(t),t instanceof we&&t[0]instanceof dc)return[e.withFields({current_route:new dc}),Lg(h([Wn(N1(),n=>new Or(n)),Wn(ip(),n=>new Or(n))]))];if(t instanceof we&&t[0]instanceof Po){let n=t[0].slug;return[e.withFields({current_route:new Po(n),current_recipe:ig(e,n)}),P()]}else{if(t instanceof we&&t[0]instanceof Sn&&t[0][0]instanceof ri&&t[0][0].slug==="")return[e.withFields({current_route:new Sn(new ri("")),current_recipe:new $(new R1(new C,"New Recipe","",0,0,0,new C,new C,new $(Ot(h([[0,new Yi("","")]]))),new $(Ot(h([[0,new cc(new C,new C,new C,new C)]]))),new $(Ot(h([[0,new ko("")]]))),new C))}),Wn(ip(),n=>new Or(n))];if(t instanceof we&&t[0]instanceof Sn&&t[0][0]instanceof ri){let n=t[0][0].slug;return[e.withFields({current_route:new Sn(new ri(n)),current_recipe:ig(e,n)}),P()]}else if(t instanceof we&&t[0]instanceof Sn&&t[0][0]instanceof sp){let n=t[0][0].recipe;return[e.withFields({current_route:new Sn(new sp(n)),current_recipe:new $(n)}),P()]}else if(t instanceof we&&t[0]instanceof ni){let n=t[0].start_date;return[e.withFields({current_route:new ni(n)}),Wn(U1(Rc(n,new Eu)),r=>new Ki(r))]}else if(t instanceof we&&t[0]instanceof Ji){let n=t[0].start_date;return[e.withFields({current_route:new Ji(n)}),P()]}else if(t instanceof we){let n=t[0];return[e.withFields({current_route:n,current_recipe:new C}),P()]}else if(t instanceof Or){let n=t[0],r=i4(e.recipes,n),i=r[0],s=r[1];return[e.withFields({recipes:i,planner:new lc(e.planner.plan_week,V(i.recipes,o=>o.title),e.planner.start_date)}),Wn(s,o=>new Or(o))]}else if(t instanceof Zi&&t[0]instanceof lv){let n=t[0][0];return[e.withFields({recipes:$5(n,e.recipes)}),Ht(r=>{let i=new we(new Po(n.slug));return r(i)})]}else if(t instanceof Zi){let n=t[0],r=r4(e.current_recipe,n),i=r[0],s=r[1];return[e.withFields({current_recipe:i}),Wn(s,o=>new Zi(o))]}else if(t instanceof Ki&&t[0]instanceof D1){let n=t[0][0];return[e.withFields({planner:e.planner.withFields({start_date:n})}),Ht(r=>{let i=new we(new ni(n));return r(i)})]}else if(t instanceof Ki&&t[0]instanceof Bh){let n=t[0][0],r=t[0][1];return[e.withFields({current_route:new ni(r),planner:e.planner.withFields({plan_week:n})}),P()]}else{let n=t[0],r=G5(e.planner,n),i=r[0],s=r[1];return[e.withFields({planner:i}),Wn(s,o=>new Ki(o))]}}}function sg(e){let t=e.query,n=qS(e.path);if(t instanceof $&&n.hasLength(2)&&n.head==="planner"&&n.tail.head==="edit"){let r=t[0],i=im(r);if(i.isOk()&&i[0].hasLength(1)&&i[0].head[0]==="date"){let s=i[0].head[1];return new we(new Ji(se(Am(s),_r())))}else return new we(new Ji(_r()))}else if(t instanceof $&&n.hasLength(1)&&n.head==="planner"){let r=t[0],i=im(r);if(i.isOk()&&i[0].hasLength(1)&&i[0].head[0]==="date"){let s=i[0].head[1];return new we(new ni(se(Am(s),_r())))}else return new we(new Ji(_r()))}else{if(n.hasLength(2)&&n.head==="recipes"&&n.tail.head==="new")return new we(new Sn(new ri("")));if(n.hasLength(3)&&n.head==="recipes"&&n.tail.tail.head==="edit"){let r=n.tail.head;return new we(new Sn(new ri(r)))}else if(n.hasLength(2)&&n.head==="recipes"){let r=n.tail.head;return new we(new Po(r))}else return n.hasLength(1)&&n.head==="recipes"?new we(new dc):n.hasLength(2)&&n.head==="planner"&&n.tail.head==="edit"?new we(new Ji(_r())):n.hasLength(1)&&n.head==="planner"?new we(new ni(_r())):new we(new fc)}}function g4(e){let t=(()=>{let n=UO(),r=J(n,sg);return J(r,i=>i instanceof we?i[0]:new fc)})();return[new m4(se(t,new fc),new C,new S5(h([]),h([]),new C),new lc(Es(),h([]),Rc(_r(),new Eu))),Lg(h([WO(sg),Wn(N1(),n=>new Or(n)),Wn(ip(),n=>new Or(n))]))]}function w4(e){return FO(h([_(`grid ml-2 mr-2 gap-2
    2xl:grid-cols-[[start]_1fr_[full-start]_3fr_[main-start]_100ch_[main-end]_3fr_[full-end]_1fr_[end]]
    xl:grid-cols-[[start]_1fr_[full-start]_3fr_[main-start]_90ch_[main-end]_3fr_[full-end]_1fr_[end]]
    lg:grid-cols-[[start]_1fr_[full-start]_3fr_[main-start]_80ch_[main-end]_3fr_[full-end]_1fr_[end]]
    md:grid-cols-[[start_full-start]_1fr_[main-start]_70ch_[main-end]_1fr_[full-end_end]]
    grid-cols-[[start_full-start_main-start]_100%_[main-end_full-end_end]]
    min-h-[90vh]
    bg-ecru-white-50  text-ecru-white-950 font-transitional text-lg`)]),h([e]))}function b4(){return ss(h([_("grid-cols-12 col-start-[main-start]")]),h([xi("Mealstack","text-9xl placeholder:underline-pink underline-pink col-span-full xxs:col-span-11"),Ms(h([_("subgrid-cols my-6 gap-y-12 col-span-full text-6xl mx-2 font-mono")]),h([Ue(h([_("flex items-baseline col-span-full sm:col-span-6 justify-between pr-4"),Be("/planner")]),h([xt(h([_("underline-orange")]),h([E("Plan")])),xt(h([_("text-5xl")]),h([E("ð")]))])),Ue(h([_("flex items-baseline col-span-full sm:col-span-6 justify-between pr-4"),Be("/recipes")]),h([xt(h([_("underline-green")]),h([E("List  ")])),xt(h([_("text-5xl")]),h([E("ð")]))])),Ue(h([_("flex items-baseline col-span-full sm:col-span-6 justify-between pr-4"),Be("/recipes/new")]),h([xt(h([_("underline-blue")]),h([E("New")])),xt(h([_("text-5xl")]),h([E("ð")]))]))]))]))}function _4(e){let t=(()=>{let n=e.current_route;if(n instanceof fc)return b4();if(n instanceof dc)return Vn(u4(e.recipes),r=>new Or(r));if(n instanceof Po)return Vn(d4(e.current_recipe),r=>new Zi(r));if(n instanceof Sn&&n[0]instanceof ri)return Vn(h4(e.current_recipe,e.recipes.tag_options),r=>new Zi(r));if(n instanceof Sn&&n[0]instanceof sp){let r=n[0].recipe;return Vn(dv(r,e.recipes.tag_options),i=>new Zi(i))}else if(n instanceof ni){let r=n.start_date;return Vn(z5(new lc(e.planner.plan_week,V(e.recipes.recipes,i=>i.title),r)),i=>new Ki(i))}else{let r=n.start_date;return Vn(W5(new lc(e.planner.plan_week,V(e.recipes.recipes,i=>i.title),r)),i=>new Ki(i))}})();return w4(t)}function v4(){TO(yT(),"type-ahead");let e=EO(g4,y4,_4),t=MO(e,"#app",void 0);if(!t.isOk())throw jt("assignment_no_match","app",28,"main","Assignment pattern did not match",{value:t});return t}v4();
